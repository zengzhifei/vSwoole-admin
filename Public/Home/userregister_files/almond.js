function myDebug(){window.console&&console.info(arguments)}function readCookie(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" "){i=i.substring(1,i.length)}if(i.indexOf(t)==0){return encodeURIComponent(i.substring(t.length,i.length))}if(i.indexOf(t)!=-1){return encodeURIComponent(i.substring(i.indexOf("=")+1,i.length))}}return null}function queueComplete(e){}var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."){if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h==="."){e.splice(l,1),l-=1}else{if(h===".."){if(l===1&&(e[2]===".."||e[0]==="..")){break}l>0&&(e.splice(l-1,2),l-=2)}}}e=e.join("/")}else{e.indexOf("./")===0&&(e=e.substring(2))}}if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p){for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}}if(s){break}!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n)){throw new Error("No "+n)}return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require"){b[y]=i.require(t)}else{if(h==="exports"){b[y]=i.exports(t),w=!0}else{if(h==="module"){l=b[y]=i.module(t)}else{if(c(s,h)||c(o,h)||c(a,h)){b[y]=m(h)}else{if(!g.p){throw new Error(t+" missing "+h)}g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}}}}d=u.apply(s[t],b);if(t){if(l&&l.exports!==e&&l.exports!==s[t]){s[t]=l.exports}else{if(d!==e||!w){s[t]=d}}}}else{t&&(s[t]=u)}},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),function(e,t){function P(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function B(e){var t=H[e]={};return b.each(e.match(E)||[],function(e,n){t[n]=!0}),t}function I(e,n,r,i){if(b.acceptData(e)){var s,o,u=b.expando,a="string"==typeof n,f=e.nodeType,c=f?b.cache:e,h=f?e[u]:e[u]&&u;if(h&&c[h]&&(i||c[h].data)||!a||r!==t){return h||(f?e[u]=h=l.pop()||b.guid++:h=u),c[h]||(c[h]={},f||(c[h].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?c[h]=b.extend(c[h],n):c[h].data=b.extend(c[h].data,n)),s=c[h],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[b.camelCase(n)]=r),a?(o=s[n],null==o&&(o=s[b.camelCase(n)])):o=s,o}}}function q(e,t,n){if(b.acceptData(e)){var r,i,s,o=e.nodeType,u=o?b.cache:e,a=o?e[b.expando]:b.expando;if(u[a]){if(t&&(s=n?u[a]:u[a].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in s?t=[t]:(t=b.camelCase(t),t=t in s?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++){delete s[t[r]]}if(!(n?U:b.isEmptyObject)(s)){return}}(n||(delete u[a].data,U(u[a])))&&(o?b.cleanData([e],!0):b.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null)}}}function R(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(F,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:j.test(r)?b.parseJSON(r):r}catch(s){}b.data(e,n,r)}else{r=t}}return r}function U(e){var t;for(t in e){if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t){return !1}}return !0}function it(){return !0}function st(){return !1}function ct(e,t){do{e=e[t]}while(e&&1!==e.nodeType);return e}function ht(e,t,n){if(t=t||0,b.isFunction(t)){return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n})}if(t.nodeType){return b.grep(e,function(e){return e===t===n})}if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(at.test(t)){return b.filter(t,r,!n)
}t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function pt(e){var t=dt.split("|"),n=e.createDocumentFragment();if(n.createElement){while(t.length){n.createElement(t.pop())}}return n}function Mt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function _t(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function Dt(e){var t=Ct.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Pt(e,t){var n,r=0;for(;null!=(n=e[r]);r++){b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}}function Ht(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,s=b._data(e),o=b._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u){for(r=0,i=u[n].length;i>r;r++){b.event.add(t,n,u[n][r])}}}o.data&&(o.data=b.extend({},o.data))}}function Bt(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events){b.removeEvent(t,r,i.handle)}t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(_t(t).text=e.text,Dt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&xt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function jt(e,n){var r,s,o=0,u=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!u){for(u=[],r=e.childNodes||e;null!=(s=r[o]);o++){!n||b.nodeName(s,n)?u.push(s):b.merge(u,jt(s,n))}}return n===t||n&&b.nodeName(e,n)?b.merge([e],u):u}function Ft(e){xt.test(e.type)&&(e.defaultChecked=e.checked)}function tn(e,t){if(t in e){return t}var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--){if(t=en[i]+n,t in e){return t}}return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,s=[],o=0,u=e.length;for(;u>o;o++){r=e[o],r.style&&(s[o]=b._data(r,"olddisplay"),n=r.style.display,t?(s[o]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(s[o]=b._data(r,"olddisplay",an(r.nodeName)))):s[o]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))))}for(o=0;u>o;o++){r=e[o],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[o]||"":"none"))}return e}function sn(e,t,n){var r=$t.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function on(e,t,n,r,i){var s=n===(r?"border":"content")?4:"width"===t?1:0,o=0;for(;4>s;s+=2){"margin"===n&&(o+=b.css(e,n+Zt[s],!0,i)),r?("content"===n&&(o-=b.css(e,"padding"+Zt[s],!0,i)),"margin"!==n&&(o-=b.css(e,"border"+Zt[s]+"Width",!0,i))):(o+=b.css(e,"padding"+Zt[s],!0,i),"padding"!==n&&(o+=b.css(e,"border"+Zt[s]+"Width",!0,i)))}return o}function un(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,s=qt(e),o=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,s);if(0>=i||null==i){if(i=Rt(e,t,s),(0>i||null==i)&&(i=e.style[t]),Jt.test(i)){return i}r=o&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+on(e,t,n||(o?"border":"content"),r,s)+"px"}function an(e){var t=s,n=Qt[e];return n||(n=fn(e,t),"none"!==n&&n||(It=(It||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(It[0].contentWindow||It[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=fn(e,t),It.detach()),Qt[e]=n),n}function fn(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}function vn(e,t,n,r){var i;if(b.isArray(t)){b.each(t,function(t,i){n||cn.test(e)?r(e,i):vn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)})}else{if(n||"object"!==b.type(t)){r(e,t)}else{for(i in t){vn(e+"["+i+"]",t[i],n,r)}}}}function _n(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(E)||[];if(b.isFunction(n)){while(r=s[i++]){"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}}}function Dn(e,n,r,i){function u(a){var f;return s[a]=!0,b.each(e[a]||[],function(e,a){var l=a(n,r,i);return"string"!=typeof l||o||s[l]?o?!(f=l):t:(n.dataTypes.unshift(l),u(l),!1)}),f}var s={},o=e===An;return u(n.dataTypes[0])||!s["*"]&&u("*")}function Pn(e,n){var r,i,s=b.ajaxSettings.flatOptions||{};for(i in n){n[i]!==t&&((s[i]?e:r||(r={}))[i]=n[i])}return r&&b.extend(!0,e,r),e}function Hn(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(u in l){u in r&&(n[l[u]]=r[u])}while("*"===f[0]){f.shift(),s===t&&(s=e.mimeType||n.getResponseHeader("Content-Type"))}if(s){for(u in a){if(a[u]&&a[u].test(s)){f.unshift(u);break}}}if(f[0] in r){o=f[0]}else{for(u in r){if(!f[0]||e.converters[u+" "+f[0]]){o=u;break}i||(i=u)}o=o||i}return o?(o!==f[0]&&f.unshift(o),r[o]):t}function Bn(e,t){var n,r,i,s,o={},u=0,a=e.dataTypes.slice(),f=a[0];
if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a[1]){for(i in e.converters){o[i.toLowerCase()]=e.converters[i]}}for(;r=a[++u];){if("*"!==r){if("*"!==f&&f!==r){if(i=o[f+" "+r]||o["* "+r],!i){for(n in o){if(s=n.split(" "),s[1]===r&&(i=o[f+" "+s[0]]||o["* "+s[0]])){i===!0?i=o[n]:o[n]!==!0&&(r=s[0],a.splice(u--,0,r));break}}}if(i!==!0){if(i&&e["throws"]){t=i(t)}else{try{t=i(t)}catch(l){return{state:"parsererror",error:i?l:"No conversion from "+f+" to "+r}}}}}f=r}}return{state:"success",data:t}}function zn(){try{return new e.XMLHttpRequest}catch(t){}}function Wn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Yn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Gn[t]||[]).concat(Gn["*"]),i=0,s=r.length;for(;s>i;i++){if(r[i].call(e,t,n)){return}}})}function er(e,t,n){var r,i,s=0,o=Qn.length,u=b.Deferred().always(function(){delete a.elem}),a=function(){if(i){return !1}var t=Xn||Yn(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;a>o;o++){f.tweens[o].run(s)}return u.notifyWith(e,[f,s,n]),1>s&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Yn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i){return this}for(i=!0;r>n;n++){f.tweens[n].run(1)}return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;for(tr(l,f.opts.specialEasing);o>s;s++){if(r=Qn[s].call(f,e,l,f.opts)){return r}}return Zn(f,l),b.isFunction(f.opts.start)&&f.opts.start.call(e,f),b.fx.timer(b.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function tr(e,t){var n,r,i,s,o;for(i in e){if(r=b.camelCase(i),s=t[r],n=e[i],b.isArray(n)&&(s=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),o=b.cssHooks[r],o&&"expand" in o){n=o.expand(n),delete e[r];for(i in n){i in e||(e[i]=n[i],t[i]=s)}}else{t[r]=s}}}function nr(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},v=[],m=e.nodeType&&nn(e);n.queue||(l=b._queueHooks(e,"fx"),null==l.unqueued&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,b.queue(e,"fx").length||l.empty.fire()})})),1===e.nodeType&&("height" in t||"width" in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==an(e.nodeName)?p.zoom=1:p.display="inline-block")),n.overflow&&(p.overflow="hidden",b.support.shrinkWrapBlocks||h.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(i in t){if(o=t[i],$n.exec(o)){if(delete t[i],a=a||"toggle"===o,o===(m?"hide":"show")){continue}v.push(i)}}if(s=v.length){u=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden" in u&&(m=u.hidden),a&&(u.hidden=!m),m?b(e).show():h.done(function(){b(e).hide()}),h.done(function(){var t;b._removeData(e,"fxshow");for(t in d){b.style(e,t,d[t])}});for(i=0;s>i;i++){r=v[i],f=h.createTween(r,m?u[r]:0),d[r]=u[r]||b.style(e,r),r in u||(u[r]=f.start,m&&(f.end=f.start,f.start="width"===r||"height"===r?1:0))}}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t){n=Zt[i],r["margin"+n]=r["padding"+n]=e}return t&&(r.opacity=r.width=e),r}function sr(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n,r,i=typeof t,s=e.document,o=e.location,u=e.jQuery,a=e.$,f={},l=[],c="1.9.1",h=l.concat,p=l.push,d=l.slice,v=l.indexOf,m=f.toString,g=f.hasOwnProperty,y=c.trim,b=function(e,t){return new b.fn.init(e,t,r)},w=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,E=/\S+/g,S=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,x=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,T=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,N=/^[\],:{}\s]*$/,C=/(?:^|:|,)(?:\s*\[)+/g,k=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,L=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,A=/^-ms-/,O=/-([\da-z])/gi,M=function(e,t){return t.toUpperCase()},_=function(e){(s.addEventListener||"load"===e.type||"complete"===s.readyState)&&(D(),b.ready())},D=function(){s.addEventListener?(s.removeEventListener("DOMContentLoaded",_,!1),e.removeEventListener("load",_,!1)):(s.detachEvent("onreadystatechange",_),e.detachEvent("onload",_))};b.fn=b.prototype={jquery:c,constructor:b,init:function(e,n,r){var i,o;if(!e){return this}if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:x.exec(e),!i||!i[1]&&n){return !n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:s,!0)),T.test(i[1])&&b.isPlainObject(n)){for(i in n){b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i])
}}return this}if(o=s.getElementById(i[2]),o&&o.parentNode){if(o.id!==i[2]){return r.find(e)}this.length=1,this[0]=o}return this.context=s,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return d.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:p,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[1]||{},a=2),"object"==typeof u||b.isFunction(u)||(u={}),f===a&&(u=this,--a);f>a;a++){if(null!=(s=arguments[a])){for(i in s){e=u[i],r=s[i],u!==r&&(l&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,o=e&&b.isArray(e)?e:[]):o=e&&b.isPlainObject(e)?e:{},u[i]=b.extend(l,o,r)):r!==t&&(u[i]=r))}}}return u},b.extend({noConflict:function(t){return e.$===b&&(e.$=a),t&&e.jQuery===b&&(e.jQuery=u),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!s.body){return setTimeout(b.ready)}b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(s,[b]),b.fn.trigger&&b(s).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return !isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?f[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e)){return !1}try{if(e.constructor&&!g.call(e,"constructor")&&!g.call(e.constructor.prototype,"isPrototypeOf")){return !1}}catch(n){return !1}var r;for(r in e){}return r===t||g.call(e,r)},isEmptyObject:function(e){var t;for(t in e){return !1}return !0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e){return null}"boolean"==typeof t&&(n=t,t=!1),t=t||s;var r=T.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&N.test(n.replace(k,"@").replace(L,"]").replace(C,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n){return null}try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(A,"ms-").replace(O,M)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=P(e);if(n){if(o){for(;s>i;i++){if(r=t.apply(e[i],n),r===!1){break}}}else{for(i in e){if(r=t.apply(e[i],n),r===!1){break}}}}else{if(o){for(;s>i;i++){if(r=t.call(e[i],i,e[i]),r===!1){break}}}else{for(i in e){if(r=t.call(e[i],i,e[i]),r===!1){break}}}}return e},trim:y&&!y.call(" ")?function(e){return null==e?"":y.call(e)}:function(e){return null==e?"":(e+"").replace(S,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(P(Object(e))?b.merge(n,"string"==typeof e?[e]:e):p.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(v){return v.call(t,e,n)}for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++){if(n in t&&t[n]===e){return n}}}return -1},merge:function(e,n){var r=n.length,i=e.length,s=0;if("number"==typeof r){for(;r>s;s++){e[i++]=n[s]}}else{while(n[s]!==t){e[i++]=n[s++]}}return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;for(n=!!n;o>s;s++){r=!!t(e[s],s),n!==r&&i.push(e[s])}return i},map:function(e,t,n){var r,i=0,s=e.length,o=P(e),u=[];if(o){for(;s>i;i++){r=t(e[i],i,n),null!=r&&(u[u.length]=r)}}else{for(i in e){r=t(e[i],i,n),null!=r&&(u[u.length]=r)}}return h.apply([],u)},guid:1,proxy:function(e,n){var r,i,s;return"string"==typeof n&&(s=e[n],n=e,e=s),b.isFunction(e)?(r=d.call(arguments,2),i=function(){return e.apply(n||this,r.concat(d.call(arguments)))
},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,s,o,u){var a=0,f=e.length,l=null==r;if("object"===b.type(r)){s=!0;for(a in r){b.access(e,n,a,r[a],!0,o,u)}}else{if(i!==t&&(s=!0,b.isFunction(i)||(u=!0),l&&(u?(n.call(e,i),n=null):(l=n,n=function(e,t,n){return l.call(b(e),n)})),n)){for(;f>a;a++){n(e[a],r,u?i:i.call(e[a],a,n(e[a],r)))}}}return s?e:l?n.call(e):f?n(e[0],r):o},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n){if(n=b.Deferred(),"complete"===s.readyState){setTimeout(b.ready)}else{if(s.addEventListener){s.addEventListener("DOMContentLoaded",_,!1),e.addEventListener("load",_,!1)}else{s.attachEvent("onreadystatechange",_),e.attachEvent("onload",_);var r=!1;try{r=null==e.frameElement&&s.documentElement}catch(i){}r&&r.doScroll&&function o(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(o,50)}D(),b.ready()}}()}}}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){f["[object "+t+"]"]=t.toLowerCase()}),r=b(s);var H={};b.Callbacks=function(e){e="string"==typeof e?H[e]||B(e):b.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){for(r=e.memory&&t,i=!0,o=u||0,u=0,s=a.length,n=!0;a&&s>o;o++){if(a[o].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}}n=!1,a&&(f?f.length&&l(f.shift()):r?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&c.has(n)||a.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?s=a.length:r&&(u=t,l(r))}return this},remove:function(){return a&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,a,r))>-1){a.splice(r,1),n&&(s>=r&&s--,o>=r&&o--)}}),this},has:function(e){return e?b.inArray(e,a)>-1:!!a&&!!a.length},empty:function(){return a=[],this},disable:function(){return a=f=r=t,this},disabled:function(){return !a},lock:function(){return f=t,r||c.disable(),this},locked:function(){return !f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!a||i&&!f||(n?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return !!i}};return c},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,s){var o=s[0],u=b.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[1^e][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=d.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,s=1===i?e:b.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){for(u=Array(r),a=Array(r),f=Array(r);r>t;t++){n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}}return i||s.resolveWith(f,n),s.promise()}}),b.support=function(){var t,n,r,o,u,a,f,l,c,h,p=s.createElement("div");if(p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0],!n||!r||!n.length){return{}}u=s.createElement("select"),f=u.appendChild(s.createElement("option")),o=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==p.className,leadingWhitespace:3===p.firstChild.nodeType,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!o.value,optSelected:f.selected,enctype:!!s.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==s.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===s.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,u.disabled=!0,t.optDisabled=!f.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}o=s.createElement("input"),o.setAttribute("value",""),t.input=""===o.getAttribute("value"),o.value="t",o.setAttribute("type","radio"),t.radioValue="t"===o.value,o.setAttribute("checked","t"),o.setAttribute("name","t"),a=s.createDocumentFragment(),a.appendChild(o),t.appendChecked=o.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,p.attachEvent&&(p.attachEvent("onclick",function(){t.noCloneEvent=!1
}),p.cloneNode(!0).click());for(h in {submit:!0,change:!0,focusin:!0}){p.setAttribute(l="on"+h,"t"),t[h+"Bubbles"]=l in e||p.attributes[l].expando===!1}return p.style.backgroundClip="content-box",p.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===p.style.backgroundClip,b(function(){var n,r,o,u="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=s.getElementsByTagName("body")[0];a&&(n=s.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(p),p.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=p.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=c&&0===o[0].offsetHeight,p.innerHTML="",p.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===p.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==a.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(p,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(p,null)||{width:"4px"}).width,r=p.appendChild(s.createElement("div")),r.style.cssText=p.style.cssText=u,r.style.marginRight=r.style.width="0",p.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof p.style.zoom!==i&&(p.innerHTML="",p.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===p.offsetWidth,p.style.display="block",p.innerHTML="<div></div>",p.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==p.offsetWidth,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(n),n=p=o=r=null)}),n=u=a=f=r=o=null,t}();var j=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,F=/([A-Z])/g;b.extend({cache:{},expando:"jQuery"+(c+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!U(e)},data:function(e,t,n){return I(e,t,n)},removeData:function(e,t){return q(e,t)},_data:function(e,t,n){return I(e,t,n,!0)},_removeData:function(e,t){return q(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType){return !1}var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return !t||t!==!0&&e.getAttribute&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,s=this[0],o=0,u=null;if(e===t){if(this.length&&(u=b.data(s),1===s.nodeType&&!b._data(s,"parsedAttrs"))){for(r=s.attributes;r.length>o;o++){i=r[o].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),R(s,i,u[i]))}b._data(s,"parsedAttrs",!0)}return u}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?s?R(s,e,b.data(s,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}}),b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),s=b._queueHooks(e,t),o=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),s.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=b.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(u--){r=b._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a))}return a(),s.promise(n)}});var z,W,X=/[\t\r\n]/g,V=/\r/g,$=/^(?:input|select|textarea|button|object)$/i,J=/^(?:a|area)$/i,K=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Q=/^(?:checked|selected)$/i,G=b.support.getSetAttribute,Y=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)
},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a="string"==typeof e&&e;if(b.isFunction(e)){return this.each(function(t){b(this).addClass(e.call(this,t,this.className))})}if(a){for(t=(e||"").match(E)||[];u>o;o++){if(n=this[o],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){s=0;while(i=t[s++]){0>r.indexOf(" "+i+" ")&&(r+=i+" ")}n.className=b.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e)){return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))})}if(a){for(t=(e||"").match(E)||[];u>o;o++){if(n=this[o],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){s=0;while(i=t[s++]){while(r.indexOf(" "+i+" ")>=0){r=r.replace(" "+i+" "," ")}}n.className=e?b.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var s,o=0,u=b(this),a=t,f=e.match(E)||[];while(s=f[o++]){a=r?a:!u.hasClass(s),u[a?"addClass":"removeClass"](s)}}else{(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")}})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++){if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0){return !0}}return !1},val:function(e){var n,r,i,s=this[0];if(arguments.length){return i=b.isFunction(e),this.each(function(n){var s,o=b(this);1===this.nodeType&&(s=i?e.call(this,n,o.val()):e,null==s?s="":"number"==typeof s?s+="":b.isArray(s)&&(s=b.map(s,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set" in r&&r.set(this,s,"value")!==t||(this.value=s))})}if(s){return r=b.valHooks[s.type]||b.valHooks[s.nodeName.toLowerCase()],r&&"get" in r&&(n=r.get(s,"value"))!==t?n:(n=s.value,"string"==typeof n?n.replace(V,""):null==n?"":n)}}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return !t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||0>i,o=s?null:[],u=s?i+1:r.length,a=0>i?u:s?i:0;for(;u>a;a++){if(n=r[a],!(!n.selected&&a!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),s){return t}o.push(t)}}return o},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var s,o,u,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a){return typeof e.getAttribute===i?b.prop(e,n,r):(o=1!==a||!b.isXMLDoc(e),o&&(n=n.toLowerCase(),s=b.attrHooks[n]||(K.test(n)?W:z)),r===t?s&&o&&"get" in s&&null!==(u=s.get(e,n))?u:(typeof e.getAttribute!==i&&(u=e.getAttribute(n)),null==u?t:u):null!==r?s&&o&&"set" in s&&(u=s.set(e,r,n))!==t?u:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t))}},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(E);if(s&&1===e.nodeType){while(n=s[i++]){r=b.propFix[n]||n,K.test(n)?!G&&Q.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(G?n:r)}}},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u){return o=1!==u||!b.isXMLDoc(e),o&&(n=b.propFix[n]||n,s=b.propHooks[n]),r!==t?s&&"set" in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get" in s&&null!==(i=s.get(e,n))?i:e[n]}},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):$.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:t}}}}),W={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),s="boolean"==typeof r?Y&&G?null!=i:Q.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return s&&s.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):Y&&G||!Q.test(n)?e.setAttribute(!G&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},Y&&G||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):z&&z.set(e,n,r)}}),G||(z=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t
},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:z.get,set:function(e,t,n){z.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;b.event={global:{},add:function(e,n,r,s,o){var u,a,f,l,c,h,p,d,v,m,g,y=b._data(e);if(y){r.handler&&(l=r,r=l.handler,o=l.selector),r.guid||(r.guid=b.guid++),(a=y.events)||(a=y.events={}),(h=y.handle)||(h=y.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(h.elem,arguments)},h.elem=e),n=(n||"").match(E)||[""],f=n.length;while(f--){u=rt.exec(n[f])||[],v=g=u[1],m=(u[2]||"").split(".").sort(),c=b.event.special[v]||{},v=(o?c.delegateType:c.bindType)||v,c=b.event.special[v]||{},p=b.extend({type:v,origType:g,data:s,handler:r,guid:r.guid,selector:o,needsContext:o&&b.expr.match.needsContext.test(o),namespace:m.join(".")},l),(d=a[v])||(d=a[v]=[],d.delegateCount=0,c.setup&&c.setup.call(e,s,m,h)!==!1||(e.addEventListener?e.addEventListener(v,h,!1):e.attachEvent&&e.attachEvent("on"+v,h))),c.add&&(c.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),o?d.splice(d.delegateCount++,0,p):d.push(p),b.event.global[v]=!0}e=null}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=b.hasData(e)&&b._data(e);if(m&&(l=m.events)){t=(t||"").match(E)||[""],f=t.length;while(f--){if(u=rt.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort(),p){c=b.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=l[p]||[],u=u[2]&&RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--){o=h[s],!i&&v!==o.origType||n&&n.guid!==o.guid||u&&!u.test(o.namespace)||r&&r!==o.selector&&("**"!==r||!o.selector)||(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o))}a&&!h.length&&(c.teardown&&c.teardown.call(e,d,m.handle)!==!1||b.removeEvent(e,p,m.handle),delete l[p])}else{for(p in l){b.event.remove(e,p+t[f],n,r,!0)}}}b.isEmptyObject(l)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,o){var u,a,f,l,c,h,p,d=[i||s],v=g.call(n,"type")?n.type:n,m=g.call(n,"namespace")?n.namespace.split("."):[];if(f=h=i=i||s,3!==i.nodeType&&8!==i.nodeType&&!nt.test(v+b.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),a=0>v.indexOf(":")&&"on"+v,n=n[b.expando]?n:new b.Event(v,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),c=b.event.special[v]||{},o||!c.trigger||c.trigger.apply(i,r)!==!1)){if(!o&&!c.noBubble&&!b.isWindow(i)){for(l=c.delegateType||v,nt.test(l+v)||(f=f.parentNode);f;f=f.parentNode){d.push(f),h=f}h===(i.ownerDocument||s)&&d.push(h.defaultView||h.parentWindow||e)}p=0;while((f=d[p++])&&!n.isPropagationStopped()){n.type=p>1?l:c.bindType||v,u=(b._data(f,"events")||{})[n.type]&&b._data(f,"handle"),u&&u.apply(f,r),u=a&&f[a],u&&b.acceptData(f)&&u.apply&&u.apply(f,r)===!1&&n.preventDefault()}if(n.type=v,!(o||n.isDefaultPrevented()||c._default&&c._default.apply(i.ownerDocument,r)!==!1||"click"===v&&b.nodeName(i,"a")||!b.acceptData(i)||!a||!i[v]||b.isWindow(i))){h=i[a],h&&(i[a]=null),b.event.triggered=v;try{i[v]()}catch(y){}b.event.triggered=t,h&&(i[a]=h)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,s,o,u=[],a=d.call(arguments),f=(b._data(this,"events")||{})[e.type]||[],l=b.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=b.event.handlers.call(this,e,f),n=0;while((s=u[n++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped()){(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))
}}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,s,o,u=[],a=n.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||"click"!==e.type)){for(;f!=this;f=f.parentNode||this){if(1===f.nodeType&&(f.disabled!==!0||"click"!==e.type)){for(s=[],o=0;a>o;o++){i=n[o],r=i.selector+" ",s[r]===t&&(s[r]=i.needsContext?b(r,this).index(f)>=0:b.find(r,this,null,[f]).length),s[r]&&s.push(i)}s.length&&u.push({elem:f,handlers:s})}}}return n.length>a&&u.push({elem:this,handlers:n.slice(a)}),u},fix:function(e){if(e[b.expando]){return e}var t,n,r,i=e.type,o=e,u=this.fixHooks[i];u||(this.fixHooks[i]=u=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=u.props?this.props.concat(u.props):this.props,e=new b.Event(o),t=r.length;while(t--){n=r[t],e[n]=o[n]}return e.target||(e.target=o.srcElement||s),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,u.filter?u.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,u=n.button,a=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||s,o=i.documentElement,r=i.body,e.pageX=n.clientX+(o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),e.which||u===t||(e.which=1&u?1:2&u?3:4&u?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==s.activeElement&&this.focus){try{return this.focus(),!1}catch(e){}}},delegateType:"focusin"},blur:{trigger:function(){return this===s.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=s.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:st):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:st,isPropagationStopped:st,isImmediatePropagationStopped:st,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;return(!i||i!==r&&!b.contains(r,i))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)
}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&s.addEventListener(e,r,!0)},teardown:function(){0===--n&&s.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,s){var o,u;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(o in e){this.on(o,n,r,e[o],s)}return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1){i=st}else{if(!i){return this}}return 1===s&&(u=i,i=function(e){return b().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj){return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this}if("object"==typeof e){for(s in e){this.off(s,n,e[s])}return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=st),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){function rt(e){return J.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function st(e){return e[w]=!0,e}function ot(e){var t=c.createElement("div");try{return e(t)}catch(n){return !1}finally{t=null}}function ut(e,t,n,r){var i,s,o,u,a,f,h,v,m,y;if((t?t.ownerDocument||t:E)!==c&&l(t),t=t||c,n=n||[],!e||"string"!=typeof e){return n}if(1!==(u=t.nodeType)&&9!==u){return[]}if(!p&&!r){if(i=K.exec(e)){if(o=i[1]){if(9===u){if(s=t.getElementById(o),!s||!s.parentNode){return n}if(s.id===o){return n.push(s),n}}else{if(t.ownerDocument&&(s=t.ownerDocument.getElementById(o))&&g(t,s)&&s.id===o){return n.push(s),n}}}else{if(i[2]){return _.apply(n,D.call(t.getElementsByTagName(e),0)),n}if((o=i[3])&&S.getByClassName&&t.getElementsByClassName){return _.apply(n,D.call(t.getElementsByClassName(o),0)),n}}}if(S.qsa&&!d.test(e)){if(h=!0,v=w,m=t,y=9===u&&e,1===u&&"object"!==t.nodeName.toLowerCase()){f=ht(e),(h=t.getAttribute("id"))?v=h.replace(Y,"\\$&"):t.setAttribute("id",v),v="[id='"+v+"'] ",a=f.length;while(a--){f[a]=v+pt(f[a])}m=$.test(e)&&t.parentNode||t,y=f.join(",")}if(y){try{return _.apply(n,D.call(m.querySelectorAll(y),0)),n}catch(b){}finally{h||t.removeAttribute("id")}}}}return Et(e.replace(R,"$1"),t,n,r)}function at(e,t){var n=t&&e,r=n&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r){return r}if(n){while(n=n.nextSibling){if(n===t){return -1}}}return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ct(e){return st(function(t){return t=+t,st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--){n[i=s[o]]&&(n[i]=!(r[i]=n[i]))}})})}function ht(e,t){var n,r,s,o,u,a,f,l=C[e+" "];if(l){return t?0:l.slice(0)}u=e,a=[],f=i.preFilter;while(u){(!n||(r=U.exec(u)))&&(r&&(u=u.slice(r[0].length)||u),a.push(s=[])),n=!1,(r=z.exec(u))&&(n=r.shift(),s.push({value:n,type:r[0].replace(R," ")}),u=u.slice(n.length));for(o in i.filter){!(r=V[o].exec(u))||f[o]&&!(r=f[o](r))||(n=r.shift(),s.push({value:n,type:o,matches:r}),u=u.slice(n.length))}if(!n){break}}return t?u.length:u?ut.error(e):C(e,a).slice(0)}function pt(e){var t=0,n=e.length,r="";for(;n>t;t++){r+=e[t].value}return r}function dt(e,t,n){var i=t.dir,s=n&&"parentNode"===i,o=T++;return t.first?function(t,n,r){while(t=t[i]){if(1===t.nodeType||s){return e(t,n,r)}}}:function(t,n,u){var a,f,l,c=x+" "+o;if(u){while(t=t[i]){if((1===t.nodeType||s)&&e(t,n,u)){return !0}}}else{while(t=t[i]){if(1===t.nodeType||s){if(l=t[w]||(t[w]={}),(f=l[i])&&f[0]===c){if((a=f[1])===!0||a===r){return a===!0}}else{if(f=l[i]=[c],f[1]=e(t,n,u)||r,f[1]===!0){return !0}}}}}}}function vt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--){if(!e[i](t,n,r)){return !1}}return !0}:e[0]}function mt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=null!=t;for(;a>u;u++){(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u))}return o}function gt(e,t,n,r,i,s){return r&&!r[w]&&(r=gt(r)),i&&!i[w]&&(i=gt(i,s)),st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||wt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:mt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;
if(n&&n(m,g,u,a),r){f=mt(g,p),r(f,[],u,a),l=f.length;while(l--){(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}}if(s){if(i||e){if(i){f=[],l=g.length;while(l--){(c=g[l])&&f.push(m[l]=c)}i(null,g=[],f,a)}l=g.length;while(l--){(c=g[l])&&(f=i?P.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}}else{g=mt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):_.apply(o,g)}})}function yt(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,l=dt(function(e){return e===t},u,!0),c=dt(function(e){return P.call(t,e)>-1},u,!0),h=[function(e,n,r){return !o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;s>a;a++){if(n=i.relative[e[a].type]){h=[dt(vt(h),n)]}else{if(n=i.filter[e[a].type].apply(null,e[a].matches),n[w]){for(r=++a;s>r;r++){if(i.relative[e[r].type]){break}}return gt(a>1&&vt(h),a>1&&pt(e.slice(0,a-1)).replace(R,"$1"),n,r>a&&yt(e.slice(a,r)),s>r&&yt(e=e.slice(r)),s>r&&pt(e))}h.push(n)}}return vt(h)}function bt(e,t){var n=0,s=t.length>0,o=e.length>0,u=function(u,a,l,h,p){var d,v,m,g=[],y=0,b="0",w=u&&[],E=null!=p,S=f,T=u||o&&i.find.TAG("*",p&&a.parentNode||a),N=x+=null==S?1:Math.random()||0.1;for(E&&(f=a!==c&&a,r=n);null!=(d=T[b]);b++){if(o&&d){v=0;while(m=e[v++]){if(m(d,a,l)){h.push(d);break}}E&&(x=N,r=++n)}s&&((d=!m&&d)&&y--,u&&w.push(d))}if(y+=b,s&&b!==y){v=0;while(m=t[v++]){m(w,g,a,l)}if(u){if(y>0){while(b--){w[b]||g[b]||(g[b]=M.call(h))}}g=mt(g)}_.apply(h,g),E&&!u&&g.length>0&&y+t.length>1&&ut.uniqueSort(h)}return E&&(x=N,f=S),w};return s?st(u):u}function wt(e,t,n){var r=0,i=t.length;for(;i>r;r++){ut(e,t[r],n)}return n}function Et(e,t,n,r){var s,o,a,f,l,c=ht(e);if(!r&&1===c.length){if(o=c[0]=c[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&9===t.nodeType&&!p&&i.relative[o[1].type]){if(t=i.find.ID(a.matches[0].replace(et,tt),t)[0],!t){return n}e=e.slice(o.shift().value.length)}s=V.needsContext.test(e)?0:o.length;while(s--){if(a=o[s],i.relative[f=a.type]){break}if((l=i.find[f])&&(r=l(a.matches[0].replace(et,tt),$.test(o[0].type)&&t.parentNode||t))){if(o.splice(s,1),e=r.length&&pt(o),!e){return _.apply(n,D.call(r,0)),n}break}}}return u(e,c)(r,t,p,n,$.test(e)),n}function St(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,w="sizzle"+-(new Date),E=e.document,S={},x=0,T=0,N=it(),C=it(),k=it(),L=typeof t,A=1<<31,O=[],M=O.pop,_=O.push,D=O.slice,P=O.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++){if(this[t]===e){return t}}return -1},H="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",j=B.replace("w","w#"),F="([*^$|!~]?=)",I="\\["+H+"*("+B+")"+H+"*(?:"+F+H+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+j+")|)|)"+H+"*\\]",q=":("+B+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=RegExp("^"+H+"+|((?:^|[^\\\\])(?:\\\\.)*)"+H+"+$","g"),U=RegExp("^"+H+"*,"+H+"*"),z=RegExp("^"+H+"*([\\x20\\t\\r\\n\\f>+~])"+H+"*"),W=RegExp(q),X=RegExp("^"+j+"$"),V={ID:RegExp("^#("+B+")"),CLASS:RegExp("^\\.("+B+")"),NAME:RegExp("^\\[name=['\"]?("+B+")['\"]?\\]"),TAG:RegExp("^("+B.replace("w","w*")+")"),ATTR:RegExp("^"+I),PSEUDO:RegExp("^"+q),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+H+"*(even|odd|(([+-]|)(\\d*)n|)"+H+"*(?:([+-]|)"+H+"*(\\d+)|))"+H+"*\\)|)","i"),needsContext:RegExp("^"+H+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+H+"*((?:-\\d)?\\d*)"+H+"*\\)|)(?=[^-]|$)","i")},$=/[\x20\t\r\n\f]*[+~]/,J=/^[^{]+\{\s*\[native code/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{D.call(E.documentElement.childNodes,0)[0].nodeType}catch(nt){D=function(e){var t,n=[];while(t=this[e++]){n.push(t)}return n}}o=ut.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},l=ut.setDocument=function(e){var n=e?e.ownerDocument||e:E;return n!==c&&9===n.nodeType&&n.documentElement?(c=n,h=n.documentElement,p=o(n),S.tagNameNoComments=ot(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),S.attributes=ot(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),S.getByClassName=ot(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),S.getByName=ot(function(e){e.id=w+0,e.innerHTML="<a name='"+w+"'></a><div name='"+w+"'></div>",h.insertBefore(e,h.firstChild);var t=n.getElementsByName&&n.getElementsByName(w).length===2+n.getElementsByName(w+0).length;return S.getIdNotName=!n.getElementById(w),h.removeChild(e),t}),i.attrHandle=ot(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==L&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)
},type:function(e){return e.getAttribute("type")}},S.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==L&&!p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==L&&!p){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==L&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=S.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==L?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++]){1===n.nodeType&&r.push(n)}return r}return s},i.find.NAME=S.getByName&&function(e,n){return typeof n.getElementsByName!==L?n.getElementsByName(name):t},i.find.CLASS=S.getByClassName&&function(e,n){return typeof n.getElementsByClassName===L||p?t:n.getElementsByClassName(e)},v=[],d=[":focus"],(S.qsa=rt(n.querySelectorAll))&&(ot(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+H+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||d.push(":checked")}),ot(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&d.push("[*^$]="+H+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")})),(S.matchesSelector=rt(m=h.matchesSelector||h.mozMatchesSelector||h.webkitMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ot(function(e){S.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",q)}),d=RegExp(d.join("|")),v=RegExp(v.join("|")),g=rt(h.contains)||h.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t){while(t=t.parentNode){if(t===e){return !0}}}return !1},y=h.compareDocumentPosition?function(e,t){var r;return e===t?(a=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||g(E,e)?-1:t===n||g(E,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],f=[t];if(e===t){return a=!0,0}if(!s||!o){return e===n?-1:t===n?1:s?-1:o?1:0}if(s===o){return at(e,t)}r=e;while(r=r.parentNode){u.unshift(r)}r=t;while(r=r.parentNode){f.unshift(r)}while(u[i]===f[i]){i++}return i?at(u[i],f[i]):u[i]===E?-1:f[i]===E?1:0},a=!1,[0,0].sort(y),S.detectDuplicates=a,c):c},ut.matches=function(e,t){return ut(e,null,null,t)},ut.matchesSelector=function(e,t){if((e.ownerDocument||e)!==c&&l(e),t=t.replace(Z,"='$1']"),!(!S.matchesSelector||p||v&&v.test(t)||d.test(t))){try{var n=m.call(e,t);if(n||S.disconnectedMatch||e.document&&11!==e.document.nodeType){return n}}catch(r){}}return ut(t,c,null,[e]).length>0},ut.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},ut.attr=function(e,t){var n;return(e.ownerDocument||e)!==c&&l(e),p||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):p||S.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},ut.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},ut.uniqueSort=function(e){var t,n=[],r=1,i=0;if(a=!S.detectDuplicates,e.sort(y),a){for(;t=e[r];r++){t===e[r-1]&&(i=n.push(r))}while(i--){e.splice(n[i],1)}}return e},s=ut.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent){return e.textContent}for(e=e.firstChild;e;e=e.nextSibling){n+=s(e)}}else{if(3===i||4===i){return e.nodeValue}}}else{for(;t=e[r];r++){n+=s(t)}}return n},i=ut.selectors={cacheLength:50,createPseudo:st,match:V,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ut.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ut.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return V.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&W.test(n)&&(t=ht(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return !0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=N[e+" "];return t||(t=RegExp("(^|"+H+")"+e+"("+H+"|$)"))&&N(e,function(e){return t.test(e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")
})},ATTR:function(e,t,n){return function(r){var i=ut.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return !!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v]){if(u?c.nodeName.toLowerCase()===g:1===c.nodeType){return !1}}d=v="only"===e&&!d&&"nextSibling"}return !0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===x&&f[1],h=f[0]===x&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop()){if(1===c.nodeType&&++h&&c===t){l[e]=[x,p,h];break}}}else{if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===x){h=f[1]}else{while(c=++p&&c&&c[v]||(h=p=0)||d.pop()){if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[w]||(c[w]={}))[e]=[x,h]),c===t)){break}}}}return h-=i,h===r||0===h%r&&h/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ut.error("unsupported pseudo: "+e);return r[w]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var i,s=r(e,t),o=s.length;while(o--){i=P.call(e,s[o]),e[i]=!(n[i]=s[o])}}):function(e){return r(e,0,n)}):r}},pseudos:{not:st(function(e){var t=[],n=[],r=u(e.replace(R,"$1"));return r[w]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--){(s=o[u])&&(e[u]=!(t[u]=s))}}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:st(function(e){return function(t){return ut(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),lang:st(function(e){return X.test(e||"")||ut.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do{if(n=p?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang){return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-")}}while((t=t.parentNode)&&1===t.nodeType);return !1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling){if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType){return !1}}return !0},parent:function(e){return !i.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[0>n?n+t:n]}),even:ct(function(e,t){var n=0;for(;t>n;n+=2){e.push(n)}return e}),odd:ct(function(e,t){var n=1;for(;t>n;n+=2){e.push(n)}return e}),lt:ct(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;){e.push(r)}return e}),gt:ct(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;){e.push(r)}return e})}};for(n in {radio:!0,checkbox:!0,file:!0,password:!0,image:!0}){i.pseudos[n]=ft(n)}for(n in {submit:!0,reset:!0}){i.pseudos[n]=lt(n)}u=ut.compile=function(e,t){var n,r=[],i=[],s=k[e+" "];if(!s){t||(t=ht(e)),n=t.length;while(n--){s=yt(t[n]),s[w]?r.push(s):i.push(s)}s=k(e,bt(i,r))}return s},i.pseudos.nth=i.pseudos.eq,i.filters=St.prototype=i.pseudos,i.setFilters=new St,l(),ut.attr=b.attr,b.find=ut,b.expr=ut.selectors,b.expr[":"]=b.expr.pseudos,b.unique=ut.uniqueSort,b.text=ut.getText,b.isXMLDoc=ut.isXML,b.contains=ut.contains}(e);var ot=/Until$/,ut=/^(?:parents|prev(?:Until|All))/,at=/^.[^:#\[\.,]*$/,ft=b.expr.match.needsContext,lt={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e){return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++){if(b.contains(r[t],this)){return !0}}}))}for(n=[],t=0;i>t;t++){b.find(e,this[t],n)}return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++){if(b.contains(this,n[t])){return !0}}})},not:function(e){return this.pushStack(ht(this,e,!1))},filter:function(e){return this.pushStack(ht(this,e,!0))},is:function(e){return !!e&&("string"==typeof e?ft.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)
},closest:function(e,t){var n,r=0,i=this.length,s=[],o=ft.test(e)||"string"!=typeof e?b(e,t||this.context):0;for(;i>r;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&11!==n.nodeType){if(o?o.index(n)>-1:b.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return this.pushStack(s.length>1?b.unique(s):s)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack,b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return ct(e,"nextSibling")},prev:function(e){return ct(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return ot.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!lt[e]?b.unique(i):i,this.length>1&&ut.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&9!==s.nodeType&&(r===t||1!==s.nodeType||!b(s).is(r))){1===s.nodeType&&i.push(s),s=s[n]}return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling){1===e.nodeType&&e!==t&&n.push(e)}return n}});var dt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",vt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+dt+")[\\s/>]","i"),gt=/^\s+/,yt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,wt=/<tbody/i,Et=/<|&#?\w+;/,St=/<(?:script|style|link)/i,xt=/^(?:checkbox|radio)$/i,Tt=/checked\s*(?:[^=]|=\s*.checked.)/i,Nt=/^$|\/(?:java|ecma)script/i,Ct=/^true\/(.*)/,kt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Lt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},At=pt(s),Ot=At.appendChild(s.createElement("div"));Lt.optgroup=Lt.option,Lt.tbody=Lt.tfoot=Lt.colgroup=Lt.caption=Lt.thead,Lt.th=Lt.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||s).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e)){return this.each(function(t){b(this).wrapAll(e.call(this,t))})}if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;null!=(n=this[r]);r++){(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(jt(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Pt(jt(n,"script")),n.parentNode.removeChild(n)))}return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);
t++){1===e.nodeType&&b.cleanData(jt(e,!1));while(e.firstChild){e.removeChild(e.firstChild)}e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t){return 1===n.nodeType?n.innerHTML.replace(vt,""):t}if(!("string"!=typeof e||St.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&gt.test(e)||Lt[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(yt,"<$1></$2>");try{for(;i>r;r++){n=this[r]||{},1===n.nodeType&&(b.cleanData(jt(n,!1)),n.innerHTML=e)}n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=h.apply([],e);var i,s,o,u,a,f,l=0,c=this.length,p=this,d=c-1,v=e[0],m=b.isFunction(v);if(m||!(1>=c||"string"!=typeof v||b.support.checkClone)&&Tt.test(v)){return this.each(function(i){var s=p.eq(i);m&&(e[0]=v.call(this,i,n?s.html():t)),s.domManip(e,n,r)})}if(c&&(f=b.buildFragment(e,this[0].ownerDocument,!1,this),i=f.firstChild,1===f.childNodes.length&&(f=i),i)){for(n=n&&b.nodeName(i,"tr"),u=b.map(jt(f,"script"),_t),o=u.length;c>l;l++){s=f,l!==d&&(s=b.clone(s,!0,!0),o&&b.merge(u,jt(s,"script"))),r.call(n&&b.nodeName(this[l],"table")?Mt(this[l],"tbody"):this[l],s,l)}if(o){for(a=u[u.length-1].ownerDocument,b.map(u,Dt),l=0;o>l;l++){s=u[l],Nt.test(s.type||"")&&!b._data(s,"globalEval")&&b.contains(a,s)&&(s.src?b.ajax({url:s.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((s.text||s.textContent||s.innerHTML||"").replace(kt,"")))}}f=i=null}return this}}),b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],s=b(e),o=s.length-1;for(;o>=r;r++){n=r===o?this:this.clone(!0),b(s[r])[t](n),p.apply(i,n.get())}return this.pushStack(i)}}),b.extend({clone:function(e,t,n){var r,i,s,o,u,a=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(Ot.innerHTML=e.outerHTML,Ot.removeChild(s=Ot.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e))){for(r=jt(s),u=jt(e),o=0;null!=(i=u[o]);++o){r[o]&&Bt(i,r[o])}}if(t){if(n){for(u=u||jt(e),r=r||jt(s),o=0;null!=(i=u[o]);o++){Ht(i,r[o])}}else{Ht(e,s)}}return r=jt(s,"script"),r.length>0&&Pt(r,!a&&jt(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l,c=e.length,h=pt(t),p=[],d=0;for(;c>d;d++){if(s=e[d],s||0===s){if("object"===b.type(s)){b.merge(p,s.nodeType?[s]:s)}else{if(Et.test(s)){u=u||h.appendChild(t.createElement("div")),a=(bt.exec(s)||["",""])[1].toLowerCase(),l=Lt[a]||Lt._default,u.innerHTML=l[1]+s.replace(yt,"<$1></$2>")+l[2],i=l[0];while(i--){u=u.lastChild}if(!b.support.leadingWhitespace&&gt.test(s)&&p.push(t.createTextNode(gt.exec(s)[0])),!b.support.tbody){s="table"!==a||wt.test(s)?"<table>"!==l[1]||wt.test(s)?0:u:u.firstChild,i=s&&s.childNodes.length;while(i--){b.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}}b.merge(p,u.childNodes),u.textContent="";while(u.firstChild){u.removeChild(u.firstChild)}u=h.lastChild}else{p.push(t.createTextNode(s))}}}}u&&h.removeChild(u),b.support.appendChecked||b.grep(jt(p,"input"),Ft),d=0;while(s=p[d++]){if((!r||-1===b.inArray(s,r))&&(o=b.contains(s.ownerDocument,s),u=jt(h.appendChild(s),"script"),o&&Pt(u),n)){i=0;while(s=u[i++]){Nt.test(s.type||"")&&n.push(s)}}}return u=null,h},cleanData:function(e,t){var n,r,s,o,u=0,a=b.expando,f=b.cache,c=b.support.deleteExpando,h=b.event.special;for(;null!=(n=e[u]);u++){if((t||b.acceptData(n))&&(s=n[a],o=s&&f[s])){if(o.events){for(r in o.events){h[r]?b.event.remove(n,r):b.removeEvent(n,r,o.handle)}}f[s]&&(delete f[s],c?delete n[a]:typeof n.removeAttribute!==i?n.removeAttribute(a):n[a]=null,l.push(s))}}}});var It,qt,Rt,Ut=/alpha\([^)]*\)/i,zt=/opacity\s*=\s*([^)]*)/,Wt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Vt=/^margin/,$t=RegExp("^("+w+")(.*)$","i"),Jt=RegExp("^("+w+")(?!px)[a-z%]+$","i"),Kt=RegExp("^([+-])=("+w+")","i"),Qt={BODY:"block"},Gt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,s,o={},u=0;if(b.isArray(n)){for(s=qt(e),i=n.length;i>u;u++){o[n[u]]=b.css(e,n[u],!1,s)}return o}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()
})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Rt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,u,a=b.camelCase(n),f=e.style;if(n=b.cssProps[a]||(b.cssProps[a]=tn(f,a)),u=b.cssHooks[n]||b.cssHooks[a],r===t){return u&&"get" in u&&(s=u.get(e,!1,i))!==t?s:f[n]}if(o=typeof r,"string"===o&&(s=Kt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(b.css(e,n)),o="number"),!(null==r||"number"===o&&isNaN(r)||("number"!==o||b.cssNumber[a]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(f[n]="inherit"),u&&"set" in u&&(r=u.set(e,r,i))===t))){try{f[n]=r}catch(l){}}}},css:function(e,n,r,i){var s,o,u,a=b.camelCase(n);return n=b.cssProps[a]||(b.cssProps[a]=tn(e.style,a)),u=b.cssHooks[n]||b.cssHooks[a],u&&"get" in u&&(o=u.get(e,!0,r)),o===t&&(o=Rt(e,n,i)),"normal"===o&&n in Yt&&(o=Yt[n]),""===r||r?(s=parseFloat(o),r===!0||b.isNumeric(s)?s||0:o):o},swap:function(e,t,n,r){var i,s,o={};for(s in t){o[s]=e.style[s],e.style[s]=t[s]}i=n.apply(e,r||[]);for(s in t){e.style[s]=o[s]}return i}}),e.getComputedStyle?(qt=function(t){return e.getComputedStyle(t,null)},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u.getPropertyValue(n)||u[n]:t,f=e.style;return u&&(""!==a||b.contains(e.ownerDocument,e)||(a=b.style(e,n)),Jt.test(a)&&Vt.test(n)&&(i=f.width,s=f.minWidth,o=f.maxWidth,f.minWidth=f.maxWidth=f.width=a,a=u.width,f.width=i,f.minWidth=s,f.maxWidth=o)),a}):s.documentElement.currentStyle&&(qt=function(e){return e.currentStyle},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u[n]:t,f=e.style;return null==a&&f&&f[n]&&(a=f[n]),Jt.test(a)&&!Wt.test(n)&&(i=f.left,s=e.runtimeStyle,o=s&&s.left,o&&(s.left=e.currentStyle.left),f.left="fontSize"===n?"1em":a,a=f.pixelLeft+"px",f.left=i,o&&(s.left=o)),""===a?"auto":a}),b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Gt,function(){return un(e,n,i)}):un(e,n,i):t},set:function(e,t,r){var i=r&&qt(e);return sn(e,t,r?on(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return zt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(s.replace(Ut,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=Ut.test(s)?s.replace(Ut,i):s+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Rt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Rt(e,n),Jt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return !b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},s="string"==typeof n?n.split(" "):[n];for(;4>r;r++){i[e+Zt[r]+t]=s[r]||s[r-2]||s[0]}return i}},Vt.test(e)||(b.cssHooks[e+t].set=sn)});var ln=/%20/g,cn=/\[\]$/,hn=/\r?\n/g,pn=/^(?:submit|button|image|reset|file)$/i,dn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&dn.test(this.nodeName)&&!pn.test(e)&&(this.checked||!xt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(hn,"\r\n")}}):{name:t.name,value:n.replace(hn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],s=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e)){b.each(e,function(){s(this.name,this.value)})}else{for(r in e){vn(r,e[r],n,s)}}return i.join("&").replace(ln,"+")},b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)
};var mn,gn,yn=b.now(),bn=/\?/,wn=/#.*$/,En=/([?&])_=[^&]*/,Sn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,xn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Tn=/^(?:GET|HEAD)$/,Nn=/^\/\//,Cn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,kn=b.fn.load,Ln={},An={},On="*/".concat("*");try{gn=o.href}catch(Mn){gn=s.createElement("a"),gn.href="",gn=gn.href}mn=Cn.exec(gn.toLowerCase())||[],b.fn.load=function(e,n,r){if("string"!=typeof e&&kn){return kn.apply(this,arguments)}var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(o="POST"),u.length>0&&b.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){s=arguments,u.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,s||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,s){return b.isFunction(r)&&(s=s||i,i=r,r=t),b.ajax({url:e,type:n,dataType:s,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gn,type:"GET",isLocal:xn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":On,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Pn(Pn(e,b.ajaxSettings),t):Pn(b.ajaxSettings,e)},ajaxPrefilter:_n(Ln),ajaxTransport:_n(An),ajax:function(e,n){function N(e,n,r,i){var l,g,y,E,S,T=n;2!==w&&(w=2,u&&clearTimeout(u),f=t,o=i||"",x.readyState=e>0?4:0,r&&(E=Hn(c,x,r)),e>=200&&300>e||304===e?(c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(b.lastModified[s]=S),S=x.getResponseHeader("etag"),S&&(b.etag[s]=S)),204===e?(l=!0,T="nocontent"):304===e?(l=!0,T="notmodified"):(l=Bn(c,E),T=l.state,g=l.data,y=l.error,l=!y)):(y=T,(e||!T)&&(T="error",0>e&&(e=0))),x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[g,T,x]):d.rejectWith(h,[x,T,y]),x.statusCode(m),m=t,a&&p.trigger(l?"ajaxSuccess":"ajaxError",[x,c,l?g:y]),v.fireWith(h,[x,T]),a&&(p.trigger("ajaxComplete",[x,c]),--b.active||b.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=b.ajaxSetup({},n),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?b(h):b.event,d=b.Deferred(),v=b.Callbacks("once memory"),m=c.statusCode||{},g={},y={},w=0,S="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(2===w){if(!l){l={};while(t=Sn.exec(o)){l[t[1].toLowerCase()]=t[2]}}t=l[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===w?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return w||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return w||(c.mimeType=e),this},statusCode:function(e){var t;if(e){if(2>w){for(t in e){m[t]=[m[t],e[t]]}}else{x.always(e[x.status])}}return this},abort:function(e){var t=e||S;return f&&f.abort(t),N(0,t),this}};if(d.promise(x).complete=v.add,x.success=x.done,x.error=x.fail,c.url=((e||c.url||gn)+"").replace(wn,"").replace(Nn,mn[1]+"//"),c.type=n.method||n.type||c.method||c.type,c.dataTypes=b.trim(c.dataType||"*").toLowerCase().match(E)||[""],null==c.crossDomain&&(r=Cn.exec(c.url.toLowerCase()),c.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=b.param(c.data,c.traditional)),Dn(Ln,c,n,x),2===w){return x}a=c.global,a&&0===b.active++&&b.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Tn.test(c.type),s=c.url,c.hasContent||(c.data&&(s=c.url+=(bn.test(s)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=En.test(s)?s.replace(En,"$1_="+yn++):s+(bn.test(s)?"&":"?")+"_="+yn++)),c.ifModified&&(b.lastModified[s]&&x.setRequestHeader("If-Modified-Since",b.lastModified[s]),b.etag[s]&&x.setRequestHeader("If-None-Match",b.etag[s])),(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+On+"; q=0.01":""):c.accepts["*"]);for(i in c.headers){x.setRequestHeader(i,c.headers[i])}if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&2!==w){S="abort";for(i in {success:1,error:1,complete:1}){x[i](c[i])}if(f=Dn(An,c,n,x)){x.readyState=1,a&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{w=1,f.send(g,N)}catch(T){if(!(2>w)){throw T}N(-1,T)}}else{N(-1,"No Transport")}return x}return x.abort()},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")
}}),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=s.head||b("head")[0]||s.documentElement;return{send:function(t,i){n=s.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var jn=[],Fn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=jn.pop()||b.expando+"_"+yn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.jsonp!==!1&&(Fn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fn.test(n.data)&&"data");return a||"jsonp"===n.dataTypes[0]?(s=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,a?n[a]=n[a].replace(Fn,"$1"+s):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||b.error(s+" was not called"),u[0]},n.dataTypes[0]="json",o=e[s],e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,jn.push(s)),u&&b.isFunction(o)&&o(u[0]),u=o=t}),"script"):t});var In,qn,Rn=0,Un=e.ActiveXObject&&function(){var e;for(e in In){In[e](t,!0)}};b.ajaxSettings.xhr=e.ActiveXObject?function(){return !this.isLocal&&zn()||Wn()}:zn,qn=b.ajaxSettings.xhr(),b.support.cors=!!qn&&"withCredentials" in qn,qn=b.support.ajax=!!qn,qn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();if(n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async),n.xhrFields){for(u in n.xhrFields){a[u]=n.xhrFields[u]}}n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i){a.setRequestHeader(u,i[u])}}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c;try{if(r&&(i||4===a.readyState)){if(r=t,o&&(a.onreadystatechange=b.noop,Un&&delete In[o]),i){4!==a.readyState&&a.abort()}else{c={},u=a.status,f=a.getAllResponseHeaders(),"string"==typeof a.responseText&&(c.text=a.responseText);try{l=a.statusText}catch(h){l=""}u||!n.isLocal||n.crossDomain?1223===u&&(u=204):u=c.text?200:404}}}catch(p){i||s(-1,p)}c&&s(u,l,c,f)},n.async?4===a.readyState?setTimeout(r):(o=++Rn,Un&&(In||(In={},b(e).unload(Un)),In[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Vn,$n=/^(?:toggle|show|hide)$/,Jn=RegExp("^(?:([+-])=|)("+w+")([a-z%]*)$","i"),Kn=/queueHooks$/,Qn=[nr],Gn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=Jn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){if(n=+s[2],r=s[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&u){u=b.css(i.elem,e,!0)||n||1;do{a=a||".5",u/=a,b.style(i.elem,e,u+r)}while(a!==(a=i.cur()/o)&&1!==a&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++){n=e[r],Gn[n]=Gn[n]||[],Gn[n].unshift(t)}},prefilter:function(e,t){t?Qn.unshift(e):Qn.push(e)}}),b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)
},animate:function(e,t,n,r){var i=b.isEmptyObject(e),s=b.speed(t,n,r),o=function(){var t=er(this,b.extend({},e),s);o.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",s=b.timers,o=b._data(this);if(n){o[n]&&o[n].stop&&i(o[n])}else{for(n in o){o[n]&&o[n].stop&&Kn.test(n)&&i(o[n])}}for(n=s.length;n--;){s[n].elem!==this||null!=e&&s[n].queue!==e||(s[n].anim.stop(r),t=!1,s.splice(n,1))}(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=b.timers,o=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=s.length;t--;){s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1))}for(t=0;o>t;t++){r[t]&&r[t].finish&&r[t].finish.call(this)}delete n.finish})}}),b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return 0.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++){e=n[r],e()||n[r]!==e||n.splice(r--,1)}n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Vn||(Vn=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Vn),Vn=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length){return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)})}var n,r,s={top:0,left:0},o=this[0],u=o&&o.ownerDocument;if(u){return n=u.documentElement,b.contains(n,o)?(typeof o.getBoundingClientRect!==i&&(s=o.getBoundingClientRect()),r=sr(u),{top:s.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:s.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):s}},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var i=b(e),s=i.offset(),o=b.css(e,"top"),u=b.css(e,"left"),a=("absolute"===r||"fixed"===r)&&b.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),b.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(f.top=t.top-s.top+c),null!=t.left&&(f.left=t.left-s.left+h),"using" in t?t.using.call(e,f):i.css(f)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||s.documentElement;while(e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position")){e=e.offsetParent}return e||s.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,s){var o=sr(e);return s===t?o?n in o?o[n]:o.document.documentElement[i]:e[i]:(o?o.scrollTo(r?b(o).scrollLeft():s,r?s:b(o).scrollTop()):e[i]=s,t)},e,i,arguments.length,null)}}),b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),u=r||(i===!0||s===!0?"margin":"border");return b.access(this,function(n,r,i){var s;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?b.css(n,r,u):b.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})}(window),define("underscore",[],function(){return function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e)
};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(null!=e){if(c&&e.forEach===c){e.forEach(t,r)}else{if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++){if(t.call(r,e[i],i,e)===n){return}}}else{for(var o in e){if(x.has(e,o)&&t.call(r,e[o],o,e)===n){return}}}}}};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p){return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t)}if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i){throw new TypeError(N)}return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d){return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t)}var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i){throw new TypeError(N)}return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return !t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t){if(t[n]!==e[n]){return !1}}return !0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length){return Math.max.apply(Math,e)}if(!t&&x.isEmpty(e)){return -1/0}var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length){return Math.min.apply(Math,e)}if(!t&&x.isEmpty(e)){return 1/0}var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;r.computed>o&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0){return 1}if(r>n||r===void 0){return -1}}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;i>n.call(r,e[u])?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})
},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return !x.contains(t,e)})},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=Array(t),r=0;t>r;r++){n[r]=x.pluck(e,""+r)}return n},x.object=function(e,t){if(null==e){return{}}for(var n={},r=0,i=e.length;i>r;r++){t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1]}return n},x.indexOf=function(e,t,n){if(null==e){return -1}var r=0,i=e.length;if(n){if("number"!=typeof n){return r=x.sortedIndex(e,t),e[r]===t?r:-1}r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y){return e.indexOf(t,n)}for(;i>r;r++){if(e[r]===t){return r}}return -1},x.lastIndexOf=function(e,t,n){if(null==e){return -1}var r=null!=n;if(b&&e.lastIndexOf===b){return r?e.lastIndexOf(t,n):e.lastIndexOf(t)}for(var i=r?n:e.length;i--;){if(e[i]===t){return i}}return -1},x.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);r>i;){s[i++]=e,e+=n}return s},x.bind=function(e,t){if(e.bind===S&&S){return S.apply(e,u.call(arguments,1))}var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return 0===t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--){t=[e[n].apply(this,t)]}return t[0]}},x.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},x.keys=E||function(e){if(e!==Object(e)){throw new TypeError("Invalid object")}var t=[];for(var n in e){x.has(e,n)&&(t[t.length]=n)}return t},x.values=function(e){var t=[];for(var n in e){x.has(e,n)&&t.push(e[n])}return t},x.pairs=function(e){var t=[];for(var n in e){x.has(e,n)&&t.push([n,e[n]])}return t},x.invert=function(e){var t={};for(var n in e){x.has(e,n)&&(t[e[n]]=n)}return t},x.functions=x.methods=function(e){var t=[];for(var n in e){x.isFunction(e[n])&&t.push(n)}return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t){for(var n in t){e[n]=t[n]}}}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e){x.contains(n,i)||(t[i]=e[i])}return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t){for(var n in t){null==e[n]&&(e[n]=t[n])}}}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t){return 0!==e||1/e==1/t}if(null==e||null==t){return e===t}e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t)){return !1}switch(i){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return +e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t){return !1}for(var s=n.length;s--;){if(n[s]==e){return r[s]==t}}n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length){for(;o--&&(u=O(e[o],t[o],n,r));){}}}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l)){return !1}for(var c in e){if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&O(e[c],t[c],n,r)))){break}}if(u){for(c in t){if(x.has(t,c)&&!(o--)){break}}u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(null==e){return !0}if(x.isArray(e)||x.isString(e)){return 0===e.length}for(var t in e){if(x.has(e,t)){return !1}}return !0},x.isElement=function(e){return !!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"
}}),x.isArguments(arguments)||(x.isArguments=function(e){return !!e&&!!x.has(e,"callee")}),"function"!=typeof/ . /&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++){r[i]=t.call(n,i)}return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(null==e){return null}var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t){return r(t,x)}var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),_}),define("json2",[],function(){return this.JSON||(this.JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a){return"null"}gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1){u[n]=str(n,a)||"null"}return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1){r=rep[n],typeof r=="string"&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}}else{for(r in a){Object.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}}return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;
gap="",indent="";if(typeof n=="number"){for(r=0;r<n;r+=1){indent+=" "}}else{typeof n=="string"&&(indent=n)}rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number"){return str("",{"":e})}throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object"){for(n in i){Object.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n])}}return reviver.call(e,t,i)}var j;cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}(),JSON}),define("backbone/backbone",["json2","underscore","jquery"],function(){return function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="1.0.0";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender||e.$,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=o.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t){return this}this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t){return this}var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,f,c,h;if(!this._events||!l(this,"off",e,[t,n])){return this}if(!e&&!t&&!n){return this._events={},this}o=e?[e]:u.keys(this._events);for(a=0,f=o.length;a<f;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n){for(c=0,h=s.length;c<h;c++){i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i)}}r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events){return this}var t=i.call(arguments,1);if(!l(this,"trigger",e,t)){return this}var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r){return this}var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r){r[s].off(t,n,this),i&&delete this._listeners[s]}return this}},f=/\s+/,l=function(e,t,n,r){if(!n){return !0}if(typeof n=="object"){for(var i in n){e[t].apply(e,[i,n[i]].concat(r))}return !1}if(f.test(n)){var s=n.split(f);for(var o=0,u=s.length;o<u;o++){e[t].apply(e,[s[o]].concat(r))}return !1}return !0},c=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i){(n=e[r]).callback.call(n.ctx)}return;case 1:while(++r<i){(n=e[r]).callback.call(n.ctx,s)}return;case 2:while(++r<i){(n=e[r]).callback.call(n.ctx,s,o)}return;case 3:while(++r<i){(n=e[r]).callback.call(n.ctx,s,o,u)}return;default:while(++r<i){(n=e[r]).callback.apply(n.ctx,t)}}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){a[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[s]=t,typeof n=="object"&&(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,u.extend(o,a);var p=o.Model=function(e,t){var n,r=e||{};t||(t={}),this.cid=u.uniqueId("c"),this.attributes={},u.extend(this,u.pick(t,d)),t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults")){r=u.defaults({},r,n)}this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},d=["url","urlRoot","collection"];u.extend(p.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null){return this}typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n)){return !1}s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i){t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t}if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++){this.trigger("change:"+o[h],this,c[o[h]],n)}}if(f){return this}if(!a){while(this._pending){this._pending=!1,this.trigger("change",this,n)}}return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes){t[n]=void 0
}return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e){return this.hasChanged()?u.clone(this.changed):!1}var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i])){continue}(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e)){return !1}n&&n(t,r,e),t.trigger("sync",t,r,e)},j(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t;if(r&&(!n||!n.wait)&&!this.set(r,n)){return !1}n=u.extend({validate:!0},n);if(!this._validate(r,n)){return !1}r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n)){return !1}f&&f(a,e,n),a.trigger("sync",a,e,n)},j(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew()){return e.success(),!1}j(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||B();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},u.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate){return !0}e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,u.extend(t||{},{validationError:n})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];u.each(v,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),u[e].apply(u,t)}});var m=o.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};u.extend(m.prototype,a,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){return this.set(e,u.defaults(t||{},y))},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s){continue}delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},set:function(e,t){t=u.defaults(t||{},g),t.parse&&(e=this.parse(e,t)),u.isArray(e)||(e=e?[e]:[]);var n,i,o,a,f,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=u.isString(this.comparator)?this.comparator:null,d=[],v=[],m={};for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(e[n],t))){continue}(f=this.get(o))?(t.remove&&(m[f.cid]=!0),t.merge&&(f.set(o.attributes,t),h&&!l&&f.hasChanged(p)&&(l=!0))):t.add&&(d.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o))}if(t.remove){for(n=0,i=this.length;n<i;++n){m[(o=this.models[n]).cid]||v.push(o)}v.length&&this.remove(v,t)}d.length&&(h&&(l=!0),this.length+=d.length,c!=null?s.apply(this.models,[c,0].concat(d)):r.apply(this.models,d)),l&&this.sort({silent:!0});if(t.silent){return this}for(n=0,i=d.length;n<i;n++){(o=d[n]).trigger("add",o,this,t)}return l&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++){this._removeReference(this.models[n])}return t.previousModels=this.models,this._reset(),this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e){if(e[n]!==t.get(n)){return !1
}}return !0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)},pluck:function(e){return u.invoke(this.models,"get",e)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},j(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t))){return !1}t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p){return e.collection||(e.collection=this),e}t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this){return}e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(b,function(e){m.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var w=["groupBy","countBy","sortBy"];u.each(w,function(e){m.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var E=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];u.extend(E.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events"))){return this}this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n){continue}var r=t.match(S),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,x)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else{this.setElement(u.result(this,"el"),!1)}}}),o.sync=function(e,t,n){var r=T[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||B()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s){return s.apply(this,arguments)}}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a};var T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var N=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)
},C=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,L=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(N.prototype,a,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e)),u.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return o.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),o.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes){return}this.routes=u.result(this,"routes");var e,t=u.keys(this.routes);while((e=t.pop())!=null){this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(C,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/]+)"}).replace(L,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return u.map(n,function(e){return e?decodeURIComponent(e):null})}});var O=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,_=/^\/+|\/+$/g,D=/msie [\w.]+/,P=/\/$/;O.started=!1,u.extend(O.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null){if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.substr(n.length))}else{e=this.getHash()}}return e.replace(M,"")},start:function(e){if(O.started){throw new Error("Backbone.history has already been started")}O.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(_,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange" in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s){return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0}this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent){return this.loadUrl()}},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment){return !1}this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t)){return e.callback(t),!0}});return n},navigate:function(e,t){if(!O.started){return !1}if(!t||t===!0){t={trigger:t}}e=this.getFragment(e||"");if(this.fragment===e){return}this.fragment=e;var n=this.root+e;if(this._hasPushState){this.history[t.replace?"replaceState":"pushState"]({},document.title,n)}else{if(!this._wantsHashChange){return this.location.assign(n)}this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else{e.hash="#"+t}}}),o.history=new O;var H=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=m.extend=N.extend=E.extend=O.extend=H;var B=function(){throw new Error('A "url" property or function must be specified')},j=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),Backbone}),define("backbone/cache",["jquery","underscore","./backbone"],function(e,t,n){var r=n.Model.prototype,i=t.clone(r);t.extend(n.Model,{cache:null}),t.extend(r,{fetch:function(n){n=n||{};var r=n.success||e.noop,s=n.removed||e.noop,o=n.error||e.noop,u=this.constructor,a=u.cache;
a&&t.extend(n,{success:function(e,t,n){a.cache(e),r(e,t,n)},removed:function(e,t,n){a.markRemoved(e),s(e,t,n)},error:function(e,t,n){o(e,t,n)}}),i.fetch.call(this,n)},query:function(t){var n=t.success||e.noop,r=t.removed||e.noop,i=this.constructor,s=i.cache,o=null;if(!s){this.fetch(t);return}if(s.isRemoved(this)){r(this);return}o=s.get(this),o?n(o):this.fetch(t)}});var s=n.Collection.prototype,o=t.clone(s);return t.extend(s,{fetch:function(n){n=n||{};var r=n.success||e.noop,i=this.model,s=i.cache;s&&t.extend(n,{success:function(e,t,n){s.cache(e.models),r(e,t,n)}}),o.fetch.call(this,n)},query:function(n){var r=n.success||e.noop,i=this.model,s=i.cache,o=[],u=n.ids;if(!s){this.fetch(n);return}if(u){var a=[];u=t.isArray(u)?u:[u];for(var f=0,l=u.length;f<l;f++){var c=u[f],h=i.cache.getCachedById(c);h?o.push(h):a.push(c)}if(!a.length){r(i.cache.getCachedByIds(u));return}n.preIds=n.ids,n.ids=a}n.success=function(e,t,n){e.add(o),r(e,t,n)},this.fetch(n)}}),n}),define("backbone/sync",["jquery","underscore","./backbone"],function(e,t,n){return n.ajaxSync=n.sync,n.sync=function(r,i,s,o){var u=i.toJSON(),a={};(r=="update"||r=="create")&&t.each(s.changes,function(e,t){e&&(a[t]=u[t])});if(r=="read"){var f=s.success;s.success=function(t,n,r){r=r||{},o=r.error;if(!t||t.ret||t.res===!1){t=t||{},removed=s.removed||e.noop,s.removed&&s.removed(i,t,r);return}f(t,n,r)}}return s.data=t.extend({},a,s.data),n.ajaxSync.apply(this,[r,i,s,o])},n}),define("backbone",["jquery","underscore","./backbone/backbone","./backbone/cache","./backbone/sync"],function(e,t,n){return n.emulateHTTP=!1,n.emulateJSON=!0,n}),define("plugin/jquery.easydrag",["jquery"],function(e){(function(e){function d(r){if(t&&c[n.id]!="false"){return e.updatePosition(r),i[n.id]!=undefined&&i[n.id](r,n),!1}}function v(i){e("body").removeClass("none-select");if(t&&c[n.id]!="false"){return t=!1,r[n.id]!=undefined&&r[n.id](i,n),!1}}var t=!1,n=null,r={},i={},s={},o={},u,a,f,l,c={},h=!1,p=!1;e.getMousePosition=function(e){var t=0,n=0;if(!e){var e=window.event}if(e.pageX||e.pageY){t=e.pageX,n=e.pageY}else{if(e.clientX||e.clientY){t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}}return{x:t,y:n}},e.updatePosition=function(t){var r=e.getMousePosition(t),i=r.x-u,s=r.y-a,o=parseFloat(e(n).css("marginLeft")),c=e(n).attr("canLeftMove"),h=e(n).attr("canTopMove");c!=="false"&&e(n).css("left",l-o+i),h!==!1&&e(n).css("top",f+s)},e.fn.unBindEvent=function(){e(document).off("mousemove",d),e(document).off("mouseup",v),p=!1},e.fn.bindEvent=function(){p||(e(document).mousemove(d),e(document).mouseup(v),p=!0)},e.fn.beforeDrag=function(e){return this.each(function(){s[this.id]=e})},e.fn.ondrag=function(e){return this.each(function(){i[this.id]=e})},e.fn.ondrop=function(e){return this.each(function(){r[this.id]=e})},e.fn.dragOff=function(){return this.each(function(){c[this.id]="off"})},e.fn.dragOn=function(){return this.each(function(){c[this.id]="on"})},e.fn.setHandler=function(t){return this.each(function(){var n=this;o[this.id]=!0,e(n).css("cursor",""),c[n.id]="handler";var r;typeof t=="string"?r=e("#"+t):t.jquery&&(r=t),r.css("cursor","move"),r.mousedown(function(t){h=!0,e(n).trigger("mousedown",t)}),r.mouseup(function(e){h=!1})})},e.fn.easydrag_release=function(e){c[e]=undefined,r[e]=undefined,i[e]=undefined,s[e]=undefined},e.fn.easydrag=function(r,i){return i!==!1&&e.fn.bindEvent(),this.each(function(){if(undefined==this.id||!this.id.length){this.id="easydrag"+(new Date).getTime()}o[this.id]=r?!0:!1,c[this.id]="on",e(this).css("cursor","move"),e(this).mousedown(function(i,p){p&&(i=e.extend({},p,i));if(!r&&i.target!=this){return}e("body").addClass("none-select");var d=!1;s&&s[this.id]&&s[this.id](i,n||this)&&(d=!0);if(d){return !0}if(c[this.id]=="off"||c[this.id]=="handler"&&!h){return o[this.id]}e(this).css("position","absolute"),e(this).css("z-index",parseInt((new Date).getTime()/1000)),t=!0,n=this;var v=e.getMousePosition(i);return u=v.x,a=v.y,f=this.offsetTop,l=this.offsetLeft,e.updatePosition(i),o[this.id]})})}})(e)}),define("plugin/dialog",["jquery","plugin/jquery.easydrag"],function(e){function f(e,t){this.dialog=e,this.config=t,this.create()}function c(t){o++,i++,h.gZIndex=i,t=t||{},this.options=e.extend(!0,{id:"dialog_"+o,group:!1,width:"",fixed:!0,dialogClass:"",header:"",content:"",close:!0,hide:!1,iframe:!1,onClose:function(){},onYes:function(){},autoClose:!1,overlayer:{clickClose:!0,opacity:0.4},template:{dialog_container:'<div class="popup" dialog-role="container"></div>',dialog_header:'<div class="hd" dialog-role="header"></div>',dialog_body:'<div class="bd" dialog-role="body"></div>',dialog_close:'<div class="close3Btn" dialog-role="close"></div>',dialog_iframe:"<iframe frameborder='0' marginheight='0' marginwidth='0' width='100%' scrolling='auto' style='background:#fff;border:none;'></iframe>"}},t),this.create(),this.bindEvents()}var t=e(window),n=e(document),r=e(document.body);
e(document).ready(function(){t=e(window),n=e(document),r=e(document.body)});var i=10000,s=i,o=1000,u=function(){return !1}(),a={exist:!1,dialogs:[],getId:function(){return"dialog_overlayer"},getHtml:function(){var e="<div id='"+this.getId()+"' class='popup-overlayer'></div>";return e},create:function(t,n){this.dialogs.push(t);if(this.exist){n.opacity!=undefined&&this.el.css("opacity",n.opacity);return}this.el=e(this.getHtml()),n.opacity!=undefined&&this.el.css("opacity",n.opacity),u&&this.hideSelect(),r.append(this.el),this.setEvent(),this.exist=!0},hideSelect:function(){this.hide_select=e("select:visible"),this.hide_select.hide()},showSelect:function(){this.hide_select&&this.hide_select.show()},open:function(t){this.el.css({zIndex:s}).height(e(document).height()),this.el.show(),t&&t.opacity!=undefined&&this.el.css("opacity",t.opacity)},close:function(e){for(var t=0;t<this.dialogs.length;t++){if(this.dialogs[t].id==e.id){this.dialogs.splice(t,1);break}}this.dialogs.length<=0&&(this.el.hide(),u&&this.showSelect())},setEvent:function(){var e=this;this.el.click(function(){var t=e.dialogs[e.dialogs.length-1];t&&t.overlayer&&t.overlayer.config&&t.overlayer.config.clickClose&&t.close()})}};f.prototype.create=function(){a.create(this.dialog,this.config)},f.prototype.open=function(e){a.open(e)},f.prototype.close=function(){a.close(this.dialog)};var l={groups:{},add:function(e,t){this.groups[e]&&this.groups[e].close(),this.groups[e]=t},del:function(e,t){this.groups[e]&&this.groups[e].id==t&&delete this.groups[e]}};c.prototype.setDrop=function(t,n){var r=i,s=this;t.beforeDrag(function(e){if(t.hasClass("fixed")){var n=t.offset().top;t.removeClass("fixed"),t.css("top",n)}}),t.ondrop(function(){t.css("zIndex",r);if(s.options.fixed){var n=t.offset().top,i=e(document).scrollTop();t.addClass("fixed"),t.css("top",n-i),t.css("position","")}}),t.ondrag(function(n,r){var i=t.position(),s=i.top,o=i.left,u=t.height(),a=t.width(),f=e(document).scrollTop(),l=e(window),c=l.height(),h=l.width();s<=f&&t.css("top",f),s-f>=c-u&&t.css("top",f+c-u),o<=0&&t.css("left",0),o+a>=h-3&&t.css("left",h-a-3)}),t.easydrag(),t.setHandler(n)},c.prototype.create=function(){var t=this.options,n=t.template,s=e(n.dialog_container);s.css("zIndex",i),s.attr("id",t.id);if(t.header){var o=e(n.dialog_header).html(t.header);s.append(o),this.setDrop(s,o)}t.content&&(s.append(e(n.dialog_body)),s.find("[dialog-role=body]").html(t.content)),t.close&&s.append(n.dialog_close),t.width&&s.css({width:t.width}),t.height?s.css({height:t.height}):s.css({height:"auto"}),t.dialogClass&&s.addClass(t.dialogClass),t.overlayer&&!e.isEmptyObject(t.overlayer)&&(this.overlayer=new f(this,t.overlayer)),r.append(s),this.$el=s},c.prototype.getEl=function(){return this.$el},c.prototype.setHeader=function(e){this.$el.find("[dialog-role=header]").text(e)},c.prototype.setContent=function(e){this.$el.find("[dialog-role=body]").text(e),this.setPosition()},c.prototype.open=function(){var n=this.options;n.group&&l.add(n.group,this),this.setHeight(),this.setPosition(),this.$el.hide(),this.setAutoClose(),this.overlayer&&this.overlayer.open(this.overlayer.config);if(n.fade){this.$el.css({opacity:0}).show().animate({opacity:1})}else{var r=this.$el.css("top");this.$el.css("top",e(window).height()),this.$el.show().focus(),this.$el.animate({top:r},200)}t.bind("resize",this,this.windowResize),this.closed=!1},c.prototype.setHeight=function(){this.options.iframe&&(this.$el.find("iframe").height(this.options.height).width(this.options.width),this.$el.css("width","auto"))},c.prototype.setAutoClose=function(){if(this.options.autoClose){var e=this;this.closeTimer=setTimeout(function(){e.close()},this.options.autoClose)}},c.prototype.setWidth=function(e){this.$el.css({width:e+"px"})},c.prototype.windowResize=function(e){e.data.setPosition()},c.prototype.setPosition=function(){var e=(t.width()-this.$el.outerWidth())/2,r=(t.height()-this.$el.outerHeight())/2;e=e>20?e:20,r=r>20?r:20;var i={};this.options.fixed?(i.left=e,u||(i.top=r),this.$el.addClass("fixed")):(i={left:n.scrollLeft()+e,top:n.scrollTop()+r},this.$el.removeClass("fixed")),this.$el.stop().css(i)},c.prototype.bindEvents=function(){var e=this;this.$el.on("click","[dialog-role=close]",function(){return e.close(),!1}),this.$el.on("click","[dialog-role=yes]",function(){return e.yesFn(),!1}),this.$el.on("click","[dialog-role=cancel]",function(){return e.close(),e.cancelFn(),!1})},c.prototype.cancelFn=function(){var t=this.options;t.onCancel&&e.isFunction(t.onCancel)&&t.onCancel.call(this)},c.prototype.yesFn=function(){var t=this.options,n=this;t.onYes&&e.isFunction(t.onYes)&&t.onYes.call(this)!==!1&&n.close()},c.prototype.unbindEvents=function(){t.unbind("resize",this.windowResize),this.$el.off(),this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=null)},c.prototype.close=function(){if(this.closed){return}var t=this.options,n=this;t.onClose&&e.isFunction(t.onClose)&&t.onClose.call(this),t.group&&l.del(t.group,t.id),this.overlayer&&this.overlayer.close(),this.closed=!0;
if(t.hide){if(t.fade){this.$el.animate({opacity:0},function(){n.$el.hide()})}else{var r=e(window).height();this.$el.animate({top:r},200,"swing",function(){n.$el.hide()})}}else{this.unbindEvents(),t.fade?this.$el.animate({opacity:0},function(){n.$el.remove()}):this.$el.animate({top:e(window).height()},200,function(){n.$el.remove()})}};var h={};return h.Dialog=c,h.success=function(t,n){var r=e.extend({content:t||"操作成功",dialogClass:"msg2",close:!1,autoClose:1000,fade:!0,overlayer:{opacity:0},template:{dialog_container:'<div class="msg2" dialog-role="container"></div>',dialog_body:"<span dialog-role='body'></span>"}},n),i=new c(r);i.open()},h.warn=function(t,n){h.alert(t,n);return;var r,i},h.alert=function(t,n){var r='<div class="msg_title">'+(t||"")+"</div>"+' <div class="operate"><a href="javascript:;" class="confirmBtn" dialog-role="yes">确认</a></div>',i=e.extend({content:r,close:!1,dialogClass:"msg msg_alert",overlayer:{clickClose:!1},onYes:function(){this.close()}},n),s=new c(i);s.open();var o=s.getEl();o.focus();var u=function(t){if(t.keyCode==13){return e(document).off("keypress",u),s.close(),!1}};e(document).on("keypress",u)},h.confirm=function(t,n,r){n=n||e.noop,r=r||{};var i='<div class="msg_title">'+(t||"您确定要这样做么？")+"</div>"+'<div class="operate">'+'<a href="javascript:;" class="confirmBtn" dialog-role="yes">'+(r.yesText||"确定")+"</a>"+'<a href="javascript:;" class="cancelBtn" dialog-role="cancel">'+(r.cancelText||"取消")+"</a></div>";r.checkbox&&(i+='<div class="msg_noprompt"><input type="checkbox"><label>'+r.checkbox+"</label></div>");var s=e.extend({content:i,dialogClass:"msg msg_confirm",close:!1,overlayer:{clickClose:!1},callback:e.noop,onYes:function(){var e=!1;r.checkbox&&(e=!!u.find("input[type=checkbox]")[0].checked),n(e),s.callback(e)},onCancel:function(){}},r),o=new c(s),u=o.getEl();o.open()},h}),define("helper",["underscore","backbone","jquery","plugin/dialog"],function(e,t,n,r){function o(e,t,n){this.tasks=[],this.isActived=!1,this.processFn=e,this.callback=t||function(){},this.context=n||this}function h(e){this.id=++h.logIndex,this.text=e,h.logs[this.id]=this}function d(){p&&clearTimeout(p),helper.isWindowBusy(!0),p=setTimeout(function(){helper.isWindowBusy(!1)},50)}var i,s;jQuery.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(2345)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],n=/(2345).*?/.test(e),r=/(Trident).*(QQBrowser).*?/i.test(e),i=/(Trident).*?/i.test(e);return{Is2345:n,isQQBrowserIE:r,isTrident:i,browser:t[1]||"",version:t[2]||"0"}},jQuery.cookie=function(e,t,r){if(typeof t=="undefined"){var f=null;if(document.cookie&&document.cookie!=""){var l=document.cookie.split(";");for(var c=0;c<l.length;c++){var h=jQuery.trim(l[c]);if(h.substring(0,e.length+1)==e+"="){f=decodeURIComponent(h.substring(e.length+1));break}}}return f}r=r||{},t===null&&(t="",r=n.extend({},r),r.expires=-1);var i="";if(r.expires&&(typeof r.expires=="number"||r.expires.toUTCString)){var s;typeof r.expires=="number"?(s=new Date,s.setTime(s.getTime()+r.expires*1000)):s=r.expires,i="; expires="+s.toUTCString()}var o=r.path?"; path="+r.path:"",u=r.domain?"; domain="+r.domain:"",a=r.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),i,o,u,a].join("")},i=jQuery.uaMatch(navigator.userAgent),s={},o.prototype={append:function(e){this.tasks.push(e),this.on()},on:function(){this.isActived||(this.isActived=!0,this.todo())},off:function(){this.isActived=!1},todo:function(){var e=this;setTimeout(function(){var t=+(new Date),n=e.tasks;do{e.processFn.apply(e.context,e.tasks.shift())}while(n.length>0&&+(new Date)-t<50);n.length>0?setTimeout(arguments.callee,25):(e.callback(),e.off())},25)}};var u={track:{30:"mobile_small",100:"web_meduim",180:"web_large","180n":"web_explore",60:"mobile_small",86:"mobile_small",640:"mobile_large","640n":"large_pop"},header:{16:"web_small",30:"web_small",60:"common_medium",86:"mobile_small",100:"web_large",110:"web_large",180:"web_x_large",200:"web_x_large",290:"mobile_large",640:"mobile_x_large"},album:{30:"web_small",86:"mobile_small",100:"web_meduim",140:"mobile_medium",180:"web_large",290:"mobile_large","640n":"large_pop"}};i.browser&&(s[i.browser]=!0,s.version=i.version,s.b2345=i.Is2345,s.isQQBrowserIE=i.isQQBrowserIE,s.isTrident=i.isTrident),n.browser||(n.browser=s);var a=/android/gi.test(navigator.appVersion),f=/iphone|ipad|ipod/gi.test(navigator.appVersion),l=/hp-tablet/gi.test(navigator.appVersion),c=f||l;h.logs={},h.logIndex=0,h.getLogText=function(e){return h.logs[e].text},window.helper={ErrorLog:h,browser:s,isAndroid:a,isIDevice:f,isTouchPad:l,hasTouch:c,RESIZE_EV:"onorientationchange" in window?"orientationchange":"resize",START_EV:c?"touchstart":"mousedown",START_CLICK_EV:c?"touchstart":"click",MOVE_EV:c?"touchmove":"mousemove",END_EV:c?"touchend":"mouseup",CANCEL_EV:c?"touchcancel":"mouseup",loading:{start:function(e){var t=n(e);
return(t.attr("loadding")&&!0)===!0?!1:(t.attr("txt",t.text()),t.html("&nbsp;"),t.attr("loadding",!0),t.spin("tiny"),!0)},end:function(e){var t=n(e);t.text(t.attr("txt")),t.removeAttr("loadding"),t.spin("stop")}},escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;")},getEvents:function(t){var n=this,r={};return e.each(t,function(e,t){t=t.replace("START_EV",n.START_EV).replace("MOVE_EV",n.MOVE_EV).replace("END_EV",n.END_EV).replace("CANCEL_EV",n.CANCEL_EV),r[t]=e}),r},scrollTop:function(){this.browser.mozilla?n("html").animate({scrollTop:0},120):n("body").animate({scrollTop:0},120)},doChangeOptions:function(e,t){var n=JSON.stringify(t);n=n.substring(1,n.length-1),e.attr("data-options",n)},getTime:function(e,t){var n=Math.floor(e/1000),r=Math.floor(n/60),i=Math.floor(r/60),s=n-r*60;return r-=i*60,t?{min:r,sec:s,hour:i}:(i?i+":":"")+((r<10?"0"+r:r)+":"+(s<10?"0"+s:s))},doCheckVersion:function(){var e=Number(helper.browser.version);n(".upgradePrompt ").remove(),helper.browser.msie&&!isNaN(e)&&(e<8?(e!=7||s.b2345!==!0)&&r.alert("系统检测到您的浏览器版本("+e+")过低,请升级至IE7.0以上，或使用Chrome、Firefox、safari、搜狗高速模式等浏览器！",{width:"300px"}):document.documentMode&&document.documentMode<8&&r.alert("请调整IE文档模式为IE8或以上！"))},cookie:{addCookie:function(e,t,n){var r=e+"="+escape(t);if(n>0){var i=new Date,s=n*3600*1000;i.setTime(i.getTime()+s),r+="; expires="+i.toGMTString()}document.cookie=r+";path=/"},getCookie:function(e){var t=document.cookie.split("; ");for(var n=0;n<t.length;n++){var r=t[n].split("=");if(r[0]==e){return unescape(r[1])}}},delCookie:function(e){document.cookie=e+"=;expires="+(new Date(0)).toGMTString()}},login:function(e,t,r){window._hmt&&t&&_hmt.push(["_trackEvent",t,"click"]);var i="gLoginCallback",s=560,o=760,u=n(window),a=u.height(),f=u.width(),l=(f-o)/2,c=(a-s)/2;l=l>0?l:0,c=c>0?c:0;var h="height="+s+",width="+o+",left="+l+",top="+c;window.open("/passport/auth/"+e+"/authorize?customerFunction="+i,"",h),window[i]=function(e){r?r(e):window.location.reload(),window[i]=null}},isLogin:function(){return config&&config.CURRENT_USER&&config.CURRENT_USER.uid?!0:!1},gblen:function(e){return n.trim(e).replace(/[^\x00-\xff]/ig,"xx").length},cutString:function(e,t,n){var r="",i=0;for(var s=0;s<e.length;s++){e.charCodeAt(s)>127||e.charCodeAt(s)==94?i+=2:i++}if(i<=t){return e}i=0,n=n||"",t=t>this.gblen(n)?t-this.gblen(n):t;for(var s=0;s<e.length;s++){e.charCodeAt(s)>127||e.charCodeAt(s)==94?i+=2:i++;if(i>t){r+=n;break}r+=e.charAt(s)}return r},strFormat:function(e){var t=[].slice.call(arguments,1);return e.replace(/\{(\d+)\}/g,function(e,n){return t[n]})},getDateNiceTime:function(e){if(!e){return""}var t=new Date,n=(new Date(e)).getTime(),r=t.getTime()-config.TIME_GAP-n,i=Math.floor(r/1000),s=Math.floor(i/60),o=Math.floor(s/60),u=Math.floor(o/24),a=Math.floor(u/30),f=Math.floor(a/12);return i=i<0?0:i,s=s<0?0:s,o=o<0?0:o,u=u<0?0:u,a=a<0?0:a,f=f<0?0:f,f?f+"年前":a?a+"月前":u?u+"天前":o?o+"小时前":s?s+"分钟前":"刚刚"},getNiceTime:function(e){if(!e){return""}var t=new Date,n=(new this.datetrans(e)).trans().date.getTime(),r=t.getTime()-config.TIME_GAP-n,i=Math.floor(r/1000),s=Math.floor(i/60),o=Math.floor(s/60),u=Math.floor(o/24),a=Math.floor(u/30),f=Math.floor(a/12);return i=i<0?0:i,s=s<0?0:s,o=o<0?0:o,u=u<0?0:u,a=a<0?0:a,f=f<0?0:f,f?f+"年前":a?a+"月前":u?u+"天前":o?o+"小时前":s?s+"分钟前":"刚刚"},datetrans:function(e){this.trans=function(){var t=this.getDateInfo(e),n=this.getDateInfo((new Date).toString()),r=t.date.getTime()/1000+(t.utc-n.utc)*3600;return{unix:r*1000,date:new Date(r*1000)}},this.getDateInfo=function(e){var t=new RegExp("[+|-]\\d{2}:\\d{2}","g"),n=e.match(t),r=null,i=null,s=0,o=0;return n!=null?(e=e.replace(n,""),e=e.replace(/T/g," "),e=e.replace(/-/g,"/"),r=new Date(e),i=n[0].split(":"),s=i[0]*1,o=i[1]/60):(t=new RegExp("[+|-]\\d{2}\\d{2}","g"),n=e.match(t),n!=null&&(i=n[0],s=i.substr(1,2)*1,o=i.substr(4,2)/60)),s<0&&(o*=-1),i=s+o,{date:r,utc:i}}},getFDFSPath:function(e,t,n,r){if(!e){r=r||n;switch(t){case"album":e="css/img/common/album_"+r+".jpg";break;case"header":e="css/img/common/default/user"+r+".jpg";break;case"track":e="css/img/common/track_"+r+".jpg";break;default:return""}return config.STATIC_PATH+"/"+e}var i=e.match(/^http:\/\//);if(i&&i.length){return e}n=n||"";if(u[t]&&u[t][n]){var s=e.lastIndexOf(".");e=e.substring(0,s)+"_"+u[t][n]+e.substring(s)}return config.FDFS_PATH+"/"+e},scrollTo1:function(e,t){n("html, body").animate({scrollTop:e+t},120)},scrollTo:function(e,t){var r=e.offset().top+e.scrollTop()+t;n("html, body").animate({scrollTop:r},120)},sortObjectKeys:function(t){var n=e.keys(t).sort(),r={};return e.each(n,function(e){r[e]=t[e]}),r},timedProcessArray:function(e,t,r){var i=e.concat();r=r||n.noop,setTimeout(function(){var n=+(new Date);do{t(i.shift())}while(i.length>0&&+(new Date)-n<50);i.length>0?setTimeout(arguments.callee,25):r(e)},25)},_isWindowBusy:!1,isWindowBusy:function(e){if(e===undefined){return this._isWindowBusy
}this._isWindowBusy=e},copyLink:function(){alert("复制链接")},getHrefRefs:function(){var e=location.href,t=e.indexOf("?"),n=e.substring(e.indexOf("?")+1),r={},t=0,i="";n=n.split("&");for(var s=0;s<n.length;s++){i=n[s],i=i.split("="),i[1]&&(t=i[1].indexOf("#"),t==-1?r[i[0]]=i[1]:r[i[0]]=i[1].substring(0,i[1].indexOf("#")))}return r},enterToTab:function(e,t){var r=e?e:window.event,i=n(t),s=i.closest(".js-tabindex"),o=document.getElementById("form1");if(r.keyCode==13){var u=i.attr("tabindex"),a;do{u++,a=s.find("[tabindex="+u+"]")}while(a.size()&&a.is(":hidden"));a.size()&&a[0].focus()}},TaskManager:o},n(window).bind("scroll",d);var p=null;return n(document).on("click",".js-channelfrom",function(){var e=n(this),t=e.attr("href"),r=n.cookie("from");r&&(t=t+"&from="+r,e.attr("href",t))}),window.helper}),define("router",["jquery","backbone","helper"],function(e,t,n){var r={$el:e(".menu").eq(0),map:function(){var e={explore:"explore",list:"u",quan:"sound",dq:"album"};return config&&config.CURRENT_USER&&(e[config.CURRENT_USER.uid]="index"),e}(),set:function(e){var t=e.split("/")[0],n=this.map[t],r=this.$el.find(".menu_"+n);this.$el.find(".on").removeClass("on"),r.size()&&r.addClass("on")}},i=t.Router.extend({_page:null,pageName:"",$el:e("#mainbox"),isRefreshing:!1,routes:{"*action":"default"},isFromChannel:function(e){return e&&e[0]==="!"},"default":function(e){if(this.isFromChannel(e)){location.hash="";return}e=e||config.CURRENT_USER.uid+"/feed",this._page&&this._page.release(),this.toPage(e),r.set(e)},toPage:function(t,r){var i=this;this.pageName=t,this.$el.html('<div class="pageLoading"></div>'),n.scrollTop();var o=/^[\d\w\!\#\$\&\'\(\)\*\+\,\-\.\/\:\;\=\?\@\_\~\%]+$/,u=o.test(t),a=(n.browser.isTrident||n.browser.msie)&&!u;this.baiduCount(t);var f=t;if(!/\.ajax\b/.test(f)){var l=t.split("?");f=l[0].replace(/\/+$/,"")+".ajax"+(l[1]?"?"+l[1]:"")}e.ajax({type:r||"get",url:"/"+(a?encodeURI(f):f),dataType:"script",cache:!0,pageName:t,statusCode:{404:function(){s.to404()}},dataFilter:function(e,t){return this.pageName!=i.pageName?!1:e}})},to404:function(){this.toPage("404s")},setPage:function(e){this._page=e},baiduCount:function(e){window._hmt&&_hmt.push(["_trackPageview","/"+e+"_login"])}}),s=new i;return e("body").on("click","a",function(t){var r=e(this);if(r.is("[forseo=true]")){if(n.isLogin()){t.preventDefault();return}t.stopPropagation();return}if(r.is("[hashlink]")){if(e(t.target).is("[hashlink-disable]")){t.preventDefault();return}var i=r.attr("href");if(n.isLogin()&&!/^http\:/.test(i)){if(location.pathname==="/"){location.hash=i,t.preventDefault();return}location.href="http://"+location.host+"/#"+i,t.preventDefault();return}}}),n.isLogin()&&(!location.pathname||location.pathname=="/")&&(t.history.start(),e("body").on("click","a",function(n){var r=e(this),i=r.attr("href"),o;if(r.is("[forseo=true]")){n.preventDefault();return}if(r.is('[onclick="return false;"]')){return}if(i){o=t.history.getFragment(i);if(t.history.fragment==o||t.history.fragment==o.replace("#/","")){return s.isRefreshing!==!1?!1:(t.history.fragment=null,t.history.navigate(o[0]==="#"?o:"#/"+o,!0),s.isRefreshing=setTimeout(function(){s.isRefreshing=!1},800),!1)}}})),s}),define("model/cache",["jquery","underscore","backbone"],function(e,t,n){function r(e){e=t.extend({data:null,keys:[]},e),this.cached=new n.Collection(e.data),this.keys=e.keys,this.removed=[]}return r.prototype={cache:function(e){this.cached.set(e,{remove:!1})},getCached:function(){return this.cached},getCachedByIds:function(e){var t=[];for(var r=0,i=e.length;r<i;r++){var s=e[r],o=this.cached.get(s);t.push(o)}return new n.Collection(t)},getCachedById:function(e){return this.cached.get(e)},get:function(e){var t=e.id,n=this.keys;if(t){return this.getCachedById(t)}for(var r=0,i=n.length;r<i;r++){var s=n[r],o=e.get(s),u;u=this.cached.find(function(e){return e.get(s)==o});if(u){return u}}},markRemoved:function(e){var t=e.id,n=this.keys;t&&this.removed.push(t);for(var r=0,i=n.length;r<i;r++){var s=n[r],o=e.get(s);o&&this.removed.push(o)}},isRemoved:function(e){var n=e.id,r=this.keys,i=[];n&&i.push(n);for(var s=0,o=r.length;s<o;s++){var u=r[s],a=e.get(u);a&&i.push(a)}return !!t.intersection(this.cached.removed,i).length}},r}),define("model/sound",["jquery","underscore","backbone","./cache"],function(e,t,n,r){var i=new r,s=n.Model.extend({defaults:{id:"",url:"",duration:0,isFavorited:!1,favoritesCount:0,title:"",author:"",authorId:"",album:"",albumId:"",coverUrl:"",soundface:"",soundfaceMiddle:"",square:"",squareId:"",categoryName:"",info:"",haveMoreIntro:"",isVerified:!1,uid:"",createAt:"",playCount:0,commentCount:0,shareCount:0,timeUntilNow:"",waveform:"",uploadId:""},fetch:function(r){r=r||{},error=r.error||e.noop,success=r.success||e.noop,id=""+this.id,isDelayed=id[0]=="d",this.isDelayed=isDelayed,id=id.replace("d_",""),url=(isDelayed?"/delayed_tracks/":config.LOCAL_PATH+"/Public/front/sound/tracks/")+id+".json",t.extend(r,{url:url}),n.Model.prototype.fetch.call(this,r)},isDelayed:!1,parse:function(e){soundid=e.id;
play_count=e.play_count;var masongsongtime=new Date();this.playMasongsongTime=masongsongtime.getFullYear()+"-"+masongsongtime.getMonth()+"-"+masongsongtime.getDate()+" "+masongsongtime.getHours()+":"+masongsongtime.getMinutes()+":"+masongsongtime.getSeconds();$.ajax({url:playcount,data:{sound_id:soundid,playcount:play_count,},type:"post",});return{id:(this.isDelayed?"d_":"")+e.id,url:config.FDFS_PATH+"/"+(e.play_path_64||e.play_path_32||e.play_path_128||e.play_path),duration:parseInt(e.duration*1000,10),title:e.title,coverUrl:e.cover_url,uid:e.uid,playCount:e.play_count,waveform:e.waveform,haveMoreIntro:e.haveMoreIntro,uploadId:e.upload_id,}},like:function(t,n){var r=this,i=this.get("favoritesCount"),s=this.get("isFavorited");t=t||e.noop,n=n||e.noop,r.save({isFavorited:!s,favoritesCount:i+(s?-1:1)},{url:s?"/favorites/destroy":"/favorites/create",type:"post",data:{track_id:this.id,no_more_alert:!0,is_sharing:!0},success:function(e,r,i){if(r.res==0){n(e,r);return}t(e,r,i)},error:function(){t(r,{msg:"服务器错误"})}})},unlike:function(e,t){this.like(e,t)},destroy:function(t,n){t=t||e.noop,n=n||e.noop,e.ajax({url:"/my_tracks/"+this.id+"/destroy",type:"post",success:function(e){e.res?t(e):n(e)},error:function(){n({msg:"服务器繁忙,请稍后再试!"})}})},setPublic:function(t,n,r){n=n||e.noop,r=r||e.noop,e.ajax({url:"/handle_track/set_public",data:{record_id:t},type:"POST",success:function(e){e.res?n(e):r(e)},error:function(e,t,n){r({msg:"服务器繁忙,请稍后再试!"})}})},recordPlayInfo:function(t,n,r){r!==!1&&(r=!0),this.set({playCount:this.get("playCount")+1}),play_count=this.get("playCount");soundid=this.id;$(".playBtn").click(function(){$.ajax({url:playcount,data:{sound_id:soundid,playcount:play_count,},type:"post",});$(".playBtn").unbind("click");$(".pauseBtn").unbind("click")});e.ajax({url:playrecod,data:{playtime:this.playMasongsongTime,sound_id:this.id,played_secs:Math.floor(parseInt(n,10)/1000),},timeout:3000,async:r,type:"post",})}},{cache:i});return s}),define("module/player/extension",["jquery","underscore","backbone","helper"],function(e,t,n,r){function s(e){var t=[];for(var n in e){e.hasOwnProperty(n)&&t.push(n)}return t}var i={$last:null,last:null,$lastSoundIds:null,_isPlaying:!1,pause:function(){this.last.pause(),this._isPlaying=!1},isPlaying:function(){return this._isPlaying},isInExtension:function(e){return e.closest("[sound_id]").is("[sound_extension]")},events:{play:function(){i._isPlaying=!0;var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var r=e[t],s=r.$el,o=r.$btn,u=r.$progressbar,a=s.closest("[sound_ids]");r.$soundIds=a,r.$btn=o,i.$last=s,i.last=this,i.$lastSoundIds=a.size()?a:null,o.addClass("pauseBtn").removeClass("playBtn player-loading")}},stop:function(){var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var r=e[t],i=r.$btn;i.addClass("playBtn").removeClass("pauseBtn player-loading")}},pause:function(){var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var r=e[t],i=r.$btn;i.addClass("playBtn").removeClass("pauseBtn player-loading")}},resume:function(){i._isPlaying=!0;var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var r=e[t],s=r.$btn;s.addClass("pauseBtn").removeClass("playBtn player-loading")}},finish:function(){var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var r=e[t],s=r.$btn,o=r.$playbar;s.addClass("playBtn").removeClass("pauseBtn player-loading"),o.css("width","0")}var u=i.$last,a=i.$lastSoundIds;if(a){var f=a.attr("sound_ids").split(","),l=u.attr("sound_id"),c=f.indexOf(l),h=f[c+1],p=null;h?(p=a.find("[sound_id="+h+"]"),p.trigger("click")):(mainPlayer.play(),i._isPlaying=!1)}this._last_position=0},whileplaying:function(){if(this.paused){return}var e=this.addeds;for(var t=0,n=e.length;t<n;t++){var i=e[t],s=i.$progressbar;if(!s.size()){continue}var o=i.$playbar,u=i.$seekbar,a=s.width();if(o.size()){var f=this.position/(i.duration||this.duration);f=f>1?1:f,o.css("width",100*f+"%"),i.$position.text(r.getTime(this.position))}}}},bind:function(t){var n=this,i=t.attr("sound_id"),s=t.attr("sound_url"),o=t.find(".player_progressbar"),u=t.find(".playBtn,.pauseBtn"),a=t.attr("sound_duration"),f=n.$last,l=n.last;u=u.size()?u:t;var c=soundManager.getSoundById("s_extend"+i);c||(c=soundManager.createSound({id:"s_extend"+i,url:s,onplay:n.events.play,onstop:n.events.stop,onpause:n.events.pause,onresume:n.events.resume,onfinish:n.events.finish,whileloading:n.events.whileloading,whileplaying:n.events.whileplaying}),c.addeds=[],c._last_position=0,c.soundId=i),c.addeds.push({$el:t,$btn:u,$progressbar:o,duration:a,$playbtn:t.find(".playBtn,.pauseBtn"),$seekbar:o.find(".player_seekbar"),$playbar:o.find(".player_playbar"),$position:t.find(".sound_position"),$wavebox:t.find(".player_wavebox"),$nonius:t.find(".player_nonius"),$noniusTime:t.find(".player_nonius_time"),$noniusCover:t.find(".player_nonius_cover")}),f&&f.attr("sound_id")==i&&l&&l.playState&&u.addClass("pauseBtn").removeClass("playBtn player-loading"),u.on("click",function(t){var r=e(this),i=r.closest("[sound_id]"),s=i.attr("sound_id"),o=n.$last,u=n.last;t.preventDefault();
if(r.is(".playBtn")){o&&o.attr("sound_id")!==s&&u&&u.playState&&(u._last_position=u.position||0,u.stop(),u.unload()),mainPlayer.pause(),c.play();return}if(r.is(".pauseBtn")){c.pause();return}return}),o.on(r.START_EV,function(e){var t=u.closest("[sound_id]"),n=e.type=="touchstart"?event.touches[0].clientX:e.clientX;if(!u.is(".pauseBtn")){u.trigger("click");return}var r=o.offset().left,i=o.width(),s=(n-r)/i,f=a*s;return c.setPosition(f),c._last_position=f,!1})}};e.fn.extensionPlayer=function(t){return this.each(function(){var t=e(this);if(t.data("is-extensionPlayer-binded")){return}t.data("is-extensionPlayer-binded",!0),i.bind(t)}),this},window.extensionPlayer=i}),define("module/player/model",["jquery","underscore","backbone","model/sound","helper","./extension"],function(e,t,n,r,i){function a(){return"localStorage" in window&&window.localStorage!==null}function f(e){if(e===undefined){return a()?parseInt(localStorage.mainplayer_volume||50,10):50}a()&&(localStorage.mainplayer_volume=e)}function c(){var e=u.sound();if(e&&e.id){var t=u.smSound();if(t&&t.playState){var n=e.id;t._last_position=t.position,t.paused||l.putInfo(n,(new Date).getTime(),"onstop"),l.postInfo(n,!0)}}}var s={STOP:0,PAUSE:1,BUFFERING:2,PLAYING:3},o=n.Model.extend({unPlayables:[],loadeds:[],_needLoop:!1,_needRandom:!1,_orderSoundIds:[],defaults:function(){return{volume:f(),soundId:"",soundIds:[],sound:{},preable:!1,nextable:!1,playable:!1,isQuerying:!1,playState:s.STOP}},volume:function(e){if(e===undefined){return this.get("volume")}this.set("volume",e),f(e),this.smSound()&&this.smSound().setVolume(e)},soundId:function(e){if(e===undefined){return this.get("soundId")}var n=this.soundIds(),r=t.indexOf(n,e);r>=0&&(this.set("soundId",e),this.set("playable",this.playable()),this.set("preable",this.preable()),this.set("nextable",this.nextable()))},soundIds:function(e){if(e===undefined){return this.get("soundIds")}this._orderSoundIds=t.uniq(e);var n=this._orderSoundIds;this.getNeedRandom()&&(n=this.getRandomSoundIds(e)),this.set("soundIds",n);var r=this.soundId();r&&(index=t.indexOf(n,r),index!==-1&&(this.set("playable",this.playable()),this.set("preable",this.preable()),this.set("nextable",this.nextable())))},isDelayed:function(e){return""+e[0]=="d"},preable:function(){var e=this.get("soundIds"),n=this.get("soundId"),r=t.indexOf(e,n);return r>0},nextable:function(){var e=this.get("soundIds"),n=this.get("soundId"),r=t.indexOf(e,n);return r<e.length-1},playable:function(){return !!this.get("soundId")},playState:function(){return this.get("playState")},getSoundInfo:function(e,t,n,i){var s=this,o=new r({id:e});o.query({async:!i,success:function(e){var n=e.toJSON();s.selectSoundId==e.id?(s.trigger("onSoundExist",n),t(n)):s.trigger("onSoundPast",n)},removed:function(){s.unPlayables.push(e),s.trigger("onSoundUnexist",e),n(e)},error:function(){n(e)}})},soundPlayable:function(n,r,s){var o=this,u=!1;r=r||e.noop,s=s||e.noop;if(t.indexOf(o.unPlayables,n)!==-1){o.trigger("onSoundUnexist",n),s(n);return}i.isIDevice&&(u=!0),this.getSoundInfo(n,r,s,u)},removeSmSound:function(e){var t=this.getSmSoundById(e);t&&t.destruct()},selectSoundId:0,select:function(n,r,i){var s=this;r=r||e.noop,this.selectSoundId=n,s.trigger("onSoundIdSelect",n),extensionPlayer.isPlaying()&&extensionPlayer.pause(),n!==this.get("soundId")&&this.pauseAndUnload(),i=i||function(e){var n=s.get("soundIds"),o=e,u=t.indexOf(n,o);s.set("soundIds",t.without(s.soundIds(),o)),u<n.length-1&&(e=n[u+1],s.select(e,r,i))},this.soundPlayable(n,function(e){s.set("soundId",n),s.set("sound",e),r(e)},function(e){i(e)})},selectPrev:function(n,r){n=n||e.noop,r=r||e.noop;if(!this.preable()){r();return}var i=this,s=this.get("soundIds"),o=this.get("soundId"),u=t.indexOf(s,o),a=s[u-1];this.select(a,function(e){n(e)},function(e){i.set("soundIds",t.without(i.soundIds(),e)),i.selectPrev(n,r)})},selectNext:function(n,r){n=n||e.noop,r=r||e.noop;if(!this.nextable()){r();return}var i=this,s=this.get("soundIds"),o=this.get("soundId"),u=t.indexOf(s,o),a=s[u+1];this.select(a,function(e){n(e)},function(e){i.set("soundIds",t.without(i.soundIds(),e)),i.selectNext(n,r)})},removeSoundId:function(e){var n=this,r=this.soundId();if(r==e){var i=this.smSound(),s=i.playState&&!i.paused;this.pauseAndUnload(),this.selectNext(function(){n.soundIds(t.without(n.soundIds(),e)),s&&n.play()},function(){n.selectPrev(function(){n.soundIds(t.without(n.soundIds(),e)),s&&n.play()},function(){n.soundIds(t.without(n.soundIds(),e)),n.set("soundId",""),n.set("sound",{})})})}},prev:function(){var e=this;this.selectPrev(function(t){e._play(t)})},next:function(){var e=this;this.selectNext(function(t){e._play(t)})},play:function(e){e=e||{};if(!soundManager.ok()){var t=this;soundManager.reboot(),soundManager.onready(function(){t._play(e)});return}this._play(e)},_play:function(e){var n=this.get("sound"),r=this.getSmSoundBySound(n);if(r.paused){r.resume()}else{if(r&&r.playState){return}var i=r._last_position||e.position;t.indexOf(this.loadeds,r.soundId)===-1&&(i=0),r.play(t.extend(e,{position:i,volume:this.volume()}))
}},pause:function(){if(!this.playable()){return}var e=this.smSound();e&&e.playState&&e.pause()},resume:function(){if(!this.playable()){return}var e=this.smSound();e&&e.playState&&e.resume()},stop:function(){if(!this.playable()){return}var e=this.smSound();e&&e.playState&&(e._last_position=0,e.paused||l.putInfo(e.soundId,(new Date).getTime(),"onstop"),e.stop(),e.unload())},pauseAndUnload:function(){if(!this.playable()){return}var e=this.smSound();e&&e.playState&&(e._last_position=e.position||0,e.paused||l.putInfo(e.soundId,(new Date).getTime(),"onstop"),e.stop(),e.unload())},isPaused:function(){return this.get("playState")===s.PAUSE},seek:function(e,t){t===undefined&&(t=this.smSound());if(!this.playable()){return}t.setPosition(e),t._last_position=e},seekPlus:function(e){var n=this.smSound(),r;e=t.extend({dif:1000},e);if(!n){return}r=n.position+e.dif,this.seek(r)},seekMinus:function(e){e=t.extend({dif:-1000},e),this.seekPlus(e)},seekInPrecent:function(e,t){var n=null;t!==undefined?n=this.getSmSoundById(t):n=this.smSound();if(!n){return}var r=n._duration_net*e;this.seek(r,n)},sound:function(){return this.get("sound")},getSmSoundById:function(e){return soundManager.getSoundById("s"+e)},smSound:function(){var e=this.get("soundId");return this.getSmSoundById(e)},getDuration:function(e){var t=soundManager.getSoundById("s"+e);if(t){return t._duration_net}},loopPlay:function(){this.setNeedLoop(!0)},orderPlay:function(){this.setNeedLoop(!1),this.setNeedRandom(!1),this.soundIds(this._orderSoundIds)},randomPlay:function(){this.setNeedLoop(!1),this.setNeedRandom(!0),this.soundIds(this._orderSoundIds)},setNeedLoop:function(e){this._needLoop=e},getNeedLoop:function(){return this._needLoop},setNeedRandom:function(e){this._needRandom=e},getNeedRandom:function(){return this._needRandom},getRandomSoundIds:function(e){var n=this.get("soundId"),r=t.shuffle(t.without(e,n)),i=t.indexOf(e,n);return n&&i>=0&&r.unshift(n),r},getSmSoundBySound:function(e){var t=this,n=e.id,r=this.getSmSoundById(n);return r||(r=soundManager.createSound({id:"s"+n,url:e.url,volume:50,onplay:function(){t.trigger("onSoundPlay",this.sound),this.isBuffering?t.set("playState",s.BUFFERING):t.set("playState",s.PLAYING),l.putInfo(this.soundId,(new Date).getTime(),"onplay"),this.started_at=(new Date).toString()},onpause:function(){t.trigger("onSoundPause",this.sound),l.putInfo(this.soundId,(new Date).getTime(),"onpause"),t.set("playState",s.PAUSE)},onresume:function(){t.trigger("onSoundResume",this.sound),l.putInfo(this.soundId,(new Date).getTime(),"onresume"),t.set("playState",s.PLAYING)},onstop:function(){t.trigger("onSoundStop",this.sound),t.set("playState",s.STOP),l.postInfo(this.soundId)},onfinish:function(){t.trigger("onSoundFinish",this.sound),l.putInfo(this.soundId,(new Date).getTime(),"onfinish"),t.set("playState",s.STOP),this._last_position=0,l.postInfo(this.soundId),t.getNeedLoop()?t.play():t.next()},onload:function(e){e?t.loadeds.push(this.soundId):t.next()},whileloading:function(){t.trigger("onSoundWhileloading",this.sound,this)},whileplaying:function(){if(this.paused){return}t.trigger("onSoundWhileplaying",this.sound,this)},onbufferchange:function(){this.isBuffering?(l.putInfo(this.soundId,(new Date).getTime(),"onbuffering"),t.set("playState",s.BUFFERING)):(l.putInfo(this.soundId,(new Date).getTime(),"onplay"),t.set("playState",s.PLAYING))}}),r.soundId=n,r._duration_net=e.duration,r._last_position=0,r.sound=e),r}},{playState:s}),u=new o,l={infos:{},initInfo:function(e){this.infos[e]={}},putInfo:function(e,t,n){this.getInfo(e)||this.initInfo(e),this.getInfo(e)[t]=n},getInfo:function(e){return this.infos[e]},postInfo:function(e,t){if(u.isDelayed(e)){return}var n=this.getInfo(e),i=this.getPlayDuration(n),s=0,o=soundManager.getSoundById("s"+e);this.initInfo(e),o&&(s=o._last_position);var a=new r({id:e});a.query({success:function(e){e.recordPlayInfo(i,s,!t)}})},getPlayDuration:function(e){var n=0,r=t.keys(e).sort(function(e,t){return e-t});return t.each(r,function(t,i){var s=e[t];(s=="onpause"||s=="onstop"||s=="onfinish"||s=="onbuffering")&&i>0&&(n+=t-r[i-1])}),n}};return i.browser.safari||i.browser.chrome?window.onbeforeunload=function(){c()}:e(window).unload(function(){c()}),o.mainPlayer=u,window.mainPlayer=u,o}),define("module/player/volume_view",["jquery","underscore","backbone","./model","plugin/jquery.easydrag"],function(e,t,n,r){var i=r.mainPlayer,s=n.View.extend({_last_volume:50,_barWidth:32,_btnGap:3,_$volume:null,_$panel:null,_$bar:null,_$muteBtn:null,events:{"click .volumePanel_unmuteBtn":"unmute","click .volumePanel_muteBtn":"mute",click:"volume"},initialize:function(){var t=this.$el,n=this;this._$volume=t.find(".volumePanel_volume"),this._$panel=t,this._$bar=t.find(".volumePanel_seekBtn"),this._$muteBtn=t.find(".volumePanel_muteBtn"),this._$bar.easydrag(!0,!1),this._$bar.beforeDrag(function(e,t){n._$bar.bindEvent()}),this._$bar.ondrag(function(t,r){var s=e(r),o=s.position(),u=o.left-n._btnGap;u<=0&&(u=0),u>=26&&(u=26),s.css({left:u+3+"px",top:"50%"}),n._$volume.width(u),i.volume(parseInt(u*100/26))
}),this._$bar.ondrop(function(e,t){n._$bar.unBindEvent()}),this.render()},render:function(){var t=i.volume(),n=26*t/100,r=!t;this._$volume.width(n),r?(this.$el.addClass("off"),this._$bar.css({left:this._barWidth/2+"px"}).dragOff(),this._$muteBtn.addClass("volumePanel_unmuteBtn").removeClass("volumePanel_muteBtn").attr("title","静音")):(this.$el.removeClass("off"),this._$bar.css({left:n+3+"px",top:"50%"}).dragOn(),this._$muteBtn.addClass("volumePanel_muteBtn").removeClass("volumePanel_unmuteBtn").attr("title","静音")),this._$volume.show(),this._$bar.show(),e(".volumePanelBox").show()},unmute:function(){i.volume(this._last_volume),this.render()},mute:function(){this._last_volume=i.volume(),i.volume(0),this.render()},volume:function(e){var t=this.$el,n=13,r=t.offset().left,s=this._barWidth,o=e.clientX-r-n,u=o/s;if(o<0||o>32){return !1}o<=3&&(u=0),o>=29&&(u=1),i.volume(parseInt(u*100)),this.render()}});return s}),define("module/wave",["jquery","underscore","backbone","helper"],function(e,t,n){var r={$parents:[],render:function(t){var n=t||{},r=n.$container,i=n.isManual||!1,s;r?s=r.find(".player_wavebox"):s=e(".player_wavebox");for(var o=0,u=s.size();o<u;o++){this._draw(s.eq(o),i)}},_draw:function(t,n){if(!n&&(t.closest(".player_progressbar").data("drawed")||t.closest(".player_progressbar").is(":hidden"))){return}var r=t.parents("[sound_id]"),i=r.attr("sound_id"),s=t.attr("sound_wave"),o=t.attr("sound_uploadId");if(!s||!o){return}t.closest(".player_progressbar").data("drawed",!0),this.$parents.push(r),e.ajax({url:s,cache:!0,dataType:"jsonp",jsonpCallback:"$.noop"})},draw:function(e,t){i.append([e,t])},drawItem:function(e,n){var r=this;t.each(this.$parents,function(t,i){if(t&&t.find("[sound_uploadId="+e+"]").size()){var s=t.find(".player_wavebox");if(s){var o=s.width(),u=s.height();if(s.find(".player_playbar,player_seekbar,player_backgroundbar").size()){var a=s.find(".player_backgroundbar"),f=s.find(".player_seekbar"),l=s.find(".player_playbar"),c=[];a.size()&&c.push({color:"#CCCCCC",container:a}),f.size()&&c.push({color:"#BBBBBB",container:f}),l.size()&&c.push({color:"#FF6600",container:l});var h=r.drawWave({data:n,width:o,height:u,isMask:!1,waves:c})}else{s.html(r.drawWave({data:n,width:o,height:u,isMask:!0,waves:[{color:"#FFFFFF",container:s}]}))}r.$parents[i]=undefined,s.closest(".player_progressbar").addClass("is-drawed")}}})},drawWave:function(e){var t=document.createElement("canvas"),n;return e.data.samples[e.data.samples.length-1]=2,t.getContext?n=this.drawWaveCanvas(e):n=this.drawWaveVml(e),n},drawWaveVml:function(e){var t=2,n=e.data,r=e.width,i=e.height,s=e.color,o=e.isMask,u=e.waves;r=r||n.width,i=i||n.height,s=s||"#fff";var a=[],f=4,l=0,c=r/n.width,h=i/n.height,p=n.samples;for(var d=0,v=r,m=v/f;d<v;d++){var g="";l=Math.round(p[Math.round(d/c)]*h),l=l<=2?l+2:l;var y=Math.ceil(i-l);o?g+=" m"+d+",-1"+" l"+d+","+y:g+=" m"+d+","+y+" l"+d+","+Math.ceil(i);var b=Math.floor(d/m);a[b]||(a[b]=""),a[b]=a[b]+g}var w=[];for(var d=0;d<u.length;d++){var E="",S=u[d].color;for(var x=0;x<f;x++){a[x]+=" e",E+='<v:shape  class="vml" style="width: '+r+"px; height: "+i+'px;" coordsize="'+[r,i].join(",")+'" '+' strokecolor="'+S+'" path="'+a[x]+'"></v:shape>'}w.push(E)}for(var d=0;d<u.length;d++){u[d].container.html(w[d])}},drawWaveCanvas:function(e){var t=2,n=e.data,r=e.width,i=e.height,s=e.color,o=e.isMask,u=e.waves;r=r||n.width,i=i||n.height,s=s||"#fff";var a=0,f=r/n.width,l=i/n.height,c=n.samples,h=[],p=[];for(var d=0,v=u.length;d<v;d++){var m=u[d],g=document.createElement("canvas"),y=g.getContext("2d");g.width=r,g.height=i,y.fillStyle=m.color,h.push(g),p.push(y)}for(var b=0,w=r;b<w;b++){a=Math.round(c[Math.round(b/f)]*l),a=a<=2?a+2:a;var E=i-a;for(var S=0,x=h.length;S<x;S++){y=p[S],o?y.fillRect(b,0,1,E):y.fillRect(b,E,1,i)}}for(var b=0;b<u.length;b++){u[b].container.html(h[b])}},release:function(){var e=this;t.each(this.$parents,function(t,n){t&&t.parents("body").size()&&(e.$parents[n]=undefined)})}},i=new helper.TaskManager(r.drawItem,function(){},r);return window.wave=r,r}),define("module/player/base",["jquery","underscore","backbone","./model","module/wave"],function(e,t,n,r,i){var s=r.mainPlayer,o=r.playState,u=n.View.extend({_isFollower:!1,_$soundIds:null,_$playbtn:null,_soundId:"",_$progressbar:null,_$commentbar:null,_$seekbar:null,_$playbar:null,_$position:null,_$wavebox:null,_$nonius:null,_$noniusTime:null,_$commentbarBtn:null,_$noniusCover:null,events:helper.getEvents({"START_EV .playBtn:not(.disabled)":"play","START_EV .pauseBtn:not(.disabled)":"pause","click .player_progressbar":"seek"}),find:function(t){var n=this.$el;return n.find(t).filter(function(t){return !extensionPlayer.isInExtension(e(this))})},initialize:function(){var e=this.$el;this._soundId=e.attr("sound_id"),this._$soundIds=e.closest("[sound_ids]"),this._$playbtn=this.find(".playBtn,.pauseBtn"),this._$progressbar=this.find(".player_progressbar"),this._$commentbar=this.find(".player_commentbar"),this._$seekbar=this._$progressbar.find(".player_seekbar"),this._$playbar=this._$progressbar.find(".player_playbar"),this._$position=this.find(".sound_position"),this._$wavebox=this.find(".player_wavebox"),this._$nonius=this.find(".player_nonius"),this._$noniusTime=this.find(".player_nonius_time"),this._$noniusCover=this.find(".player_nonius_cover"),this._$commentbarBtn=this.find(".player_commentbarBtn"),this._$seekbar.size()&&t.extend(this.events,{"mousemove .player_progressbar":"onSeekbarMousemove"}),this._$nonius.size()&&t.extend(this.events,{"mouseenter .player_progressbar":"onSeekbarMouseenter","mouseleave .player_progressbar":"onSeekbarMouseleave"}),this._$progressbar.size()&&s.on("onSoundWhileplaying",this.onSoundWhileplaying,this),this._$commentbarBtn.size()&&t.extend(this.events,{"click .player_commentbarBtn":"onCommentbarBtnClick"}),s.on("change:playState",this.rendPlaybtn,this),s.on("onSoundUnexist",this.onSoundUnexist,this),s.on("onSoundIdSelect",this.onSoundIdSelect,this),s.on("onSoundPlay",this.onSoundPlay,this),s.on("onSoundPause",this.onSoundPause,this),s.on("onSoundResume",this.onSoundResume,this),s.on("onSoundStop",this.onSoundStop,this),s.on("onSoundFinish",this.onSoundFinish,this),s.on("onSoundPast",this.onSoundPast,this),s.soundId()==this._soundId&&this.rendPlaybtn()
},isOnPlaying:function(){return this._$playbtn.is(".pauseBtn")},onCommentbarBtnClick:function(){this.$el.toggleClass("is-player-commentbarHidden",!this.$el.is(".is-player-commentbarHidden")),i.render({$container:this.$el,isManual:!0})},seekbarMouseenterTimeoutId:null,onSeekbarMouseenter:function(){var e=this;e.seekbarMouseenterTimeoutId&&clearTimeout(e.seekbarMouseenterTimeoutId),e.seekbarMouseenterTimeoutId=setTimeout(function(){e.isOnPlaying()&&e._$nonius.fadeIn(200)},200)},onSeekbarMouseleave:function(){clearTimeout(this.onSeekbarMousemoveTimeoutId),this.seekbarMouseenterTimeoutId&&clearTimeout(this.seekbarMouseenterTimeoutId),this.isOnPlaying()&&this._$nonius.hide()},onSoundIdSelect:function(e){if(e!=this._soundId){return}this.$el.trigger("onSoundIdSelect",[e])},onSoundPlay:function(e){if(s.soundId()!=this._soundId){return}this.$el.trigger("onSoundPlay",[e])},onSoundPause:function(e){if(s.soundId()!=this._soundId){return}this.$el.trigger("onSoundPause",[e])},onSoundResume:function(e){if(s.soundId()!=this._soundId){return}this.$el.trigger("onSoundResume",[e])},onSoundStop:function(e){if(s.soundId()!=this._soundId){return}this.$el.trigger("onSoundStop",[e])},onSoundFinish:function(e){if(s.soundId()!=this._soundId){return}this._$playbar.size()&&(this._$playbar.width(0),this._$position.text("00:00"),this._$nonius.hide()),this.$el.trigger("onSoundFinish",[e])},getSoundId:function(){return this._soundId},render:function(){},seek:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}if(!this.isOnPlaying()){this.play();return}var n=this._$progressbar,r=this._soundId,i=n.offset().left,o=n.width(),u=(t.clientX-i)/o;return s.seekInPrecent(u,r),!1},_lastLeft:0,onSeekbarMousemoveTimeoutId:-1,onSeekbarMousemove:function(e){var t=this;clearTimeout(this.onSeekbarMousemoveTimeoutId),this.onSeekbarMousemoveTimeoutId=setTimeout(function(){var n=t._$progressbar,r=e.clientX-n.offset().left,i=n.width(),o=t._soundId;if(Math.abs(r-t._lastLeft)<1){return !1}if(o===undefined){return}if(!t.isOnPlaying()){return}if(r<0||r>i){return}var u=38;t._$nonius.is(".is-long")&&(u=48),r<u/2-4?t._$noniusTime.css("left",-r-4):r>i-(u/2-4)?t._$noniusTime.css("left",i-r+4-u):t._$noniusTime.css("left",-u/2),t._$nonius.css("left",r),t._$noniusCover.css({width:r+"px",left:-r+"px"}),s.getSoundInfo(o,function(e){var n=e.duration,s=r/i*n,o=3600000;n>o&&t._$nonius.toggleClass("is-long",s>=o),t._$noniusTime.text(helper.getTime(s))})},0)},onSoundUnexist:function(e){if(e!=this._soundId){return !1}var t=this.$el;return this._$playbtn.addClass("disabled playBtn").removeClass("pauseBtn player-loading").attr("title","无法播放").css({cursor:"default"}),this._$commentbar.addClass("disabled"),t.find(".middlePlayer").addClass("disabled").attr("title","无法播放"),t.find(".sound_bottom").html(""),!0},onSoundWhileplaying:function(e,t){if(!this.isWorking()){return !1}if(helper.isWindowBusy()){return !1}var n=this._$progressbar;if(!n.size()){return !1}var r=this._$playbar,i=this._$seekbar,s=n.width();if(r.size()){var o=t.position/t._duration_net;o=o>1?1:o,r.css("width",100*o+"%"),this._$position.text(helper.getTime(t.position))}if(i.size()){var o=t.bytesLoaded/t.bytesTotal;o=o>1?1:o,i.css("width",100*o+"%")}return !0},isWorking:function(){var e=s.soundId();if(e==this._soundId){return !0}},rendPlaybtn:function(){if(!this.isWorking()){return !1}var e=this._$playbtn,t=s.playState();return o.STOP==t||o.PAUSE==t?(e.addClass("playBtn").removeClass("pauseBtn player-loading").attr("title","播放"),this._$progressbar.attr("title","点击播放")):o.PLAYING==t?e.addClass("pauseBtn").removeClass("playBtn player-loading").attr("title","暂停"):o.BUFFERING==t&&e.addClass("player-loading").removeClass("playBtn pauseBtn").attr("title","加载中"),!0},onSoundPast:function(e){if(e.id!=this._soundId){return !1}var t=this._$playbtn;return t.addClass("playBtn").removeClass("pauseBtn player-loading").attr("title","播放"),this._$progressbar.attr("title","点击播放"),!0},play:function(t){var n=this,r=this.$el,i=r.attr("sound_id"),o=[];if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}r.is("[sound_restart=true]")||(this._$playbtn.addClass("player-loading").removeClass("playBtn pauseBtn").attr("title","加载中"),this._$progressbar.attr("title","")),e(".j-player-soundIdsWorking").removeClass("j-player-soundIdsWorking"),this._$soundIds.size()?o=this._$soundIds.addClass("j-player-soundIdsWorking").attr("sound_ids").split(","):o=[i],s.soundIds(o),s.select(i,function(e){var t=n.getPlayOptions();s.play(t)})},getPlayOptions:function(){var e={};return this.$el.is("[sound_restart=true]")&&(s.stop({position:0}),e.position=0),e},pause:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}this._$playbtn.addClass("playBtn").removeClass("pauseBtn player-loading").attr("title","播放"),s.pause()},release:function(){this.$el.off(),this.undelegateEvents(),s.off(null,null,this)}});return e("body").keydown(function(e){var t=e.target.tagName;if(t=="INPUT"||t=="TEXTAREA"){return}if(e.keyCode===32){return s.isPaused()?s.play():s.pause(),!1
}if(e.keyCode===39){return s.seekPlus(),!1}if(e.keyCode===37){return s.seekMinus(),!1}if(e.keyCode===40){return s.next(),!1}if(e.keyCode===38){return s.prev(),!1}}),u}),define("module/player/extend/info",["jquery","underscore","backbone","helper","../model","../base"],function(e,t,n,r,i,s){var o=i.mainPlayer,u=t.template(['<div class="line"></div>','<div class="infobox-content">','<%if(soundfaceMiddle.indexOf("/css/")==-1){%>','<img style="cursor: pointer;" popsrc="<%=coverUrl%>" alt="简介" src="<%= soundfaceMiddle?(soundfaceMiddle):(config.STATIC_ROOT+\'/css/img/common/track_180.jpg\')%>">',"<%}else{%>","<img src=\"<%= soundfaceMiddle?(soundfaceMiddle):(config.STATIC_ROOT+'/css/img/common/track_180.jpg')%>\">","<%}%>","<%if(info){%>",'<p><%=info%><%if(haveMoreIntro){%>...  (<a class="c2" href="<%=(helper.isLogin()?"/#/":"/") + uid + "/sound/" + id+"/"%>">更多</a>)<%}%></p>',"<%}%>","</div>"].join("")),a=s.prototype,f=t.clone(a);return t.extend(a,{_$playCount:null,_$info:null,events:t.extend({"click .info":"showInfo"},f.events),initialize:function(){var e=this.$el;f.initialize.apply(this,arguments),this._$info=this.find(".info"),this._$playCount=this.find(".sound_playcount"),this._$playCount.size()&&o.on("change:sound",this.onChangeSound,this)},onChangeSound:function(e){if(this._soundId!=e.soundId()){return}var t=parseInt(this._$playCount.eq(0).text(),10)+1,n=this._$playCount.eq(0).text().replace(/\d*/,t);this._$playCount.text(n).attr("title",t+"次播放")},showInfo:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}var n=this.$el,r=this._soundId;n.is(".open")?n.removeClass("open"):o.getSoundInfo(r,function(e){var t=n.find(".infobox");n.addClass("open"),t.html(u(e))})}}),s}),define("module/player/extend/like",["jquery","underscore","backbone","helper","model/sound","../model","../base","plugin/dialog"],function(e,t,n,r,i,s,o,u){var a=o.prototype,f=t.clone(a);return t.extend(a,{_$likebtn:null,_$likeCount:null,locked:!1,events:t.extend({"click .likeBtn:not(.is-sound-liked)":"like","click .likeBtn.is-sound-liked":"unlike"},f.events),initialize:function(){var e=this.$el;f.initialize.apply(this,arguments),this._$likebtn=this.find(".likeBtn"),this._$likeCount=this._$likebtn.find(".count")},like:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}var n=this,r=this._soundId,s=0,o=new i({id:r,isFavorited:!1});n.locked||(n.locked=!0,o.like(function(){o.set("id",r);var t=e("[sound_id='"+r+"'] .likeBtn .count:eq(0)").text()*1;++t,n._$likebtn.addClass("is-sound-liked"),n._$likeCount.text(t).show(),n.doShowCartoon(!0)},function(e,t){u.alert(t.msg),n.locked=!1}))},unlike:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}var n=this,r=this._soundId,s=0,o=new i({id:r,isFavorited:!0});n.locked||o.like(function(){o.set("id",r);var t=e("[sound_id='"+r+"'] .likeBtn .count:eq(0)").text()*1;--t,n._$likeCount.text(t),n._$likebtn.removeClass("is-sound-liked"),n.doShowCartoon(!1)},function(e,t){u.alert(t.msg),n.locked=!1})},doShowCartoon:function(t){var n=e("<div><span></span></div>"),r=this._$likebtn.offset(),i=this;i.locked=!1,n.addClass("likeBtnDynamic"),t&&n.addClass("liked"),n.css({left:r.left,top:r.top}),e(document.body).append(n),n.animate({top:r.top-25,opacity:"toggle"},1500,function(){n.remove()}),i.locked=!1}}),o}),define("model/user",["jquery","underscore","backbone","./cache"],function(e,t,n,r){var i=n.Model.extend({defaults:{id:"",nickname:"",logoPic:"",email:"",account:null,mobile:null,isVerified:!1,isCompleted:!0,isVEmail:!1,isVMobile:!1,isRobot:!1,province:"",city:"",town:null,country:"",personalSignature:"",ptitle:null,isGuideCompleted:!0,taskCompleteProfile:!0,taskFollow:!0,taskDownloadApp:!0,taskEmail:!1,vCompany:null,vTags:null,vCategoryId:null,deviceToken:null,isLoginBan:!1,isDeleted:!1,registerCategory:"",personDescribe:null,guidePlayPanel:!0,guideVoicePanel:!0,guideSharePanel:!0,createdTime:"",loginBanStart:null,loginBanEnd:null,isNotFollowing:!1,beFollowed:!1,tracksCount:0,followingsCount:0,followersCount:0,avatarUrl60:"",ids:[]},fetch:function(e){e=e||{};var r=this.id||"n"+this.get("nickname");t.extend(e,{url:"/"+r+"/card"}),n.Model.prototype.fetch.call(this,e)},parse:function(e){return{id:e.uid,nickname:e.nickname,logoPic:e.logoPic,email:e.email,account:e.account,mobile:e.mobile,isVerified:e.isVerified,isCompleted:e.isCompleted,isVEmail:e.isVEmail,isVMobile:e.isVMobile,isRobot:e.isRobot,province:e.province,city:e.city,town:e.town,country:e.country,personalSignature:e.personalSignature,ptitle:e.ptitle,isGuideCompleted:e.isGuideCompleted,taskCompleteProfile:e.taskCompleteProfile,taskFollow:e.taskFollow,taskDownloadApp:e.taskDownloadApp,taskEmail:e.taskEmail,vCompany:e.vCompany,vTags:e.vTags,vCategoryId:e.vCategoryId,deviceToken:e.deviceToken,isLoginBan:e.isLoginBan,isDeleted:e.isDeleted,registerCategory:e.registerCategory,personDescribe:e.personDescribe,guidePlayPanel:e.guidePlayPanel,guideVoicePanel:e.guideVoicePanel,guideSharePanel:e.guideSharePanel,createdTime:e.createdTime,loginBanStart:e.loginBanStart,loginBanEnd:e.loginBanEnd,isNotFollowing:e.is_not_following,beFollowed:e.be_followed,tracksCount:e.tracks_count,followingsCount:e.followings_count,followersCount:e.followers_count,avatarUrl60:e.avatar_url_60}
},doFollow:function(t,n){var r=this,i="",s=r.get("id");t=t||e.noop,n=n||e.noop,i=r.get("isNotFollowing")?"create":"destroy",r.save(r.toJSON(),{url:"/followings/"+i,type:"post",dataType:"json",parse:!1,data:{following_uid:s},success:function(e,r,i){e.set("id",s),r.res!==!1?t(e,r,i):n(e,r,i)},error:function(e,t,r){n(e,null,r)}})},doMutiFollow:function(t,n,r){var i=this;t=t||e.noop,r=r||e.noop,n=r||e.noop,i.save({},{url:"/followings/group_create",type:"post",dataType:"json",data:{list:i.get("ids").join(",")},success:function(e,s,o){if(s["message"]=="create"){var u=i.cache.getCachedByIds(i.get("ids"));u&&u.models.length&&u.each(function(){var e=this;e.set("isNotFollowing",!e.get("isNotFollowing"))}),t(e,s,o)}else{s["message"]=="login"?n(e,s,o):r(e,s,o)}}})},doRemoveFans:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/followers/destroy",type:"post",dataType:"json",data:{uid:r.get("id")},success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},doChangeDes:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/passport/modifySignature",type:"post",dataType:"json",data:{personalSignature:r.get("personalSignature")},success:function(e,r,i){r.success===!0?t(e,r,i):n(e,r,i)}})},doChangeArea:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/passport/profile/location/save",type:"post",dataType:"json",data:{province:r.get("province"),city:r.get("city")},success:function(e,r,i){r.success===!0?t(e,r,i):n(e,r,i)}})}},{cache:new r({keys:["nickname"]})});return i}),define("plugin/jquery.placeholder",["jquery"],function(e){return e.fn.placeholder=function(t){var n={focusClass:"input_1",label:"span",text:""};return t=e.extend(n,t),this.each(function(){var n=e(this),r=n.find("input, textarea"),i=n.find(t.label);if(n.attr("is-placeholder")){return !0}n.attr("is-placeholder",!0),t.text&&i.text(t.text),n.click(function(){r.focus()});var s=function(){r.val()?i.hide():i.show()};r.bind({blur:function(){s(),n.removeClass(t.focusClass)},focus:function(){i.hide(),n.addClass(t.focusClass)}}),setTimeout(function(){s()},150);var o=function(){i.hide(),n.addClass(t.focusClass)};r.bind("keypress keydown keyup mousedown",o)}),this},e}),define("plugin/placeholder",["jquery","plugin/jquery.placeholder"],function(e){return function(t){window.console&&console.log("plugin/placeholder--->plugin/jquery.placeholder"),e(t).placeholder()}}),define("module/dialogs/city_data",[],function(){var e=[{name:"北京",has_child:!0,id:"108288",habitable:!0,children:[{population:0,id:"128519",name:"东城区",habitable:!1},{population:0,id:"128520",name:"西城区",habitable:!1},{population:0,id:"128521",name:"崇文区",habitable:!1},{population:0,id:"128522",name:"宣武区",habitable:!1},{population:0,id:"128523",name:"朝阳区",habitable:!1},{population:0,id:"128524",name:"丰台区",habitable:!1},{population:0,id:"128525",name:"石景山区",habitable:!1},{population:0,id:"128526",name:"海淀区",habitable:!1},{population:0,id:"128527",name:"门头沟区",habitable:!1},{population:0,id:"128528",name:"房山区",habitable:!1},{population:0,id:"128529",name:"通州区",habitable:!1},{population:0,id:"128530",name:"顺义区",habitable:!1},{population:0,id:"128531",name:"昌平区",habitable:!1},{population:0,id:"128532",name:"大兴区",habitable:!1},{population:0,id:"128533",name:"怀柔区",habitable:!1},{population:0,id:"128534",name:"平谷区",habitable:!1},{population:0,id:"128535",name:"密云县",habitable:!1},{population:0,id:"128536",name:"延庆县",habitable:!1}],population:1604009},{name:"上海",has_child:!0,id:"108296",habitable:!0,children:[{population:0,id:"129242",name:"黄浦区",habitable:!1},{population:0,id:"129243",name:"卢湾区",habitable:!1},{population:0,id:"129244",name:"徐汇区",habitable:!1},{population:0,id:"129245",name:"长宁区",habitable:!1},{population:0,id:"129246",name:"静安区",habitable:!1},{population:0,id:"129247",name:"普陀区",habitable:!1},{population:0,id:"129248",name:"闸北区",habitable:!1},{population:0,id:"129249",name:"虹口区",habitable:!1},{population:0,id:"129250",name:"杨浦区",habitable:!1},{population:0,id:"129251",name:"闵行区",habitable:!1},{population:0,id:"129252",name:"宝山区",habitable:!1},{population:0,id:"129253",name:"嘉定区",habitable:!1},{population:0,id:"129254",name:"浦东新区",habitable:!1},{population:0,id:"129255",name:"金山区",habitable:!1},{population:0,id:"129256",name:"松江区",habitable:!1},{population:0,id:"129257",name:"青浦区",habitable:!1},{population:0,id:"129258",name:"南汇区",habitable:!1},{population:0,id:"129259",name:"奉贤区",habitable:!1},{population:0,id:"129260",name:"崇明县",habitable:!1}],population:963775},{name:"深圳",has_child:!0,id:"118282",habitable:!0,children:[{population:0,id:"130288",name:"罗湖区",habitable:!1},{population:0,id:"130289",name:"福田区",habitable:!1},{population:0,id:"130290",name:"南山区",habitable:!1},{population:0,id:"130291",name:"宝安区",habitable:!1},{population:0,id:"130292",name:"龙岗区",habitable:!1},{population:0,id:"130293",name:"盐田区",habitable:!1}],population:438850},{name:"重庆",has_child:!0,id:"108309",habitable:!0,children:[{population:0,id:"130519",name:"万州区",habitable:!1},{population:0,id:"130520",name:"涪陵区",habitable:!1},{population:0,id:"130521",name:"渝中区",habitable:!1},{population:0,id:"130522",name:"大渡口区",habitable:!1},{population:0,id:"130523",name:"江北区",habitable:!1},{population:0,id:"130524",name:"沙坪坝区",habitable:!1},{population:0,id:"130525",name:"九龙坡区",habitable:!1},{population:0,id:"130526",name:"南岸区",habitable:!1},{population:0,id:"130527",name:"北碚区",habitable:!1},{population:0,id:"130528",name:"万盛区",habitable:!1},{population:0,id:"130529",name:"双桥区",habitable:!1},{population:0,id:"130530",name:"渝北区",habitable:!1},{population:0,id:"130531",name:"巴南区",habitable:!1},{population:0,id:"130532",name:"黔江区",habitable:!1},{population:0,id:"130533",name:"长寿区",habitable:!1},{population:0,id:"130534",name:"江津区",habitable:!1},{population:0,id:"130535",name:"合川区",habitable:!1},{population:0,id:"130536",name:"永川区",habitable:!1},{population:0,id:"130537",name:"南川区",habitable:!1},{population:0,id:"130538",name:"綦江县",habitable:!1},{population:0,id:"130539",name:"潼南县",habitable:!1},{population:0,id:"130540",name:"铜梁县",habitable:!1},{population:0,id:"130541",name:"大足县",habitable:!1},{population:0,id:"130542",name:"荣昌县",habitable:!1},{population:0,id:"130543",name:"璧山县",habitable:!1},{population:0,id:"130544",name:"梁平县",habitable:!1},{population:0,id:"130545",name:"城口县",habitable:!1},{population:0,id:"130546",name:"丰都县",habitable:!1},{population:0,id:"130547",name:"垫江县",habitable:!1},{population:0,id:"130548",name:"武隆县",habitable:!1},{population:0,id:"130549",name:"忠县",habitable:!1},{population:0,id:"130550",name:"开县",habitable:!1},{population:0,id:"130551",name:"云阳县",habitable:!1},{population:0,id:"130552",name:"奉节县",habitable:!1},{population:0,id:"130553",name:"巫山县",habitable:!1},{population:0,id:"130554",name:"巫溪县",habitable:!1},{population:0,id:"130555",name:"石柱",habitable:!1},{population:0,id:"130556",name:"秀山",habitable:!1},{population:0,id:"130557",name:"酉阳",habitable:!1},{population:0,id:"130558",name:"彭水",habitable:!1}],population:258584},{name:"天津",has_child:!0,id:"108289",habitable:!0,children:[{population:0,id:"128537",name:"和平区",habitable:!1},{population:0,id:"128538",name:"河东区",habitable:!1},{population:0,id:"128539",name:"河西区",habitable:!1},{population:0,id:"128540",name:"南开区",habitable:!1},{population:0,id:"128541",name:"河北区",habitable:!1},{population:0,id:"128542",name:"红桥区",habitable:!1},{population:0,id:"128543",name:"塘沽区",habitable:!1},{population:0,id:"128544",name:"汉沽区",habitable:!1},{population:0,id:"128545",name:"大港区",habitable:!1},{population:0,id:"128546",name:"东丽区",habitable:!1},{population:0,id:"128547",name:"西青区",habitable:!1},{population:0,id:"128548",name:"津南区",habitable:!1},{population:0,id:"128549",name:"北辰区",habitable:!1},{population:0,id:"128550",name:"武清区",habitable:!1},{population:0,id:"128551",name:"宝坻区",habitable:!1},{population:0,id:"128552",name:"宁河县",habitable:!1},{population:0,id:"128553",name:"静海县",habitable:!1},{population:0,id:"128554",name:"蓟县",habitable:!1},{population:0,id:"131436",name:"滨海新区",habitable:!1},{population:0,id:"131437",name:"保税区",habitable:!1}],population:250332}],t=[{name:"广东",has_child:!0,id:"108306",habitable:!1,children:[{population:696157,id:"118281",name:"广州",habitable:!0},{population:433868,id:"118282",name:"深圳",habitable:!0},{population:88957,id:"118297",name:"东莞",habitable:!0},{population:69691,id:"118286",name:"佛山",habitable:!0},{population:53720,id:"118284",name:"汕头",habitable:!0},{population:45549,id:"118283",name:"珠海",habitable:!0},{population:36161,id:"118291",name:"惠州",habitable:!0},{population:34733,id:"118298",name:"中山",habitable:!0},{population:33828,id:"118287",name:"江门",habitable:!0},{population:26297,id:"118300",name:"揭阳",habitable:!0},{population:25164,id:"118288",name:"湛江",habitable:!0},{population:20621,id:"118289",name:"茂名",habitable:!0},{population:20093,id:"118299",name:"潮州",habitable:!0},{population:18854,id:"118292",name:"梅州",habitable:!0},{population:17016,id:"118290",name:"肇庆",habitable:!0},{population:14455,id:"118285",name:"韶关",habitable:!0},{population:13321,id:"118296",name:"清远",habitable:!0},{population:12496,id:"118293",name:"汕尾",habitable:!0},{population:12285,id:"118294",name:"河源",habitable:!0},{population:10120,id:"118295",name:"阳江",habitable:!0},{population:8467,id:"118301",name:"云浮",habitable:!0},{population:1675,id:"128493",name:"开平",habitable:!0}],population:1657472},{name:"北京",has_child:!0,id:"108288",habitable:!0,children:[{population:0,id:"128519",name:"东城区",habitable:!1},{population:0,id:"128520",name:"西城区",habitable:!1},{population:0,id:"128521",name:"崇文区",habitable:!1},{population:0,id:"128522",name:"宣武区",habitable:!1},{population:0,id:"128523",name:"朝阳区",habitable:!1},{population:0,id:"128524",name:"丰台区",habitable:!1},{population:0,id:"128525",name:"石景山区",habitable:!1},{population:0,id:"128526",name:"海淀区",habitable:!1},{population:0,id:"128527",name:"门头沟区",habitable:!1},{population:0,id:"128528",name:"房山区",habitable:!1},{population:0,id:"128529",name:"通州区",habitable:!1},{population:0,id:"128530",name:"顺义区",habitable:!1},{population:0,id:"128531",name:"昌平区",habitable:!1},{population:0,id:"128532",name:"大兴区",habitable:!1},{population:0,id:"128533",name:"怀柔区",habitable:!1},{population:0,id:"128534",name:"平谷区",habitable:!1},{population:0,id:"128535",name:"密云县",habitable:!1},{population:0,id:"128536",name:"延庆县",habitable:!1}],population:1546204},{name:"上海",has_child:!0,id:"108296",habitable:!0,children:[{population:0,id:"129242",name:"黄浦区",habitable:!1},{population:0,id:"129243",name:"卢湾区",habitable:!1},{population:0,id:"129244",name:"徐汇区",habitable:!1},{population:0,id:"129245",name:"长宁区",habitable:!1},{population:0,id:"129246",name:"静安区",habitable:!1},{population:0,id:"129247",name:"普陀区",habitable:!1},{population:0,id:"129248",name:"闸北区",habitable:!1},{population:0,id:"129249",name:"虹口区",habitable:!1},{population:0,id:"129250",name:"杨浦区",habitable:!1},{population:0,id:"129251",name:"闵行区",habitable:!1},{population:0,id:"129252",name:"宝山区",habitable:!1},{population:0,id:"129253",name:"嘉定区",habitable:!1},{population:0,id:"129254",name:"浦东新区",habitable:!1},{population:0,id:"129255",name:"金山区",habitable:!1},{population:0,id:"129256",name:"松江区",habitable:!1},{population:0,id:"129257",name:"青浦区",habitable:!1},{population:0,id:"129258",name:"南汇区",habitable:!1},{population:0,id:"129259",name:"奉贤区",habitable:!1},{population:0,id:"129260",name:"崇明县",habitable:!1}],population:929103},{name:"江苏",has_child:!0,id:"108297",habitable:!1,children:[{population:334289,id:"118159",name:"南京",habitable:!0},{population:169621,id:"118163",name:"苏州",habitable:!0},{population:97963,id:"118160",name:"无锡",habitable:!0},{population:59563,id:"118162",name:"常州",habitable:!0},{population:58255,id:"118161",name:"徐州",habitable:!0},{population:41965,id:"118164",name:"南通",habitable:!0},{population:35019,id:"118168",name:"扬州",habitable:!0},{population:26666,id:"118167",name:"盐城",habitable:!0},{population:24828,id:"118165",name:"连云港",habitable:!0},{population:22721,id:"118169",name:"镇江",habitable:!0},{population:22178,id:"118170",name:"泰州",habitable:!0},{population:19969,id:"118166",name:"淮安",habitable:!0},{population:14187,id:"118171",name:"宿迁",habitable:!0},{population:5351,id:"131411",name:"昆山",habitable:!0},{population:3394,id:"131413",name:"常熟",habitable:!0},{population:1451,id:"131414",name:"吴江",habitable:!0},{population:1156,id:"128505",name:"海安",habitable:!0},{population:1155,id:"131482",name:"张家港",habitable:!0}],population:917372},{name:"浙江",has_child:!0,id:"108298",habitable:!1,children:[{population:376145,id:"118172",name:"杭州",habitable:!0},{population:169679,id:"118174",name:"温州",habitable:!0},{population:114676,id:"118173",name:"宁波",habitable:!0},{population:60033,id:"118181",name:"台州",habitable:!0},{population:57370,id:"118178",name:"金华",habitable:!0},{population:44550,id:"118175",name:"嘉兴",habitable:!0},{population:42982,id:"118177",name:"绍兴",habitable:!0},{population:21757,id:"118176",name:"湖州",habitable:!0},{population:16342,id:"118182",name:"丽水",habitable:!0},{population:13001,id:"118179",name:"衢州",habitable:!0},{population:12474,id:"118180",name:"舟山",habitable:!0}],population:909356},{name:"湖北",has_child:!0,id:"108304",habitable:!1,children:[{population:471150,id:"118254",name:"武汉",habitable:!0},{population:25390,id:"118259",name:"宜昌",habitable:!0},{population:21305,id:"118258",name:"荆州",habitable:!0},{population:20511,id:"118256",name:"襄樊",habitable:!0},{population:14865,id:"118257",name:"十堰",habitable:!0},{population:14439,id:"118263",name:"黄冈",habitable:!0},{population:12940,id:"118255",name:"黄石",habitable:!0},{population:12923,id:"118262",name:"孝感",habitable:!0},{population:10007,id:"118260",name:"荆门",habitable:!0},{population:8847,id:"118264",name:"咸宁",habitable:!0},{population:8401,id:"118266",name:"恩施",habitable:!0},{population:5747,id:"118265",name:"随州",habitable:!0},{population:5503,id:"118261",name:"鄂州",habitable:!0},{population:5305,id:"128465",name:"仙桃",habitable:!0},{population:3806,id:"128464",name:"天门",habitable:!0},{population:3540,id:"128466",name:"潜江",habitable:!0},{population:1100,id:"130143",name:"神农架林区",habitable:!0}],population:633074},{name:"四川",has_child:!0,id:"108310",habitable:!1,children:[{population:417894,id:"118318",name:"成都",habitable:!0},{population:25776,id:"118323",name:"绵阳",habitable:!0},{population:18713,id:"118328",name:"南充",habitable:!0},{population:14934,id:"118322",name:"德阳",habitable:!0},{population:13978,id:"118331",name:"达州",habitable:!0},{population:13505,id:"118327",name:"乐山",habitable:!0},{population:13251,id:"118329",name:"宜宾",habitable:!0},{population:11047,id:"118326",name:"内江",habitable:!0},{population:10895,id:"118319",name:"自贡",habitable:!0},{population:10615,id:"118321",name:"泸州",habitable:!0},{population:9588,id:"118325",name:"遂宁",habitable:!0},{population:8639,id:"118330",name:"广安",habitable:!0},{population:7635,id:"118332",name:"眉山",habitable:!0},{population:7325,id:"118324",name:"广元",habitable:!0},{population:6973,id:"118320",name:"攀枝花",habitable:!0},{population:6806,id:"118335",name:"资阳",habitable:!0},{population:5726,id:"118334",name:"巴中",habitable:!0},{population:5650,id:"118338",name:"凉山",habitable:!0},{population:5594,id:"118333",name:"雅安",habitable:!0},{population:2463,id:"118336",name:"阿坝",habitable:!0},{population:1706,id:"118337",name:"甘孜",habitable:!0}],population:633048},{name:"山东",has_child:!0,id:"108302",habitable:!1,children:[{population:144708,id:"118221",name:"青岛",habitable:!0},{population:140182,id:"118220",name:"济南",habitable:!0},{population:54419,id:"118226",name:"烟台",habitable:!0},{population:39890,id:"118225",name:"潍坊",habitable:!0},{population:35098,id:"118232",name:"临沂",habitable:!0},{population:33734,id:"118222",name:"淄博",habitable:!0},{population:31868,id:"118228",name:"济宁",habitable:!0},{population:23475,id:"118227",name:"威海",habitable:!0},{population:20393,id:"118229",name:"泰安",habitable:!0},{population:15799,id:"118234",name:"聊城",habitable:!0},{population:15559,id:"118223",name:"枣庄",habitable:!0},{population:15312,id:"118224",name:"东营",habitable:!0},{population:15065,id:"118236",name:"菏泽",habitable:!0},{population:13904,id:"118230",name:"日照",habitable:!0},{population:12469,id:"118233",name:"德州",habitable:!0},{population:10509,id:"118235",name:"滨州",habitable:!0},{population:5243,id:"118231",name:"莱芜",habitable:!0}],population:629980},{name:"福建",has_child:!0,id:"108300",habitable:!1,children:[{population:195593,id:"118200",name:"福州",habitable:!0},{population:136826,id:"118201",name:"厦门",habitable:!0},{population:92803,id:"118204",name:"泉州",habitable:!0},{population:23231,id:"118205",name:"漳州",habitable:!0},{population:22003,id:"118202",name:"莆田",habitable:!0},{population:19161,id:"118208",name:"宁德",habitable:!0},{population:17854,id:"118203",name:"三明",habitable:!0},{population:16999,id:"118207",name:"龙岩",habitable:!0},{population:15106,id:"118206",name:"南平",habitable:!0}],population:529836},{name:"河南",has_child:!0,id:"108303",habitable:!1,children:[{population:259891,id:"118237",name:"郑州",habitable:!0},{population:44848,id:"118239",name:"洛阳",habitable:!0},{population:23372,id:"118243",name:"新乡",habitable:!0},{population:21367,id:"118249",name:"南阳",habitable:!0},{population:18312,id:"118244",name:"安阳",habitable:!0},{population:18307,id:"118251",name:"信阳",habitable:!0},{population:18046,id:"118240",name:"平顶山",habitable:!0},{population:17147,id:"118241",name:"焦作",habitable:!0},{population:15013,id:"118238",name:"开封",habitable:!0},{population:14957,id:"118250",name:"商丘",habitable:!0},{population:14720,id:"118252",name:"周口",habitable:!0},{population:14684,id:"118246",name:"许昌",habitable:!0},{population:11223,id:"118253",name:"驻马店",habitable:!0},{population:10958,id:"118245",name:"濮阳",habitable:!0},{population:9126,id:"118247",name:"漯河",habitable:!0},{population:9077,id:"118248",name:"三门峡",habitable:!0},{population:5248,id:"118242",name:"鹤壁",habitable:!0},{population:4028,id:"128517",name:"济源",habitable:!0}],population:520329},{name:"辽宁",has_child:!0,id:"108293",habitable:!1,children:[{population:167632,id:"118123",name:"沈阳",habitable:!0},{population:138130,id:"118124",name:"大连",habitable:!0},{population:25924,id:"118125",name:"鞍山",habitable:!0},{population:20497,id:"118135",name:"朝阳",habitable:!0},{population:18321,id:"118129",name:"锦州",habitable:!0},{population:15186,id:"118130",name:"营口",habitable:!0},{population:14679,id:"118126",name:"抚顺",habitable:!0},{population:12480,id:"118128",name:"丹东",habitable:!0},{population:12042,id:"118133",name:"盘锦",habitable:!0},{population:11883,id:"118136",name:"葫芦岛",habitable:!0},{population:10742,id:"118132",name:"辽阳",habitable:!0},{population:10640,id:"118134",name:"铁岭",habitable:!0},{population:9982,id:"118127",name:"本溪",habitable:!0},{population:9181,id:"118131",name:"阜新",habitable:!0}],population:469786},{name:"陕西",has_child:!0,id:"108314",habitable:!1,children:[{population:334496,id:"118371",name:"西安",habitable:!0},{population:15788,id:"118373",name:"宝鸡",habitable:!0},{population:15727,id:"118374",name:"咸阳",habitable:!0},{population:14109,id:"118375",name:"渭南",habitable:!0},{population:13120,id:"118378",name:"榆林",habitable:!0},{population:11230,id:"118377",name:"汉中",habitable:!0},{population:9975,id:"118376",name:"延安",habitable:!0},{population:7584,id:"118379",name:"安康",habitable:!0},{population:5029,id:"118380",name:"商洛",habitable:!0},{population:4072,id:"118372",name:"铜川",habitable:!0},{population:1184,id:"131409",name:"杨凌",habitable:!0}],population:423191},{name:"湖南",has_child:!0,id:"108305",habitable:!1,children:[{population:262472,id:"118267",name:"长沙",habitable:!0},{population:20858,id:"118270",name:"衡阳",habitable:!0},{population:19339,id:"118268",name:"株洲",habitable:!0},{population:16714,id:"118269",name:"湘潭",habitable:!0},{population:16051,id:"118273",name:"常德",habitable:!0},{population:15268,id:"118272",name:"岳阳",habitable:!0},{population:13295,id:"118276",name:"郴州",habitable:!0},{population:12883,id:"118271",name:"邵阳",habitable:!0},{population:11449,id:"118278",name:"怀化",habitable:!0},{population:8470,id:"118275",name:"益阳",habitable:!0},{population:8361,id:"118279",name:"娄底",habitable:!0},{population:8060,id:"118277",name:"永州",habitable:!0},{population:5314,id:"118280",name:"湘西",habitable:!0},{population:5151,id:"118274",name:"张家界",habitable:!0}],population:415324},{name:"河北",has_child:!0,id:"108290",habitable:!1,children:[{population:106069,id:"118088",name:"石家庄",habitable:!0},{population:47965,id:"118093",name:"保定",habitable:!0},{population:41838,id:"118089",name:"唐山",habitable:!0},{population:30017,id:"118091",name:"邯郸",habitable:!0},{population:27845,id:"118090",name:"秦皇岛",habitable:!0},{population:23342,id:"118096",name:"沧州",habitable:!0},{population:22230,id:"118092",name:"邢台",habitable:!0},{population:18816,id:"118097",name:"廊坊",habitable:!0},{population:14683,id:"118094",name:"张家口",habitable:!0},{population:12375,id:"118098",name:"衡水",habitable:!0},{population:11269,id:"118095",name:"承德",habitable:!0}],population:348695},{name:"安徽",has_child:!0,id:"108299",habitable:!1,children:[{population:112192,id:"118183",name:"合肥",habitable:!0},{population:25658,id:"118184",name:"芜湖",habitable:!0},{population:18850,id:"118190",name:"安庆",habitable:!0},{population:17852,id:"118193",name:"阜阳",habitable:!0},{population:14429,id:"118185",name:"蚌埠",habitable:!0},{population:13247,id:"118186",name:"淮南",habitable:!0},{population:12763,id:"118187",name:"马鞍山",habitable:!0},{population:10573,id:"118196",name:"六安",habitable:!0},{population:10462,id:"118192",name:"滁州",habitable:!0},{population:9922,id:"118194",name:"宿州",habitable:!0},{population:9522,id:"118188",name:"淮北",habitable:!0},{population:9457,id:"118195",name:"巢湖",habitable:!0},{population:8324,id:"118199",name:"宣城",habitable:!0},{population:8049,id:"118191",name:"黄山",habitable:!0},{population:7734,id:"118197",name:"亳州",habitable:!0},{population:6347,id:"118189",name:"铜陵",habitable:!0},{population:4855,id:"118198",name:"池州",habitable:!0}],population:297027},{name:"黑龙江",has_child:!0,id:"108295",habitable:!1,children:[{population:160231,id:"118146",name:"哈尔滨",habitable:!0},{population:23262,id:"118151",name:"大庆",habitable:!0},{population:19326,id:"118147",name:"齐齐哈尔",habitable:!0},{population:17487,id:"118153",name:"牡丹江",habitable:!0},{population:13388,id:"118154",name:"佳木斯",habitable:!0},{population:9352,id:"118148",name:"鸡西",habitable:!0},{population:8823,id:"118157",name:"绥化",habitable:!0},{population:7516,id:"118150",name:"双鸭山",habitable:!0},{population:6327,id:"118156",name:"黑河",habitable:!0},{population:5797,id:"118149",name:"鹤岗",habitable:!0},{population:5665,id:"118152",name:"伊春",habitable:!0},{population:5106,id:"118155",name:"七台河",habitable:!0},{population:3125,id:"118158",name:"大兴安岭",habitable:!0}],population:279680},{name:"重庆",has_child:!0,id:"108309",habitable:!0,children:[{population:0,id:"130519",name:"万州区",habitable:!1},{population:0,id:"130520",name:"涪陵区",habitable:!1},{population:0,id:"130521",name:"渝中区",habitable:!1},{population:0,id:"130522",name:"大渡口区",habitable:!1},{population:0,id:"130523",name:"江北区",habitable:!1},{population:0,id:"130524",name:"沙坪坝区",habitable:!1},{population:0,id:"130525",name:"九龙坡区",habitable:!1},{population:0,id:"130526",name:"南岸区",habitable:!1},{population:0,id:"130527",name:"北碚区",habitable:!1},{population:0,id:"130528",name:"万盛区",habitable:!1},{population:0,id:"130529",name:"双桥区",habitable:!1},{population:0,id:"130530",name:"渝北区",habitable:!1},{population:0,id:"130531",name:"巴南区",habitable:!1},{population:0,id:"130532",name:"黔江区",habitable:!1},{population:0,id:"130533",name:"长寿区",habitable:!1},{population:0,id:"130534",name:"江津区",habitable:!1},{population:0,id:"130535",name:"合川区",habitable:!1},{population:0,id:"130536",name:"永川区",habitable:!1},{population:0,id:"130537",name:"南川区",habitable:!1},{population:0,id:"130538",name:"綦江县",habitable:!1},{population:0,id:"130539",name:"潼南县",habitable:!1},{population:0,id:"130540",name:"铜梁县",habitable:!1},{population:0,id:"130541",name:"大足县",habitable:!1},{population:0,id:"130542",name:"荣昌县",habitable:!1},{population:0,id:"130543",name:"璧山县",habitable:!1},{population:0,id:"130544",name:"梁平县",habitable:!1},{population:0,id:"130545",name:"城口县",habitable:!1},{population:0,id:"130546",name:"丰都县",habitable:!1},{population:0,id:"130547",name:"垫江县",habitable:!1},{population:0,id:"130548",name:"武隆县",habitable:!1},{population:0,id:"130549",name:"忠县",habitable:!1},{population:0,id:"130550",name:"开县",habitable:!1},{population:0,id:"130551",name:"云阳县",habitable:!1},{population:0,id:"130552",name:"奉节县",habitable:!1},{population:0,id:"130553",name:"巫山县",habitable:!1},{population:0,id:"130554",name:"巫溪县",habitable:!1},{population:0,id:"130555",name:"石柱",habitable:!1},{population:0,id:"130556",name:"秀山",habitable:!1},{population:0,id:"130557",name:"酉阳",habitable:!1},{population:0,id:"130558",name:"彭水",habitable:!1}],population:248174},{name:"天津",has_child:!0,id:"108289",habitable:!0,children:[{population:0,id:"128537",name:"和平区",habitable:!1},{population:0,id:"128538",name:"河东区",habitable:!1},{population:0,id:"128539",name:"河西区",habitable:!1},{population:0,id:"128540",name:"南开区",habitable:!1},{population:0,id:"128541",name:"河北区",habitable:!1},{population:0,id:"128542",name:"红桥区",habitable:!1},{population:0,id:"128543",name:"塘沽区",habitable:!1},{population:0,id:"128544",name:"汉沽区",habitable:!1},{population:0,id:"128545",name:"大港区",habitable:!1},{population:0,id:"128546",name:"东丽区",habitable:!1},{population:0,id:"128547",name:"西青区",habitable:!1},{population:0,id:"128548",name:"津南区",habitable:!1},{population:0,id:"128549",name:"北辰区",habitable:!1},{population:0,id:"128550",name:"武清区",habitable:!1},{population:0,id:"128551",name:"宝坻区",habitable:!1},{population:0,id:"128552",name:"宁河县",habitable:!1},{population:0,id:"128553",name:"静海县",habitable:!1},{population:0,id:"128554",name:"蓟县",habitable:!1},{population:0,id:"131436",name:"开发区",habitable:!1}],population:240945},{name:"广西",has_child:!0,id:"108307",habitable:!1,children:[{population:88659,id:"118302",name:"南宁",habitable:!0},{population:35205,id:"118304",name:"桂林",habitable:!0},{population:29018,id:"118303",name:"柳州",habitable:!0},{population:15621,id:"118310",name:"玉林",habitable:!0},{population:9537,id:"118305",name:"梧州",habitable:!0},{population:9041,id:"118306",name:"北海",habitable:!0},{population:8799,id:"118309",name:"贵港",habitable:!0},{population:6901,id:"118311",name:"百色",habitable:!0},{population:6826,id:"118308",name:"钦州",habitable:!0},{population:6779,id:"118313",name:"河池",habitable:!0},{population:5366,id:"118312",name:"贺州",habitable:!0},{population:4059,id:"118307",name:"防城港",habitable:!0},{population:3583,id:"118314",name:"来宾",habitable:!0},{population:2969,id:"118315",name:"崇左",habitable:!0}],population:227884},{name:"山西",has_child:!0,id:"108291",habitable:!1,children:[{population:80513,id:"118099",name:"太原",habitable:!0},{population:22751,id:"118107",name:"运城",habitable:!0},{population:19937,id:"118100",name:"大同",habitable:!0},{population:18990,id:"118109",name:"临汾",habitable:!0},{population:15441,id:"118110",name:"吕梁",habitable:!0},{population:14951,id:"118106",name:"晋中",habitable:!0},{population:13392,id:"118103",name:"长治",habitable:!0},{population:11786,id:"118104",name:"晋城",habitable:!0},{population:11532,id:"118108",name:"忻州",habitable:!0},{population:9064,id:"118102",name:"阳泉",habitable:!0},{population:5424,id:"118105",name:"朔州",habitable:!0},{population:731,id:"118101",name:"大宁",habitable:!0}],population:219421},{name:"吉林",has_child:!0,id:"108294",habitable:!1,children:[{population:125269,id:"118137",name:"长春",habitable:!0},{population:29113,id:"129059",name:"吉林",habitable:!0},{population:10970,id:"118145",name:"延边",habitable:!0},{population:10425,id:"118139",name:"四平",habitable:!0},{population:9040,id:"118141",name:"通化",habitable:!0},{population:8194,id:"118143",name:"松原",habitable:!0},{population:7116,id:"118142",name:"白山",habitable:!0},{population:6248,id:"118144",name:"白城",habitable:!0},{population:4692,id:"118140",name:"辽源",habitable:!0}],population:208785},{name:"江西",has_child:!0,id:"108301",habitable:!1,children:[{population:98919,id:"118209",name:"南昌",habitable:!0},{population:24686,id:"118215",name:"赣州",habitable:!0},{population:19466,id:"118212",name:"九江",habitable:!0},{population:13744,id:"118219",name:"上饶",habitable:!0},{population:11824,id:"118217",name:"宜春",habitable:!0},{population:9747,id:"118216",name:"吉安",habitable:!0},{population:9020,id:"118210",name:"景德镇",habitable:!0},{population:8631,id:"118218",name:"抚州",habitable:!0},{population:7281,id:"118211",name:"萍乡",habitable:!0},{population:5610,id:"118213",name:"新余",habitable:!0},{population:4810,id:"118214",name:"鹰潭",habitable:!0}],population:208691},{name:"云南",has_child:!0,id:"108312",habitable:!1,children:[{population:103101,id:"118348",name:"昆明",habitable:!0},{population:10587,id:"118360",name:"大理",habitable:!0},{population:9891,id:"118349",name:"曲靖",habitable:!0},{population:7530,id:"118350",name:"玉溪",habitable:!0},{population:7159,id:"118353",name:"丽江",habitable:!0},{population:7132,id:"118357",name:"红河",habitable:!0},{population:5312,id:"118352",name:"昭通",habitable:!0},{population:4383,id:"118358",name:"西双版纳",habitable:!0},{population:4057,id:"118356",name:"文山",habitable:!0},{population:3819,id:"118359",name:"楚雄",habitable:!0},{population:3567,id:"118361",name:"德宏",habitable:!0},{population:3511,id:"118351",name:"保山",habitable:!0},{population:2947,id:"118355",name:"临沧",habitable:!0},{population:2222,id:"130880",name:"普洱",habitable:!0},{population:1433,id:"118354",name:"思茅",habitable:!0},{population:1211,id:"118363",name:"迪庆",habitable:!0},{population:1047,id:"118362",name:"怒江",habitable:!0},{population:870,id:"130945",name:"德宏景颇族",habitable:!0}],population:176023},{name:"内蒙古",has_child:!0,id:"108292",habitable:!1,children:[{population:33094,id:"118111",name:"呼和浩特",habitable:!0},{population:19667,id:"118112",name:"包头",habitable:!0},{population:13455,id:"118117",name:"呼伦贝尔",habitable:!0},{population:11705,id:"118114",name:"赤峰",habitable:!0},{population:8441,id:"118116",name:"鄂尔多斯",habitable:!0},{population:8260,id:"118115",name:"通辽",habitable:!0},{population:5270,id:"118118",name:"巴彦淖尔",habitable:!0},{population:4013,id:"118113",name:"乌海",habitable:!0},{population:3633,id:"118119",name:"乌兰察布",habitable:!0},{population:3249,id:"118120",name:"锡林郭勒",habitable:!0},{population:2831,id:"118122",name:"兴安",habitable:!0},{population:1943,id:"128932",name:"锡林郭勒盟",habitable:!0},{population:1542,id:"118121",name:"阿拉善",habitable:!0},{population:1522,id:"128925",name:"兴安盟",habitable:!0},{population:1083,id:"128945",name:"阿拉善盟",habitable:!0}],population:117114},{name:"贵州",has_child:!0,id:"108311",habitable:!1,children:[{population:51710,id:"118339",name:"贵阳",habitable:!0},{population:14783,id:"118341",name:"遵义",habitable:!0},{population:6392,id:"118340",name:"六盘水",habitable:!0},{population:6374,id:"118346",name:"黔东南",habitable:!0},{population:5845,id:"118344",name:"毕节",habitable:!0},{population:5367,id:"118342",name:"安顺",habitable:!0},{population:5137,id:"118347",name:"黔南",habitable:!0},{population:4837,id:"118343",name:"铜仁",habitable:!0},{population:4246,id:"118345",name:"黔西南",habitable:!0}],population:102674},{name:"甘肃",has_child:!0,id:"108315",habitable:!1,children:[{population:48162,id:"118381",name:"兰州",habitable:!0},{population:7619,id:"118384",name:"天水",habitable:!0},{population:4989,id:"118390",name:"庆阳",habitable:!0},{population:4684,id:"118389",name:"酒泉",habitable:!0},{population:4250,id:"118383",name:"白银",habitable:!0},{population:3999,id:"118388",name:"平凉",habitable:!0},{population:3233,id:"118386",name:"武威",habitable:!0},{population:2950,id:"118387",name:"张掖",habitable:!0},{population:2856,id:"118392",name:"陇南",habitable:!0},{population:2852,id:"118385",name:"嘉峪关",habitable:!0},{population:2416,id:"118382",name:"金昌",habitable:!0},{population:2373,id:"118391",name:"定西",habitable:!0},{population:1790,id:"118393",name:"临夏",habitable:!0},{population:1367,id:"118394",name:"甘南",habitable:!0}],population:93197},{name:"新疆",has_child:!0,id:"108318",habitable:!1,children:[{population:44012,id:"118408",name:"乌鲁木齐",habitable:!0},{population:3780,id:"118409",name:"克拉玛依",habitable:!0},{population:3628,id:"128496",name:"石河子",habitable:!0},{population:3609,id:"118419",name:"伊犁",habitable:!0},{population:3329,id:"118417",name:"昌吉",habitable:!0},{population:2540,id:"118413",name:"阿克苏",habitable:!0},{population:2184,id:"131317",name:"巴音郭楞州",habitable:!0},{population:2153,id:"118416",name:"巴音郭楞",habitable:!0},{population:2113,id:"118414",name:"喀什",habitable:!0},{population:1913,id:"118411",name:"哈密",habitable:!0},{population:1645,id:"118421",name:"阿勒泰",habitable:!0},{population:1291,id:"118420",name:"塔城",habitable:!0},{population:1058,id:"118410",name:"吐鲁番",habitable:!0},{population:1000,id:"131313",name:"博尔塔拉州",habitable:!0},{population:955,id:"118418",name:"博尔塔拉",habitable:!0},{population:901,id:"118412",name:"和田",habitable:!0},{population:714,id:"131385",name:"阿拉尔",habitable:!0},{population:681,id:"131336",name:"克孜勒苏柯尔克孜",habitable:!0},{population:552,id:"118415",name:"克孜勒苏",habitable:!0},{population:540,id:"131386",name:"图木舒克",habitable:!0}],population:75689},{name:"海南",has_child:!0,id:"108308",habitable:!1,children:[{population:37468,id:"118316",name:"海口",habitable:!0},{population:12773,id:"118317",name:"三亚",habitable:!0},{population:3125,id:"131407",name:"琼海",habitable:!0},{population:2772,id:"131433",name:"儋州",habitable:!0},{population:379,id:"131497",name:"文昌",habitable:!0},{population:282,id:"131492",name:"保亭",habitable:!0}],population:55300},{name:"宁夏",has_child:!0,id:"108317",habitable:!1,children:[{population:25267,id:"118403",name:"银川",habitable:!0},{population:4556,id:"118404",name:"石嘴山",habitable:!0},{population:3940,id:"118405",name:"吴忠",habitable:!0},{population:3320,id:"118406",name:"固原",habitable:!0},{population:3131,id:"118407",name:"中卫",habitable:!0}],population:39275},{name:"青海",has_child:!0,id:"108316",habitable:!1,children:[{population:17769,id:"118395",name:"西宁",habitable:!0},{population:2464,id:"118402",name:"海西",habitable:!0},{population:2268,id:"118396",name:"海东",habitable:!0},{population:1670,id:"118399",name:"海南",habitable:!0},{population:1576,id:"118397",name:"海北",habitable:!0},{population:1481,id:"118401",name:"玉树",habitable:!0},{population:1455,id:"118400",name:"果洛",habitable:!0},{population:1303,id:"118398",name:"黄南",habitable:!0}],population:29190},{name:"西藏",has_child:!0,id:"108313",habitable:!1,children:[{population:8254,id:"118364",name:"拉萨",habitable:!0},{population:2570,id:"118368",name:"日喀则",habitable:!0},{population:2146,id:"118370",name:"林芝",habitable:!0},{population:1994,id:"118369",name:"阿里",habitable:!0},{population:1971,id:"118365",name:"那曲",habitable:!0},{population:1957,id:"118367",name:"山南",habitable:!0},{population:1954,id:"118366",name:"昌都",habitable:!0}],population:19949},{name:"香港",has_child:!0,habitable:!1,children:[{id:3365,name:"沙田区"},{id:3366,name:"东区"},{id:3367,name:"观塘区"},{id:3368,name:"黄大仙区"},{id:3369,name:"九龙城区"},{id:3370,name:"屯门区"},{id:3371,name:"葵青区"},{id:3372,name:"元朗区"},{id:3373,name:"深水埗区"},{id:3374,name:"西贡区"},{id:3375,name:"大埔区"},{id:3376,name:"湾仔区"},{id:3377,name:"油尖旺区"},{id:3378,name:"北区",lat:22.391577,lon:114},{id:3379,name:"南区"},{id:3380,name:"荃湾区"},{id:3381,name:"中西区"},{id:3382,name:"离岛区"}],population:19949},{name:"澳门",has_child:!0,habitable:!1,children:[{name:"花地玛堂区"},{name:"圣安多尼堂区"},{name:"大堂区"},{name:"望德堂区"},{name:"风顺堂区"}],population:19949},{name:"台湾",has_child:!0,habitable:!1,children:[{id:3384,name:"台北"},{id:3385,name:"高雄"},{id:3386,name:"基隆"},{id:3387,name:"台中"},{id:3388,name:"台南"},{id:3389,name:"新竹"},{id:3390,name:"嘉义"},{id:3391,name:"宜兰县"},{id:3392,name:"桃园县"},{id:3393,name:"苗栗县"},{id:3394,name:"彰化县"},{id:3395,name:"南投县"},{id:3396,name:"云林县"},{id:3397,name:"屏东县"},{id:3398,name:"台东县"},{id:3399,name:"花莲县"},{id:3400,name:"澎湖县"}],population:19949},{name:"海外",has_child:!0,children:[{name:"不限"},{name:"美国"},{name:"英国"},{name:"法国"},{name:"俄罗斯"},{name:"加拿大"},{name:"巴西"},{name:"澳大利亚"},{name:"印尼"},{name:"泰国"},{name:"马来西亚"},{name:"新加坡"},{name:"菲律宾"},{name:"越南"},{name:"印度"},{name:"日本"},{name:"新西兰"},{name:"韩国"},{name:"德国"},{name:"意大利"},{name:"爱尔兰"},{name:"荷兰"},{name:"瑞士"},{name:"乌克兰"},{name:"南非"},{name:"芬兰"},{name:"瑞典"},{name:"奥地利"},{name:"西班牙"},{name:"比利时"},{name:"挪威"},{name:"丹麦"},{name:"波兰"},{name:"阿根廷"},{name:"白俄罗斯"},{name:"哥伦比亚"},{name:"古巴"},{name:"埃及"},{name:"希腊"},{name:"匈牙利"},{name:"伊朗"},{name:"蒙古"},{name:"墨西哥"},{name:"葡萄牙"},{name:"沙特阿拉伯"},{name:"土耳其"},{name:"其他"}]}];
return{directly:e,china:t}}),define("module/dialogs/city",["jquery","plugin/dialog","./city_data"],function(e,t,n){var r=n.china,i={open:function(t,n){this.callback=t||e.noop,this.popDialog?this.popDialog.open():this.createPop(n)},createPop:function(n){var i="<div>"+this.getItemsHtml(r)+'</div><div class="town content-expand"></div>',s=e.extend({id:"dialog_city",hide:!0,dialogClass:"location",header:"选择您的所在地",content:i},n),o=new t.Dialog(s);o.open(),this.popDialog=o,this.bindEvents()},getItemsHtml:function(e,t){var n="";for(var r=0,i=e.length;r<i;r++){var s=e[r];n+='<a  href="javascript:;" has_child="'+(s.has_child?"yes":"no")+'"  province="'+(t||"")+'">'+s.name+"</a>"}return n},bindEvents:function(){var t=this.popDialog.getEl(),n=t.find(".bd"),i=n.find(".town"),s=this;n.on("click","a",function(){var t=e(this),n=t.text();t.parent().children(".on").removeClass("on"),t.addClass("on");if(t.attr("has_child")=="no"){var o=t.attr("province")||"";s.callback(o,n),s.popDialog.close()}else{var u=r[t.index()].children;u&&i.empty().html(s.getItemsHtml(u,n))}}),n.find("a").eq(0).trigger("click")}};return i}),define("module/dialogs/login_box",["jquery","helper","plugin/dialog","plugin/placeholder","module/dialogs/city","model/user"],function(e,t,n,r,i,s){function m(e,t,n){e.status==401&&(window.location.href=error_url)}var o=config.PASSPORT_DOMAIN||"/passport",u=o+"/guider/profile/checkEmail",a=o+"/guider/profile/checkNickname",f=o+"/login/checkAccount",l=o+"/register",c=o+"/popupLogin",h={email:/^\w+((-\w+)|(\.\w+))*@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,url:/^http[s]?:\/\/([\w\-]+\.)+[\w\-]+([\w\-.\/\?\%\&\=\#]*)?$/,chinese:/^[\u4E00-\u9FA5\uF900-\uFA2D]+$/,include_chinese:/[\u4E00-\u9FA5\uF900-\uFA2D]/g,mobile:/^1[0-9]{10}$/,qq:/^[1-9]*[1-9][0-9]*$/,username:/^\w+$/,illchar:/[\~\`\!\@\#\$\%\^\&\*\(\)\-\=\+\\\|\'\"\;\:\.\>\,\<\/\?\~\·\！\@\#\￥\%\…\…\&\*\（\）\—\—\-\+\=\|\\\}\]\{\[\"\'\:\;\?\/\>\.\<\,]/},p=function(e,t){var n=!1;return h[t]&&h[t].test(e)&&(n=!0),n},d="",v={open:function(e){this.callback=e||function(){window.location.reload()},this.openInit()},setFollowsId:function(e){t.cookie.addCookie("j_follow_id",e)},getFollowsId:function(){var e=t.cookie.getCookie("j_follow_id");return t.cookie.delCookie("j_follow_id"),e},setLikeSoundId:function(e){t.cookie.addCookie("j_like_sound_id",e)},getLikeSoundId:function(){var e=t.cookie.getCookie("j_like_sound_id");return t.cookie.delCookie("j_like_sound_id"),e},getLocation:function(){var t=this;e.ajax({url:"/passport/location",type:"get",data:{},dataType:"json",success:function(e){e.success?t.setLocation(e.location):t.setLocation("")}})},setLocation:function(e){this.el.find("#city_info").html(e),this.el.find("#register_province").val(e)},openBox:function(t){var r="";if(d){r=d}else{var s='<form action=""><div class="formList"><div class="formItem item_in"><span class="sp_name"><label for="userAccount">账号</label></span><span class="ph_input"><input type="text" placeholder="手机号/邮箱" style="" id="login_userAccount" name="userAccount"></span><span class="sp_tip"></span><div class="error">该用户名已被使用</div></div><div class="formItem item_in"><span class="sp_name"><label for="userPwd">密码</label></span><span class="ph_input"><input type="password" id="login_userPwd" name="userPwd"></span><div id="login_error" class="login_error"><!--您的密码或者账号有误-->&nbsp; </div></div><div class="formItem loginBtm"><input type="checkbox" checked="checked" class="userRemember" id="login_userRemember" name="userRemember"><label for="">记住登录状态</label><a href="/passport/user_info/show" class="a_1">找回密码</a><a class="confirmBtn" id="login_btn">登录</a></div></div></form>',o='<form action="/passport/register" method="post"><input type="hidden" value="上海" id="register_province"><input type="hidden" id="register_city"><div class="formItem item_in"><span class="sp_name"><label for="nickName">昵称</label></span><span class="ph_input"><input type="text" placeholder="想一个20个字符以内的昵称" id="register_nickName" name="nickname"> </span><span class="sp_tip"></span><div class="error">该用户名已被使用</div></div><div class="formItem item_in"><span class="sp_name"><label for="userAccount">邮箱</label></span><span class="ph_input"><input type="text" placeholder="选择一个您常用的邮箱" id="register_userAccount" name="email"></span><span class="sp_tip"></span><div class="error"></div></div><div class="formItem item_in"><span class="sp_name"><label for="userPwd">密码</label></span> <span class="ph_input"><input type="password" placeholder="请输入6-16位密码" id="register_userPwd" name="password"></span><span class="sp_tip"></span><div class="error"></div></div><div class="formItem regBtm"><div class="fl"><input type="checkbox" checked="checked" class="ck_1" id="register_agreeDeal" name=""><label>我已看过并同意</label><br><a href="javascript:;" id="register_deal_info" class="a_1">《喜马拉雅网络服务使用协议》</a><span class="register_error" id="register_infoErr"></span></div><div class="fr"><a class="confirmBtn" id="register_btn">注册</a></div></div></form>';r='<a class="thirdParty popLoginBtns"><span class="loginSinaIcon login-btn"></span><span class="loginQqIcon login-btn"></span><span class="renrenSmallLoginBtn login-btn"></span><span>使用第三方登录</span></a><div class="reg_login_form_wrap '+t+'">'+'<div class="reg_login_tabs">'+'<a class="login_tab_btn">登录</a>'+'<a class="register_tab_btn">注册</a>'+"</div>"+'<div class="reg_login_from">'+'<div class="login_from">'+s+"</div>"+'<div class="reg_from">'+o+"</div>"+"</div>"+"</div>"
}var u={dialogClass:"reglogin",content:r,template:{dialog_container:'<div class="loginPop" dialog-role="container"></div>',dialog_close:'<a class="close5Btn" dialog-role="close"></a>'}},a=new n.Dialog(u);this.popup=a,a.open();var f=a.getEl();f.find(".reg_login_tabs a").click(function(){var t=e(this),n=t.index(),r=f.find(".reg_login_form_wrap");n==1?r.addClass("is-reg"):r.removeClass("is-reg")});var l=this;f.find(".thirdParty").on("click",function(){a.close(),l.openInit()});var c=f.find("#changeCity");c.click(function(){if(c.attr("forbidden")){return}c.attr("forbidden",!0);if(!i){return}i.open(function(t,n){e("#city_info").html(t+n),e("#register_province").val(t),e("#register_city").val(n),c.removeAttr("forbidden")})}),this.el=f,this.getLocation(),this.thirdParty(f),this.login(),this.register()},openInit:function(){var t='<div class="loginPop_tit"></div><div class="left"><div class="loginPop_pic"></div></div><div class="right"><div class="popLoginBtns"><a href="javascript:;" class="weiboLoginBtn login-btn" data-baidu="weibo1"></a><a href="javascript:;" class="qqLoginBtn login-btn"  data-baidu="QQ1"></a><a href="javascript:;" class="renrenLoginBtn login-btn" data-baidu="renren1"></a></div><div>没有以上账号？<a class="register" href="javascript:;" data-baidu="register1">直接注册</a></div><div>以前来过这里？<a class="login" href="javascript:;" data-baidu="login1">立即登录</a></div><div>不记得密码了？<a  href="/passport/user_info/show" >找回密码</a></div></div>',r={content:t,template:{dialog_container:'<div class="loginPop" dialog-role="container"></div>',dialog_body:'<div class="loginPopInner" dialog-role="body"></div>',dialog_close:'<div class="close5Btn" dialog-role="close"></div>'}},i=new n.Dialog(r);this.popup=i,i.open();var s=i.getEl(),o=this;s.find(".register").click(function(){o.baidu(e(this)),i.close(),o.openBox("is-reg")}),s.find(".login").click(function(){o.baidu(e(this)),i.close(),o.openBox("")}),this.thirdParty(s)},thirdParty:function(n){var r=this;n.find(".popLoginBtns").on("click",".login-btn",function(){var n=e(this);r.baidu(n);var i=n.index()+1;t.login(i,"",function(e){r.login_callback(e)})})},login_callback:function(e){var t=this,n=t.getFollowsId();config.CURRENT_USER||(config.CURRENT_USER={}),config.CURRENT_USER.uid||(config.CURRENT_USER.uid=n),n?s.follow(n,!0,function(){t.callback(e)}):t.callback(e),this.close()},baidu:function(e){var t=e.attr("data-baidu");window.console&&console.log(t),window._hmt&&_hmt.push(["_trackEvent",t,"click"])},login:function(){r(".login_from .ph_input");var t={userError:"账号格式不正确!",noUser:"该账号尚未注册!",pwdError:"该账号密码不正确!",userEmpty:"请输入账号!",pwdEmpty:"请输入密码!"},n=this.el.find("#login_userAccount "),i=this.el.find("#login_userPwd"),s=this.el.find("#login_userRemember"),o=this.el.find("#login_btn");n.blur(function(){if(e(this).attr("cancel_blur")){return}a.account(e(this))}),i.blur(function(){a.accountSuccess&&a.password(e(this))});var u=this,a={accountSuccess:!1,passwordSuccess:!1,account:function(n){this.accountSuccess=!1;var r=n.val();if(!r){this.error(n,t.userEmpty);return}if(!p(r,"email")&&!p(r,"mobile")){this.error(n,t.userError);return}var i=this;e.ajax({url:f,type:"post",dataType:"json",data:{email:r},success:function(e){if(e.success){i.accountSuccess=!0,i.success()}else{var t="";e.msg&&(t=e.msg),i.error(n,t)}},error:function(){i.error(n,"真不幸，服务器貌似打酱油去了")}})},password:function(e){var n=e.val();if(!n){this.error(e,t.pwdEmpty);return}this.passwordSuccess=!0,this.success()},error:function(e,t){var n=u.el.find("#login_error");n.html(t)},success:function(){var e=u.el.find(".login_error");e.html("&nbsp;")}};e(".formList input[type=password]").bind({keydown:function(t){t.keyCode==13&&(e(this).triggerHandler("blur"),o.click())}}),o.click(function(){a.accountSuccess?a.passwordSuccess||a.password(i):a.account(n),a.accountSuccess&&a.passwordSuccess&&e.post(c,{account:e.trim(n.val()),password:e.trim(i.val()),rememberMe:s[0].checked?!0:!1},function(e){e.success?(u.login_callback(e),a.success()):a.error("",e.errorMsg)},"json")})},close:function(){this.popup&&this.popup.close()},getEl:function(){return this.popup?this.popup.getEl():""},register:function(){e("#register_deal_info").click(function(){e.get("/passport/register_rule",function(e){var t='<div class="for" style="height:600px;overflow-y: scroll;">'+e+"</div>",r={dialogClass:"",caption:"喜马拉雅网络服务使用协议",content:t,width:680},i=new n.Dialog(r);i.open()})});var t={emailExist:"该邮箱已被注册",emailFormatError:"账号格式错误，请输入邮箱",emailLengthError:"账号长度不能超过30个字符",nameIll:"昵称包含非法字符",nameTooShort:"昵称过短",nameTooLong:"昵称过长",nameExist:"该昵称已有人使用",pwdTooShort:"密码不能短于6位",pwdTooLong:"密码不能长于16位",emailEmpty:"注册邮箱必填",pwdEmpty:"密码必填",pwdIll:"密码请勿使用特殊字符",nameEmpty:"昵称必填",dealEmpty:"请先同意用户协议"};r(".reg_from .ph_input");var i=this.el.find("#register_nickName"),s=this.el.find("#register_userAccount"),o=this.el.find("#register_userPwd"),f=this.el.find("#register_agreeDeal"),l=this.el.find("#register_infoErr"),c=this.el.find("#register_btn");i.blur(function(){d.name(e(this))}),s.blur(function(){if(e(this).attr("cancel_blur")){return
}d.account(e(this))}),o.blur(function(){d.password(e(this))}),f.click(function(){d.deal()});var d={nameSuccess:!1,accountSuccess:!1,passwordSuccess:!1,name:function(n){this.nameSuccess=!1,this.resetTip(n);var r=n.val();if(!r){this.error(n,t.nameEmpty);return}var i=p(r,"illchar");if(i){this.error(n,t.nameIll);return}var s=r;s=s.replace(h.include_chinese,"aa");var o=s.length;if(o<4){this.error(n,t.nameTooShort);return}if(o>20){this.error(n,t.nameTooLong);return}var u=this;e.ajax({url:a,type:"post",dataType:"json",data:{nickname:r},success:function(e){e.success?(u.nameSuccess=!0,u.success(n)):u.error(n,e.msg)},error:function(e,t,n){m(e,t,n)}})},account:function(n){this.accountSuccess=!1,this.resetTip(n);var r=n.val();if(!r){this.error(n,t.emailEmpty);return}if(!p(r,"email")){this.error(n,t.emailFormatError);return}if(r.length>30){this.error(n,t.emailLengthError);return}var i=this;e.ajax({url:u,type:"post",dataType:"json",data:{email:r},success:function(e){e.success?(i.nameSuccess=!0,i.success(n)):i.error(n,e.msg)},error:function(e,t,n){m(e,t,n)}}),this.accountSuccess=!0,this.success(n)},password:function(e){this.passwordSuccess=!1,this.resetTip(e);var n=e.val();if(!n){this.error(e,t.pwdEmpty);return}var r=n.length;if(r<6){this.error(e,t.pwdTooShort);return}if(r>16){this.error(e,t.pwdTooLong);return}if(p(n,"include_chinese")){this.error(e,t.pwdIll);return}this.passwordSuccess=!0,this.success(e)},resetTip:function(e){var t=e.closest(".formItem");t.removeClass("is-error");var n=t.children(".sp_tip");n.removeClass("sp_right")},error:function(e,t){var n=e.closest(".formItem");n.addClass("is-error"),n.find(".error").html(t);var r=n.children(".sp_tip");r.removeClass("sp_right")},success:function(e){var t=e.closest(".formItem");t.removeClass("is-error");var n=t.children(".sp_tip");n.addClass("sp_right")},deal:function(){return f[0].checked?(l.html(""),!0):(l.html(t.dealEmpty),!1)}};e(".formList input[type=password]").bind({keydown:function(t){t.keyCode==13&&(e(this).triggerHandler("blur"),c.click())}}),c.click(function(){d.nameSuccess&&d.accountSuccess&&d.passwordSuccess&&d.deal()?c.closest("form").submit():(i.blur(),s.blur(),o.blur())})}};return v}),define("model/sound_images",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({cache:{},getData:function(t,n,r){n=n||e.noop,r=r||e.noop;var i="/sounds/"+t+"/pictures",s=this,o=this.cache[t];t.indexOf("d_")==0&&(i=""),e.ajax({url:i,type:"get",cache:!1,dataType:"json",success:function(e){s.cache[t]=e,n(e)},error:function(e){r(e)}})}});return r}),define("module/dialogs/imageslider",["jquery","plugin/dialog","model/sound_images"],function(e,t,n){var r=new n,i={open:function(e){if(!e){return}var t=this;this.openDialog(),r.getData(e,function(e){t.renderImage(e)})},openDialog:function(){var e='<div class="num"><span class="cur_order">1</span>/<span class="all_num"></span></div><div class="gCon"><img src=""><span class="imgLoad"></span><a title="上一张" class="prev disabled" href="javascript:;"><span></span></a><a title="下一张" class="next disabled" href="javascript:;"><span></span></a></div><ul class="gCon2"></ul>',n={id:"imageSlider",content:e,fixed:!1,template:{dialog_container:'<div class="gPopupMulti"  dialog-role="container"></div>',dialog_close:'<div class="close6Btn" dialog-role="close"></div>'}},r=new t.Dialog(n);r.open(),this.pop=r,this.$el=r.getEl(),this.bindEvents()},bindEvents:function(){var t=this,n=this.$el.find(".gCon2"),r=this.$el.find(".cur_order"),i=this.$el.find(".prev"),s=this.$el.find(".next");n.on("click","li",function(){var o=e(this),u=o.attr("image-large");if(o.hasClass("on")){return}t.renderLargeImage(u),n.find(".on").removeClass("on"),o.addClass("on"),r.html(o.index()+1),o.prev().size()==0?i.addClass("disabled"):i.removeClass("disabled"),o.next().size()==0?s.addClass("disabled"):s.removeClass("disabled")}),i.on("click",function(){var t=e(this);if(t.hasClass("disabled")){return !1}var r=n.find(".on");return r.prev().trigger("click"),!1}),s.on("click",function(){var t=e(this);if(t.hasClass("disabled")){return !1}var r=n.find(".on");return r.next().trigger("click"),!1})},renderLargeImage:function(e){var t=this,n=this.$el.find(".gCon"),r=n.find("img");this.largeImage=e,n.addClass("is-loading"),n.css("opacity",0.5);var i=new Image;i.onload=function(){if(t.largeImage!=this.src){i=null;return}n.removeClass("is-loading"),r.attr("src",e),n.animate({opacity:1}),t.pop.setPosition(),i=null},i.onerror=function(){n.removeClass("is-loading"),i=null},i.src=e},renderImage:function(n){if(n.ret==0){this.pop.close(),n.msg&&t.alert(n.msg);return}var r="",i=n.pictures,s=i.length;this.$el.find(".all_num").html(s);if(s==1){this.renderLargeImage(i[0].large);return}for(var o=0;o<s;o++){var u=i[o];r+='<li class="is-loading" image-large="'+u.large+'"><a>'+'<img src="'+u.small+'"><span class="imgLoad"></span></a></li>'}var a=this.$el.find(".gCon2");a.append(r),a.find("img").on("load",function(){var t=e(this),n=t.closest("li");n.removeClass("is-loading")}),a.find("li").eq(0).click()
}};return i}),define("model/message",["jquery","underscore","backbone","json2"],function(e,t,n,r){var i=n.Model.extend({defaults:{category:"",newMessage:0,newNotice:0,newComment:0,newQuan:0,newFollower:0,newLikes:0},getNewMessage:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/notices",type:"post",dataType:"json",success:function(e,r,i){r.res&&r.res!=0&&r.res!="0"?t(e,r,i):n(e,r,i)}})},parse:function(e){return e.res||(e.res={}),{newMessage:e.res.new_message,newNotice:e.res.new_notice,newComment:e.res.new_comment,newQuan:e.res.new_quan,newFollower:e.res.new_follower,newLikes:e.res.new_like}},clearNewMessage:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/notices/clear",type:"post",dataType:"json",data:{category:r.get("category")},success:function(e,r,i){r.res!=0?t(e,r,i):n(e,r,i)}})}});return i}),define("module/header/message",["jquery","json2","model/message","plugin/dialog","helper"],function(e,t,n,r){var i=e("div.login-msg"),s=e(".loginPanel_MsgPop ul"),o={newComment:'<li><a attribute="newComment" category="new_comment" href=\'/#/msgcenter/comment\'>{0}条新评论</a></li>',newQuan:'<li><a attribute="newQuan" category="new_quan" href=\'/#/msgcenter/referme\'>{0}个人@了你</a></li>',newFollower:'<li><a attribute="newFollower" category="new_follower" href=\'/#/{1}/fans\'>{0}个新粉丝</a></li>',newNotice:'<li><a attribute="newNotice" category="new_notice" href=\'/#/msgcenter/notice\'>{0}个系统通知</a></li>',newMessage:'<li><a attribute="newMessage" category="new_message" href=\'/#/msgcenter/letter\'>{0}封私信</a></li>',newLikes:'<li><a attribute="newLikes" category="new_like" href=\'/#/msgcenter/like\'>{0}个“赞”</a></li>'},u={isRequist:!1,seqID:0,locked:!1,messageModel:null,start:function(){this.messageModel=new n,this.messageModel.on("change:newMessage",this.onChangeCount,this),this.messageModel.on("change:newComment",this.onChangeCount,this),clearInterval(this.seqID),this.seqID=setInterval(function(){u.seqMessage()},config.WARNING_SEQ*1000)},onChangeCount:function(t){var n=t.get("newMessage")+t.get("newComment");n>0?(e(".homeNavMoreBar .navNumIcon em").text(n),e(".homeNavMoreBar .navNumIcon").show()):e(".homeNavMoreBar .navNumIcon").hide(),t.get("newMessage")>0?(e(".message .navNumIcon em").text(t.get("newMessage")),e(".message .navNumIcon").show()):e(".message .navNumIcon").hide(),t.get("newComment")>0?(e(".comment .navNumIcon em").text(t.get("newComment")),e(".comment .navNumIcon").show()):e(".comment .navNumIcon").hide()},seqMessage:function(){if(!helper.isLogin()){return}if(!u.isRequist){var r=e.cookie("msgwarn");if(r){u.messageModel=new n(t.parse(r)),u.doResetmsg(u.messageModel);return}}u.isRequist=!0,u.messageModel.getNewMessage(function(n,r){u.isRequist=!0,r=n.toJSON(),e.cookie("msgwarn",t.stringify(r),{expires:config.WARNING_SEQ*1+3}),u.doResetmsg(n)})},closeAllCate:function(){return u.messageModel.set("category",undefined),u.messageModel.set({newMessage:0,newNotice:0,newComment:0,newQuan:0,newFollower:0,newLikes:0}),u.isRequist||e.cookie("msgwarn",t.stringify(u.messageModel.toJSON()),{expires:config.WARNING_SEQ*1+3}),u.messageModel.clearNewMessage(function(e){s.parent().hide()}),!1},closeCate:function(){var n=this;return e(n).parent().remove(),s.find("a[category]").length==0&&s.parent().hide(),location.href=e(n).attr("href"),u.messageModel.set("category",e(n).attr("category")),u.messageModel.set(e(n).attr("attribute"),0),u.messageModel.clearNewMessage(),u.isRequist||e.cookie("msgwarn",t.stringify(u.messageModel.toJSON()),{expires:config.WARNING_SEQ*1+3}),!1},doResetmsg:function(e){var t=!0;if(!e){return}s.find("li").remove();for(var n in e.attributes){n in o&&e.attributes[n]>0&&(t=!1,s.append(helper.strFormat(o[n],e.attributes[n],config.CURRENT_USER.uid)))}t?s.parent().hide():(!i.hasClass("show")&&u.locked==0&&s.parent().show(),s.find("a[category]").off().on("click",u.closeCate),s.parent().find("div.del").off().on("click",u.closeAllCate))}};return u}),define("model/account",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({regMobileCode:function(e,t,n){var r="/passport/mobile/getVerifyCode";this.set("postData",{phone_num:e,msgType:4}),this.ajax(r,t,n)},regUserCheck:function(){var e="/passport/guider/profile/checkEmail";this.set("postData",{email:val}),this.ajax(e,success,error)},regNickNameCheck:function(e,t,n){var r="/passport/guider/profile/checkNickname";this.set("postData",{nickname:e}),this.ajax(r,t,n)},loginUserCheck:function(e,t,n){var r="/passport/login/checkAccount";this.set("postData",{email:e}),this.ajax(r,t,n)},login:function(e,t,n,r,i){var s="/passport/popupLogin";this.set("postData",{account:e,password:t,rememberMe:n}),this.ajax(s,r,i)},ajax:function(t,n,r,i){n=n||e.noop,r=r||e.noop;var s=this.get("postData");e.ajax({url:t,type:i?"get":"post",dataType:"json",data:s,success:function(e){e.result=="success"||e.success?n(e):r(e)},error:function(e){r(e)}})}});return r}),define("module/header/header",["jquery","plugin/dialog","module/header/message","helper","model/account"],function(e,t,n,r,i){var s=e(".menu"),o=s.find(".menu_explore"),u=e(".getNewMsgBtn"),a=e(".loginPanel_MenuPop"),f=0,l=10;
o.find("span").off().on("click",function(){return o.hasClass("is-open")?o.removeClass("is-open"):o.addClass("is-open"),e(".discoverMenu").stop().slideToggle("normal"),!1}),u.on({mouseenter:function(){n.locked||(n.locked=!0,a.height(0).css("opacity","hide").animate({height:124,opacity:"show"},200),e(".loginPanel_MsgPop").hide()),clearTimeout(f)},mouseleave:function(){clearTimeout(f),f=setTimeout(function(){a.stop().slideUp(100,"swing",function(){n.locked=!1,n.doResetmsg(n.messageModel)})},200)}}),a.on({mouseover:function(){clearTimeout(f)},mouseleave:function(){u.trigger("mouseleave")}}),n.start();var c=e(".loginPanel"),h=c.find(".loginPanel_accountPop");c.find(".userfaceBtn").on({mouseenter:function(){l&&h.css("opacity","hide").height(0).animate({height:79,opacity:"toggle"},100),clearTimeout(l),e(".loginPanel_MsgPop").hide(),l=0},mouseleave:function(){clearTimeout(l),l=setTimeout(function(){h.stop().slideUp(100),n.locked=!1,n.doResetmsg(n.messageModel)},200)}}),h.on({mouseover:function(){clearTimeout(l),l=0},mouseleave:function(){c.find(".userfaceBtn").trigger("mouseleave")}});var p=c.find(".loginBtn"),d=c.find(".loginPanel_loginPop"),v=d.find(".password"),m=c.find(".loginPanel_thirdLoginPop"),g=e(document),y=function(t){var n=e(t.target);if(n.closest(".loginPanel_loginPop").size()>0||n.closest(".loginPanel_thirdLoginPop").size()>0){return}d.hide(),m.hide(),g.off("mousedown",y)};p.on("click",function(){d.show(),g.on("mousedown",y)}),d.on("click",".thirdlogin_click, .qqSmallLoginBtn, .weiboSmallLoginBtn, .renrenSmallLoginBtn",function(){return d.hide(),m.show(),!1}),m.on("click",".login_click",function(){return d.show(),m.hide(),!1});var b=new i;d.on("click",".submitBtn",function(){var n=d.find(".username"),r=d.find(".rememberMe"),i=e.trim(n.val()),s=e.trim(v.val()),o=!!r[0].checked;if(!i||!s){t.alert("帐号或密码不能为空");return}b.login(i,s,o,function(e){window.location.reload()},function(e){t.alert(e.errorMsg||"帐号或密码错误")})}),v.on("keydown",function(e){e.keyCode==13&&d.find(".submitBtn").trigger("click")}),m.on("click","a",function(){var t=e(this),n=0;t.hasClass("weiboLoginBtn")&&(n=1),t.hasClass("qqLoginBtn")&&(n=2),t.hasClass("renrenLoginBtn")&&(n=3);if(n==0){return}return r.login(n,""),!1})}),define("model/tag",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{tagName:0},delFollowingTag:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/following_tags/"+encodeURIComponent(r.get("tagName"))+"/destroy",type:"post",dataType:"json",success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},switchFollowedTag:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/tag/"+encodeURIComponent(r.get("tagName"))+"/switch_follow",type:"post",dataType:"json",success:function(e,r,i){r.response==="create"||r.response==="destroy"?t(e,r,i):n(e,r,i)}})},create:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/following_tags/create",data:{tname:this.get("tagName")},type:"post",dataType:"json",success:function(e,r,i){r.res===!1?n(r.msg,e,r,i):t(e,r,i)}})}});return r}),define("module/right/right",["jquery","underscore","backbone","model/tag","plugin/dialog"],function(e,t,n,r,i){function o(e,t){var n=[];while(e--){n[e]=e}var r=[];while(t--){var i=parseInt(Math.random()*n.length);r.push(n[i]),n.splice(i,1)}return r}e("body").on("click",".recommendTagsBar .tab_item",function(){var t=e(this),n=t.parent(),r=t.closest(".recommendTagsBar");r.find(".tab_content,.tab_item").removeClass("on");var i=n.find(".tab_item").index(t);t.addClass("on"),r.find(".tab_content").eq(i).addClass("on")}),e("body").on("click",".addTagBtn",function(){var t=e(this),n=t.closest(".addTagOperate"),r=n.find("input");t.hide(),n.find("div").fadeIn(200),r.focus()}),e("body").on("click",".addTagOperate",function(e){return !1}),e("body").on("click",function(t){var n=e(".addTagOperate");if(n.size()){var r=n.find("input");n.find("div").fadeOut(200,function(){r.val(""),n.find(".addTagBtn").show()})}}),e("body").on("keydown",".addTagOperate input",function(t){if(t.keyCode===13){var n=e(this),r=n.closest(".addTagOperate"),i=r.find(".editConfirm"),s=r.find("input");s.blur(),i.click()}}),e("body").on("click",".addTagOperate .editConfirm",function(){var t=e(this),n=t.closest(".addTagOperate"),s=n.closest(".tagsBox"),o=n.find("input"),u=o.val(),a='<a class="tagBtn" href="/#/tag/'+u+'/"><span>'+u+'</span><div class="del"></div></a>';if(u){var f=new r({tagName:u});if(t.data("is_querying")){return}t.data("is_querying",!0),f.create(function(){n.find("div").fadeOut(200,function(){n.find(".addTagBtn").show(),o.val("")}),e(a).appendTo(s).hide().fadeIn(200),t.data("is_querying",!1)},function(e){i.alert(e),t.data("is_querying",!1)})}}),e("body").on("click",".tagBtn .del",function(){var t=e(this),n=t.closest(".tagBtn"),i=n.find("span").text(),s=new r({tagName:i});return s.switchFollowedTag(),n.fadeOut(200),!1}),e("body").on("click",".homeNavMoreBar a.off",function(){var t=e(this);e("li.message,li.comment,li.at").slideToggle(200,"linear"),t.toggleClass("on"),t.hasClass("on")?t.text("收起"):t.text("展开")
});var s=e(document);s.on("click",".personPanelBar3 .selectBtn",function(){var t=e(this),n=t.closest(".personPanelBar3");n.toggleClass("is-open"),n.hasClass("is-open")?t.addClass("on"):t.removeClass("on")}),s.on("click",".personPanelBar3 .closeBtn",function(){var t=e(this),n=t.closest(".listItem");n.slideUp(function(){n.remove()})}),s.on("click",".recommendedBar .more",function(){var t=e(this).closest(".recommendedBar"),n=t.find(".personPanelBar3List"),r=n.children();r.hide();var i=r.length;if(i<=6){r.show();return}var s=o(i,6);for(var u=0;u<s.length;u++){r.eq(s[u]).show()}})}),define("module/dialogs/copyright",["jquery","plugin/dialog"],function(e,t){return t.applyDeal=function(){e.get("/passport/register_rule",function(e){var n='<div class="for">'+e+"</div>",r={dialogClass:"dialog-applydeal",caption:"喜马拉雅网络服务使用协议",fixed:!1,content:n,width:680},i=new t.Dialog(r);i.open()})},t.copyright=function(){e.get("/passport/copyright",function(e){var n='<div class="for" >'+e+"</div>",r={dialogClass:"dialog-copyright",caption:"版权声明",content:n,width:580},i=new t.Dialog(r);i.open()})},t}),define("module/dialogs/zawan",["jquery","plugin/dialog"],function(e,t){var n={open:function(e){this.createPop()},createPop:function(){var e=config.STATIC_ROOT+"/y/welcome.htm?file="+config.STATIC_ROOT+"/ximalaya.mp4";config.STATIC_ROOT.indexOf("test")&&(e="http://s1.xmcdn.com/y/welcome.htm?file=http://s1.xmcdn.com/ximalaya.mp4");var n="<iframe frameborder='0' src='"+e+"'"+" marginheight='0' marginwidth='0' width='100%' scrolling='auto' style='background:#fff;border:none;'></iframe>",r={content:n,iframe:!0,width:720,height:480},i=new t.Dialog(r);i.open()}};return n}),define("module/foot",["jquery","module/dialogs/copyright","helper","module/dialogs/zawan"],function(e,t,n,r){e("#apply_deal").off("click").click(function(){t.applyDeal()}),e(".apply_deal").off("click").click(function(){t.applyDeal()}),e("#copy_right").off("click").click(function(){t.copyright()}),e(".copy_right").off("click").click(function(){t.copyright()}),e(".j_friendly_link").click(function(){e(".footer_friendly_link").toggle(),e(".footer-other .bomb-layer").not(".footer_friendly_link").hide()}),e(".j_hot_sound").click(function(){e(".footer_hot_sound").toggle(),e(".footer-other .bomb-layer").not(".footer_hot_sound").hide()}),e(".j_personal_radio").click(function(){e(".footer_personal_radio").toggle(),e(".footer-other .bomb-layer").not(".footer_personal_radio").hide()}),e(".register-tip-video").on("click",function(){r.open()}),e(".weixin").on("click",function(){var e={dialogClass:"dialog-copyright",caption:"版权声明",content:'<div class="weixin_download1"></div>',close:!1,width:"auto"},n=new t.Dialog(e);return n.open(),!1});var i={init:function(){var t=e(".register-tip");if(t.length==0){return}this.addEvent(),this.initDigit()},addEvent:function(){var t=e(".register-tip");t.find(".register-tip-btn2").click(function(){t.animate({height:15},120)}),t.on("mouseenter",function(n){if(e(n.target).hasClass("register-tip-btn2")){return}t.animate({height:80},120)}),e(".register-tip-panel").on("click","a",function(t){var r=e(this),i=r.index()+1,s=r.attr("data-baidu");n.login(i,s)})},getData:function(){var t=this;e.ajax({url:"/global_counts_json",type:"post",dataType:"json",success:function(e){t.user_digit=e.users+"",t.voice_digit=e.tracks+"",t.createDigit()},error:function(){}})},initDigit:function(){this.getData();var e=this},createDigit:function(){var t=this,n=e("#user_digit"),r=e("#voice_digit");if(!n.size()||!r){return}if(!t.user_digit){return}t.addDigit(n,t.user_digit),setTimeout(function(){if(!t.voice_digit){return}t.addDigit(r,t.voice_digit)},200)},addDigit:function(t,n){n+="";var r=t.attr("data-digit")||"0",i=0;t.attr("data-digit",n);if(n==r){return}var s=n.length,o=r.length;if(s>o){for(i=0;i<s-o;i++){var u=t.children().first().clone();u.find(".digit").text(""),u.appendTo(t)}}var a=n.split(""),f=r.split("");for(i=s-1;i>=0;i--){if(a[i]!=f[i]){var l=t.children().eq(i).find(".digit");l.text(a[i]),function(t,n){setTimeout(function(){t.animate({fontSize:40,marginLeft:-8},100,function(){e(this).animate({fontSize:16,marginLeft:0},100)})},100*(s-n))}(l,i)}}}};e(document).ready(function(){i.init()});var s={unloginBottomTip:i};return s}),define("module/common/backtotop",["jquery","underscore","backbone","plugin/dialog"],function(e,t,n,r){var i=[""].join(""),s=n.View.extend({template:t.template(i),className:"rightFixed",events:{"click .top":"toTop"},initialize:function(){var t=this;t.render(),e(window).on("scroll",[t],t.backToTop)},toTop:function(){helper.scrollTo1(0,0),this.$el.find(".top").addClass("hidden1"),this.model.set("isShow",!1)},backToTop:function(t){var n=t.data[0],r=0;clearTimeout(n.model.get("backtotoptimeout")),r=setTimeout(function(){var t=e(document).scrollTop();t>0?n.model.get("isShow")||(n.$el.find(".top").removeClass("hidden1"),n.model.set("isShow",!0)):n.model.get("isShow")&&(n.$el.find(".top").addClass("hidden1"),n.model.set("isShow",!1))},500),n.model.set("backtotoptimeout",r)
},render:function(){this.$el.append(this.template()).show(),e(document.body).append(this.$el)}});return new s({model:new n.Model({backtotoptimeout:50,isShow:!1})})}),define("module/my/search_input",["jquery","underscore","backbone"],function(e,t,n){var r=n.View.extend({init:function(){this.$el=e(document),this.bindEvents()},bindEvents:function(){var t=this;this.$el.on("click",".searchPanel2 .search_btn",function(){t.searchResult(e(this).parent().find(".search_input"))}),this.$el.on("keyup",".searchPanel2 .search_input",function(n){n.keyCode==13&&t.searchResult(e(this))})},searchResult:function(t){var n=e.trim(t.val()),r="q:"+decodeURIComponent(n),i=t.attr("data-options");i&&(r+=","+i);var s=window.location.href;s.indexOf("?")&&(s=s.replace(/\?.*/,"")),r=r.replace(/\:/g,"=").replace(/\,/g,"&"),window.location.href=s+"?"+r},release:function(){this.$el.off("click",".search_btn"),this.$el.off("keyup",".search_input")}}),i=new r;return i.init(),i}),define("module/common",["plugin/dialog","model/user","module/dialogs/login_box","helper","module/dialogs/imageslider","./header/header","./right/right","module/foot","module/common/backtotop","module/my/search_input"],function(e,t,n,r,i){function v(){s.size()&&m(),y()}function m(){var e=d.scrollTop(),t=c+(u.is(":hidden")?0:p);a.toggleClass("is-fixed",e>s.offset().top+t),f.toggleClass("is-fixed",e>s.offset().top+t)}function g(e){return e.parents(".mainbox_right").size()&&$(".mainbox_right").height()>$(".mainbox_left").height()?!1:!0}function y(){var e=d.scrollTop(),t=$(".fixedBox"),n=h;if(d.height()+document.documentElement.clientHeight<d.scrollTop()){return}if(d.height()<document.documentElement.clientHeight+d.scrollTop()){return}$.each(t,function(t,r){var i=$(r);if(!g(i)){i.removeClass("is-fixed");return}if(i.is(".is-fixed")){var s=i.data("scrollTop");if(s>e){i.removeClass("is-fixed");return}}else{var u=i.offset().top;if(!(e+h+10>u)){return}i.addClass("is-fixed"),i.data("scrollTop",e)}var a=o.offset().top,f=i.height(),l=f+n-document.documentElement.clientHeight;l>0&&(n-=l),l=f+n+e-a,l>0&&(n-=l),i.css({top:n})})}$(window).bind("scroll",v);var s=$(".header").eq(0),o=$(".footer").eq(0),u=$(".discoverMenu").eq(0),a=$(".floatHeader").eq(0),f=$(".downloadApp2").eq(0),l=o.height(),c=s.height(),h=a.height(),p=110,d=$(document).eq(0);$(document).ajaxComplete(function(e,t,r){t.status==400&&n.open()}),function(){var e="close_download";d.on("click",".downloadApp .closeBtn",function(){$(".downloadApp").hide(),$.cookie(e,!0,86400)}),$.cookie(e)?$(".downloadApp").hide():$(".downloadApp").show()}(),d.on("click","[sound_popsrc]",function(){var e=$(this).attr("sound_popsrc");return i.open(e),!1}),d.on("click","a",function(){var t=$(this),n=t.attr("notice");if(n){return e.alert(n),!1}}),d.on("click",".js-errorLog",function(){var t=$(this),n=t.attr("errorLog"),i=r.ErrorLog.getLogText(n),s={content:'<div style="word-break: break-all;word-wrap: break-word;padding:10px">'+i+"</div>",width:480,title:"错误详情"},o=new e.Dialog(s);return o.open(),!1});var b={userModel:new t(config.CURRENT_USER,{parse:!0}),refreshFixedBox:y,refreshFloatHeader:m};return b}),define("model/comment_chunkinfo",["jquery","underscore","backbone","./cache"],function(e,t,n,r){var i=null;return i=n.Model.extend({defaults:{id:"",chunks:[],duration:0},fetch:function(e){e=e||{},t.extend(e,{url:"/track_blocks/avatars",type:"get"}),e.data={track_ids:this.id},n.Model.prototype.fetch.call(this,e)},parse:function(e,t){for(id in e){var n=e[id];return{id:id,chunks:n[0],duration:n[1]}}}},{cache:new r}),window.t=i,i}),define("model/comment",["jquery","underscore","backbone","./cache"],function(e,t,n,r){var i=n.Model.extend({defaults:{id:"",avatarPath:"",content:"",coverPath:"",createdAt:"",nickname:"",parentId:"",second:"",trackId:"",trackUid:"",uid:"",updatedAt:"",uploadSource:"",userSource:""},check:function(t,n){var t=this.toJSON();if(!t.content){return"评论不能为空。"}var r=/[\u0391-\uFFE5]/g,i=e.trim(t.content).replace(r,"aa"),s=Math.ceil(i.length/2);if(s>140){return"评论不能超过140个字。"}},fetch:function(e){e=e||{},t.extend(e,{url:"/tracks/"+this.id+".json"}),n.Model.prototype.fetch.call(this,e)},parse:function(e){return{id:e.id,avatarPath:e.avatar_url,content:e.content,coverPath:e.cover_path,createdAt:e.created_at,niceTime:helper.getNiceTime(e.created_at),nickname:e.nickname,parentId:e.parent_id,second:e.second,trackId:e.track_id,trackUid:e.track_uid,uid:e.uid,updatedAt:e.updated_at,uploadSource:e.upload_source,userSource:e.user_source}},create:function(t,n){t=t||e.noop,n=n||e.noop,this.save({},{url:"/comments/create",data:{track_id:this.get("trackId"),parent_id:this.get("parentId"),content:this.get("content"),sharing_to:this.get("sharing_to"),no_more_alert:this.get("no_more_alert"),second:this.get("second")},type:"post",success:function(e,r,i){if(r.res===!1){n(e,r);return}t(e,r)},error:function(e,t,r){n(e,t,r)}})},del:function(t,n){t=t||e.noop,n=n||e.noop,this.destroy({url:"/tracks/"+this.get("trackId")+"/comments/"+this.id+"/destroy",type:"post",success:function(e,r,i){if(r.res===!1){n(e,r);
return}t(e,r)},error:function(e,t,r){n(e,t,r)}})},delMycenter:function(t,n){t=t||e.noop,n=n||e.noop;var r=this;this.destroy({url:"/msgcenter/destroy_comment",type:"post",data:{track_id:r.get("track_id"),comment_id:r.get("comment_id")},success:function(e,r,i){if(r.res===!1){n(e,r);return}t(e,r)},error:function(e,t,r){n(e,t,r)}})}},{cache:new r});return i}),define("collection/comment",["jquery","underscore","backbone","model/comment"],function(e,t,n,r){var i=n.Collection.extend({model:r,fetch:function(e){e=e||{};var r=e.data||{};if(r.soundId===undefined||r.chunkIndex===undefined){return}t.extend(e,{url:"/tracks/"+r.soundId+"/"+r.chunkIndex}),r.soundId=undefined,r.chunkIndex=undefined,n.Collection.prototype.fetch.call(this,e)},parse:function(e){return e.comments}});return i}),define("model/comment_chunk",["jquery","underscore","backbone","./cache","collection/comment","model/comment"],function(e,t,n,r,i,s){var o="",u=n.Model.extend({defaults:{id:"",comments:new i,count:0,soundId:"",index:0},fetch:function(e){if(o==this.id){return}o=this.id,t.extend(e,{url:"/tracks/"+this.get("soundId")+"/"+this.get("index")}),n.Model.prototype.fetch.call(this,e)},parse:function(e,n){var r=new i;return t.each(e.comments,function(e,t){var n=new s(e,{parse:!0});r.add(n)}),{comments:r}}},{cache:new r});return u}),define("plugin/face.lib",[],function(){var e="";window.config&&window.config.STATIC_ROOT&&(e=window.config.STATIC_ROOT);var t={"呵呵":e+"/css/img/face/d_hehe.gif","嘻嘻":e+"/css/img/face/d_xixi.gif","哈哈":e+"/css/img/face/d_haha.gif","太开心":e+"/css/img/face/d_taikaixin.gif","亲亲":e+"/css/img/face/d_qinqin.gif","酷":e+"/css/img/face/d_ku.gif","拜拜":e+"/css/img/face/d_baibai.gif","可爱":e+"/css/img/face/d_keai.gif","馋嘴":e+"/css/img/face/d_chanzui.gif","花心":e+"/css/img/face/d_huaxin.gif","爱你":e+"/css/img/face/d_aini.gif","汗":e+"/css/img/face/d_han.gif","鄙视":e+"/css/img/face/d_bishi.gif","怒":e+"/css/img/face/d_nu.gif","失望":e+"/css/img/face/d_shiwang.gif","害羞":e+"/css/img/face/d_haixiu.gif","可怜":e+"/css/img/face/d_kelian.gif","悲伤":e+"/css/img/face/d_beishang.gif","泪":e+"/css/img/face/d_lei.gif","闭嘴":e+"/css/img/face/d_bizui.gif","委屈":e+"/css/img/face/d_weiqu.gif","挖鼻屎":e+"/css/img/face/d_wabishi.gif","思考":e+"/css/img/face/d_sikao.gif","疑问":e+"/css/img/face/d_yiwen.gif","嘘":e+"/css/img/face/d_xu.gif","晕":e+"/css/img/face/d_yun.gif","书呆子":e+"/css/img/face/d_shudaizi.gif","阴险":e+"/css/img/face/d_yinxian.gif","做鬼脸":e+"/css/img/face/d_zuoguilian.gif","黑线":e+"/css/img/face/d_heixian.gif","吃惊":e+"/css/img/face/d_chijing.gif","衰":e+"/css/img/face/d_shuai.gif","怒骂":e+"/css/img/face/d_numa.gif","愤怒":e+"/css/img/face/d_fennu.gif","左哼哼":e+"/css/img/face/d_zuohengheng.gif","右哼哼":e+"/css/img/face/d_youhengheng.gif","哼":e+"/css/img/face/d_heng.gif","懒得理你":e+"/css/img/face/d_landelini.gif","打哈气":e+"/css/img/face/d_dahaqi.gif","钱":e+"/css/img/face/d_qian.gif","偷笑":e+"/css/img/face/d_touxiao.gif","鼓掌":e+"/css/img/face/d_guzhang.gif","生病":e+"/css/img/face/d_shengbing.gif","感冒":e+"/css/img/face/d_ganmao.gif","困":e+"/css/img/face/d_kun.gif","睡觉":e+"/css/img/face/d_shuijiao.gif","抓狂":e+"/css/img/face/d_zhuakuang.gif","吐":e+"/css/img/face/d_tu.gif","顶":e+"/css/img/face/d_ding.gif","男孩儿":e+"/css/img/face/d_nanhaier.gif","女孩儿":e+"/css/img/face/d_nvhaier.gif","兔子":e+"/css/img/face/d_tuzi.gif","熊猫":e+"/css/img/face/d_xiongmao.gif","猪头":e+"/css/img/face/d_zhutou.gif","奥特曼":e+"/css/img/face/d_aoteman.gif","互粉":e+"/css/img/face/f_hufen.gif","神马":e+"/css/img/face/f_shenma.gif","萌":e+"/css/img/face/f_meng.gif","囧":e+"/css/img/face/f_jiong.gif","给力":e+"/css/img/face/f_geili.gif","心":e+"/css/img/face/l_xin.gif","爱心传递":e+"/css/img/face/l_aixinchuandi.gif","伤心":e+"/css/img/face/l_shangxin.gif","帅":e+"/css/img/face/f_shuai.gif","威武":e+"/css/img/face/f_v5.gif","喜":e+"/css/img/face/f_xi.gif","发红包":e+"/css/img/face/o_fahongbao.gif","握手":e+"/css/img/face/h_woshou.gif","耶":e+"/css/img/face/h_ye.gif","赞":e+"/css/img/face/h_zan.gif",ok:e+"/css/img/face/h_ok.gif",good:e+"/css/img/face/h_good.gif","弱":e+"/css/img/face/h_ruo.gif","最差":e+"/css/img/face/h_zuicha.gif","不要":e+"/css/img/face/h_buyao.gif","拳头":e+"/css/img/face/h_quantou.gif",haha:e+"/css/img/face/h_haha.gif","太阳":e+"/css/img/face/w_taiyang.gif","月亮":e+"/css/img/face/w_yueliang.gif","蛋糕":e+"/css/img/face/o_dangao.gif","咖啡":e+"/css/img/face/o_kafei.gif","干杯":e+"/css/img/face/o_ganbei.gif","西瓜":e+"/css/img/face/o_xigua.gif","礼物":e+"/css/img/face/o_liwu.gif","蜡烛":e+"/css/img/face/o_lazhu.gif","鲜花":e+"/css/img/face/w_xianhua.gif","落叶":e+"/css/img/face/w_luoye.gif","绿丝带":e+"/css/img/face/o_lvsidai.gif","红丝带":e+"/css/img/face/o_hongsidai.gif","围观":e+"/css/img/face/o_weiguan.gif","雪人":e+"/css/img/face/w_xueren.gif","钟":e+"/css/img/face/o_zhong.gif","微风":e+"/css/img/face/w_weifeng.gif","下雨":e+"/css/img/face/w_xiayu.gif","雪":e+"/css/img/face/w_xue.gif","沙尘暴":e+"/css/img/face/w_shachenbao.gif","浮云":e+"/css/img/face/w_fuyun.gif","足球":e+"/css/img/face/o_zuqiu.gif","手套":e+"/css/img/face/o_shoutao.gif","围脖":e+"/css/img/face/o_weibo.gif","温暖帽子":e+"/css/img/face/o_wennuanmaozi.gif","自行车":e+"/css/img/face/o_zixingche.gif","汽车":e+"/css/img/face/o_qiche.gif","飞机":e+"/css/img/face/o_feiji.gif","手机":e+"/css/img/face/o_shouji.gif","音乐":e+"/css/img/face/o_yinyue.gif","话筒":e+"/css/img/face/o_huatong.gif","照相机":e+"/css/img/face/o_zhaoxiangji.gif","电影":e+"/css/img/face/o_dianying.gif","风扇":e+"/css/img/face/o_fengshan.gif","实习":e+"/css/img/face/o_shixi.gif"};
return t}),define("plugin/face",["jquery","./face.lib"],function(e,t){function i(t){t.stopPropagation();var n=e(this),i=n.offset().left,s=n.offset().top;r.setPosition(i,s+n.height()),r.setTextarea(t.data.textarea),r.setWidth(t.data.width),r.show()}jQuery.fn.extend({getCurPos:function(){var t=e(this).get(0);if(t.selectionStart){return t.selectionStart}if(document.selection){var n=document.selection.createRange();if(n==null){return t.value.length}var r=t.createTextRange(),i=r.duplicate();return r.moveToBookmark(n.getBookmark()),i.setEndPoint("EndToStart",r),i.text.length}return t.value.length},setCurPos:function(t){var n=e(this).get(0);if(n.setSelectionRange){n.setSelectionRange(t,t)}else{if(n.createTextRange){var r=n.createTextRange();r.collapse(!0),r.moveEnd("character",t),r.moveStart("character",t),r.select()}}}});var n=function(){this.el=e("<div class='window-face'><div class='face-header'><a href='javascript:;'>x</a></div></div>"),this.onEmotionClick(),this.created=!1};n.prototype.createEl=function(){},n.prototype.create=function(){var e="<div class='face-container'>",n=0,r=50;for(var i in t){var s=parseInt(n/r)+1;n%r==0&&(s>1?e+='<div style="display:none;">':e+='<div class="current-page">'),n++,e+="<a title='"+i+"' href='javascript:void(0);'><img src='"+t[i]+"' title='"+i+"'/></a>",n%r==0&&(e+="</div>")}n%r!=0&&(e+="</div>"),e+="</div>",e+='<div class="face-pageBar"><a class="face-prev disabled"></a><a class="face-next disabled"></a></div>';var o=this.el;o.append(e);var u=o.find(".face-prev"),a=o.find(".face-next"),f=o.find(".face-container"),l=f.children();l.size()>1?a.removeClass("disabled"):a.addClass("disabled"),u.on("click",function(){if(u.hasClass("disabled")){return}var e=f.find(".current-page"),t=e.prev();if(t.size()==0){u.addClass("disabled");return}e.removeClass("current-page").hide(),t.addClass("current-page").show(),t.prev().size()==0&&u.addClass("disabled"),a.removeClass("disabled")}),a.on("click",function(){if(a.hasClass("disabled")){return}var e=f.find(".current-page"),t=e.next();if(t.size()==0){a.addClass("disabled");return}e.removeClass("current-page").hide(),t.addClass("current-page").show(),t.next().size()==0&&a.addClass("disabled"),u.removeClass("disabled")}),this.created=!0},n.prototype.onEmotionClick=function(){var t=this;this.el.on("click",function(n){n.stopPropagation();var r=e(n.target),i=r.attr("title");if(!i){return}i="["+i+"]",t.textarea.triggerHandler("focus");var s=t.textarea.getCurPos(),o=t.textarea.val(),u;s==0?(u=o+i,s=u.length-1):u=o.substring(0,s)+i+o.substring(s),t.textarea.val(u),t.textarea.setCurPos(s+i.length),t.textarea.change(),t.hide()}),this.el.find(".face-header").mouseover(function(){e(this).addClass("hover")}).mouseout(function(){e(this).removeClass("hover")}).click(function(){t.hide()})},n.prototype.setPosition=function(e,t){this.el.css({left:e,top:t,zIndex:100000})},n.prototype.setWidth=function(e){this.el.width(e)},n.prototype.setTextarea=function(e){this.textarea=e},n.prototype.show=function(){this.created||this.create(),e(document).bind("click",this,this.hide),this.el.show()},n.prototype.hide=function(t){var n=this;t&&t.data&&(n=t.data),n.el.hide(),e(document).unbind("click",n.hide)};var r=null,s={};return s.init=function(t,s,o){o=o||{},r||(r=new n(t));var u=o.method||"click";e(t).unbind(u,i).bind(u,{textarea:e(s),width:o.width||330},i)},s.getHtml=function(e){var n=/(\[([^\]\[]*?)\])/g,r=e.replace(n,function(){var e=arguments;return t[e[2]]?"<img class='face-image' title='"+e[2]+"' src='"+t[e[2]]+"'/>":e[1]});return r},s}),define("model/thirdpart",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({_cacheData:{bindStatus:{},syncStatus:{}},name2type:function(e){var t={tSina:1,qzone:2,tQQ:2,renren:3};return t[e]},addBind:function(t,n){n=n||e.noop;var r=this,i="gAddBindCallback",s=this.name2type(t);window.open("/passport/auth/"+s+"/authorize?bind=true&customerFunction="+i,"","height=560, width=760, left=400"),window[i]=function(e){n(e),window[i]=null;if(r._cacheData.bindStatus.data){var s=r._cacheData.bindStatus.data;for(var o=0,u=s.length;o<u;o++){if(s[o]==t){return}}s.push(t)}else{r._cacheData.bindStatus={data:[t],msg:"",success:!0}}}},unBind:function(t,n,r){n=n||e.noop,r=r||e.noop;var i=this.name2type(t),s="/passport/auth/"+i+"/unbind";e.ajax({url:s,type:"get",cache:!1,dataType:"json",success:function(e){e.success?n(e):r(e)},error:function(){r({success:!1,msg:"网络异常"})}})},bindStatusAfter:function(e,t){var n=this.bindStatusList||[];for(var r=0;r<n.length;r++){var i=n[r];e?i.success(t):i.error(t)}},bindStatus:function(t,n){t=t||e.noop,n=n||e.noop;var r=this;if(this._cacheData&&this._cacheData.bindStatus&&!e.isEmptyObject(this._cacheData.bindStatus)){t(this._cacheData.bindStatus);return}this.bindStatusList||(this.bindStatusList=[]),this.bindStatusList.push({success:t,error:n});if(this._doAjax){return}this._doAjax=!0,e.ajax({url:"/passport/auth/bindStatus",type:"get",cache:!1,dataType:"json",success:function(e){e.success?(r._cacheData.bindStatus=e,r.bindStatusAfter(!0,e)):r.bindStatusAfter(!1,e),r.doAjax=!1
},error:function(){r.bindStatusAfter(!1,{success:!1}),r.doAjax=!1}})},syncStatus:function(t,n,r){n=n||e.noop,r=r||e.noop;var i=this.getSyncStatus();if(i&&i[t]){n(i[t]);return}var s=this;e.ajax({url:"/passport/new_sync/get",data:{type:t},cache:!1,dataType:"json",success:function(e){e.success?(i[t]=e,n(e)):(i[t]={},r(e))},error:function(){r({success:!1})}})},setSync:function(t,n,r,i){i=i||e.noop;var s=this.name2type(t),o="/passport/sync/"+s+"/set",u=this.getSyncStatus(r);e.ajax({url:o,type:"get",dataType:"json",cache:!1,data:{isChecked:n,type:r,thirdpartyName:t},success:function(e){e&&e.success&&i(e)}});var a=u.data;for(var f=0,l=a.length;f<l;f++){if(a[f].name==t){a[f].isChecked=n,r||(a[f].isChecked=!0);return}}},getSyncStatus:function(e){return e?this._cacheData.syncStatus[e]:this._cacheData.syncStatus}});return r}),define("module/dialogs/sync",["jquery","plugin/dialog"],function(e,t){var n={open:function(t){this.options=e.extend({noCheckBox:!1,syncFn:e.noop,unSyncFn:e.noop,text:"温馨提示：您的评论将会被自动同步到微博、腾讯?"},t),this.createPop()},createPop:function(){var e=this.options,n=!1,r='<div class="msg_title">'+e.text+"</div>"+'<div class="operate"><a href="javascript:;" class="confirmBtn" dialog-role="yes">同步</a>'+'<a href="javascript:;" class="cancelBtn" dialog-role="cancel">不同步</a></div>'+'<div class="msg_noprompt"><input type="checkbox"><label>下次不再提示</label></div>',i={dialogClass:"msg msg_sync",close:!1,content:r,onYes:function(){e.syncFn(n)},onCancel:function(){e.unSyncFn(n)}},s=new t.Dialog(i);s.open();var o=s.getEl();o.find("input[type=checkbox]").on("click",function(){n=!!this.checked}),e.noCheckBox&&o.find(".msg_noprompt").hide()}};return n}),define("module/share",["jquery","backbone","helper","model/thirdpart","plugin/dialog","module/dialogs/sync","helper"],function(e,t,n,r,i,s){var o=new r,u=t.View.extend({model:o,initialize:function(t){this.options=e.extend({$el:"",bindedClass:"",checkedClass:"on",checkedSuccess:e.noop},t);var r=t.$el,i=this;this.$el=r,this.type=this.$el.find("[data-name][data-type]").attr("data-type"),n.isLogin()&&this.getBind(function(){i.getChecked()}),this.bindEvents()},getBind:function(t){t=t||e.noop;var n=this;this.model.bindStatus(function(e){n.getBindCallback(e),t(e)},function(e){t(e)})},getBindCallback:function(e){var t=e.data;for(var n=0;n<t.length;n++){var r=t[n],i=this.$el.find("[data-name="+r+"]");i.attr("data-bind",1),i.addClass(this.options.bindedClass),r=="qzone"&&(i=this.$el.find("[data-name=tQQ]"),i.attr("data-bind",1),i.addClass(this.options.bindedClass))}},getChecked:function(t){t=t||e.noop;var n=this;this.model.syncStatus(this.type,function(e){n.getCheckedCallback(e),t(e)},function(e){t(e)})},getCheckedCallback:function(e){var t=e.data,n=this.type,r=this.options.checkedClass;for(var i=0;i<t.length;i++){var s=t[i].name,o=t[i].isChecked,u=this.$el.find("[data-name="+s+"][data-type="+n+"]");if(u.attr("data-bind")!=1){continue}o?u.attr("data-share",1).addClass(r):u.attr("data-share",0).removeClass(r)}this.options.checkedSuccess()},setChecked:function(e,t,n,r){var i=this;this.model.setSync(e,t,n,function(){r(),i.options.checkedSuccess()})},addBind:function(t){if(!t){return}var n=!1;t=="tQQ"&&(t="qzone",n=!0);var r=this;this.model.addBind(t,function(){e("[data-name="+t+"]").attr({"data-bind":1},{"data-share":1}).addClass(r.options.checkedClass),n&&e("[data-name=tQQ]").attr({"data-bind":1},{"data-share":1}).addClass(r.options.checkedClass)})},unBind:function(e){var t=this,n={tSina:"新浪微博",qzone:"QQ",renren:"人人网"};i.confirm("是否要解除绑定,解绑后不能再用该"+n[e]+"帐号登录？",{callback:function(){t.model.unBind(e,function(e){callback(e)},function(e){i.alert(e.msg)})}})},bindEvents:function(){var t=this;this.$el.on("click","[data-name][data-type]",function(){var r=e(this),i=r.attr("data-name"),s=r.attr("data-type");if(!n.isLogin()){var o=t.model.name2type(i);n.login(o,!0);return}r.attr("data-bind")!=1?t.addBind(i):r.attr("data-share")!=1?t.setChecked(i,!0,s,function(){e("[data-name="+i+"][data-type="+s+"]").attr("data-share",1).addClass(t.options.checkedClass)}):t.setChecked(i,!1,s,function(){e("[data-name="+i+"][data-type="+s+"]").attr("data-share",0).removeClass(t.options.checkedClass)})})},getShareData:function(t){var n=this,r=[],i=!1;t=t||e.noop;var o=this.$el.find("[data-share=1]"),u=o.eq(0);if(u.size()==0){t({sharing_to:[]});return}var a=u.attr("data-type"),f=u.attr("data-name"),l=n.model.getSyncStatus(a);o.each(function(){var t=e(this),n=t.attr("data-name");r.push(n)});var c={tSina:"新浪微博",qzone:"腾讯微博",renren:"人人网"},h="温馨提示:您的评论将会被自动同步到微博、腾讯或人人网?",p=!1,d=!1;(a=="comment"||a=="relay")&&l.isCommentAlert&&(a=="relay"&&(h="温馨提示:您的转采将会被自动同步到微博、腾讯或人人网?"),p=!0),a=="favorite"&&l.isFavoriteAlert&&(d=!0,p=!0,h="赞了就分享一下吧，点击同步，这条消息会被同步到"+c[f]+"，您可以在个人设置中设置同步开关哟。"),p?s.open({noCheckBox:d,syncFn:function(e){if(a=="comment"||a=="relay"){l.isCommentAlert=!e,t({no_more_alert:e,sharing_to:r})}a=="favorite"&&(l.isFavoriteAlert=!1,t({no_more_alert:!0,sharing_to:r}))},unSyncFn:function(r){if(a=="comment"||a=="relay"){l.isCommentAlert=!r,t({no_more_alert:r,sharing_to:[]})
}a=="favorite"&&(l.isFavoriteAlert=!1,t({no_more_alert:!0,sharing_to:[]}));if(l.data){for(var i=0;i<l.data.length;i++){l.data[i].name==f&&(l.data[i].isChecked=!1)}}e("[data-name][data-type="+a+"]").attr("data-share",0).removeClass(n.options.checkedClass)},text:h}):t({sharing_to:r,no_more_alert:!0})},release:function(){var e=this.$el;e.off(),e.empty()}});return u}),define("model/feed_group",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({idAttribute:"id",defaults:{id:0,title:"",title1:"",uid:0,createdAt:"",isAutoDownload:!1,isPublic:!1,orderNum:0,updatedAt:"",followingGroupIds:[],isAutoPush:!1},parse:function(e){return e},createGroup:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/following_groups/create",type:"post",dataType:"json",data:{title:r.get("title")},success:function(e,r,i){r.id?(e.set("id",r.id),t(e,r,i)):n(e,r,i)}})},deleteGroup:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/following_groups/"+r.get("id")+"/destroy",type:"post",dataType:"json",success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},editGroup:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/following_groups/"+r.get("id")+"/update",type:"post",dataType:"json",data:{title:r.get("title")},success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},followGroups:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/followings/set_groups",type:"post",dataType:"json",data:{following_uid:r.get("uid"),following_group_ids:r.get("followingGroupIds"),is_auto_push:r.get("isAutoPush")},success:function(e,r,i){r.res?t(e,r,i):n(e,r,i)}})}});return r}),define("collection/feed_group",["jquery","underscore","backbone","model/feed_group"],function(e,t,n,r){var i=n.Collection.extend({model:r,fetch:function(e){e=e||{},t.extend(e,{url:"/following_groups"}),n.Collection.prototype.fetch.call(this,e)},parse:function(e){return t.map(e,function(e){var t={id:e.id,title:e.title,uid:e.uid,createdAt:e.created_at,isAutoDownload:e.is_auto_download,isPublic:e.is_public,orderNum:e.order_num,updatedAt:e.updated_at};return t})}});return i}),define("module/feed_group/group",["jquery","underscore","backbone","model/feed_group","collection/feed_group"],function(e,t,n,r,i){var s=n.View.extend({groups:null,initialize:function(){},getGroups:function(){var e=this;this.model.get("isLoad")?this.loadGroups():this.model.get("isLoadings")||(this.groups=new i,this.groups.on("reset",this.loadGroups,this),this.groups.fetch({success:function(){e.loadGroups()}}),this.model.set("isLoadings",!0))},onLoad:function(e,t,n){this.model.get("onLoadEvent")[e]={func:t,pointer:n}},onRemoveLoad:function(e){this.model.get("onLoadEvent")[e]=null,delete this.model.get("onLoadEvent")[e]},doAdd:function(e){var t=this;t.groups.add(e),t.callAdd(e,"add")},doRemove:function(e){this.groups.remove(e),this.callAdd(e,"remove")},doEdit:function(e){var t=this.groups._byId[e.get("id")];t&&this.callAdd(t,"edit")},callAdd:function(e,t){var n=this;for(var r in n.model.get("onAddEvent")){var i=n.model.get("onAddEvent")[r];i.func.call(i.pointer,e,t)}},callLoad:function(){var e=this;for(var t in e.model.get("onLoadEvent")){var n=e.model.get("onLoadEvent")[t];n.func.call(n.pointer,e.groups)}},onAdd:function(e,t,n){this.model.get("onAddEvent")[e]={func:t,pointer:n}},onRemoveAdd:function(e){this.model.get("onAddEvent")[e]=null,delete this.model.get("onAddEvent")[e]},loadGroups:function(){this.model.set("isLoad",!0),this.callLoad()}});return new s({model:new n.Model({isLoad:!1,isLoadings:!1,onAddEvent:{},onLoadEvent:{},onLoad:function(){}})})}),define("module/feed_group/groupview1",["jquery","underscore","backbone","model/feed_group","module/feed_group/group"],function(e,t,n,r,i){var s=['<label><input type="checkbox" <% if(checked){ %> checked <%}%> value="<%=id%>" class="checkbox">&nbsp;<%=title%></label>',"<% if(id==-1){%> ",'<div class="listenhelp">','	<a class="grouphelp"></a>','	<div class="grouphelp_txt">',"		把最想听的加入必听组，可以在手机客户端实时收到更新通知哦！",'		<span class="arrow_grouphelp"><i></i></span>',"	</div>","</div>","<%}%>",""].join(""),o=n.View.extend({template:t.template(s),tagName:"span",render:function(){var e=this;return e.$el.html(e.template(e.model.toJSON())),this.undelegateEvents(),this.delegateEvents(this.events),e.$el}});return o}),define("module/feed_group/followmanager",["jquery","underscore","backbone","module/feed_group/groupview1","module/feed_group/group","model/feed_group","plugin/dialog"],function(e,t,n,r,i,s,o){var u=['	<div class="grouping_title">','		<div class="fl">为<span></span>设置分组</div>','		<div class="fr"><a>为什么要设置分组</a>','           <div class="grouphelp_txt">',"				将关注的账号加入分组，可以帮助你更有效率地浏览关注的声音流和新鲜事。",'				<span class="arrow_group"><i></i></span>',"			</div>","       </div>","	</div>",'	<ul class="grouping_list">',"		<li>","		</li>","		<li><span>",'				<div class="groupcreate">','					<a href="javascript:;" class="group_add">+创建新分组</a>','					<div class="edit"><input type="text" maxlength="8"  /><a class="editConfirm">确认</a><a class="cancel">取消</a></div>',"				</div>","			</span></li>","	</ul>",'	<div class="grouping_btm">','		<div class="addgroupdtl">','			<div class="addgroupdtl_r">','				<a href="javascript:;" class="saveBtn" dialog-role="yes">保存</a>','				<a href="javascript:;" class="removeBtn" dialog-role="close">取消</a>',"			</div>","		</div>","	</div>"].join(""),a=n.View.extend({template:t.template(u),events:{"click .group_add":"doAddGroup","click .cancel":"doAddGroup","click .editConfirm":"doSaveGroup"},groups:[],doAddGroup:function(t){var n=e(t.currentTarget);
n.closest(".groupcreate").toggleClass("is-group-create")},doSaveGroup:function(e){var t=this.$(".groupcreate input"),n=t.val(),r=this,u;n&&(u=new s({title:n}),u.createGroup(function(n,s){i.doAdd(n),r.doAddGroup(e),t.val("")},function(e,t){o.alert(t.msg)}))},initialize:function(){this.render()},render:function(){var e=this;e.$el.html(e.template()),i.onLoad("followmanager",function(t){t.unshift({id:-1,title:"必听组"}),e.$el.find("ul.grouping_list li:eq(0)").empty(),t.each(e.doAddGroupView,e),t.remove(-1)},e),i.onAdd("followmanager",function(t,n){n=="add"&&e.doAddGroupView.call(e,t)},e)},doAddGroupView:function(t){t.set("checked",e.inArray(t.get("id")+"",this.groups)!=-1),this.$el.find("ul.grouping_list li:eq(0)").append((new r({model:t})).render())},show:function(t){var n=this,r=e.extend({id:"dialog_aftattention",dialogClass:"aftattention",header:"关注成功",content:n.$el,onYes:function(){var r,i=this.getEl(),u=!1,a=i.find("input[type='checkbox']:checked"),f=a.map(function(){var t=e(this).val();return u||(u=t==-1),t}).get();return r=new s({uid:t.uid,followingGroupIds:f,isAutoPush:u}),r.followGroups(function(){n.$(".removeBtn").click();var t=e(".setGroups");if(t.size()){var r=e.extend({},e.parser.parseOptions(t[0],[{uid:"number",sids:"string",nickname:"string"}]));r.sids=f.join(","),helper.doChangeOptions(t,r)}setTimeout(function(){o.success("分组成功",{})},300)},function(e,t){o.alert(t.error)}),!1}},{}),u=new o.Dialog(r);u.open(),n.$(".grouping_title .fl span").text(t.nickname),t&&t.sids?n.groups=t.sids.split(","):n.groups.length=0,i.getGroups(),n.undelegateEvents(),n.delegateEvents(n.events)}});return new a({model:new n.Model})}),define("plugin/jquery.parser",["jquery"],function(e){(function(e){e.parser={auto:!0,onComplete:function(e){},plugins:["timeline","eyscroll","combobox"],parse:function(t){var n=[];for(var r=0;r<e.parser.plugins.length;r++){var i=e.parser.plugins[r],s=e(".easyui-"+i,t);s.length&&(s[i]?s[i]():n.push({name:i,jq:s}))}if(n.length&&window.easyloader){var o=[];for(var r=0;r<n.length;r++){o.push(n[r].name)}easyloader.load(o,function(){for(var r=0;r<n.length;r++){var i=n[r].name,s=n[r].jq;s[i]()}e.parser.onComplete.call(e.parser,t)})}else{e.parser.onComplete.call(e.parser,t)}},parseOptions:function(t,n){var r=e(t),i={},s=e.trim(r.attr("data-options"));if(s){var o=s.substring(0,1),u=s.substring(s.length-1,s.length);o!="{"&&(s="{"+s),u!="}"&&(s+="}"),i=(new Function("return "+s))()}if(n){var a={};for(var f=0;f<n.length;f++){var l=n[f];if(typeof l=="string"){l=="width"||l=="height"||l=="left"||l=="top"?a[l]=parseInt(t.style[l])||undefined:a[l]=r.attr(l)}else{for(var c in l){var h=l[c];h=="boolean"?a[c]=r.attr(c)?r.attr(c)=="true":undefined:h=="number"&&(a[c]=r.attr(c)=="0"?0:parseFloat(r.attr(c))||undefined)}}}e.extend(i,a)}return i}},e(function(){!window.easyloader&&e.parser.auto&&e.parser.parse()}),e.fn._outerWidth=function(t){return this.each(function(){!e.boxModel&&e.browser.msie?e(this).width(t):e(this).width(t-(e(this).outerWidth()-e(this).width()))})},e.fn._outerHeight=function(t){return this.each(function(){!e.boxModel&&e.browser.msie?e(this).height(t):e(this).height(t-(e(this).outerHeight()-e(this).height()))})}})(e)}),define("module/common/ifollow",["jquery","underscore","backbone","json2","model/user","module/feed_group/followmanager","plugin/dialog","plugin/jquery.parser"],function(e,t,n,r,i,s,o){var u={follow:"关注",follow_loading:"关注中",already_follow:"已关注",already_follow_loading:"取消中",follow_eachother:"相互关注"},a=n.View.extend({init:function(){this.release(),e(".followBtn[data-options]").on("click",[this],this.doFollow),e(".addBtn[data-options],.addBtn2[data-options], .addBtn3[data-options]").on("click",[this],this.doFollow),e(".personal_operate[data-options]").on("click",[this],this.doRemoveFans)},doBindOne:function(e){e.on("click",[this],this.doFollow)},doRemoveFans:function(t){var n=e(this),r=e.extend({},e.parser.parseOptions(this,[{uid:"number"}])),i=t.data[0];i.model&&r.uid&&r.lock!==!0&&(r.lock=!0,helper.doChangeOptions(n,r),i.model.set("id",r.uid),i.model.doRemoveFans(function(e,t,i){n.closest(".item").fadeOut(),r.lock=undefined,helper.doChangeOptions(n,r)},function(e,t,i){alert(t.msg),r.lock=undefined,helper.doChangeOptions(n,r)}))},doFollow:function(t){var n=e(this),r=e.extend({},e.parser.parseOptions(this,[{uid:"number",is_follow:"boolean",be_followed:"boolean",remove:"string",show:"string",remove_state:"boolean",is_from_cache:"boolean"}])),i=t.data[0];if(i.model&&r.uid&&r.lock!==!0){var s=n.find("span.default");r.lock=!0,helper.doChangeOptions(n,r),r.is_follow=!r.is_follow,i.model.set("id",r.uid),i.model.set("isNotFollowing",r.is_follow),r.is_follow?(n.addClass("loading").attr("otext",s.text()),s.text(u.follow_loading)):(n.addClass("canceling").attr("otext",s.text()),s.text(u.already_follow_loading),n.removeClass("both")),i.model.doFollow(function(t,a,f){r.lock=undefined,a.res.be_followed&&(r.be_followed=a.res.be_followed),helper.doChangeOptions(n,r),r.is_from_cache===!0&&i.model.query({success:function(e){e.set("isNotFollowing",!r.is_follow),e.set("beFollowed",r.be_followed)
}});var l=e(".follows_count"),c=0;l.size()&&(c=e(l[0]).text()*1,r.is_follow?c++:c--,l.text(c)),r.is_follow?(e(".setGroups").show(),o.success("关注成功",{}),setTimeout(function(){n.trigger("blur")},60)):e(".setGroups").hide();if(r.remove&&r.remove_state===r.is_follow){var h=n.closest(r.remove);r.show&&h.siblings(r.show).fadeIn(),h.fadeOut(100,function(){h.remove()});return}r.is_follow?r.be_followed?(n.removeClass("loading").addClass("already").addClass("both"),s.text(u.follow_eachother)):(n.removeClass("loading").addClass("already"),s.text(u.already_follow)):(n.removeClass("canceling").removeClass("already"),r.be_followed&&n.removeClass("both"),s.text(u.follow)),e(".personPanelBar3List li[recommend_uid="+r.uid+"]").fadeOut()},function(e,t,i){r.lock=undefined,helper.doChangeOptions(n,r),n.removeClass("loading").removeClass("canceling"),s.text(n.attr("otext")),r.be_followed&&r.is_follow&&n.addClass("both"),t&&o.alert(t.msg)})}return !1},release:function(){e(".followBtn[data-options]").off("click"),e(".addBtn[data-options],.addBtn2[data-options]").off("click"),e(".personal_operate[data-options]").off("click")}});return new a({model:new i})}),define("model/letter",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{id:0,nickname:"",content:"",ids:[],pass:0},add:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/msgcenter/create_letter",type:"post",dataType:"json",data:{to_nickname:r.get("nickname"),content:r.get("content")},success:function(e,r,i){r.res!==!1?t(e,r,i):n(e,r,i)},error:function(e,t,r){n(e,null,r)}})},del:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/msgcenter/destroy_letter",type:"post",dataType:"json",data:{id:r.get("id")},success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},delAll:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/msgcenter/destroy_letter_with_uid",type:"post",dataType:"json",data:{uid:r.get("id")},success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},delArray:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/msgcenter/batch_destroy_letter",type:"post",dataType:"json",validate:!1,data:{ids:r.get("ids")},success:function(e,r,i){r.res===!0?t(e,r,i):n(e,r,i)}})},validate:function(e,t){if(!e.nickname){return"收件人不能为空"}if(!e.content){return"发送消息不能为空"}if(e.pass){return"消息字数超出"}}});return r}),define("model/search",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{scope:"",keywords:undefined,title:undefined},searchUrl:"/s/search/suggest",setSearchUrl:function(e){this.searchUrl=e},doSearch:function(t,n){t=t||e.noop,n=n||e.noop;var r=this.searchUrl,i=this.toJSON();e.ajax({url:r,type:"get",cache:!1,data:i,dataType:"json",success:function(e){t(e)},error:function(e){n(e)}})},doSearchUsers:function(t,n){t=t||e.noop,n=n||e.noop,e.ajax({url:"/quan_suggest?q="+this.get("keywords"),type:"get",success:function(e){t(e)},error:function(e){n(e)}})}});return r}),define("module/common/userview",["jquery","underscore","backbone"],function(e,t,n){var r=['<a class="attextbox_data" href="javascript:void(0);">',"	<span><%=title%></span>","</a>"].join(""),i=n.View.extend({template:t.template(r),tagName:"dl",className:"clearfix_after attextbox_data1",events:{click:"doClick"},doClick:function(){this.model.get("input")&&this.model.get("input").val(this.model.get("title"))},initialize:function(){this.model.on("change:checked",function(){this.render()},this),this.model.on("change:click",function(){this.$el.click()},this)},render:function(e){var t=this;return t.$el.attr("idx",e).html(t.template(t.model.toJSON())),this.model.get("checked")?t.$el.addClass("dropListselect"):t.$el.removeClass("dropListselect"),t.$el}});return i}),define("module/common/iletterbox",["jquery","underscore","backbone","json2","model/search","module/common/userview"],function(e,t,n,r,i,s){var o=['	<div class="selectItem">','   <div class="container"></div>    ',"	</div>"].join(""),u=n.View.extend({isChange:!0,index:0,className:"dropList",list:new n.Collection,template:t.template(o),initialize:function(){this.model.on("change:keywords",this.ChangeKeyword,this),this.render()},ChangeKeyword:function(){this.isChange=!0},doChangeIndex:function(e,t){var n=this,r=n.data.length;if(r){switch(e){case 13:t.val(n.list.models[n.index].get("title")),t.trigger("blur");break;case 40:n.list.models[n.index].set("checked",!1),n.index>=n.data.length-1?n.index=0:n.index++,n.list.models[n.index].set("checked",!0);break;case 38:n.list.models[n.index].set("checked",!1),n.index==0?n.index=n.data.length-1:n.index--,n.list.models[n.index].set("checked",!0)}}return !1},bind:function(e){var t=this,n=e.val();t.isChange=!1,t.model.set("keywords",n),t.isChange?t.model.doSearchUsers(function(n){n&&n!=" "?n=n.split(","):n=[],t.data=n,t.doDealData(e)},function(e){}):t.data&&t.doDealData(e)},doDealData:function(e){if(!this.data){return}var t=this.data.length;this.list.reset();if(t){this.$(".container").empty();for(var n=0;n<t;n++){var r=new i({title:this.data[n],checked:n==0,input:e}),o=new s({model:r});
this.list.add(r),this.$(".selectItem .container").append(o.render())}this.index=0}else{this.$(".selectItem .container").html("没有匹配的用户")}e.after(this.$el.show())},render:function(){this.$el.html(this.template())},release:function(){e.attextbox("destroy",!0)}});return new u({model:new i})}),define("plugin/count_char",["jquery"],function(e){function i(i,o,u,a){a=e.extend({},n,a),a.maxLength=u?u:a.maxLength;var f=e(o),l=e(i);s(l,f,a),l.bind("keydown keyup focus change input blur",function(e){r&&clearTimeout(r),r=setTimeout(function(){t(e.type),s(l,f,a)},100)}).bind("paste cut",function(){window.clipboardData&&setTimeout(function(){l.change()},0)})}function s(t,n,r){var i=0;if(t.attr("placeholder")!=t.val()||!t.hasClass("placeholder")){var s=/[\u0391-\uFFE5]/g,o=t.val().replace(s,"aa");o=e.trim(o),i=Math.ceil(o.length/2)}var u="";i<=r.maxLength?(u=r.text.replace(/\{count\}/,function(){return Math.abs(r.maxLength-i)}),n.addClass(r.textCss).removeClass(r.passTextCss),t.removeAttr("pass"),t.trigger("count_ok")):(u=r.passText.replace(/\{count\}/,function(){return Math.abs(i-r.maxLength)}),n.addClass(r.passTextCss),t.attr("pass",Math.abs(i-r.maxLength)),t.trigger("count_pass")),n.html(u)}var t=function(e){return},n={maxLength:140,text:"您还可以输入<span>{count}</span>字",passText:"已超出<span>{count}</span>字",textCss:"count-tip",passTextCss:"pass-count-tip"},r=0;return i}),define("module/common/iletter",["jquery","underscore","backbone","model/letter","plugin/dialog","module/common/iletterbox","plugin/count_char","plugin/face","plugin/jquery.parser"],function(e,t,n,r,i,s,o,u){var a=['   <dl class="popup_dl">',"		<dt>发给</dt>",'		<dd><input type="text" value="<%=nickname%>" /></dd>',"	</dl>",'	<dl class="popup_dl">',"		<dt>内容</dt>","		<dd><textarea><%=content%></textarea></dd>","	</dl>",'	<div class="popup_btm">','		<div class="fr">','			<span class="charCount">还剩<em>300</em>字</span>','			<a class="faceBtn" href="javascript:;"></a>','			<a class="hidden" dialog-role="close" href="javascript:;"></a>','			<a class="submitBtn" href="javascript:;"><span>发送</span></a>',"		</div>","    </div>"].join(""),f=n.View.extend({template:t.template(a),initialize:function(){this.model.on("invalid",function(e,t){i.alert(t)}),this.render()},events:{"keyup input[type='text']":"doKeyPress","click input[type='text']":"doKeyPress","blur input[type='text']":"doBlur","click .submitBtn":"doSubmitLetter"},doBlur:function(){setTimeout(function(){s.$el.hide()},200)},doSubmitLetter:function(){var e=this,t=e.$(".popup_dl input").val(),n=e.$(".popup_dl textarea").val(),r=e.$(".popup_dl textarea").attr("pass");r||(r=0),e.model.set({nickname:t,content:n,pass:r}),e.model.isValid()&&(e.undelegateEvents(),e.model.add(function(){e.$("[dialog-role='close']").click(),i.success("发送成功"),e.delegateEvents(e.events)},function(t,n){n&&i.alert(n.msg),e.delegateEvents(e.events)}))},doKeyPress:function(t){var n=e(t.currentTarget);switch(t.keyCode){case 13:case 38:case 40:s.doChangeIndex(t.keyCode,n);break;default:s.bind(n)}return !1},init:function(){this.release(),e(".sendLetterBtn").on("click",[this],this.doSendLetter)},bind:function(e){e.on("click",[this],this.doSendLetter)},bindDel:function(e){e.on("click",[this],this.doDelLetter)},doSendLetter:function(t){var n=t.data[0],r=e.extend({},e.parser.parseOptions(this,[{nickname:"string"}]));return n.model.set({nickname:"",content:"",pass:0},{silent:!0}),r.nickname&&n.model.set("nickname",r.nickname),n.render(),n.doShowDialog(),!1},doDelLetter:function(t){var n=e(this),r=t.data[0],s=e.extend({},e.parser.parseOptions(this,[{id:"number"}]));s.id&&s.lock!==!0&&(s.lock=!0,helper.doChangeOptions(n,s),r.model.set({id:s.id,nickname:"000",content:"000"},{silent:!0}),r.model.delAll(function(){s.lock=undefined,helper.doChangeOptions(n,s),n.closest(".msg_notice_item").slideUp()},function(e,t){s.lock=undefined,helper.doChangeOptions(n,s),i.alert(t.msg)}))},doShowDialog:function(){var t=this,n=e.extend({id:"dialog_letter",dialogClass:"letter",header:"发私信",content:t.$el,onYes:function(){return !0}},{}),r=new i.Dialog(n);r.open()},render:function(){this.$el.empty().html(this.template(this.model.toJSON())),o(this.$(".popup_dl textarea"),this.$(".charCount"),300,{text:"还剩<em>{count}</em>字",passText:"超出<em>{count}</em>字"}),u.init(this.$(".faceBtn"),this.$(".popup_dl textarea")),this.undelegateEvents(),this.delegateEvents(this.events)},release:function(){e(".sendLetterBtn").off("click"),this.$el.empty()}});return new f({model:new r})}),define("module/card",["jquery","underscore","backbone","model/user","module/common/ifollow","module/common/iletter"],function(e,t,n,r,i,s){var o={$pop:e("").appendTo(""),init:function(){this.$pop.on({mouseenter:function(){var t=e(this);t.data("hideTimeoutId")&&clearTimeout(t.data("hideTimeoutId"))},mouseleave:function(){var t=e(this),n=setTimeout(function(){t.hide().html("")},100);t.data("hideTimeoutId",n)}})},render:function(t){var n=t||{},r=n.$container,i;r?i=r.find("[card]"):i=e("[card]");for(var s=0,o=i.length;s<o;
s++){var u=i.eq(s);!u.data("cardEventBinded")&&u.attr("card")&&this.eventBind(u)}},eventBind:function(t){var n=this;t.data("cardEventBinded",!0),t.on({mouseenter:function(){n.onMouseenter(e(this))},mouseleave:function(){n.onMouseleave(e(this))},click:function(){e(this).mouseleave()}})},onMouseenter:function(n){if(helper.isWindowBusy()){return}var o=this.$pop;o.data("hideTimeoutId")&&clearTimeout(o.data("hideTimeoutId"));var u=n.attr("card"),a=n.attr("card_type")||"",f=u.charAt(0)=="n",l=setTimeout(function(){var l=new r;f?l.set("nickname",u.substring(1)):l.set("id",u),l.query({success:function(r){var u="",f=r.toJSON();if(n.parents("body").size()===0){return}t.isEmpty(f)?(o.addClass("nobody"),u=t.template(['<div class="userCard">','<p class="desc">该昵称目前不存在哟╮(╯▽╰)╭</p>',"</div>",'<div class="arrow"><i></i></div>'].join(""))):(o.removeClass("nobody"),f.card_type=a,u=t.template(['<div class="userCard_info">','<div class="left">','<a class="userface" href="<%=(helper.isLogin())?"/#":""%>/zhubo/<%=id%>/">',"<%if(avatarUrl60){%>",'<img alt="" src="<%=avatarUrl60%>">',"<%}%>","</a>","</div>",'<div class="right <%=(province||city)?"":"area-unexist"%>">','<a class="title" href="<%=(helper.isLogin())?"/#":""%>/zhubo/<%=id%>/">',"<%=nickname%>","<%if (isVerified){%>",'<i class="VIcon" title="喜马拉雅认证播主">&nbsp;</i>',"<%}%>","</a>",'<p class="area"><%=province%> <%=(province&&city)?"•":""%> <%=city%></p>','<div class="count">','<a class="count_sound" href="<%=(helper.isLogin())?"/#":""%>/<%=id%>/sound/" title="声音"><%= tracksCount%></a>','<a class="count_attention" href="<%=(helper.isLogin())?"/#":""%>/<%=id%>/follow/" title="关注"><%=followingsCount%></a>','<a class="count_fans" href="<%=(helper.isLogin())?"/#":""%>/<%=id%>/fans/" title="粉丝"><%=followersCount%></a>',"</div>","</div>","</div>",'<p class="userCard_intro">','<%=_.escape(isVerified?(ptitle||personalSignature||"这家伙很懒，什么都没留下"):(personalSignature||"这家伙很懒，什么都没留下"))%>',"</p>","<%if (!(config && config.CURRENT_USER && config.CURRENT_USER.uid == id)){%>",'<div class="userCard_operate">',"<% if(isNotFollowing){%>",'<a class="addBtn2 small j-follow" data-options="uid:<%=id%>,is_follow:false,nickname:\'<%=nickname%>\',is_from_cache:true"><span class="default">关注</span><span class="hover">取消</span></a>',"<%}else{%>",'<a class="addBtn2 small already <%=beFollowed?"both":""%> j-follow" data-options="uid:<%=id%>,is_follow:true,nickname:\'<%=nickname%>\',is_from_cache:true" href="javascript:;"><span class="default"><%=beFollowed?"相互关注":"已关注"%></span><span class="hover">取消</span></a>',"<%}%>",'<a class="j-letter" data-options="nickname:\'<%=nickname%>\'">发私信</a>',"</div>","<%}%>",'<span class="arrow_popup"><i></i></span>'].join("")));var l=30,c=10,h=10,p=10,d=n.width(),v=n.height(),m=n.offset().left,g=n.offset().top,y=0,b=0;o.html(u(f)).css({top:-1000}).show(),i.doBindOne(o.find(".j-follow")),s.bind(o.find(".j-letter"));var w="",E=o.width(),S=o.height()+22;m+E<document.body.clientWidth?(w+="l",b=m+d/2-l):(w+="r",b=m+d/2-E+c),g>S+h+e(document).scrollTop()?(w+="b",y=g-S-h):(w+="t",y=g+v+p),o.removeClass("lb").removeClass("lt").removeClass("rb").removeClass("rt").addClass(w).css({left:b+"px",top:y+"px"}).hide().fadeIn(100)}})},200);n.data("popTimeoutId",l)},onMouseleave:function(e){var t=this.$pop,n=e.data("popTimeoutId");if(n){clearTimeout(n);var r=setTimeout(function(){t.hide().html("")},100);t.data("hideTimeoutId",r)}},hidePop:function(){this.$pop.hide()},release:function(){this.hidePop()}};return e(window).bind("scroll",function(){o.hidePop()}),o.init(),o}),define("plugin/jquery.default_image",["jquery"],function(e){e.fn.defaultImage=function(){return this.find("img").off("error").on("error",function(){var t=e(this),n=t.parent();n.addClass("is-error"),t.remove()}),this}}),define("module/default_image",["jquery","underscore","backbone","plugin/jquery.default_image"],function(e,t,n){var r={init:function(){this.render()},render:function(t){var n=t||{},r=n.$container,i;r?i=r.find(".userface,.albumface,.soundface"):i=e(".userface,.albumface,.soundface"),i.defaultImage()},release:function(){}};return r}),define("plugin/jquery.attextbox",["jquery","plugin/jquery.parser"],function(e){(function(e){function u(e,t){return e.attr?e.style[t]:e.currentStyle?e.currentStyle[t]:document.defaultView&&document.defaultView.getComputedStyle?(t=t.replace(/([A-Z])/g,"-$1").toLowerCase(),document.defaultView.getComputedStyle(e,null).getPropertyValue(t)):null}function a(e){var t=e.createTextRange();t.collapse(!0),t.moveStart("character",this.textinfo.index),t.select(),e.scrollTop=10000000,e.scrollLeft=10000000}function f(t){if(t.selectionStart){return{index:t.selectionStart}}if(document.selection){var n=document.selection.createRange();if(n==null){return t.value.length}var r=t.createTextRange(),i=r.duplicate(),s=0;return r.moveToBookmark(n.getBookmark()),i.setEndPoint("EndToStart",r),s=i.text.replace(/\r/g,"").length,s==0&&(s=e(t).val()),{index:i.text.replace(/\r/g,"").length,text:i.text}}return{index:t.value.length,text:t.value}
}function l(e){var t=e.attextbox("options");t.offset=e.offset(),r.css({left:t.offset.left,top:t.offset.top+50,width:e.outerWidth(),height:e.outerHeight()+20})}function c(e){var t=e.attextbox("options"),n=t.position,r=e.val().substr(0,n),s=r.lastIndexOf("@"),u=r.substr(n-1,1);r=r.substring(s+1,n),s>=0&&u!=" "&&!r.match(":|：")&&!/[\s|\n|\r]/g.test(r)?(l(e),h(e,s,r)):(o=!1,i.hide())}function h(t,n,s){var o=t.attextbox("options"),u=t.val().substr(0,n),a=e("<span>&nbsp;</span>"),f=null,l=0,c=0,h={leftfrom:0,leftto:0,topfrom:0,topto:0,width:0,height:0};f=t.offset(),h.width=t.outerWidth(!0),h.height=t.outerHeight(!0),h.leftfrom=f.left,h.leftto=f.left+h.width,h.topfrom=f.top,h.topto=f.top+h.height,o.lastIndex=n,a.attr("class",t.attr("class")),u=u.replace(/\n/g,"</br>"),u=u.replace(/\s/g,"&nbsp;"),r.html(u),r.append(a),f=a.offset(),r.scrollLeft(r[0].scrollWidth-r.outerWidth(!1)),r.scrollTop(r[0].scrollHeight-r.outerHeight(!0)),l=Math.abs(r.scrollLeft()-t.scrollLeft()),c=Math.abs(r.scrollTop()-t.scrollTop()),l=h.width-h.leftto+f.left+h.leftfrom-l,c=h.height+o.lineheight-h.topto+f.top+h.topfrom-c-25,i.css({left:l>h.leftto?h.leftto:l,top:c>h.topto?h.topto:c}),p(t,s)}function p(e,t){var n=e.attextbox("options");t=t||"",n.selected=-1,n.onCallData.call(e,i,t,function(e){o=!0,n.selected=0,n.count=e})}function d(t){var n=e(t);e.fn.attextboxinit(),n.on("focus",v),n.on("keydown",m),n.on("keyup click",g),n.on("blur",y)}function v(t){var n=e(t.currentTarget),s=n.attextbox("options");i.hide(),r.attr("class",n.attr("class")),r.css({"white-space":s.nowrap,font:s.font,"font-family":u(n[0],"font-family"),"font-size":u(n[0],"font-size")}),l(n),i.off("click").on("click",".attextbox_data1",[n],b)}function m(e){if(o){switch(e.keyCode){case 13:case 38:case 40:return !1}}}function g(t){var n=e(t.currentTarget),r=n.attextbox("options");clearTimeout(s);if(t.keyCode){switch(t.keyCode){case 13:case 38:case 40:return r.onKeyClick.call(n,t.keyCode)}}r.textinfo=f(n[0]),r.offset=n.offset(),r.position=r.textinfo.index,c(n),r.lastIndex=r.position}function y(e){clearTimeout(s),s=setTimeout(function(){i.hide(),o=!1},300)}function b(t){var n=e(t.currentTarget).find("span"),r=e(t.data[0]),i=r.attextbox("options"),s=r.val(),o=s.substr(0,i.position),u=s.substr(i.position),a=o.lastIndexOf("@"),f=u.substr(0,1);return f!=" "&&(u=" "+u),o=o.substring(0,a+1),s=o+n.text()+u,r.val(s),i.lastIndex=i.textinfo.index+n.text().length+2,r.focus(),!1}function w(t,n){var r=e(t);return r.off("focus",v),r.off("keydown",m),r.off("keyup click",g),r.off("blur",y),n===!0&&e.fn.attextboxdestroy(),r}var t="<div id=\"attextbox_positionpanel\" style='visibility:hidden;width:185px;overflow:auto;white-space:nowrap;position:absolute;z-index:99999;background:#e5e5e5;'></div>",n="<div id=\"attextbox_panel\" style='position:absolute;z-index:99999;'></div>",r=null,i=null,s=0,o=!1;e.fn.attextboxinit=function(){var s=e("#attextbox_panel"),o=e("#attextbox_positionpanel")},e.fn.attextboxdestroy=function(){var t=e("#attextbox_panel"),n=e("#attextbox_positionpanel");t.size()&&(t.off("click"),t.remove()),n.size()&&n.remove()},e.fn.attextboxlocked=function(){return o},e.fn.attextbox=function(t,n){return typeof t=="string"?e.fn.attextbox.methods[t](this,n):(t=t||{},this.each(function(){var n=e.data(this,"attextbox");n?e.extend(n.options,t):(n=e.data(this,"attextbox",{options:e.extend({},e.fn.attextbox.defaults,e.fn.attextbox.parseOptions(this),t)}),d(this))}))},e.fn.attextbox.methods={options:function(t,n){return n=n||"options",e.data(t[0],"attextbox")[n]},destroy:function(e,t){w(e,t)}},e.fn.attextbox.parseOptions=function(t){return e.extend({},e.parser.parseOptions(t,[{showBar:"boolean",fixed:"boolean"}]))},e.fn.attextbox.defaults=e.extend({},{nowrap:"nowrap",font:"inherit",onCallData:function(e,t,n){},onKeyClick:function(e){},lastIndex:0,lineheight:0,position:0,offset:{},count:0,selected:-1})})(e)}),define("module/common/iattextbox",["jquery","underscore","backbone","json2","model/search","module/common/userview","plugin/jquery.attextbox"],function(e,t,n,r,i,s){var o=['	<div class="selectItem">','		<p class="tit">选择需要@的人或直接输入</p>','   <div class="container"></div>    ',"	</div>"].join(""),u=n.View.extend({isChange:!0,className:"dropList",template:t.template(o),list:null,index:0,initialize:function(){this.list=new n.Collection,this.model.on("change:keywords",this.ChangeKeyword,this),this.render()},ChangeKeyword:function(){this.isChange=!0},bind:function(t,n){var r=this;t.attextbox(e.extend(n,{onKeyClick:function(e){var t=r.data.length;if(t){switch(e){case 13:r.list.models[r.index].set("click",!0);break;case 40:r.list.models[r.index].set("checked",!1),r.index>=r.data.length-1?r.index=0:r.index++,r.list.models[r.index].set("checked",!0);break;case 38:r.list.models[r.index].set("checked",!1),r.index==0?r.index=r.data.length-1:r.index--,r.list.models[r.index].set("checked",!0)}}return !1},onCallData:function(e,t,n){r.isChange=!1,r.model.set("keywords",t),t?r.$(".tit").text("选择昵称或轻敲空格完成输入"):r.$(".tit").text("选择需要@的人或直接输入"),r.isChange?r.model.doSearchUsers(function(t){t=t.split(","),r.data=t,r.doDealData(e),n(r.data.length)
},function(e){}):r.data&&(r.doDealData(e),n(r.data.length))}}))},doDealData:function(e){if(!this.data){return}var t=this.data.length;if(t){this.$(".container").empty(),this.list.reset();for(var n=0;n<t;n++){var r=new i({title:this.data[n],checked:n==0,click:!1}),o=new s({model:r});this.list.add(r),this.$(".selectItem .container").append(o.render())}this.index=0,e.empty().append(this.$el).show()}},render:function(){this.$el.html(this.template())},release:function(){e.attextbox("destroy",!0)}});return new u({model:new i})}),define("plugin/jquery.mousewheel",["jquery"],function(e){var t={};try{(function(){var e=0,n=navigator.userAgent.toLowerCase(),r=function(e){return e.test(n)},i=document,s=i.compatMode=="CSS1Compat",o=r(/opera/),u=r(/\bchrome\b/),a=r(/webkit/),f=!u&&r(/safari/),l=f&&r(/applewebkit\/4/),c=f&&r(/version\/3/),h=f&&r(/version\/4/),p=!o&&r(/msie/),d=p&&r(/msie 7/),v=p&&r(/msie 8/),m=p&&!d&&!v,g=!a&&r(/gecko/),y=g&&r(/rv:1\.8/),b=g&&r(/rv:1\.9/),w=p&&!s,E=r(/windows|win32/),S=r(/macintosh|mac os x/),x=r(/adobeair/),T=r(/linux/),N=r(/ipad/),C=/^https/i.test(window.location.protocol);t={isOpera:o,isIE:p,isIE6:m,isFirefox:g,isSafari:f,isChrome:u,isIpad:N}})()}catch(n){}(function(e){e.event.special.mousewheel={setup:function(){var n=e.event.special.mousewheel.handler;t.isFirefox&&e(this).bind("mousemove.mousewheel",function(t){e.data(this,"mwcursorposdata",{pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY})}),this.addEventListener?this.addEventListener(t.isFirefox?"DOMMouseScroll":"mousewheel",n,!1):this.onmousewheel=n},teardown:function(){var n=e.event.special.mousewheel.handler;e(this).unbind("mousemove.mousewheel"),this.removeEventListener?this.removeEventListener(t.isFirefox?"DOMMouseScroll":"mousewheel",n,!1):this.onmousewheel=function(){},e.removeData(this,"mwcursorposdata")},handler:function(n){var r=Array.prototype.slice.call(arguments,1),i=e.extend({},n||window.event);n=e.event.fix(n||window.event),e.extend(n,e.data(this,"mwcursorposdata")||{});var s=0,o=!0;i.wheelDelta&&(s=i.wheelDelta/120),i.detail&&(s=-i.detail/3),t.isOpera&&(s=-n.wheelDelta),n.data=n.data||{},n.type="mousewheel",r.unshift(s),r.unshift(i);var u=(jQuery._data(this,"events")||{})[n.type]||[],a=e.event.handlers.apply(this,[n,u]),f,l,c,h,p,d,v,m,g,y;for(f=0;f<a.length&&!n.isPropagationStopped();f++){d=a[f],n.currentTarget=d.elem;for(l=0;l<d.handlers.length&&!n.isImmediatePropagationStopped();l++){m=d.handlers[l];if(!n.namespace&&!m.namespace||n.namespace_re&&n.namespace_re.test(m.namespace)){n.data=m.data,n.handleObj=m,h=((jQuery.event.special[m.origType]||{}).handle||m.handler).apply(d.elem,r),n.preventDefault(),n.stopPropagation()}}}}},e.fn.extend({mousewheel:function(e){return e?this.on("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.off("mousewheel",e)}})})(e)}),define("plugin/jquery.eyscroll",["jquery","plugin/jquery.easydrag","plugin/jquery.mousewheel","plugin/jquery.parser"],function(e){(function(e){function t(t,n){var r=e(t),i=r.position(),s=t.scrollHeight,o=r.outerWidth(),u=r.outerHeight();return n.showBar=s>u,u=u-2*n.borderWidthL-0*n.borderWidth,n.panelHeight=u,n.barHeight=u-(s-u),n.barHeight=n.barHeight<n.minBlockHeight?n.minBlockHeight:n.barHeight,n.pix=(s-n.panelHeight)/(s-u),n.pix1=(s-u)/(u-n.barHeight),n.pix1<1&&(n.pix1=1),{height:u,width:o,offset:i}}function n(e,t,n,r,i,s){t.addClass(i.barClass).attr("data-type","eyscroll-bar").css({width:i.barWidth,height:e.height,position:"absolute",display:i.showBar?"":"none",top:e.offset.top+1*i.borderWidth+i.borderWidthL,left:e.offset.left+e.width-i.barWidth-i.borderWidthL}),i.showBar||n.scrollTop(0),r.attr("data-type","eyscroll-barblock").css({width:i.barWidth,height:i.barHeight,position:"absolute",left:0}),s===!0&&r.css("top",0),r.find(".barblock-center").css({height:i.barHeight-7}),i.autoVisible&&i.showBar&&(u(n[0],!1),n.off("mouseenter").on("mouseenter",function(){i.showBar&&(i.mouseEnter=!0,n.eyscroll("setVisible",!0))}).off("mouseleave").on("mouseleave",function(){i.mouseEnter=!1,i.canHide&&n.eyscroll("setVisible",!1)}))}function r(r){var i=e(r),o=i.eyscroll("options"),u=e("<div></div>"),a=e("<div canLeftMove='false'><em class='barblock barblock-top'/><em class='barblock barblock-center'/><em class='barblock barblock-bottom'/></div>"),f=t(r,o);i.addClass(o.eyscrollCls),u.append(a),i.append(u),n(f,u,i,a,o,!0),i.scrollTop(0),a.easydrag(!0,o.autoBindEvent),a.beforeDrag(function(e,t){o.autoBindEvent||a.bindEvent()}),a.ondrag(function(e,t){s(e,t,i,o)}),a.ondrop(function(e,t){o.canHide=!0,o.autoBindEvent||a.unBindEvent(),!o.mouseEnter&&o.autoVisible&&i.eyscroll("setVisible",!1)}),i.mousewheel(function(t,n){var r=e(this).scrollTop();if(n>0){if(r==0){return}}else{if(r/o.pix1>=e(this).outerHeight()){return}}e(this).eyscroll("setHeight",{delta:n,scrollTop:r})})}function i(r,i){var o=r.target,u=e(o),a=u.eyscroll("options");if(a){var f={},l,c;l=u.find("[data-type='eyscroll-bar']"),c=u.find("[data-type='eyscroll-barblock']"),f=t(o,a),n(f,l,u,c,a),i===!0&&c.css("top",0),s(null,c,u,a),a.canHide=!0
}else{u.eyscroll()}}function s(t,n,r,i){var s=e(n),o=s.position(),u=o.top;i.canHide=!1,u<0?u=0:u+(i.barHeight>0?i.barHeight:i.minBlockHeight)>i.panelHeight&&(u=i.panelHeight-(i.barHeight>0?i.barHeight:i.minBlockHeight)),s.css("top",u),u>0&&(u+=i.step/i.pix),r.scrollTop(u*i.pix1)}function o(t,n){var r=e(t),i=r.eyscroll("options"),s=n.scrollTop/i.pix1-n.delta*i.step,o=0;s+=i.step/i.pix*-1*n.delta,o=s*i.pix1,Math.abs(n.scrollTop-o)>i.barHeight*0.75&&(s=n.scrollTop/i.pix1-n.delta*i.barHeight/i.pix1),r.scrollTop(s*i.pix1),s<0&&(r.scrollTop(0),s=0),s+(i.barHeight>0?i.barHeight:i.minBlockHeight)>=i.panelHeight&&(r.scrollTop(i.panelHeight*i.pix1),s=i.panelHeight-(i.barHeight>0?i.barHeight:i.minBlockHeight)),r.find("[data-type='eyscroll-barblock']").css({top:s})}function u(t,n){var r=e(t);n?r.find("[data-type='eyscroll-bar']").fadeIn():r.find("[data-type='eyscroll-bar']").stop().fadeOut()}function a(t){var n=e(t),r=n.find("[data-type='eyscroll-bar']");n.off("resize"),n.unmousewheel(null),n.off("mouseenter").off("mouseleave"),r.empty().remove(),e.data(t,"eyscroll",null),e.fn.easydrag_release(r.attr("id"))}e.fn.eyscroll=function(t,n){if(typeof t=="string"){var i=e.fn.eyscroll.methods[t];return i&&e.isFunction(i)?i(this,n):this}return t=t||{},this.each(function(){var n=e.data(this,"eyscroll");return n?e.extend(n.options,t):(n=e.data(this,"eyscroll",{options:e.extend({},e.fn.eyscroll.defaults,e.fn.eyscroll.parseOptions(this),t)}),r(this)),this})},e.fn.eyscroll.methods={options:function(t,n){if(t.size()){n=n||"options";var r=e.data(t[0],"eyscroll");return r?r[n]:null}},setHeight:function(e,t){if(e.size()){return o(e[0],t)}},setVisible:function(e,t){if(e.size()){return u(e[0],t)}},destroy:function(e){if(e.size()){return a(e[0])}},reset:function(e,t){if(e.size()){return i({target:e[0]},t)}}},e.fn.eyscroll.parseOptions=function(t){return e.extend({},e.parser.parseOptions(t,[{autoResize:"boolean",autoBindEvent:"boolean",autoVisible:"boolean",showBar:"boolean",minBlockHeight:"number",borderWidth:"number",barWidth:"number",step:"number"}]))},e.fn.eyscroll.defaults=e.extend({},{canHide:!0,pix:1,pix1:1,autoResize:!1,autoBindEvent:!1,minBlockHeight:20,eyscrollCls:"eyscroll",borderWidthL:1,borderWidth:1,barWidth:9,barClass:"eyscroll-bar",step:2,autoVisible:!0,showBar:!0})})(e)}),define("module/comment2d/view",["jquery","underscore","backbone","module/common","model/comment_chunkinfo","model/comment_chunk","model/comment","collection/comment","plugin/face","module/share","module/card","module/default_image","plugin/dialog","module/common/iattextbox","module/dialogs/login_box","plugin/jquery.eyscroll"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=r.userModel.get("logoPic"),m=n.View.extend({tagName:"li",template:t.template(['<div class="commentInPop">','<div class="left">',"<%if(avatarPath){%>",'<a card="<%=uid%>" class="userface" href="<%=(helper.isLogin())?"/#":""%>/zhubo/<%=uid%>/"><img src="<%=avatarPath%>" alt=""></a>',"<%}else{%>",'<a card="<%=uid%>" class="userface is-error" href="<%=(helper.isLogin())?"/#":""%>/zhubo/<%=uid%>/"></a>',"<%}%>","</div>",'<div class="right">','<div class="commentInPop_content">','<a card="<%=uid%>"  href="<%=(helper.isLogin())?"/#":""%>/zhubo/<%=uid%>/"><%=nickname%>:</a><%=content%>',"</div>",'<div class="cl">','<span class="commentInPop_createtime"><%= niceTime %></span>','<a class="comment_replyBtn" href="javascript:;">回复</a>',"<%if(config.CURRENT_USER.uid == uid){%>",'<a comment_id="<%=id%>" class="comment_deleteBtn" href="javascript:;">删除</a>',"<%}%>","</div>","</div>","</div>"].join("")),events:{"click .comment_deleteBtn":"onDeleteBtnClick","click .comment_replyBtn":"onReplyBtnClick"},onDeleteBtnClick:function(e){return this.$el.remove(),y.resetScroll(),this.model.del(),y.commentChunkModel.set("count",y.commentChunkModel.get("count")-1),!1},onReplyBtnClick:function(){var e=this.model,t=e.get("trackId"),n=e.get("second"),r=e.get("id"),i=e.get("nickname");return y.$sumbitBtn.attr("track_id",t).attr("second",n).attr("parent_id",r).attr("nickname",i),y.$text.focus(),y.$text.val("回复@"+i+":"),!1},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),g=e(),y={$el:g,$tempContainer:e("body"),$position:g.find(".commentPopBox_position"),$closeBtn:g.find(".commentPop_closeBtn"),$content:g.find(".commentPop_content"),$count:g.find(".commentPopBox_count"),$commentList:g.find(".commentInPopList"),$text:g.find(".commentPop_text"),$bottom:g.find(".commentPop_bottom_bottom"),$myface:e('<div class="chunk_userface myface">'+(v?'<div class="userface"><img src="'+v+'" alt=""></div>':'<div class="userface is-error"></div>')+"</div>"),$onEditFace:e('<div class="chunk_userface onEditFace">'+(v?'<div class="userface"><img src="'+v+'" alt=""></div>':'<div class="userface is-error"></div>')+"</div>"),$sumbitBtn:g.find(".submit2Btn"),isOnManual:!1,isOnEdit:!1,position:0,soundId:"",autoHideTime:5000,autoHideTimeoutId:-1,chunkIndex:-1,commentChunkModel:new s,shareView:null,autoHide:function(e,t){var n=this;
t=t||function(){},this.autoHideTimeoutId=setTimeout(function(){if(n.isOnEdit||n.isOnManual){return}n.afterClose(),t()},e||this.autoHideTime)},clearHide:function(){clearTimeout(this.autoHideTimeoutId)},resetScroll:function(){this.$content.eyscroll("reset",!0)},init:function(){var t=this;this.$content.eyscroll({borderWidth:7}),this.initFace(),e(document).on("click",function(){t.$text.blur(),t.close()}),p.bind(this.$text)},close:function(){this.isOnEdit=!1,this.isOnManual=!1,this.$el.hide(),this.$text.blur(),this.$text.val(""),this.$onEditFace.hide(),this.$bottom.hide(),this.afterClose()},afterClose:function(){var e=this.$el.closest(".chunk_userface");this.$tempContainer.append(this.$el),this.$commentList.children().size()||e.remove()},rendComment:function(e,n){var r=this,i=e?e.get("comments").models:new u;r.$commentList.html(""),r.$count.text(e.get("count")),t.each(i,function(e,t){var n=new m({model:e});n.render(),r.$commentList.append(n.$el)}),r.resetScroll(),r.$count.text(i.length),l.render(),c.render()},isReplying:!1,reply:function(){var t=this,n=this.position,r=this.$sumbitBtn.attr("parent_id"),i=this.$text.val();if(this.isReplying){return}this.isReplying=!0,this.shareView.getShareData(function(s){var u=e.extend({trackId:t.soundId,content:i,parentId:r,second:n},s),a=new o(u),f=a.check();if(f){h.alert(f),t.isReplying=!1;return}a.create(function(e){t.isReplying=!1,t.commentChunkModel.get("comments").unshift(e),t.commentChunkModel.set("count",t.commentChunkModel.get("count")+1);var n=new m({model:e});n.render(),t.$commentList.prepend(n.$el),t.$text.val(""),t.resetScroll(),l.render(),t.$sumbitBtn.attr("parent_id","")},function(e,n){t.isReplying=!1,n.msg&&h.alert(n.msg)})})},initFace:function(){var e=this.$el.find(".faceBtn");if(!e.size()){return}a.init(e,this.$text)},initShare:function(){if(helper.isLogin()&&!this.shareView){var e=new f({$el:this.$el});this.shareView=e}},release:function(){this.close()}};y.init();var b=n.View.extend({_$sound:null,_chunkInfoModel:null,_chunkWidths:[],_isOnEdit:!1,_isOnManual:!1,_width:0,_faceNum:1,events:{"click .chunk_userface":"onChunkUserfaceClick",mousemove:"onMouseMove",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave","mouseenter .chunk":"onChunkMouseEnter",click:"onClick","mouseenter .commentPopBox":"onPopBoxMouseenter","mouseleave .commentPopBox":"onPopBoxMouseleave","focus .commentPop_text":"onFocusCommentPopText","blur .commentPop_text":"onBlurCommentPopText","click .commentPop_closeBtn":"closePop","click .submit2Btn":"reply","keydown .commentPop_text":"onKeydownCommentPopText"},onChunkUserfaceClick:function(t){var n=e(t.target).closest(".chunk_userface");n.append(y.$el)},onMouseEnter:function(e){if(this._isOnEffect){return !1}this.$el.append(y.$myface.hide())},onMouseLeave:function(e){clearTimeout(this._lastOnManualTimeoutId),y.$myface.remove()},onMouseMoveTimeoutId:-1,onMouseMove:function(e){if(y._isOnEffect){return !1}var t=this,n=this._chunkInfoModel;if(!n||!n.get("duration")){return}clearTimeout(this.onMouseMoveTimeoutId),this.onMouseMoveTimeoutId=setTimeout(function(){var n=t.$el,r=e.clientX-n.offset().left,i=e.pageY-n.offset().top;if(Math.abs(r-t._lastLeft)<1){return !1}t._lastLeft=r;if(!(i>0)){y.$myface.hide();return}y._myfaceFadeIn||(y._myfaceFadeIn=!0,y.$myface.fadeIn(function(){y._myfaceFadeIn=!1})),r<=8?y.$myface.css({left:"0px"}):r>=n.width()-8?y.$myface.css({left:n.width()-16+"px"}):y.$myface.css({left:r-8+"px"}),t.showPopOnManual(r)},0)},onPopBoxMouseenter:function(){return y.isOnManual=!0,y.clearHide(),y.$myface.hide(),!1},onPopBoxMouseleave:function(){var e=this;return y.isOnManual=!1,y.autoHide(200,function(){e._lastOnManualIndex=-1,e._isOnManual=!1}),!1},onFocusCommentPopText:function(){y.isOnEdit=!0,y.clearHide(),y.$bottom.show(),y.$text.parent().addClass("focus")},onBlurCommentPopText:function(){y.$text.parent().removeClass("focus")},onKeydownCommentPopText:function(e){if(e.keyCode==13&&!y.$text.attextboxlocked()){return y.reply(),!1}},closePop:function(){y.close()},reply:function(){y.reply()},_isOnManual:!1,_lastOnManualIndex:-1,_lastOnManualTimeoutId:-1,showPopOnManual:function(e){if(y.isOnEdit){return !1}var t=this,n=t._getPosition(e),r=t._chunkInfoModel,i=r.get("duration"),s=r.get("chunks"),o=s.length,u=parseInt(n*o/i);t._lastOnManualIndex!=u&&(t._lastOnManualIndex=u,clearTimeout(t._lastOnManualTimeoutId),s[u]&&s[u].length?t._lastOnManualTimeoutId=setTimeout(function(){t._isOnManual=!0,t.showPop(u,n,i),t.queryAtPosition(n,function(e,n){if(t._isOnManual&&u!=t._lastOnManualIndex){return}y.rendComment(e,n)})},200):t._isOnManual=!1)},_lastOnManualIndex:-1,_lastOnManualTimeoutId:-1,_lastOnAutoIndex:-1,showPopAuto:function(e){if(y.isOnManual||y.isOnEdit||this._isOnManual){return !1}var t=this,n=this._chunkInfoModel;if(!n||!n.get("duration")){return}var r=n.get("duration"),i=n.get("chunks"),s=i.length,o=parseInt(e*s/r);t._lastOnAutoIndex!=o&&(t._lastOnAutoIndex=o,i[o]&&i[o].length&&(t.showPop(o,e,r),t.queryAtPosition(e,function(e,t){y.rendComment(e,t)
})))},onClick:function(t){if(this._isOnEffect){return !1}var n=this.getSoundId();if(!helper.isLogin()){return d.open(function(e){window.location.href="/sound/"+n,d.close()}),!1}this._isOnManual=!1;var r=this,i=this.$el,s=t.pageY-i.offset().top;if(e(t.target).closest(".commentPop_content").size()){return}if(e(t.target).closest(".comment_config").size()){return}if(s<0){return !1}y.isOnEdit=!0;var o=this._chunkInfoModel;if(!o||!o.get("duration")){return !1}var u=t.clientX-i.offset().left,a=this._getIndex(u),f=i.find(".chunk").eq(a),l=this._getPosition(u),c=o.get("duration"),h=null;return f.find(y.$onEditFace).size()?h=y.$onEditFace:(h=y.$onEditFace,f.find(".chunkWrapper").prepend(y.$onEditFace)),y.$onEditFace.show(),r.showPop(a,l,c),setTimeout(function(){y.$text.focus()},0),r.effect(h),this.queryAtIndex(a,function(e,t){y.rendComment(e,t)}),!1},_isOnEffect:!1,effect:function(t){var n=this,r=this.$el;this._isOnEffect=!0,helper.browser.msie&&parseInt(helper.browser.version)<=8?n._isOnEffect=!1:y.$myface.clone().appendTo(r).animate({opacity:0,left:t.offset().left-r.offset().left},{duration:200,complete:function(){e(this).remove(),n._isOnEffect=!1}}),y.$myface.hide()},showPop:function(e,t,n){var r=this,i=this._$sound.attr("sound_id"),s=this.$el.find(".chunk").eq(e);(y.soundId!=i||y.chunkIndex!=e)&&y.$commentList.html(""),y.clearHide(),y.position=t,y.soundId=i,y.chunkIndex=e,y.$position.text(helper.getTime(t*1000)),s.prepend(y.$el),y.$el.toggleClass("is-budAtRight",t/n>0.5),y._isOnFadeIn||(y._isOnFadeIn=!0,y.$el.hide().fadeIn(200,function(){y._isOnFadeIn=!1})),y.autoHide(5000,function(){r._lastOnManualIndex=-1,r._isOnManual=!1}),y.initShare()},queryAtPosition:function(e,t){var n=this._chunkInfoModel,r=n.get("duration"),i=n.get("chunks"),s=i.length,o=parseInt(e*s/r),u=this.$el.find(".chunk").eq(o),a=u.find(y.$el);if(a.size()&&!a.is(":hidden")){return}this.queryAtIndex(o,t)},queryAtIndex:function(e,t){var n=this,r=new s({id:this._$sound.attr("sound_id")+"_"+e,soundId:this._$sound.attr("sound_id"),index:e});r.query({success:function(e,r){y.commentChunkModel&&y.commentChunkModel.off(null,null,n),y.commentChunkModel=e,y.commentChunkModel.on("change",n.onPopBoxCommentChunkModelChange,n),t(e,r)}})},initialize:function(){var e=this.$el;this._$sound=e.closest("[sound_id]"),this._width=e.width()},render:function(){var e=this,t=this.getSoundId(),n=this._chunkInfoModel;if(!n||t!=n.id){n=new i({id:t}),this._chunkInfoModel=n}n.query({success:function(t){e._chunkInfoModel=t,e._render()}})},_render:function(){var e=this,n=this.$el,r="",i=parseInt(this._width),s=this._chunkInfoModel;if(!n.data("chunkNumBinded")){n.data("chunkNumBinded",!0);var o=i>=500?18:16,u=s.get("chunks"),a=u.length,f=i/a,l=parseInt((f+1)/o,10),h=parseInt(i/a,10),p=f==h?h:h+1,d=p*a-i,v=a-d;this._chunkWidths=[],this._faceNum=l,t.each(u,function(t,n){var i=n<v?p:h,s='style="width:'+i+'px;"';e._chunkWidths.push(i);var o="";for(var u=0,a=t.length;u<a&&u<l;u++){o+='<div class="chunk_userface">'+(t[u]?'<div class="userface"><img src="'+t[u]+'" alt=""></div>':'<div class="userface is-error"></div>')+"</div>"}r+='<div class="chunk" chunkindex="'+n+'" hidefocus="true" '+s+'><div class="chunkWrapper">'+o+"</div></div>"}),n.html(r),this.bindEvents(),c.render({$container:n})}},onPopBoxCommentChunkModelChange:function(){var n=y.commentChunkModel.get("comments").models,r=this._chunkInfoModel.get("chunks"),i=y.chunkIndex,s=this._faceNum,o="",u=this.$el.find(".chunk").eq(i),a=t.map(n,function(e){return e.get("avatarPath")});r[i]=a;for(var f=0,l=a.length;f<l&&f<s;f++){o+='<div class="chunk_userface">'+(a[f]?'<div class="userface"><img src="'+a[f]+'" alt=""></div>':'<div class="userface is-error"></div>')+"</div>"}u.find(".chunk_userface:not(.onEditFace)").remove(),y.$onEditFace.hide().appendTo(e("body")),u.find(".chunkWrapper").html(o),y.$count.text(n.length),this.updateCount()},updateCount:function(){var e=y.commentChunkModel,t=this._$sound.find(".commentBtn");if(!t.size()){return}var n=t.find(".count");if(!n.size()){return}var r=parseInt(n.text(),10);e.previous("count")>e.get("count")?r--:e.previous("count")<e.get("count")&&r++,n.text(r)},_getChunkUserfaceIndex:function(e){return parseInt(e/16)-1},_getPosition:function(e){var t=this._chunkInfoModel,n=this.$el.width(),r=t.get("duration");return e/n*r},_getIndex:function(e){var t=0;for(var n=0,r=this._chunkWidths.length;n<r;n++){t+=this._chunkWidths[n];if(t>e){return n}}},setChunkInfoModel:function(e){this._chunkInfoModel=e},bindEvents:function(){},getSoundId:function(){return this._$sound.attr("sound_id")},release:function(){y.commentChunkModel.off(null,null,this),y.release(),this.undelegateEvents()}});return b}),define("module/player/extend/comment2d",["jquery","underscore","backbone","helper","model/sound","../model","../base","module/comment2d/view"],function(e,t,n,r,i,s,o,u){var a=o.prototype,f=t.clone(a);return t.extend(a,{_$commentbar:null,_comment2dView:null,initialize:function(){var e=this.$el;f.initialize.apply(this,arguments),this._$commentbar=this.find(".player_commentbar"),this.createComment2dView()
},getComment2dView:function(){return this._comment2dView},hasComment2d:function(){return !!this._comment2dView},createComment2dView:function(){this._$commentbar.size()&&(this._$commentbar.eq(0).is(":hidden")||(this._comment2dView=new u({el:this._$commentbar[0]})))},getComment2dView:function(){return this._comment2dView||this.createComment2dView(),this._comment2dView},onSoundWhileplaying:function(e,t){return f.onSoundWhileplaying.apply(this,arguments)?(this.hasComment2d()&&(this._comment2dView.$el.is(":hidden")||this._comment2dView.showPopAuto(t.position/1000)),!0):!1}}),o}),define("collection/comment_chunkinfo",["jquery","underscore","backbone","model/comment_chunkinfo"],function(e,t,n,r){var i=n.Collection.extend({model:r,fetch:function(e){e=e||{},e.data=e.data||{},e.data.track_ids=e.ids.join(","),t.extend(e,{url:"/track_blocks/avatars",type:"get"}),n.Collection.prototype.fetch.call(this,e)},parse:function(e,n){return t.map(e,function(e,t){var n={},r=e[0],i=e[1],s=e[2],o=[];for(var u=0;u<r;u++){o.push(i[u]||[])}var a=[o,s];return n[t]=a,n})}});return i}),define("module/comment2d/comment2d",["jquery","underscore","backbone","collection/comment_chunkinfo"],function(e,t,n,r){var i={render:function(e){var n=[],i;for(var s=0,o=e.length;s<o;s++){i=e[s];var u=i.getSoundId();t.indexOf(n,u)==-1&&n.push(u)}var a=new r;a.query({ids:n,success:function(t){for(var n=0,r=e.length;n<r;n++){var i=e[n],s=i.getSoundId();i.setChunkInfoModel(t.get(s)),i.render()}}})}};return i}),define("module/player/extend/expand",["jquery","underscore","backbone","helper","../model","../base","module/wave","module/comment2d/comment2d"],function(e,t,n,r,i,s,o,u){var a=i.mainPlayer,f=i.playState,l=s.prototype,c=t.clone(l);return t.extend(l,{_$expandBox:null,_$unexpandBox:null,initialize:function(){var e=this.$el;this._$expandBox=this.find(".sound_expandBox"),this._$unexpandBox=this.find(".sound_unexpandBox"),c.initialize.apply(this,arguments)},events:t.extend({"click .smallPlayer":"smallPlayerClick"},c.events),smallPlayerClick:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}e(t.target).parents(".pin").size()||this._$expandBox.find(".playBtn").size()&&this.play()},onSoundUnexist:function(){if(!c.onSoundUnexist.apply(this,arguments)){return !1}var e=this._$unexpandBox.find(".smallPlayer");return this._$unexpandBox.size()&&!e.find(".smallPlayer_errmsg").size()&&(e.addClass("disabled"),e.append('<div class="disabled smallPlayer_errmsg">该声音不存在</div>'),this._$unexpandBox.find(".smallPlayer").removeClass("player-loading")),!0},onSoundPast:function(){return c.onSoundPast.apply(this,arguments)?(this._$unexpandBox&&this._$unexpandBox.find(".smallPlayer").removeClass("player-loading"),!0):!1},rendPlaybtn:function(){if(!c.rendPlaybtn.apply(this,arguments)){return !1}var e=a.playState();f.PLAYING==e&&this.expand(),this._$unexpandBox&&this._$unexpandBox.find(".smallPlayer").toggleClass("player-loading",f.BUFFERING==e)},play:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}return this._$unexpandBox&&this._$unexpandBox.find(".smallPlayer").addClass("player-loading"),c.play.apply(this,arguments)},pause:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}return this._$unexpandBox&&this._$unexpandBox.find(".smallPlayer").removeClass("player-loading"),c.pause.apply(this,arguments)},expand:function(){var e=this;if(this.$el.is(".disabled")){return}if(this._$expandBox&&!this._$expandBox.size()){return}this._$expandBox.is(":hidden")&&(this._$expandBox.show(),this._$unexpandBox.hide(),this._$expandBox.find(".middlePlayer").css("opacity",0.1).animate({opacity:1},400),o.render({$container:e.$el}),this.createComment2dView(),this.hasComment2d()&&u.render([this.getComment2dView()]),this.$el.trigger("onExpand"))}}),s}),define("model/forward",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({check:function(t,n){var t=this.toJSON(),r=/[\u0391-\uFFE5]/g,i=e.trim(t.content).replace(r,"aa"),s=Math.ceil(i.length/2);if(s>30){return"转采不能超过30个字。"}},create:function(t,n){t=t||e.noop,n=n||e.noop,this.save({},{url:"/handle_track/relay",data:{no_more_alert:this.get("no_more_alert"),id:this.get("trackId"),content:this.get("content"),sharing_to:this.get("sharing_to")},type:"post",success:function(e,r,i){if(r.res===!1){n(e,r);return}t(e,r)},error:function(e,t,r){n(e,t,r)}})}});return r}),define("module/comment_box",["jquery","underscore","backbone","model/comment","model/forward","plugin/count_char","plugin/face","module/share","plugin/dialog","module/common/iattextbox"],function(e,t,n,r,i,s,o,u,a,f){var l=n.View.extend({initialize:function(t){this.trackId=t.trackId,this.parentId=t.parentId||"",this.second=t.second||"",this.success=t.success||e.noop,this.error=t.error||e.noop,this.isForward=t.isForward,this.isForward?this.forwardModel=new i:this.commentModel=new r,this.beforeComment=t.beforeComment||e.noop;var n=t.$el;this.$el=n,this.$input=t.$input||n.find(".commentBox_inputBox input[type=text]"),this.$submitBtn=t.$submitBtn||n.find(".submitBtn"),this.$charCount=t.$charCount||this.$el.find(".charCount"),this.$closeBtn=n.find(".closeBtn"),this.initCount(),this.initFace(),this.initShare(),this.bindEvents()
},bindEvents:function(){var e=this.$submitBtn,t=this;e.on("click",function(){e.addClass("is-loading"),t.createComment(function(){e.removeClass("is-loading")})}),this.$closeBtn.on("click",function(){t.$el.stop().slideToggle()}),this.$input.on({count_ok:function(){t.$el.removeClass("is-error")},count_pass:function(){t.$el.addClass("is-error")}}),f.bind(this.$input)},initCount:function(){var e=this.$charCount;if(!e.size()){return}var t=140;this.isForward&&(t=30),s(this.$input,e,t,{text:"还剩<em>{count}</em>字",passText:"超出<em>{count}</em>字"})},initFace:function(){var e=this.$el.find(".faceBtn");if(!e.size()){return}o.init(e,this.$input)},initShare:function(){var e=new u({$el:this.$el});this.shareView=e},createForward:function(t){t=t||e.noop;var n=this,r=e.trim(this.$input.val()),i={content:r,trackId:n.trackId},s=this.beforeComment(i);this.shareView.getShareData(function(r){i=e.extend(i,s,r),n.forwardModel.set(i);var o=n.forwardModel.check();if(o){a.alert(o),n._isAjax=!1,t();return}n.forwardModel.create(function(e,r){n.commentSuccess(e,r),a.success("转采成功"),n._isAjax=!1,t()},function(e,r,i){n.commentError(e,r,i),n._isAjax=!1,t()})})},createComment:function(t){t=t||e.noop;if(this._isAjax){return}this._isAjax=!0;if(this.isForward){this.createForward(t);return}var n=this,r=e.trim(this.$input.val());if(!r){a.alert("评论不能为空"),this._isAjax=!1,t();return}var i={content:r,trackId:n.trackId,parentId:n.parentId,second:n.second},s=this.beforeComment(i);this.shareView.getShareData(function(r){i=e.extend(i,s,r),n.commentModel.set(i);var o=n.commentModel.check();if(o){a.alert(o),n._isAjax=!1,t();return}n.commentModel.create(function(e,r){n.commentSuccess(e,r);var s="评论成功";i.parentId&&(s="回复成功"),a.success(s),t()},function(e,r,i){n.commentError(e,r,i),t()})},function(){n._isAjax=!1,t()})},commentSuccess:function(e,t){this._isAjax=!1,this.$input.val(""),this.$input.blur(),this.success(t)},commentError:function(e,t,n){this._isAjax=!1,this.error(t);if(t.status==400){return}a.alert(t.msg||"服务器繁忙,请稍后再试!")},release:function(){var e=this.$el;e.off(),e.empty()}});return l}),define("module/dialogs/forward",["jquery","plugin/dialog","module/comment_box"],function(e,t,n){var r={open:function(t,n,r){this.callback=r||e.noop,this.track_id=t,this.isComment=n,this.createPop()},createPop:function(){var e=this,r={text:"转采",count:30,type:"relay"};this.isComment&&(r={text:"评论",count:140,type:"comment"});var i='<textarea placeholder="写点'+r.text+'理由吧"></textarea>'+'<div class="popup_btm">'+'<div class="fl">'+"<span>分享到</span>"+'<a href="javascript:;" class="qqWeiboBtn" data-name="tQQ" data-type="'+r.type+'" title="腾讯微博"></a>'+'<a href="javascript:;" class="qZoneBtn" data-name="qzone" data-type="'+r.type+'" title="qq空间"></a>'+'<a href="javascript:;" class="sinaWeiboBtn" data-name="tSina" data-type="'+r.type+'" title="新浪微博"></a>'+'<a href="javascript:;" class="renrenBtn" data-name="renren" data-type="'+r.type+'" title="人人网"></a> '+'<a href="/passport/profile"  target="_blank">配置</a></div>'+'<div class="fr"><span class="charCount">还剩<em>'+r.count+"</em>字</span>"+'<a href="javascript:;" class="faceBtn"></a>'+'<a href="javascript:;" class="submitBtn"><span>'+r.text+"</span></a>"+"</div></div>",s={dialogClass:"forward",header:r.text,content:i},o=new t.Dialog(s);o.open(),this.pop=o,this.$el=o.getEl();var u=this.$el.find("textarea");new n({$el:this.$el,trackId:e.track_id,$input:u,isForward:!e.isComment,success:function(t){e.pop.close(),e.callback(t)},error:function(){e.pop.close()}})}};return r}),define("module/player/extend/comment",["jquery","underscore","backbone","helper","model/sound","../model","../base","module/comment_box","module/card","module/default_image","module/dialogs/forward","model/comment","plugin/dialog"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=o.prototype,d=t.clone(p);return t.extend(p,{_$likebtn:null,_$likeCount:null,events:t.extend({"click .commentBtn":"showComment","click .forwardBtn":"showForward","click .replyBtn":"showReply"},d.events),initialize:function(){var e=this.$el;d.initialize.apply(this,arguments),this.track_id=e.attr("sound_id"),this._$commentbtn=this.find(".commentBtn"),this._$commentCount=this._$commentbtn.find(".count"),this._$commentBoxEntry=this.find(".comment_box_entry"),this._$forwardbtn=this.find(".forwardBtn"),this._$forwardCount=this._$forwardbtn.find(".count"),this._$forwardBoxEntry=this.find(".relay_box_entry"),this._$replybtn=this.find(".replyBtn"),this._$replyBoxEntry=this.find(".reply_box_entry")},getTemplate:function(){if(this._commentBoxStr){return}var e=document.getElementById("tpl_comment_box"),n,r={};e&&(n=t.template(e.innerHTML),r={comment:{title:"评论声音",btnText:"评论",shareType:"comment",logoPic60:current_user.logoPic60},forward:{title:"转采声音",btnText:"转采",shareType:"relay",logoPic60:current_user.logoPic60},reply:{title:"回复",btnText:"评论",shareType:"comment",logoPic60:current_user.logoPic60}},this._commentBoxStr=n(r.comment),this._forwardBoxStr=n(r.forward),this._replyBoxStr=n(r.reply))},getTrackId:function(){return this.$el.attr("sound_id")
},showCommonBox:function(t,n,r,i,s){var o=e(t.target),a=o.attr("data-options"),f=a?e.parseJSON(a):{};s=s||e.noop;var l=n=="forward",c=n=="reply",p=n=="comment",d=this.getTrackId(),v,m=this;if(r.attr("data-comment-init")){v=r.find(".commentBox"),v.stop().slideToggle(function(){m.$el.trigger("onExpand"),v.css("height","auto")});return}r.attr("data-comment-init",!0),r.html(i),v=r.find(".commentBox");var g=v.find(".commentBox_inputBox"),y=g.find("input"),b=g.find("textarea");y.on("focus",function(){return g.addClass("is-onEdit focus"),b.focus(),!1}),b.on({blur:function(){g.removeClass("focus"),e.trim(b.val())||g.removeClass("is-onEdit")},focus:function(){g.addClass("is-onEdit focus"),v.height("auto"),!b.val()&&f.c_nickname&&b.val("回复@"+f.c_nickname+":")}}),v.on("click",".comment_delete",function(){var t=e(this),n=e.parseJSON(t.attr("data-options")),r=t.closest(".listItem");m.delComment(n,function(e,t){r.slideUp()},function(e,t){t.msg&&h.alert(t.msg)})}),new u({$el:v,trackId:d,parentId:f.c_id||"",second:f.c_second,$input:b,isForward:l,success:function(e){var t=r;c&&(t=m._$commentBoxEntry),m.getCommentList(d,t,l,function(){g.removeClass("is-onEdit")}),s(e)}});if(c){v.stop().slideToggle(function(){m.$el.trigger("onExpand"),v.css("height","auto")});return}this.getCommentList(d,r,l,function(){v.stop().slideToggle(function(){m.$el.trigger("onExpand"),v.css("height","auto")})})},showComment:function(t){this.getTemplate();var n=this.getTrackId();if(this._$commentBoxEntry.size()==0){l.open(n,!0,function(t){var r=e("[sound_id="+n+"] .commentBtn .count"),i=t.track_comments_count||r.text()*1+1;r.text(i)});return}var r=this._$forwardBoxEntry.find(".commentBox");r.stop().hide();var i=this._$commentCount;this.showCommonBox(t,"comment",this._$commentBoxEntry,this._commentBoxStr,function(e){i.text(e.track_comments_count||i.text()*1+1)})},delComment:function(e,t,n){var r=new c({id:e.comment_id}),i=this;r.set({trackId:i.$el.attr("sound_id")}),r.del(t,n)},getCommentList:function(t,n,r,i){i=i||e.noop;var s=n.find(".commentBox_commentList"),o=r?"/sounds/relay_list_template":"/sounds/comment_list_template";if(s.size()==0){i();return}e.get(o,{id:t},function(e){s.empty().html(e),a.render({$container:s}),f.render({$container:s}),i()})},showForward:function(t){this.getTemplate();var n=this.getTrackId();if(this._$forwardBoxEntry.size()==0){l.open(n,!1,function(t){var r=e("[sound_id="+n+"] .forwardBtn .count"),i=t.track_shares_count||r.text()*1+1;r.text(i)});return}var r=this._$commentBoxEntry.find(".commentBox");r.stop().hide();var i=this._$forwardCount;this.showCommonBox(t,"forward",this._$forwardBoxEntry,this._forwardBoxStr,function(e){i.text(e.track_shares_count||i.text()*1+1)})},showReply:function(t){this.getTemplate();var n=e(t.target),r=n.closest(".comment"),i;r.size()>0||(r=n.closest("li"));if(r.size()==0){return}i=r.find(".right").find(".reply_box_entry"),this.showCommonBox(t,"reply",i,this._replyBoxStr)}}),o}),define("module/dialogs/download",["jquery","plugin/dialog"],function(e,t){var n={open:function(e){this.options=e,this.createPop()},createPop:function(e){var n='<div class="code"><a target="_blank" href="/download"><img src="'+config.STATIC_ROOT+"/css/img/code.png?"+config.ASSETS_VERSION+'"/>下载手机版'+"</a>"+'<div class="logo"></div>'+'</div><div class="info"></div>',r={dialogClass:"download",header:"下载",content:n},i=new t.Dialog(r);i.open()}};return n}),define("module/player/extend/download",["jquery","../base","module/dialogs/download"],function(e,t,n){var r=t.prototype,i=_.clone(r);return _.extend(r,{events:_.extend({"click .downloadToMobile ":"downloadToMobile"},i.events),downloadToMobile:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}n.open()}}),t}),define("module/player/extend/destroy",["jquery","underscore","backbone","helper","../model","../base","plugin/dialog","model/sound"],function(e,t,n,r,i,s,o,u){var a=s.prototype,f=t.clone(a);return t.extend(a,{events:t.extend({"click .destroyBtn":"destroy"},f.events),destroy:function(t){if(t&&extensionPlayer.isInExtension(e(t.currentTarget))){return}var n=this,r=e(t.target),i=r.attr("destroy_id");o.confirm("你确定要删除该声音吗?",function(){var e=new u({id:i});e.destroy(function(e){n.$el.slideUp(function(){n.$el.remove()})},function(e){o.alert(e.msg)})})}}),s}),define("module/player/view",["jquery","underscore","backbone","./base","./extend/info","./extend/like","./extend/comment2d","./extend/expand","./extend/comment","./extend/download","./extend/destroy"],function(e,t,n,r){return r}),define("module/player/follower_view",["jquery","underscore","backbone","./model","./view","module/wave","module/comment2d/comment2d","model/sound"],function(e,t,n,r,i,s,o,u){var a=r.mainPlayer,f=i.extend({initialize:function(){var e=this.$el,n=e.closest("[sound_ids]"),r=a.soundId(),s=[],o=!1,f=this;n.size()&&(s=n.attr("sound_ids").split(","),t.indexOf(s,r)>=0&&(e.attr("sound_id",r),o=!0)),i.prototype.initialize.apply(this,arguments),a.on("change:sound",function(e,t){this.render(e,t)
},this),a.on("change:soundIds",function(e,t){this._$soundIds.is(".j-player-soundIdsWorking")&&this._$soundIds.attr("sound_ids",t)},this);if(o){if(!r){return}var l=new u({id:r});l.query({success:function(e){var t=e.toJSON();f.render(e,t,!0)}})}},needRender:function(){var e=a.soundId(),n=[];n=this._$soundIds.attr("sound_ids").split(",");if(t.indexOf(n,e)!==-1){return !0}},render:function(e,n,r){if(!r&&!this.needRender()){return !1}var u=n.uploadId,a=config.FDFS_PATH+"/"+n.waveform,f=this.$el;if(n.id!=this._soundId||r){this._soundId=n.id,this.$el.attr("sound_id",n.id),this._$commentbar&&this._$commentbar.is(":visible")&&(this.getComment2dView().$el.data("chunkNumBinded",!1),o.render([this.getComment2dView()])),f.is(".j-sound_detail")&&(n.durationStr=helper.getTime(n.duration),t.each(n,function(e,t){var r=f.find(".j-sound_"+t);r.text(e);if(t=="title"){r.attr("title",e);var i=r.attr("href").replace(/\d+$/,n.id);r.attr("href",i)}if(t=="playCount"){var s=parseInt(e)+1;r.attr("title",s+"次播放"),r.text(s)}})),this._$likebtn&&this._$likebtn.toggleClass("is-sound-liked",n.isFavorited)}else{var l=parseInt(n.playCount)+1,c=f.find(".j-sound_playCount");c.attr("title",l+"次播放"),c.text(l)}if(this._$wavebox&&this._$wavebox.is(":visible")&&u!=this._$wavebox.attr("sound_uploadid")||r){this._$wavebox.closest(".player_progressbar").data("drawed",!1),this._$wavebox.attr("sound_uploadid",u).attr("sound_wave",a),s.render({$container:this.$el})}i.prototype.render.apply(this,arguments)},onSoundUnexist:function(){}});return f}),define("module/player/mainfollower_view",["jquery","underscore","backbone","./model","./follower_view","helper"],function(e,t,n,r,i,s){var o=r.mainPlayer,u=i.extend({events:t.extend({"click .prevBtn:not(.disabled)":"prev","click .nextBtn:not(.disabled)":"next","click .orderplayBtn":"clickOrderPlayBtn","click .randomplayBtn":"clickRandomPlayBtn","click .loopplayBtn":"clickLoopPlayBtn"},i.prototype.events),initialize:function(){i.prototype.initialize.apply(this,arguments),this._$playModelbtn=this.$el.find(".j-player_model"),o.on("change:sound",function(e,t){this.renderBtns(),this.$el.show()},this),o.on("change:soundIds",this.renderBtns,this)},prev:function(){o.prev()},next:function(){o.next()},play:function(){o.play()},needRender:function(){return !0},clickOrderPlayBtn:function(){this._$playModelbtn.addClass("loopplayBtn").removeClass("orderplayBtn").removeClass("randomplayBtn").attr("title","单曲循环"),this.loopPlay()},clickRandomPlayBtn:function(){this._$playModelbtn.addClass("orderplayBtn").removeClass("loopplayBtn").removeClass("randomplayBtn").attr("title","顺序播放"),this.orderPlay()},clickLoopPlayBtn:function(){this._$playModelbtn.addClass("randomplayBtn").removeClass("orderplayBtn").removeClass("loopplayBtn").attr("title","随机播放"),this.randomPlay()},orderPlay:function(){o.orderPlay()},randomPlay:function(){o.randomPlay()},loopPlay:function(){o.loopPlay()},render:function(t,n){i.prototype.render.apply(this,arguments);var r=this.$el;if(n&&n.id){var o=e("<span>").html(n.title).text(),u=s.cutString(o,30);r.find(".title").html(u).attr("title",o),r.is(":hidden")&&(r.fadeIn(200),r.trigger("onfirstshow"),e(".volumePanelBox").show())}},renderBtns:function(){var e=this.$el,t=e.find(".prevBtn"),n=e.find(".nextBtn"),r=this._$playbtn;o.preable()?t.removeClass("is-btn-disabled").attr("title","上一首"):t.addClass("is-btn-disabled").attr("title",""),o.nextable()?n.removeClass("is-btn-disabled").attr("title","下一首"):n.addClass("is-btn-disabled").attr("title",""),o.playable()?r.removeClass("is-btn-disabled").attr("title","播放"):r.addClass("is-btn-disabled").attr("title","")}});return u}),define("module/player/min_view",["jquery","underscore","backbone","./model","./view"],function(e,t,n,r,i){var s=i.extend({events:{click:"onClick"},initialize:function(){i.prototype.initialize.apply(this,arguments),this._$playbtn=this.$el},onSoundUnexist:function(e){i.prototype.onSoundUnexist.apply(this,arguments);if(e!=this._soundId){return !1}var t=this.$el;t.find(".warning").html("该声音不存在").addClass("removed").removeAttr("href")},onClick:function(){var e=this.$el;if(e.is(".disabled")){return !1}e.is(".playBtn")?this.play():e.is(".pauseBtn")&&this.pause()}});return s}),define("module/player/player",["jquery","underscore","backbone","./volume_view","./view","./follower_view","./mainfollower_view","./min_view","module/wave","module/comment2d/comment2d","./model"],function(e,t,n,r,i,s,o,u,a,f,l){var c=l.mainPlayer,h=null,p=e(".volumePanel");p.size()&&new r({el:p[0]});var d={volume:h,views:[],mainPlayer:null,render:function(t){var n=t||{},r=n.$container,i=n.waveRenderDelay||!1,s;r?(s=r.find("[sound_id]"),r.is("[sound_id]")&&(s=r)):s=e("[sound_id]"),s=s.add(".grobalPlayer");for(var o=0,u=s.size();o<u;o++){this.bindView(s.eq(o))}this.renderComment2dViews(),i||a.render(t)},init:function(){this.render()},bindView:function(e){var t=e[0],n=null;if(this.isBinded(e)){return}e.data("viewIsBinded",!0);if(e.is("[sound_extension]")){e.extensionPlayer();return}e.is(".grobalPlayer")?this.mainPlayer=new o({el:t}):e.is(".follower")?n=new s({el:t}):e.is(".playBtn")?n=new u({el:t}):n=new i({el:t}),n&&this.views.push(n)
},renderComment2dViews:function(){var e=[],t=this.views,n;for(var r=0,i=t.length;r<i;r++){n=t[r],n.hasComment2d()&&e.push(n.getComment2dView())}f.render(e)},soundIds:function(e){c.soundIds(e)},appendSoundIds:function(e){var t=c.soundIds();for(var n=0,r=e.length;n<r;n++){t.push(e[n])}},isBinded:function(e){return e.data("viewIsBinded")},removeSound:function(e){c.removeSoundId(e)},release:function(e){var n=[],r=e||{},i=r.$container;if(i!==undefined){for(var s=0,o=this.views.length;s<o;s++){var u=this.views[s],a=u.$el;i.find(a).size()&&n.push(u)}}else{n=this.views}for(s=0,o=n.length;s<o;s++){u=n[s],u.release()}i!==undefined?this.views=t.difference(this.views,n):this.views=[]}};return d}),define("module/common/iverify",["jquery","underscore","backbone","model/letter","plugin/dialog","module/common/iletterbox","plugin/count_char","plugin/face","plugin/dialog","plugin/jquery.parser"],function(e,t,n,r,i,s,o,u,i){var a=n.View.extend({initialize:function(){this.model.on("invalid",function(e,t){i.alert(t)}),this.render()},init:function(){this.release(),e("i.VIcon").on("click",[this],this.gotoVerigy),e("span.BVIcon").on("click",[this],this.gotoVerigy)},gotoVerigy:function(e){return location.href="/verify",e.preventDefault(),!1},render:function(){},release:function(){e("i.VIcon").off("click"),e("span.BVIcon").off("click")}});return new a({model:new n.Model})}),define("plugin/common",["jquery","underscore","backbone","plugin/dialog"],function(e,t,n,r){e("body").on("click","[popsrc]",function(){var t=e(this).attr("popsrc");if(!t){return}var n=new r.Dialog({fixed:!1,overlayer:{clickClose:!0,opacity:0.5},template:{dialog_container:'<div class="gPopupMulti" dialog-role="container" style="padding:0;"></div>',dialog_body:'<div class="mask"></div><div class="con" dialog-role="body" style="border:none;background-color:#fff;"></div>',dialog_close:'<div class="close6Btn" dialog-role="close"></div>'},content:'<div id="imgPlaceholder" class="imgLoading" style="margin: 80px 0;"></div>',width:300});n.open();var i=new Image;return i.src=t,i.style.display="",function(){if(i.complete){if(i.width>640){var t=640/i.width;i.height=i.height*t,i.width=640}e("#imgPlaceholder").replaceWith(e(i)),n.setWidth(i.width),n.setPosition()}else{setTimeout(arguments.callee,50)}}(),!1})}),define("plugin/jquery.selecter",["jquery"],function(){function n(e){var t=e.find(".selecter-text"),n=e.find(".selecter-arrow"),r=$.trim(t.text()),i=e.width(),s=t.width(),o=n.outerWidth(!0),u=0;while(i&&i<s+o){u++;if(u>=40){break}r=r.substring(0,r.length-1),t.text(r),s=t.width()}u>0&&t.text(r.substring(0,r.length-3)+"...")}function r(t){t=t||{};var n=$.extend({},e,t),r=$(this),o=n.isCreate;for(var u=0,a=r.length;u<a;u++){var f=r.eq(u);f.attr("inited")||(f.attr("inited",!0),o?i(f,n):s(f,n))}return r}function i(e,t){if(!t.options){return}var n=' <div class="selecter-options "><ul>',r='<div class="selecter-selected" data-value="{value}"><span class="selecter-text">{name}</span><em class="selecter-arrow">◆</em></div>',i=t.options,s=t.filed,u={value:"",name:t.defaultLabel||""};for(var a=0,f=i.length;a<f;a++){var l=i[a],c=l[s.name],h=l[s.value],p=s.selected,d="";p==h&&(d=" selected",u={value:h,name:c}),n+='<li data-value="'+h+'" class="selecter-item '+d+'">'+c+"</li>"}n+="</ul></div>",r=r.replace("{value}",u.value).replace("{name}",u.name),e.append(r+n),e.addClass("selecter"),e.addClass(t.customClass),o(e,t)}function s(e,t){e.addClass(t.customClass),o(e,t)}function o(e,t){var r={$select:e,$selectSelected:e.find(".selecter-selected"),$selectOptions:e.find(".selecter-options")},i=r.$selectSelected.attr("data-value");i&&r.$selectOptions.find("[data-value="+i+"]").addClass("selected");var s=0,o=this,u=function(){s&&clearTimeout(s),r.$select.addClass("open");var e=r.$selectOptions.offset().top,n=r.$selectOptions.height(),i=$(document).scrollTop(),u=$(window).height();e+n>i+u&&e-i>=n&&r.$select.addClass("selecter-up"),t.onDrop.call(o)},a=function(){t.delay?s=setTimeout(function(){r.$select.removeClass("open"),r.$select.removeClass("selecter-up")},t.delay):r.$select.removeClass("open"),t.onClose.call(o)};e.removeClass("selecter-hover"),r.$select.on(t.openEvent,function(e){e.stopPropagation();if(r.$select.hasClass("disabled")){return}u()});var f={mouseleave:1,mouseout:1};f[t.closeEvent]?r.$select.on(t.closeEvent,a):$(document).on(t.closeEvent,a),r.$select.on("click",".selecter-item",function(e){$(this).is("[hashlink]")||e.stopPropagation(),r.$select.removeClass("open");var i=$(this),s=i.attr("data-value");if(t.onChange.call(i,s)===!1){return}if(i.hasClass("selected")){return}t.muti||i.parent().find(".selected").removeClass("selected"),i.addClass("selected"),r.$selectSelected.attr({"data-value":s}),r.$selectSelected.find(".selecter-text").text(i.text()),r.$select.find("input").val(s),n(r.$selectSelected),r.$select.trigger("change")}),r.$select.on("mouseenter",".selecter-item",function(e){u()}),n(r.$selectSelected)}function u(e,t,n){}var e={customClass:"",defaultLabel:!1,openEvent:"mouseenter",closeEvent:"mouseleave",delay:"0",muti:!1,onDrop:function(){},onClose:function(){},onChange:function(){},isCreate:!1,options:[{name:"用户",value:"user"},{name:"声音",value:"voice"},{name:"专辑",value:"album"}],filed:{name:"name",value:"value",selected:"voice"}},t={val:function(e){var t=$(this),n=t.find(".selecter-selected"),r=t.find("input");
if(typeof e=="object"){return n.attr("data-value",e.value).text(e.name),r.val(e.value),t}if(typeof e=="string"||typeof e=="number"){var i=t.find(".selecter-item[data-value="+e+"]"),s=i.text();return t.find(".selecter-item.selected").removeClass("selected"),i.addClass("selected"),n.attr("data-value",e),n.find(".selecter-text").text(s),r.val(e),t}return $.trim(n.attr("data-value"))},text:function(){var e=$(this),t=e.find(".selecter-selected");return $.trim(t.find(".selecter-text").text())},create:function(e){e.isCreate=!0,r.call(this,e)},del:function(e){var t=$(this),n=t.find(".selecter-item[data-value="+e+"]");n.remove()},add:function(e,t){var n=$(this),r=n.find(".selecter-item").eq(0),i=r.clone().removeClass("selected"),s;if(s=r.size()){i.attr("data-value",e.value).html(e.name),t==undefined||s<=t?r.parent().append(i):t>0?i.insertBefore(r.parent().find("li:eq("+(t-1)+")")):t==-1&&i.insertBefore(r.parent().find("li:eq("+(s-2)+")"))}},edit:function(e){var t=$(this),n=t.find(".selecter-item[data-value="+e.value+"]");n.text(e.name)}};$.fn.selecter=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):typeof e=="object"||!e?r.apply(this,arguments):this}}),define("module/header_search",["jquery","underscore","model/search","module/player/player","helper","module/common/ifollow","plugin/jquery.selecter"],function(e,t,n,r,i,s){function l(t){var n=this;this.options=e.extend({url:"/s/search/suggest",type:"get",pramName:"keywords",isHistory:!0,resultKeyCode:[],$el:e(".g-player-search"),callback:function(){n.callback.apply(n,arguments)},$listResult:""},t),a.setSearchUrl(this.options.url);var r=this.options.$el;this.$el=r,this.$searchType=r.find(".selecter"),this.$searchPanel=r,this.$searchInput=r.find("input[type!=hidden]").attr("autocomplete","off"),this.$searchBtn=r.find(".searchBtn"),this.$listResult=this.options.$listResult||r.find(".results_wrap"),this.isBlur=!0,this.init()}var o={voice:"t2",user:"t4",album:"t3"},u={enter:13,left:37,up:38,right:39,down:40,space:32},a=new n,f={voice:t.template('<li data-scope="<%= scope %>" sound_id="<%= id %>"><div class="searchPanel_sound"><a class="title" href="<%= url %>" title="<%= title %>"><%= text %></a><div class="operateBtn"><a class="playBtn" href="javascript:;"><span class="sub-play">play</span><span class="sub-pause">pause</span></a></div></div></li>'),user:t.template('<li data-scope="<%= scope %>" user_id="<%= id %>" is_follow="<%= is_follow %>"><div class="searchPanel_sound"><a class="title" href="<%= url %>" title="<%= title %>"><%= text %></a><a class="operateBtn" data-options=\'{"uid":<%= id %>,"is_follow":<%= is_follow%>,"be_followed":false,"nickname":"<%= title%>"}\'><span class="default"><% if(is_follow) {%>已<% } %>关注</span></a></div></li>'),album:t.template('<li data-scope="<%= scope %>" album_id="<%= id %>"><div class="searchPanel_sound"><a class="title" href="<%= url %>" title="<%= title %>"><%= text %></a></div></li>'),history:t.template('<li class="history-link" text="<%=title%>" href="<%=href%>"><a href="<%=href%>"><%=title%></a><a title="<%=title%>" class="searchHistoryDelBtn">删除</a></li>')};l.prototype={cookieName:"search_history",maxHistory:5,init:function(){this.addInputEvent(),this.addBtnEvent(),this.addEvents(),this.hideList()},addEvents:function(){var t=this;this.$searchType.selecter(),this.setScope(this.$searchType.selecter("val")),this.$searchType.on("change",function(){t.setScope(t.$searchType.selecter("val"))}),this.$searchPanel.on({mouseenter:function(){e(this).addClass("focus")},mouseleave:function(){if(!t.isBlur){return}e(this).removeClass("focus"),t.$searchType.removeClass("is-type-hover")}}),this.$listResult.on({mouseenter:function(n){var r=e(this);t.$listResult.find("li[data-select]").removeAttr("data-select"),r.attr("data-select",!0),t.$listResult.find(".on").removeClass("on"),r.addClass("on")},click:function(){t.chooseResult()}},".results li"),this.$listResult.on({click:function(){return !1},mousedown:function(){return !1}},".results li .operateBtn")},initPlayer:function(){r.render({$container:this.$listResult})},releasePlayer:function(){r.release({$container:this.$listResult})},unbindEvents:function(){this.$listResult.off()},showList:function(){if(this.isBlur||this.$listResult.children().length==0){return}this.$listResult.removeClass("hidden"),this.show=!0},hideList:function(){this.$listResult.addClass("hidden"),this.show=!1},getPostData:function(){return{scope:this.getScope()}},getScope:function(){return this.searchScope},getFDFSPath:function(e){return e.indexOf("http://")<0&&window.config&&(e=(config.FDFS_PATH||"")+"/"+e),e},createAllHtml:function(e){var t="<ul class='resultsAll'>"+this.createAllItemHtml(e.sound,"voice")+this.createAllItemHtml(e.user,"user")+this.createAllItemHtml(e.album,"album")+"</ul>";return t},createAllItemHtml:function(e,t){var n={voice:"声音",user:"用户",album:"专辑"};if(!e.list||e.list&&e.list.length<=0){return""}var r='<li><div class="resultsAll_tit">'+n[t]+"</div>";return r+=this.createResultHtml(e,t),r+="</li>",r
},createResultHtml:function(t,n){if(!t||e.isEmptyObject(t)){return""}var r="";if(this.options.createResultHtml){r=this.options.createResultHtml.call(this,t,n);if(r){return r}}if(n=="all"&&t.scope=="all"){return r=this.createAllHtml(t),r}var i=f[n],s={voice:"results",album:"results",user:"results"},o=e('<div><ul class="'+s[n]+'"></ul></div>');if(!i){return""}for(var u=0;u<t.list.length;u++){var a=t.list[u];a.scope=n,a.url=this.getUrl(a.id,n),r+=i(a)}return o.find("ul").append(r),o.html()},getUrl:function(e,t){var n={voice:"/sound/"+e,album:"/album/"+e,user:"/"+e},r=n[t]||"";return i.isLogin()&&(r="#"+r),r},shortWords:function(e,t){var n=e.length,r=e.replace(/[\u0391-\uFFE5]/g,".."),i=r.length;if(i>t){var s=Math.floor(t*n/i);return e.substring(0,s)+"..."}return e},addBtnEvent:function(){if(this.$searchBtn.length>0){var e=this;this.$searchBtn.on("click",function(){if(!e.$searchInput.val()){e.$searchInput.focus();return}e.chooseResult(!0)})}},beginLoading:function(){this.$searchPanel.addClass("is-searchPanel-search")},endLoading:function(){this.$searchPanel.removeClass("is-searchPanel-search")},chearHistory:function(){e.cookie(this.cookieName,"",{domain:".ximalaya.com",path:"/"})},getHistory:function(){var t=e.cookie(this.cookieName);if(!t){return}var n=t.split("||"),r=[];for(var i=0,s=n.length;i<s;i++){var o=n[i];if(e.trim(o)){var u={title:decodeURIComponent(o),icon:""};r.push(u)}}return r},setHistory:function(t,n){if(!e.trim(t)||!this.options.isHistory){return}var r=e.cookie(this.cookieName)||"",i=encodeURIComponent(e.trim(t)),s=r.split("||");s=e.grep(s,function(e){return e!=i}),r=s.join("||"),r&&(r="||"+r),n&&(r=i+r),r=r.replace(/\|{4}/g,"||");var o=r.split("||");o.length>this.maxHistory&&(o.length=this.maxHistory,r=o.join("||")),e.cookie(this.cookieName,r,{domain:".ximalaya.com",path:"/"})},getHistoryList:function(e){var t=e.list,n="<ul class='searchHistory'>";if(!t||!t.length){return""}for(var r=0,s=t.length;r<s;r++){var o=t[r],u=o.title,a={title:u,href:(i.isLogin()?"#":"")+"/search/"+encodeURIComponent(u)+"/",href1:i.isLogin()?"#/s?q="+u+"&qf=":"/s?q="+u+"&qf="};n+=f.history(a)}return n+='<li class="searchHistoryClear"><a>清空历史记录</a></li>',n+="</ul>",n},doShowHistory:function(t){var n=this;if(!this.options.isHistory){return}if(t&&!n.$searchInput.val()){var r=n.getHistory();if(!r){return}var s={list:r},u=n.getHistoryList(s);if(!u){return}var a=e(u);a.on("click",".searchHistoryDelBtn",function(){return n.setHistory(e(this).attr("title"),!1),setTimeout(function(){n.$searchInput.focus()},100),!1}),a.find(".searchHistoryClear").on("click",function(){return n.chearHistory(),!1}),a.on("click",".history-link",function(){var t=e(this),r=t.attr("href"),s=t.attr("text");return s&&n.setHistory(s,!0),r&&o[n.searchScope]&&(r+=o[n.searchScope]),i.isLogin()?location.href=location.origin+"/"+r:location.href=r,!1}),n.$searchInput.parent().append(a)}else{setTimeout(function(){e("ul.searchHistory").remove()},200)}},addInputEvent:function(){var e=this;this.$searchInput.on({blur:function(){setTimeout(function(){e.hideList()},150),e.doShowHistory(!1),e.isBlur=!0,e.$searchPanel.removeClass("focus"),e.$searchPanel.removeClass("is-searchPanel-focus")},focus:function(){e.isBlur=!1,e.$searchPanel.addClass("focus"),e.$searchPanel.addClass("is-searchPanel-focus"),e.doShowHistory(!0)},keypress:function(t){e.doShowHistory(!1),e.holdSearch(!0);if(t.keyCode==u.enter){return e.chooseResult(),e.hideList(),!1}},keydown:function(t){var n=t.keyCode;e.doShowHistory();for(var r=0;r<e.options.resultKeyCode.length;r++){if(n==e.options.resultKeyCode[r]){return e.chooseResult(),e.hideList(),!1}}if(!e.show){return}e.holdSearch(!0);switch(n){case u.left:break;case u.right:break;case u.up:var i=e.$listResult.find(".results li"),s=e.$listResult.find("[data-select]"),o=0;return i.each(function(e,t){t==s[0]&&(o=e)}),o<=0&&o==i.length-1,i.eq(o-1).mouseenter(),!1;case u.down:var i=e.$listResult.find(".results li"),s=e.$listResult.find("[data-select]"),o=-1;return i.each(function(e,t){t==s[0]&&(o=e)}),o>=i.length-1&&(o=-1),i.eq(o+1).mouseenter(),!1;default:}}}),this.$searchInput.on("input keyup keydown paste cut focus mousedown",function(t){setTimeout(function(){e.onChange(t)},0)}),this.$searchInput.val()},onChange:function(e){var t=e.keyCode;if(t){for(var n in u){if(t==u[n]){return !0}}}this.holdSearch()},holdSearch:function(e){var t=this;t.holdTimer&&clearTimeout(t.holdTimer);if(e){return}t.holdTimer=setTimeout(function(){t.doSearch(t.$searchInput.val())},200)},doSearch:function(t){t=this.cutStr(e.trim(t));var n=this.getPostData(),r=n.scope;if(this.lastKeywords==t&&t!=""&&this.lastScope==r){this.showList();return}this.lastKeywords=t,this.lastScope=r,this.$searchInput.attr("keyowrds",t);if(!t){this.hideList();return}var i=this,s={};s[this.options.pramName]=t,s=e.extend(s,n),this.beginLoading(),a.set(s),a.doSearch(function(e){if(i.lastKeywords!=t){return}i.$listResult.children().remove(),i.hideList(),i.searchResult(e,t,r),i.endLoading()},function(){i.endLoading()
})},setScope:function(e){this.searchScope=e},searchResult:function(e,t,n){this.searchKeywords=t,n=n||this.searchScope||"";var r="";r+=this.createResultHtml(e,n);if(!r){this.hideList();return}this.releasePlayer(),this.$listResult.children().remove(),this.$listResult.html(r),this.showList(),this.initPlayer(),s.doBindOne(this.$listResult.find(".operateBtn[data-options]"))},chooseResult:function(e){var t=this.$listResult.find("[data-select]");t.removeAttr("data-select");if(!this.show||e||t.length==0){var n=this.getScope(),r=this.cutStr(this.$searchInput.val());this.options.callback({scope:n},r,null),this.setHistory(r,!0);return}var r=this.$searchInput.attr("keyowrds");if(this.searchKeywords!=r){return}var i={scope:t.attr("data-scope"),id:t.attr("data-id"),title:t.attr("data-title"),uid:t.attr("data-uid")};this.setHistory(r,!0),this.$searchInput.val(i.title),this.options.callback(i,this.searchKeywords)},release:function(){this.unbindEvents()},cutStr:function(e){var t=/[\u4e00-\u9fa5]/g,n=e.replace(t,"aa");return n.length>70&&(e=e.substring(0,30)),e},callback:function(e,t){window._hmt&&_hmt.push(["_trackEvent","home_search","click"]),e||(e={scope:"voice",id:"",title:""});if(e.id||e.title){var n={voice:"/sound/",album:"/album/",tag:"/tag/",user:"/"},r="";switch(e.scope){case"tag":r=n[e.scope]+e.title;break;case"user":r="/"+e.id;break;case"voice":case"album":e.uid?r="/"+e.uid+n[e.scope]+e.id:r=n[e.scope]+e.id;break;default:r="/search/"+encodeURIComponent(t)+"/"+(o[e.scope]||"")}i.isLogin()&&(r="/#"+r),window.location.href=r}else{var s=r="/search/"+encodeURIComponent(t)+"/"+(o[e.scope]||""),u="";i.isLogin()&&(u="/#"),window.location.href=u+s}}};var c=function(e){var t=new l(e);return t};return c({$el:e(".floatHeader_wrapper .searchPanel")}),c}),define("page/page_base",["jquery","underscore","backbone","router","module/player/player","module/card","module/default_image","module/common/iverify","module/common","plugin/common","module/header_search","module/foot"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({el:"#mainbox",init:function(){var t=e("#bgimg");r.setPage(this),i.init(),s.render(),o.render(),u.init(),helper.doCheckVersion(),t.attr("src",t.attr("originsrc")).show(),window._bd_share_main&&_bd_share_main.init()},release:function(){i.release(),s.release(),o.release(),this.unbindEvents(),this.$el&&this.$el.empty(),u.release(),e("#bdshare_pop").hide(),this.releaseBdshare()},releaseBdshare:function(){e(".bdshare_dialog_box").hide(),e(".bdshare_dialog_bg").hide(),e(".bdshare_popup_box").hide(),e(".bdshare_popup_bg").hide(),e("#bdshare_weixin_qrcode_dialog").hide(),e("#bdshare_weixin_qrcode_dialog_bg").hide()},render:function(){},afterRender:function(){i.init(),s.render(),o.render()},bindEvents:function(){},unbindEvents:function(){this.$el.unbind(),this.$el.undelegate()},callParent:function(e,t){if(!e){return !1}var n=this.constructor.__super__;return e in n?n[e].apply(this,t||[]):!1}});return a}),function(e,t){var n;e.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not(button[type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input:file",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(t){var n=e('meta[name="csrf-token"]').attr("content");n&&t.setRequestHeader("X-CSRF-Token",n)},fire:function(t,n,r){var i=e.Event(n);return t.trigger(i,r),i.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},handleRemote:function(r){var i,s,o,u=r.data("cross-domain")||null,a=r.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,f;if(n.fire(r,"ajax:before")){if(r.is("form")){i=r.attr("method"),s=r.attr("action"),o=r.serializeArray();var l=r.data("ujs:submit-button");l&&(o.push(l),r.data("ujs:submit-button",null))}else{r.is(n.inputChangeSelector)?(i=r.data("method"),s=r.data("url"),o=r.serialize(),r.data("params")&&(o=o+"&"+r.data("params"))):(i=r.data("method"),s=r.attr("href"),o=r.data("params")||null)}return f={type:i||"GET",data:o,dataType:a,crossDomain:u,beforeSend:function(e,i){return i.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+i.accepts.script),n.fire(r,"ajax:beforeSend",[e,i])},success:function(e,t,n){r.trigger("ajax:success",[e,t,n])},complete:function(e,t){r.trigger("ajax:complete",[e,t])},error:function(e,t,n){r.trigger("ajax:error",[e,t,n])}},s&&(f.url=s),n.ajax(f)}return !1},handleMethod:function(n){var r=n.attr("href"),i=n.data("method"),s=n.attr("target"),o=e("meta[name=csrf-token]").attr("content"),u=e("meta[name=csrf-param]").attr("content"),a=e('<form method="post" action="'+r+'"></form>'),f='<input name="_method" value="'+i+'" type="hidden" />';
u!==t&&o!==t&&(f+='<input name="'+u+'" value="'+o+'" type="hidden" />'),s&&a.attr("target",s),a.hide().append(f).appendTo("body"),a.submit()},disableFormElements:function(t){t.find(n.disableSelector).each(function(){var t=e(this),n=t.is("button")?"html":"val";t.data("ujs:enable-with",t[n]()),t[n](t.data("disable-with")),t.prop("disabled",!0)})},enableFormElements:function(t){t.find(n.enableSelector).each(function(){var t=e(this),n=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[n](t.data("ujs:enable-with")),t.prop("disabled",!1)})},allowAction:function(e){var t=e.data("confirm"),r=!1,i;return t?(n.fire(e,"confirm")&&(r=n.confirm(t),i=n.fire(e,"confirm:complete",[r])),r&&i):!0},blankInputs:function(t,n,r){var i=e(),s,o=n||"input,textarea";return t.find(o).each(function(){s=e(this);if(r?s.val():!s.val()){i=i.add(s)}}),i.length?i:!1},nonBlankInputs:function(e,t){return n.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},callFormSubmitBindings:function(n,r){var i=n.data("events"),s=!0;return i!==t&&i.submit!==t&&e.each(i.submit,function(e,t){if(typeof t.handler=="function"){return s=t.handler(r)}}),s},disableElement:function(e){e.data("ujs:enable-with",e.html()),e.html(e.data("disable-with")),e.bind("click.railsDisable",function(e){return n.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.data("ujs:enable-with",!1)),e.unbind("click.railsDisable")}},e.ajaxPrefilter(function(e,t,r){e.crossDomain||n.CSRFProtection(r)}),e(document).delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(e(this))}),e(document).delegate(n.linkClickSelector,"click.rails",function(r){var i=e(this),s=i.data("method"),o=i.data("params");if(!n.allowAction(i)){return n.stopEverything(r)}i.is(n.linkDisableSelector)&&n.disableElement(i);if(i.data("remote")!==t){return(r.metaKey||r.ctrlKey)&&(!s||s==="GET")&&!o?!0:(n.handleRemote(i)===!1&&n.enableElement(i),!1)}if(i.data("method")){return n.handleMethod(i),!1}}),e(document).delegate(n.inputChangeSelector,"change.rails",function(t){var r=e(this);return n.allowAction(r)?(n.handleRemote(r),!1):n.stopEverything(t)}),e(document).delegate(n.formSubmitSelector,"submit.rails",function(r){var i=e(this),s=i.data("remote")!==t,o=n.blankInputs(i,n.requiredInputSelector),u=n.nonBlankInputs(i,n.fileInputSelector);if(!n.allowAction(i)){return n.stopEverything(r)}if(o&&i.attr("novalidate")==t&&n.fire(i,"ajax:aborted:required",[o])){return n.stopEverything(r)}if(s){return u?n.fire(i,"ajax:aborted:file",[u]):!e.support.submitBubbles&&e().jquery<"1.7"&&n.callFormSubmitBindings(i,r)===!1?n.stopEverything(r):(n.handleRemote(i),!1)}setTimeout(function(){n.disableFormElements(i)},13)}),e(document).delegate(n.formInputClickSelector,"click.rails",function(t){var r=e(this);if(!n.allowAction(r)){return n.stopEverything(t)}var i=r.attr("name"),s=i?{name:i,value:r.val()}:null;r.closest("form").data("ujs:submit-button",s)}),e(document).delegate(n.formSubmitSelector,"ajax:beforeSend.rails",function(t){this==t.target&&n.disableFormElements(e(this))}),e(document).delegate(n.formSubmitSelector,"ajax:complete.rails",function(t){this==t.target&&n.enableFormElements(e(this))})}(jQuery),define("plugin/jquery_ujs",function(){}),define("page/search",["jquery","module/header_search","helper","page/page_base","module/common/ifollow","module/common/iletter","module/player/player","plugin/jquery_ujs","plugin/jquery.selecter"],function(e,t,n,r,i,s,o){function a(t,r,i){var s=e.trim(e("#gSearch-input").val());r=r||"";var o=/[\u4e00-\u9fa5]/g,u=s.replace(o,"aa");u.length>70&&(s=s.substring(0,30),e("#gSearch-input").val(s)),t||(t="voice");var a={voice:"t2",user:"t4",album:"t3"},l=f(t);i==null&&(i="");var c={qf:a[t]?a[t]:"",sort:r,fq:l,page:i},h=[];for(var p in c){h.push(encodeURIComponent(c[p]))}var d="";n.isLogin()&&(d="/#"),window.location.href=d+"/search/"+s+"/"+h.join("")}function f(t){var n="";if(t=="voice"){var r=e("#sub_voice_category_id").attr("data-value"),i=e("#sub_voice_user_source").selecter("val");n=(r||"")+(i||"")}if(t=="album"){var r=e("#sub_album_category_id").attr("data-value"),i=e("#sub_album_user_source").selecter("val");n=(r||"")+(i||"")}if(t=="user"){var s=e("#sub_user_gender").selecter("val");n=s}return n}var u=r.extend({init:function(){this.callParent("init"),this.$searchUserPage=e("#searchUserPage"),this.initSearch(),this.bindEvents(),i.init(),s.bind(e(".sendLetterBtn")),s.bind(e(".radioLetterIcon").parent())},initSearch:function(){var n=t({$el:e(".searchContent .searchBar ")});n.setScope(e(".searchTab .tab_item.on").attr("data-scope")),e(".searchField button").on("click",function(){n.chooseResult(!0)})},bindEvents:function(){var t=this.$searchUserPage,r=this;t.find(".selecter").selecter(),t.on("click",".searchTab [data-scope]",function(){var t=e(this).attr("data-scope");a(t)}),t.find(".follow_list").on({mouseenter:function(){var t=e(this),n=t.parent();
n.find(".on").removeClass("on"),t.addClass("on")}},"li"),t.find(".radioUserListItem").on("click",function(t){var n=e(this).find(".radioUserPanel .userface").attr("href");return n&&(location.href=n),!1}),t.on("click",".gSearch-sub-voice",function(){a("voice",e(this).attr("name"))}),t.on("click",".gSearch-sub-album",function(){a("album",e(this).attr("name"))}),t.on("click",".gSearch-sub-tag",function(){a("tag",e(this).attr("name"))}),t.on("click",".gSearch-sub-user",function(){a("user",e(this).attr("name"))}),e("#sub_voice_user_source").on("change",function(){var t=e(".gSearch-sub-voice.on");a("voice",t.attr("name"))}),e("#sub_voice_category_id").on("click","a",function(){var t=e(this);if(t.hasClass("more")){return}e("#sub_voice_category_id").attr("data-value",t.attr("data-value"));var n=e(".gSearch-sub-voice.on");a("voice",n.attr("name"))}),e("#sub_album_category_id").on("click","a",function(){var t=e(this);if(t.hasClass("more")){return}e("#sub_album_category_id").attr("data-value",t.attr("data-value"));var n=e(".gSearch-sub-album.on");a("album",n.attr("name"))}),e("#sub_voice_category_id, #sub_album_category_id").on("click",".more",function(){var t=e(this);t.parent().find(".more-category").removeClass("hidden"),t.hide()}),e("#sub_album_user_source").on("change",function(){var t=e(".gSearch-sub-album.on");a("album",t.attr("name"))}),e("#sub_user_gender,#sub_user_isVerified").on("change",function(){var t=e(".gSearch-sub-user.on");a("user",t.attr("name"))}),t.on("click",".miniPlayBtn3",function(){var t=e(this),i=t.closest(".soundReport"),s=i.find(".expandbox_player_entry");if(t.attr("data-inited")){s.size()>0&&(i.addClass("is-soundReport-expand"),s.slideDown(),s.find(".playBtn").trigger(n.START_EV));return}t.attr("data-inited",!0);var o=t.attr("track_id");r.initPlayer(i,o,t)}),t.on("click",".miniPauseBtn3",function(){var t=e(this),r=t.closest(".soundReport");r.find(".pauseBtn").trigger(n.START_EV)})},initPlayer:function(t,r,i){var s=t.find(".expandbox_player_entry");e.get("/sounds/"+r+"/expend_box",function(e){s.hide().html(e),t.addClass("is-soundReport-expand"),s.slideDown(function(){o.render({$container:t}),t.find(".playBtn").trigger(n.START_EV)}),t.on({onSoundPlay:function(){i.removeClass().addClass("miniPauseBtn3")},onSoundPause:function(){window.console&&console.log("pause"),i.removeClass().addClass("miniPlayBtn3")},onSoundFinish:function(){window.console&&console.log("finish"),i.removeClass().addClass("miniPlayBtn3")},onSoundStop:function(){window.console&&console.log("stop"),i.removeClass().addClass("miniPlayBtn3"),s.slideUp(function(){t.removeClass("is-soundReport-expand")})},onSoundResume:function(){window.console&&console.log("resume"),i.removeClass().addClass("miniPauseBtn3")}}),_bd_share_main.init()})},unbindEvents:function(){this.$searchUserPage.off(),this.$searchUserPage.empty()},release:function(){this.callParent("release"),this.unbindEvents()}}),l=new u;return l}),define("model/report",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{report_id:undefined,content:{},album_id:undefined,uid:undefined,nickname:undefined,content_title:undefined,is_processed:undefined,content_type:undefined,fujian_path:undefined,track_id:undefined},doReport:function(t,n){var r=this;t=t||e.noop,n=n||e.noop,r.save({},{url:"/report/create",type:"post",data:r.toJSON(),success:function(e,r,i){r&&r.result=="success"?t(e,r,i):n(e,r,i)}})}});return r});var SWFUpload;define("plugin/swfupload/swfupload",[],function(){return SWFUpload==undefined&&(SWFUpload=function(e){this.initSWFUpload(e)}),SWFUpload.prototype.initSWFUpload=function(e){try{this.customSettings={},this.settings={},this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(e),this.loadFlash(),this.displayDebugInfo()}catch(t){throw delete SWFUpload.instances[this.movieName],t}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.1 2009-03-30",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120,JAVASCRIPT:-130},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(e){try{var t="";if(typeof e!="string"||e.match(/^https?:\/\//i)||e.match(/^\//)||e===""){return e}var n=window.location.pathname.lastIndexOf("/");return n<=0?t="/":t=window.location.pathname.substr(0,n)+"/",t+e}catch(r){return e}},SWFUpload.prototype.initSettings=function(e){this.ensureDefault=function(t,n){var r=e[t];
if(r!=undefined){if(typeof r!="object"||r instanceof Array){this.settings[t]=r}else{var i={};for(var s in r){r.hasOwnProperty(s)&&(i[s]=r[s])}this.settings[t]=i}}else{this.settings[t]=n}},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("requeue_on_error_time",30),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("button_action_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.ensureDefault("transcoding_url",""),this.ensureDefault("transcoding_success",null),this.customSettings=this.settings.custom_settings,!this.settings.prevent_swf_caching||(this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var e,t;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}e=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(e==undefined){throw"Could not find the placeholder element: "+this.settings.button_placeholder_id}var n=(e.currentStyle&&e.currentStyle.display||window.getComputedStyle&&document.defaultView.getComputedStyle(e,null).getPropertyValue("display"))!=="block"?"span":"div";t=document.createElement(n),t.innerHTML=this.getFlashHTML(),e.parentNode.replaceChild(t.firstChild,e),window[this.movieName]==undefined&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")},SWFUpload.prototype.getFlashVars=function(){var e=this.buildParamString(),t=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(t),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(e),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")
},SWFUpload.prototype.getMovieElement=function(){this.movieElement==undefined&&(this.movieElement=document.getElementById(this.movieName));if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement},SWFUpload.prototype.buildParamString=function(){var e=this.settings.post_params,t=[];if(typeof e=="object"){for(var n in e){e.hasOwnProperty(n)&&t.push(encodeURIComponent(n.toString())+"="+encodeURIComponent(e[n].toString()))}}return t.join("&amp;")},SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1),this.callFlash("StopExternalInterfaceCheck");var e=this.getMovieElement();this.cleanUp();if(e){try{e.parentNode.removeChild(e)}catch(t){}}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(n){return !1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler=="function").toString(),"\n","	","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler=="function").toString(),"\n","	","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler=="function").toString(),"\n","	","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler=="function").toString(),"\n","	","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler=="function").toString(),"\n","	","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler=="function").toString(),"\n","	","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler=="function").toString(),"\n","	","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler=="function").toString(),"\n","	","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler=="function").toString(),"\n","	","debug_handler assigned:             ",(typeof this.settings.debug_handler=="function").toString(),"\n"].join(""))},SWFUpload.prototype.addSetting=function(e,t,n){return t==undefined?this.settings[e]=n:this.settings[e]=t},SWFUpload.prototype.getSetting=function(e){return this.settings[e]!=undefined?this.settings[e]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement(),returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return returnValue!=undefined&&typeof returnValue.post=="object"&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue
},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(e){this.callFlash("StartUpload",[e])},SWFUpload.prototype.cancelUpload=function(e,t){t!==!1&&(t=!0),this.callFlash("CancelUpload",[e,t])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.requeueUpload=function(e){return this.callFlash("RequeueUpload",[e])},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(e){this.callFlash("SetStats",[e])},SWFUpload.prototype.getFile=function(e){return typeof e=="number"?this.callFlash("GetFileByIndex",[e]):this.callFlash("GetFile",[e])},SWFUpload.prototype.addFileParam=function(e,t,n){return this.callFlash("AddFileParam",[e,t,n])},SWFUpload.prototype.removeFileParam=function(e,t){this.callFlash("RemoveFileParam",[e,t])},SWFUpload.prototype.setUploadURL=function(e){this.settings.upload_url=e.toString(),this.callFlash("SetUploadURL",[e])},SWFUpload.prototype.setPostParams=function(e){this.settings.post_params=e,this.callFlash("SetPostParams",[e])},SWFUpload.prototype.addPostParam=function(e,t){this.settings.post_params[e]=t,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(e){delete this.settings.post_params[e],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(e,t){this.settings.file_types=e,this.settings.file_types_description=t,this.callFlash("SetFileTypes",[e,t])},SWFUpload.prototype.setFileSizeLimit=function(e){this.settings.file_size_limit=e,this.callFlash("SetFileSizeLimit",[e])},SWFUpload.prototype.setFileUploadLimit=function(e){this.settings.file_upload_limit=e,this.callFlash("SetFileUploadLimit",[e])},SWFUpload.prototype.setFileQueueLimit=function(e){this.settings.file_queue_limit=e,this.callFlash("SetFileQueueLimit",[e])},SWFUpload.prototype.setFilePostName=function(e){this.settings.file_post_name=e,this.callFlash("SetFilePostName",[e])},SWFUpload.prototype.setUseQueryString=function(e){this.settings.use_query_string=e,this.callFlash("SetUseQueryString",[e])},SWFUpload.prototype.setRequeueOnError=function(e){this.settings.requeue_on_error=e,this.callFlash("SetRequeueOnError",[e])},SWFUpload.prototype.setHTTPSuccess=function(e){typeof e=="string"&&(e=e.replace(" ","").split(",")),this.settings.http_success=e,this.callFlash("SetHTTPSuccess",[e])},SWFUpload.prototype.setAssumeSuccessTimeout=function(e){this.settings.assume_success_timeout=e,this.callFlash("SetAssumeSuccessTimeout",[e])},SWFUpload.prototype.setDebugEnabled=function(e){this.settings.debug_enabled=e,this.callFlash("SetDebugEnabled",[e])},SWFUpload.prototype.setButtonImageURL=function(e){e==undefined&&(e=""),this.settings.button_image_url=e,this.callFlash("SetButtonImageURL",[e])},SWFUpload.prototype.setButtonDimensions=function(e,t){this.settings.button_width=e,this.settings.button_height=t;var n=this.getMovieElement();n!=undefined&&(n.style.width=e+"px",n.style.height=t+"px"),this.callFlash("SetButtonDimensions",[e,t])},SWFUpload.prototype.setButtonText=function(e){this.settings.button_text=e,this.callFlash("SetButtonText",[e])},SWFUpload.prototype.setButtonTextPadding=function(e,t){this.settings.button_text_top_padding=t,this.settings.button_text_left_padding=e,this.callFlash("SetButtonTextPadding",[e,t])},SWFUpload.prototype.setButtonTextStyle=function(e){this.settings.button_text_style=e,this.callFlash("SetButtonTextStyle",[e])},SWFUpload.prototype.setButtonDisabled=function(e){this.settings.button_disabled=e,this.callFlash("SetButtonDisabled",[e])},SWFUpload.prototype.setButtonAction=function(e){this.settings.button_action=e,this.callFlash("SetButtonAction",[e])},SWFUpload.prototype.setButtonCursor=function(e){this.settings.button_cursor=e,this.callFlash("SetButtonCursor",[e])},SWFUpload.prototype.queueEvent=function(e,t){t==undefined?t=[]:t instanceof Array||(t=[t]);var n=this;if(typeof this.settings[e]=="function"){this.eventQueue.push(function(){this.settings[e].apply(this,t)}),setTimeout(function(){n.executeNextEvent()},0)}else{if(this.settings[e]!==null){throw"Event handler "+e+" is unknown or is not a function"}}},SWFUpload.prototype.executeNextEvent=function(){var e=this.eventQueue?this.eventQueue.shift():null;typeof e=="function"&&e.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(e){var t=/[$]([0-9a-f]{4})/i,n={},r;if(e!=undefined){for(var i in e.post){if(e.post.hasOwnProperty(i)){r=i;var s;while((s=t.exec(r))!==null){r=r.replace(s[0],String.fromCharCode(parseInt("0x"+s[1],16)))}n[r]=e.post[i]}}e.post=n}return e},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(e){return !1}},SWFUpload.prototype.flashReady=function(){var e=this.getMovieElement();if(!e){this.debug("Flash called back ready but the flash movie can't be found.");
return}this.cleanUp(),this.queueEvent("swfupload_loaded_handler")},SWFUpload.prototype.cleanUp=function(){var e=this.getMovieElement();try{if(e&&typeof e.CallFunction=="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var t in e){try{typeof e[t]=="function"&&(e[t]=null)}catch(n){}}}}catch(r){}window.__flash__removeCallback=function(e,t){try{e&&(e[t]=null)}catch(n){}}},SWFUpload.prototype.buttonAction=function(){this.queueEvent("button_action_handler")},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("file_queued_handler",e)},SWFUpload.prototype.fileQueueError=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("file_queue_error_handler",[e,t,n])},SWFUpload.prototype.fileDialogComplete=function(e,t,n){this.queueEvent("file_dialog_complete_handler",[e,t,n])},SWFUpload.prototype.uploadStart=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("return_upload_start_handler",e)},SWFUpload.prototype.returnUploadStart=function(e){var t;if(typeof this.settings.upload_start_handler=="function"){e=this.unescapeFilePostParams(e),t=this.settings.upload_start_handler.call(this,e)}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}}t===undefined&&(t=!0),t=!!t,this.callFlash("ReturnUploadStart",[t])},SWFUpload.prototype.uploadProgress=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_progress_handler",[e,t,n])},SWFUpload.prototype.uploadError=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_error_handler",[e,t,n])},SWFUpload.prototype.uploadSuccess=function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_success_handler",[e,t,n])},SWFUpload.prototype.uploadComplete=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("upload_complete_handler",e)},SWFUpload.prototype.debug=function(e){this.queueEvent("debug_handler",e)},SWFUpload.prototype.debugMessage=function(e){if(this.settings.debug){var t,n=[];if(typeof e=="object"&&typeof e.name=="string"&&typeof e.message=="string"){for(var r in e){e.hasOwnProperty(r)&&n.push(r+": "+e[r])}t=n.join("\n")||"",n=t.split("\n"),t="EXCEPTION: "+n.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(t)}else{SWFUpload.Console.writeLine(e)}}},SWFUpload.Console={},SWFUpload.Console.writeLine=function(e){var t,n;try{t=document.getElementById("SWFUpload_Console"),t||(n=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(n),t=document.createElement("textarea"),t.id="SWFUpload_Console",t.style.fontFamily="monospace",t.setAttribute("wrap","off"),t.wrap="off",t.style.overflow="auto",t.style.width="700px",t.style.height="350px",t.style.margin="5px",n.appendChild(t)),t.value+=e+"\n",t.scrollTop=t.scrollHeight-t.clientHeight}catch(r){alert("Exception: "+r.name+" Message: "+r.message)}},SWFUpload}),define("plugin/swfupload/swfupload.queue",["./swfupload"],function(e){function t(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" "){i=i.substring(1,i.length)}if(i.indexOf(t)==0){return encodeURIComponent(i.substring(t.length,i.length))}if(i.indexOf(t)!=-1){return encodeURIComponent(i.substring(i.indexOf("=")+1,i.length))}}return null}return typeof e=="function"&&(e.queue={},e.prototype.initSettings=function(t){return function(n){typeof t=="function"&&t.call(this,n),this.queueSettings={},this.queueSettings.queue_cancelled_flag=!1,this.queueSettings.queue_upload_count=0,this.queueSettings.user_upload_complete_handler=this.settings.upload_complete_handler,this.queueSettings.user_upload_start_handler=this.settings.upload_start_handler,this.settings.upload_complete_handler=e.queue.uploadCompleteHandler,this.settings.upload_start_handler=e.queue.uploadStartHandler,this.settings.queue_complete_handler=n.queue_complete_handler||null}}(e.prototype.initSettings),e.prototype.startUpload=function(e){this.queueSettings.queue_cancelled_flag=!1,this.callFlash("StartUpload",[e])},e.prototype.cancelQueue=function(){this.queueSettings.queue_cancelled_flag=!0,this.stopUpload();var e=this.getStats();while(e.files_queued>0){this.cancelUpload(),e=this.getStats()}},e.queue.uploadStartHandler=function(e){var n=this.getSetting("upload_url");n.indexOf("?")>0?this.setUploadURL(n.substr(0,n.indexOf("?"))+"?fileSize="+e.size+"&token="+t(config.TOKEN_LABEL)+"&rememberMe="+t(config.REMEMBERME_LABEL)):this.setUploadURL(n+"?fileSize="+e.size+"&token="+t(config.TOKEN_LABEL)+"&rememberMe="+t(config.REMEMBERME_LABEL));var r;return typeof this.queueSettings.user_upload_start_handler=="function"&&(r=this.queueSettings.user_upload_start_handler.call(this,e)),r=r===!1?!1:!0,this.queueSettings.queue_cancelled_flag=!r,r},e.queue.uploadCompleteHandler=function(t){var n=this.queueSettings.user_upload_complete_handler,r;t.filestatus===e.FILE_STATUS.COMPLETE&&this.queueSettings.queue_upload_count++,typeof n=="function"?r=n.call(this,t)===!1?!1:!0:t.filestatus===e.FILE_STATUS.QUEUED?r=!1:r=!0;
if(r){var i=this.getStats();if(i.files_queued>0&&this.queueSettings.queue_cancelled_flag===!1){if(i.upload_errors!=0&&this.settings.requeue_on_error){this.setStats({upload_errors:0});var s=this.settings.requeue_on_error_time,o=this;setTimeout(function(){o.startUpload(t.id)},s*1000)}else{this.startUpload()}}else{this.queueSettings.queue_cancelled_flag===!1?(this.queueEvent("queue_complete_handler",[this.queueSettings.queue_upload_count]),this.queueSettings.queue_upload_count=0):(this.queueSettings.queue_cancelled_flag=!1,this.queueSettings.queue_upload_count=0)}}}),e}),define("module/uploadimg",["jquery","underscore","backbone","plugin/dialog","plugin/swfupload/swfupload.queue"],function(e,t,n,r){var i=config.DIRECT_DTRES_ROOT+"/headerThumb/upload",s=n.View.extend({initialize:function(t){this.options=e.extend({url:i,$el:"",maxSize:5,beforeUpload:e.noop,success:e.noop,error:e.noop,textClass:"",file_queue_limit:1,file_upload_limit:0,file_queued_handler:e.noop,swfupload_loaded_handler:e.noop},t),this.$el=this.options.$el,this.initUploadImg()},initUploadImg:function(){var t=this,n=this.$el,i=n.text(),s=this.options;n.css("position","relative"),n.html('<div class="'+s.textClass+'">'+i+'</div><div style="position: absolute;left:0;top:0;"><span id="imgUploadSwf"></span></div>');var o=config.STATIC_PATH+"/cdnswf/swfupload.swf",u={flash_url:o,upload_url:s.url,file_size_limit:s.maxSize+" MB",file_types:"*.gif; *.jpg; *.png;*.jpeg;*.bmp;",file_types_description:"Image Files",debug:!1,file_queue_limit:s.file_queue_limit,file_upload_limit:s.file_upload_limit,button_width:n.width(),button_height:n.height(),button_placeholder_id:"imgUploadSwf",button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,swfupload_loaded_handler:function(){s.swfupload_loaded_handler.call(this)},file_queued_handler:function(e){s.file_queued_handler.call(this,e)},file_dialog_complete_handler:function(e,t){if(e==0){return}this.startUpload()},upload_error_handler:function(e,t,n){if(!e&&t){return}s.error.call(this,e,t,n)},file_queue_error_handler:function(e,t,n){t==SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED&&r.alert("选择图片超过最大上传限制"),t==SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT&&r.alert("图片最大不超过"+s.maxSize+"M");return},upload_start_handler:function(e){s.beforeUpload.call(this,e)},upload_success_handler:function(t,n){var i=e.parseJSON(n);if(!i.status){r&&r.alert(i.msg),s.error.call(this,i,t);return}s.success.call(this,i,t,n)}};this.swfupload=new SWFUpload(u)},setButtonDisabled:function(e){this.swfupload.setButtonDisabled(e)},setFileUploadLimit:function(e){this.swfupload.setFileUploadLimit(e),this.swfupload.setFileQueueLimit(e)},getFileUploadLimit:function(){return this.swfupload.getSetting("file_upload_limit")},increaseUploadLimit:function(){this.setFileUploadLimit(this.getFileUploadLimit()+1)}});return s}),define("plugin/jquery.validate",["jquery"],function(e){(function(e){e.extend(e.fn,{validate:function(t){if(!this.length){t&&t.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing.");return}var n=e.data(this[0],"validator");return n?n:(this.attr("novalidate","novalidate"),n=new e.validator(t,this[0]),e.data(this[0],"validator",n),n.settings.onsubmit&&(this.validateDelegate(":submit","click",function(t){n.settings.submitHandler&&(n.submitButton=t.target),e(t.target).hasClass("cancel")&&(n.cancelSubmit=!0),e(t.target).attr("formnovalidate")!==undefined&&(n.cancelSubmit=!0)}),this.submit(function(t){function r(){var r;return n.settings.submitHandler?(n.submitButton&&(r=e("<input type='hidden'/>").attr("name",n.submitButton.name).val(e(n.submitButton).val()).appendTo(n.currentForm)),n.settings.submitHandler.call(n,n.currentForm,t),n.submitButton&&r.remove(),!1):!0}return n.settings.debug&&t.preventDefault(),n.cancelSubmit?(n.cancelSubmit=!1,r()):n.form()?n.pendingRequest?(n.formSubmitted=!0,!1):r():(n.focusInvalid(),!1)})),n)},valid:function(){if(e(this[0]).is("form")){return this.validate().form()}var t=!0,n=e(this[0].form).validate();return this.each(function(){t=t&&n.element(this)}),t},removeAttrs:function(t){var n={},r=this;return e.each(t.split(/\s/),function(e,t){n[t]=r.attr(t),r.removeAttr(t)}),n},rules:function(t,n){var r=this[0];if(t){var i=e.data(r.form,"validator").settings,s=i.rules,o=e.validator.staticRules(r);switch(t){case"add":e.extend(o,e.validator.normalizeRule(n)),delete o.messages,s[r.name]=o,n.messages&&(i.messages[r.name]=e.extend(i.messages[r.name],n.messages));break;case"remove":if(!n){return delete s[r.name],o}var u={};return e.each(n.split(/\s/),function(e,t){u[t]=o[t],delete o[t]}),u}}var a=e.validator.normalizeRules(e.extend({},e.validator.classRules(r),e.validator.attributeRules(r),e.validator.dataRules(r),e.validator.staticRules(r)),r);if(a.required){var f=a.required;delete a.required,a=e.extend({required:f},a)}return a}}),e.extend(e.expr[":"],{blank:function(t){return !e.trim(""+e(t).val())},filled:function(t){return !!e.trim(""+e(t).val())},unchecked:function(t){return !e(t).prop("checked")
}}),e.validator=function(t,n){this.settings=e.extend(!0,{},e.validator.defaults,t),this.currentForm=n,this.init()},e.validator.format=function(t,n){return arguments.length===1?function(){var n=e.makeArray(arguments);return n.unshift(t),e.validator.format.apply(this,n)}:(arguments.length>2&&n.constructor!==Array&&(n=e.makeArray(arguments).slice(1)),n.constructor!==Array&&(n=[n]),e.each(n,function(e,n){t=t.replace(new RegExp("\\{"+e+"\\}","g"),function(){return n})}),t)},e.extend(e.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error1",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:e([]),errorLabelContainer:e([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(e,t){this.lastActive=e,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,e,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(e)).hide())},onfocusout:function(e,t){!this.checkable(e)&&(e.name in this.submitted||!this.optional(e))&&this.element(e)},onkeyup:function(e,t){if(t.which===9&&this.elementValue(e)===""){return}(e.name in this.submitted||e===this.lastElement)&&this.element(e)},onclick:function(e,t){e.name in this.submitted?this.element(e):e.parentNode.name in this.submitted&&this.element(e.parentNode)},highlight:function(t,n,r){t.type==="radio"?this.findByName(t.name).addClass(n).removeClass(r):e(t).addClass(n).removeClass(r)},unhighlight:function(t,n,r){t.type==="radio"?this.findByName(t.name).removeClass(n).addClass(r):e(t).removeClass(n).addClass(r)}},setDefaults:function(t){e.extend(e.validator.defaults,t)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:e.validator.format("Please enter no more than {0} characters."),minlength:e.validator.format("Please enter at least {0} characters."),rangelength:e.validator.format("Please enter a value between {0} and {1} characters long."),range:e.validator.format("Please enter a value between {0} and {1}."),max:e.validator.format("Please enter a value less than or equal to {0}."),min:e.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function r(t){var n=e.data(this[0].form,"validator"),r="on"+t.type.replace(/^validate/,"");n.settings[r]&&n.settings[r].call(n,this[0],t)}this.labelContainer=e(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||e(this.currentForm),this.containers=e(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var t=this.groups={};e.each(this.settings.groups,function(n,r){typeof r=="string"&&(r=r.split(/\s/)),e.each(r,function(e,r){t[r]=n})});var n=this.settings.rules;e.each(n,function(t,r){n[t]=e.validator.normalizeRule(r)}),e(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",r).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",r),this.settings.invalidHandler&&e(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),e.extend(this.submitted,this.errorMap),this.invalid=e.extend({},this.errorMap),this.valid()||e(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var e=0,t=this.currentElements=this.elements();t[e];e++){this.check(t[e])}return this.valid()},element:function(t){t=this.validationTargetFor(this.clean(t)),this.lastElement=t,this.prepareElement(t),this.currentElements=e(t);var n=this.check(t)!==!1;return n?delete this.invalid[t.name]:this.invalid[t.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),n},showErrors:function(t){if(t){e.extend(this.errorMap,t),this.errorList=[];for(var n in t){this.errorList.push({message:t[n],element:this.findByName(n)[0]})}this.successList=e.grep(this.successList,function(e){return !(e.name in t)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){e.fn.resetForm&&e(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue")
},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(e){var t=0;for(var n in e){t++}return t},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()===0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{e(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(t){}}},findLastActive:function(){var t=this.lastActive;return t&&e.grep(this.errorList,function(e){return e.element.name===t.name}).length===1&&t},elements:function(){var t=this,n={};return e(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return !this.name&&t.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in n||!t.objectLength(e(this).rules())?!1:(n[this.name]=!0,!0)})},clean:function(t){return e(t)[0]},errors:function(){var t=this.settings.errorClass.replace(" ",".");return e(this.settings.errorElement+"."+t,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=e([]),this.toHide=e([]),this.currentElements=e([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(e){this.reset(),this.toHide=this.errorsFor(e)},elementValue:function(t){var n=e(t).attr("type"),r=e(t).val();return n==="radio"||n==="checkbox"?e("input[name='"+e(t).attr("name")+"']:checked").val():typeof r=="string"?r.replace(/\r/g,""):r},check:function(t){t=this.validationTargetFor(this.clean(t));var n=e(t).rules(),r=!1,i=this.elementValue(t),s;for(var o in n){var u={method:o,parameters:n[o]};try{s=e.validator.methods[o].call(this,i,t,u.parameters);if(s==="dependency-mismatch"){r=!0;continue}r=!1;if(s==="pending"){this.toHide=this.toHide.not(this.errorsFor(t));return}if(!s){return this.formatAndAdd(t,u),!1}}catch(a){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+t.id+", check the '"+u.method+"' method.",a),a}}if(r){return}return this.objectLength(n)&&this.successList.push(t),!0},customDataMessage:function(t,n){return e(t).data("msg-"+n.toLowerCase())||t.attributes&&e(t).attr("data-msg-"+n.toLowerCase())},customMessage:function(e,t){var n=this.settings.messages[e];return n&&(n.constructor===String?n:n[t])},findDefined:function(){for(var e=0;e<arguments.length;e++){if(arguments[e]!==undefined){return arguments[e]}}return undefined},defaultMessage:function(t,n){return this.findDefined(this.customMessage(t.name,n),this.customDataMessage(t,n),!this.settings.ignoreTitle&&t.title||undefined,e.validator.messages[n],"<strong>Warning: No message defined for "+t.name+"</strong>")},formatAndAdd:function(t,n){var r=this.defaultMessage(t,n.method),i=/\$?\{(\d+)\}/g;typeof r=="function"?r=r.call(this,n.parameters,t):i.test(r)&&(r=e.validator.format(r.replace(i,"{$1}"),n.parameters)),this.errorList.push({message:r,element:t}),this.errorMap[t.name]=r,this.submitted[t.name]=r},addWrapper:function(e){return this.settings.wrapper&&(e=e.add(e.parent(this.settings.wrapper))),e},defaultShowErrors:function(){var e,t;for(e=0;this.errorList[e];e++){var n=this.errorList[e];this.settings.highlight&&this.settings.highlight.call(this,n.element,this.settings.errorClass,this.settings.validClass),this.showLabel(n.element,n.message)}this.errorList.length&&(this.toShow=this.toShow.add(this.containers));if(this.settings.success){for(e=0;this.successList[e];e++){this.showLabel(this.successList[e])}}if(this.settings.unhighlight){for(e=0,t=this.validElements();t[e];e++){this.settings.unhighlight.call(this,t[e],this.settings.errorClass,this.settings.validClass)}}this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return e(this.errorList).map(function(){return this.element})},showLabel:function(t,n){var r=this.errorsFor(t);r.length?(r.removeClass(this.settings.validClass).addClass(this.settings.errorClass),r.html(n)):(r=e("<"+this.settings.errorElement+">").attr("for",this.idOrName(t)).addClass(this.settings.errorClass).html(n||""),this.settings.wrapper&&(r=r.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(r).length||(this.settings.errorPlacement?this.settings.errorPlacement(r,e(t)):r.insertAfter(t))),!n&&this.settings.success&&(r.text(""),typeof this.settings.success=="string"?r.addClass(this.settings.success):this.settings.success(r,t)),this.toShow=this.toShow.add(r)},errorsFor:function(t){var n=this.idOrName(t);return this.errors().filter(function(){return e(this).attr("for")===n})},idOrName:function(e){return this.groups[e.name]||(this.checkable(e)?e.name:e.id||e.name)},validationTargetFor:function(e){return this.checkable(e)&&(e=this.findByName(e.name).not(this.settings.ignore)[0]),e
},checkable:function(e){return/radio|checkbox/i.test(e.type)},findByName:function(t){return e(this.currentForm).find("[name='"+t+"']")},getLength:function(t,n){switch(n.nodeName.toLowerCase()){case"select":return e("option:selected",n).length;case"input":if(this.checkable(n)){return this.findByName(n.name).filter(":checked").length}}return t.length},depend:function(e,t){return this.dependTypes[typeof e]?this.dependTypes[typeof e](e,t):!0},dependTypes:{"boolean":function(e,t){return e},string:function(t,n){return !!e(t,n.form).length},"function":function(e,t){return e(t)}},optional:function(t){var n=this.elementValue(t);return !e.validator.methods.required.call(this,n,t)&&"dependency-mismatch"},startRequest:function(e){this.pending[e.name]||(this.pendingRequest++,this.pending[e.name]=!0)},stopRequest:function(t,n){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[t.name],n&&this.pendingRequest===0&&this.formSubmitted&&this.form()?(e(this.currentForm).submit(),this.formSubmitted=!1):!n&&this.pendingRequest===0&&this.formSubmitted&&(e(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(t){return e.data(t,"previousValue")||e.data(t,"previousValue",{old:null,valid:!0,message:this.defaultMessage(t,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(t,n){t.constructor===String?this.classRuleSettings[t]=n:e.extend(this.classRuleSettings,t)},classRules:function(t){var n={},r=e(t).attr("class");return r&&e.each(r.split(" "),function(){this in e.validator.classRuleSettings&&e.extend(n,e.validator.classRuleSettings[this])}),n},attributeRules:function(t){var n={},r=e(t),i=r[0].getAttribute("type");for(var s in e.validator.methods){var o;s==="required"?(o=r.get(0).getAttribute(s),o===""&&(o=!0),o=!!o):o=r.attr(s),/min|max/.test(s)&&(i===null||/number|range|text/.test(i))&&(o=Number(o)),o?n[s]=o:i===s&&i!=="range"&&(n[s]=!0)}return n.maxlength&&/-1|2147483647|524288/.test(n.maxlength)&&delete n.maxlength,n},dataRules:function(t){var n,r,i={},s=e(t);for(n in e.validator.methods){r=s.data("rule-"+n.toLowerCase()),r!==undefined&&(i[n]=r)}return i},staticRules:function(t){var n={},r=e.data(t.form,"validator");return r.settings.rules&&(n=e.validator.normalizeRule(r.settings.rules[t.name])||{}),n},normalizeRules:function(t,n){return e.each(t,function(r,i){if(i===!1){delete t[r];return}if(i.param||i.depends){var s=!0;switch(typeof i.depends){case"string":s=!!e(i.depends,n.form).length;break;case"function":s=i.depends.call(n,n)}s?t[r]=i.param!==undefined?i.param:!0:delete t[r]}}),e.each(t,function(r,i){t[r]=e.isFunction(i)?i(n):i}),e.each(["minlength","maxlength"],function(){t[this]&&(t[this]=Number(t[this]))}),e.each(["rangelength","range"],function(){var n;t[this]&&(e.isArray(t[this])?t[this]=[Number(t[this][0]),Number(t[this][1])]:typeof t[this]=="string"&&(n=t[this].split(/[\s,]+/),t[this]=[Number(n[0]),Number(n[1])]))}),e.validator.autoCreateRanges&&(t.min&&t.max&&(t.range=[t.min,t.max],delete t.min,delete t.max),t.minlength&&t.maxlength&&(t.rangelength=[t.minlength,t.maxlength],delete t.minlength,delete t.maxlength)),t},normalizeRule:function(t){if(typeof t=="string"){var n={};e.each(t.split(/\s/),function(){n[this]=!0}),t=n}return t},addMethod:function(t,n,r){e.validator.methods[t]=n,e.validator.messages[t]=r!==undefined?r:e.validator.messages[t],n.length<3&&e.validator.addClassRules(t,e.validator.normalizeRule(t))},methods:{required:function(t,n,r){if(!this.depend(r,n)){return"dependency-mismatch"}if(n.nodeName.toLowerCase()==="select"){var i=e(n).val();return i&&i.length>0}return this.checkable(n)?this.getLength(t,n)>0:e.trim(t).length>0},email:function(e,t){return this.optional(t)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e)},url:function(e,t){return this.optional(t)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)
},date:function(e,t){return this.optional(t)||!/Invalid|NaN/.test((new Date(e)).toString())},dateISO:function(e,t){return this.optional(t)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(e)},number:function(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)},digits:function(e,t){return this.optional(t)||/^\d+$/.test(e)},creditcard:function(e,t){if(this.optional(t)){return"dependency-mismatch"}if(/[^0-9 \-]+/.test(e)){return !1}var n=0,r=0,i=!1;e=e.replace(/\D/g,"");for(var s=e.length-1;s>=0;s--){var o=e.charAt(s);r=parseInt(o,10),i&&(r*=2)>9&&(r-=9),n+=r,i=!i}return n%10===0},minlength:function(t,n,r){var i=e.isArray(t)?t.length:this.getLength(e.trim(t),n);return this.optional(n)||i>=r},maxlength:function(t,n,r){var i=e.isArray(t)?t.length:this.getLength(e.trim(t),n);return this.optional(n)||i<=r},rangelength:function(t,n,r){var i=e.isArray(t)?t.length:this.getLength(e.trim(t),n);return this.optional(n)||i>=r[0]&&i<=r[1]},min:function(e,t,n){return this.optional(t)||e>=n},max:function(e,t,n){return this.optional(t)||e<=n},range:function(e,t,n){return this.optional(t)||e>=n[0]&&e<=n[1]},equalTo:function(t,n,r){var i=e(r);return this.settings.onfocusout&&i.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){e(n).valid()}),t===i.val()},remote:function(t,n,r){if(this.optional(n)){return"dependency-mismatch"}var i=this.previousValue(n);this.settings.messages[n.name]||(this.settings.messages[n.name]={}),i.originalMessage=this.settings.messages[n.name].remote,this.settings.messages[n.name].remote=i.message,r=typeof r=="string"&&{url:r}||r;if(i.old===t){return i.valid}i.old=t;var s=this;this.startRequest(n);var o={};return o[n.name]=t,e.ajax(e.extend(!0,{url:r,mode:"abort",port:"validate"+n.name,dataType:"json",data:o,success:function(r){s.settings.messages[n.name].remote=i.originalMessage;var o=r===!0||r==="true";if(o){var u=s.formSubmitted;s.prepareElement(n),s.formSubmitted=u,s.successList.push(n),delete s.invalid[n.name],s.showErrors()}else{var a={},f=r||s.defaultMessage(n,"remote");a[n.name]=i.message=e.isFunction(f)?f(t):f,s.invalid[n.name]=!0,s.showErrors(a)}i.valid=o,s.stopRequest(n,o)}},r)),"pending"}}}),e.format=e.validator.format})(e),function(e){var t={};if(e.ajaxPrefilter){e.ajaxPrefilter(function(e,n,r){var i=e.port;e.mode==="abort"&&(t[i]&&t[i].abort(),t[i]=r)})}else{var n=e.ajax;e.ajax=function(r){var i=("mode" in r?r:e.ajaxSettings).mode,s=("port" in r?r:e.ajaxSettings).port;return i==="abort"?(t[s]&&t[s].abort(),t[s]=n.apply(this,arguments),t[s]):n.apply(this,arguments)}}}(e),function(e){e.extend(e.fn,{validateDelegate:function(t,n,r){return this.bind(n,function(n){var i=e(n.target);if(i.is(t)){return r.apply(i,arguments)}})}})}(e)}),define("module/common/soundreportview",["jquery","underscore","backbone","json2","model/report","plugin/dialog","module/uploadimg","plugin/jquery.validate"],function(e,t,n,r,i,s,o){var u=["<form>",'	<dl class="report_r1">',"		<dt>如果你觉得该声音内容存在问题，欢迎向管理员举报:</dt>",'		<dd><label><input name="reportType" type="radio" value="3">含有反动内容</label></dd>','		<dd><label><input name="reportType" type="radio" value="2">版权侵权</label></dd>','		<dd><label><input name="reportType" type="radio" value="1">广告欺诈</label></dd>','		<dd><label><input name="reportType" type="radio" value="5">包含色情内容</label></dd>','		<dd><label><input name="reportType" type="radio" value="4">其他</label></dd>',"	</dl>",'	<dl class="popup_dl">',"		<dt>说明</dt>",'		<dd><textarea class="reportText" name="content"></textarea></dd>',"	</dl>",'	<div class="report_tort hidden">','		<div class="fl">',"			<dl>","				<dt>联系人（著作本人或代理律师）</dt>",'				<dd><input type="text" id="username" name="username"></dd>',"			</dl>","			<dl>","				<dt>邮箱</dt>",'				<dd><input type="text" id="email" name="email"></dd>',"			</dl>","			<dl>","				<dt>电话</dt>",'				<dd><input type="text" id="phone" name="phone"></dd>',"			</dl>","		</div>",'		<div class="fr" style="position:relative;">','			<div class="uploadImg report_tort_pic">','               <span style="z-index:1;position: absolute;top: 0px;left: 0px;padding:5px;">侵权证明材料：<br>著作权声明及版权拥有声明等(支持jpeg,jpg,bmp,png格式）</span>','               <img style="width:100%;height:100%;z-index:0;" src="" alt="" />',"           </div>",'           <input type="text" style="position:absolute;top:-10000px;" id="imgPath" name="imgPath">','           <a class="uploadPicBtn">上传图片</a>',"		</div>","       ","	</div>",'	<div class="operate"><a href="javascript:;" class="confirmBtn">确认</a></div>',"</form>"].join(""),a=config.DIRECT_DTRES_ROOT+"/cover/upload",f=n.View.extend({template:t.template(u),events:{"click .confirmBtn":"doReport","click [name='reportType']":"doClick"},doClick:function(t){var n=e(t.currentTarget);n.val()=="2"?this.$el.find(".report_tort").removeClass("hidden"):this.$el.find(".report_tort").addClass("hidden"),this.pop.setPosition()},initialize:function(){this.render()},show:function(){var t=this,n=e.extend({id:"report_aftattention",dialogClass:"report",header:"举报",width:420,content:t.$el},{});
t.render(),t.pop=new s.Dialog(n),t.pop.open(),t.$el.find("[name='reportType']:eq(0)").attr("checked","checked"),new o({url:a,$el:t.$el.find(".uploadPicBtn"),maxSize:5,success:function(e,n){var r=e.data[0];t.$el.find(" img").attr("src",config.FDFS_PATH+"//"+r.dfsId),t.$el.find("#imgPath").val(config.FDFS_PATH+"//"+r.dfsId)}}),t.$el.find("form").validate({rules:{username:{required:!0},email:{required:!0,email:!0},phone:{required:!0},imgPath:{required:!0}},messages:{username:{required:"联系人不能为空"},email:{required:"邮箱不能为空",email:"请填写正确的邮箱"},phone:{required:"电话不能为空"},imgPath:{required:"图片不能为空"}},onfocusout:!1,onkeyup:!1,onclick:!1,showErrors:function(t,n){var r=[];n.length&&(e.each(n,function(e,t){r.push(t.message)}),s.alert(r.join("</br>")))},submitHandler:function(){var e=t.$el.find("[name='reportType']:checked").val(),n=t.$el.find(".reportText").val(),i=t.$el.find("#username").val(),o=t.$el.find("#email").val(),u=t.$el.find("#phone").val(),a=t.$el.find("#imgPath").val();e=="2"?n={content:n,picpath:a,mail:o,to_nick:i,phone:u}:n={content:n},t.model.set({report_id:e,content:r.stringify(n)}),t.model.doReport(function(){s.success("举报成功!"),t.pop.close()},function(e,t){s.alert("举报失败!")})}})},doReport:function(e){this.$el.find("form").submit()},render:function(){this.$el.html(this.template(this.model.toJSON())),this.undelegateEvents(),this.delegateEvents(this.events)}});return new f({model:new i})}),define("module/common/commentreportview",["jquery","underscore","backbone","model/report","plugin/dialog"],function(e,t,n,r,i){var s=['<dl class="report_r1">',"	<dt>如果你觉得该声音内容存在问题，欢迎向管理员举报:</dt>",'	<dd><label><input name="reportType" type="radio" value="6">垃圾广告</label></dd>','	<dd><label><input name="reportType" type="radio" value="10">人身攻击我</label></dd>','	<dd><label><input name="reportType" type="radio" value="7">虚假中奖</label></dd>','	<dd><label><input name="reportType" type="radio" value="11">骚扰我</label></dd>','	<dd><label><input name="reportType" type="radio" value="8">含有色情内容</label></dd>','	<dd><label><input name="reportType" type="radio" value="12">冒充我</label></dd>','	<dd><label><input name="reportType" type="radio" value="9">含有反动内容</label></dd>','	<dd><label><input name="reportType" type="radio" value="13">泄露我隐私</label></dd>','	<dd><label><input name="reportType" type="radio" value="14">其他</label></dd>',"</dl>",'<dl class="popup_dl">',"	<dt>说明</dt>",'	<dd><input type="text" class="reportText" name="content"/></dd>',"</dl>",'<div class="operate"><a class="confirmBtn">确认</a></div>'].join(""),o=n.View.extend({template:t.template(s),events:{"click .confirmBtn":"doReport"},initialize:function(){this.render()},show:function(){var t=this,n=e.extend({id:"report_aftattention",dialogClass:"report",header:"举报",content:t.$el},{});t.render(),t.pop=new i.Dialog(n),t.pop.open(),t.$el.find("[name='reportType']:eq(0)").attr("checked","checked"),t.undelegateEvents(),t.delegateEvents(t.events)},doReport:function(e){var t=this,n=t.$el.find("[name='reportType']:checked").val(),r=t.$el.find(".reportText").val();t.model.set({report_id:n,content:JSON.stringify({content:r})}),t.model.doReport(function(){i.success("举报成功!"),t.pop.close()},function(e,t){i.alert("举报失败!")})},render:function(){this.$el.html(this.template(this.model.toJSON()))}});return new o({model:new r})}),define("module/common/ireport",["jquery","underscore","backbone","model/report","module/common/soundreportview","module/common/commentreportview","module/dialogs/login_box"],function(e,t,n,r,i,s,o){function u(){return location.host.indexOf("test")!=-1?document.cookie.indexOf("4&_token=")!=-1:document.cookie.indexOf("1&_token=")!=-1}var a=n.View.extend({init:function(){this.release(),e(".reportBtn").on("click",[this],this.doReport),e(".reportBtn2").on("click",[this],this.doReport)},doBindOne:function(e){e.on("click",[this],this.doReport)},doReport:function(e){if(!u()){o.open();return}var t=e.data[0];t.doReport1(this,t)},doReport1:function(t,n){var o=e.extend({},e.parser.parseOptions(t,[{track_id:"number",content_title:"string",content_type:"number"}]));o.content_type==2?(s.model=new r(o),s.show()):o.content_type==1&&(i.model=new r(o),i.show())},release:function(){e(".reportBtn").off("click"),e(".reportBtn2").off("click")}});return new a({model:new r})}),define("plugin/jquery.menu-aim",["jquery"],function(e){function t(t){var n=e(this),r=null,i=[],s=null,o=null,u=e.extend({rowSelector:"> li",submenuSelector:"*",submenuDirection:"right",tolerance:75,enter:e.noop,exit:e.noop,activate:e.noop,deactivate:e.noop,exitMenu:e.noop},t),a=3,f=30,l=function(e){i.push({x:e.pageX,y:e.pageY}),i.length>a&&i.shift()},c=function(){o&&clearTimeout(o),u.exitMenu(this)&&(r&&u.deactivate(r),r=null)},h=function(){o&&clearTimeout(o),u.enter(this),m(this)},p=function(){u.exit(this)},d=function(){v(this)},v=function(e){if(e==r){return}r&&u.deactivate(r),u.activate(e),r=e},m=function(e){var t=g();t?o=setTimeout(function(){m(e)},t):v(e)},g=function(){function d(e,t){return(t.y-e.y)/(t.x-e.x)}if(!r||!e(r).is(u.submenuSelector)){return 0
}var t=n.offset(),o={x:t.left,y:t.top-u.tolerance},a={x:t.left+n.outerWidth(),y:o.y},l={x:t.left,y:t.top+n.outerHeight()+u.tolerance},c={x:t.left+n.outerWidth(),y:l.y},h=i[i.length-1],p=i[0];if(!h){return 0}p||(p=h);if(p.x<t.left||p.x>c.x||p.y<t.top||p.y>c.y){return 0}if(s&&h.x==s.x&&h.y==s.y){return 0}var v=a,m=c;u.submenuDirection=="left"?(v=l,m=o):u.submenuDirection=="below"?(v=c,m=l):u.submenuDirection=="above"&&(v=o,m=a);var g=d(h,v),y=d(h,m),b=d(p,v),w=d(p,m);return g<b&&y>w?(s=h,f):(s=null,0)};n.mouseleave(c).find(u.rowSelector).mouseenter(h).mouseleave(p).click(d),e(this).mousemove(l)}e.fn.menuAim=function(e){return this.each(function(){t.call(this,e)}),this}}),define("page/discovery/album_sound",["jquery","page/page_base","underscore","plugin/jquery.menu-aim"],function(e,t,n){var r=t.extend({url_tag:"/explore/tag_list",container:"#discoverSound",initCommon:function(t){this.callParent("init"),this.$container=e(this.container),this.$tagWrap=e(".tag_wrap"),this.category_text="",this.initData(t),this.bindEvents(),e(".bodyBgColor").addClass("bodyBgColor2")},createTags:function(t,n){var r=this,i=this.data.category,s=this.$tagWrap.find("[data-cache="+i+"]");if(s.size()>0){this.$tagWrap.children().hide(),s.show(),r.resetTagsTop(t,n);return}this.index_load||(this.index_load={});if(this.index_load[t]){return}this.index_load[t]=!0,e.get(this.url_tag,this.data,function(s){if(!s){return}var o=s.list,u=e("<div></div>").attr("data-cache",i);for(var a=0,f=o.length;a<f;a++){var l=o[a];u.append('<a class="tagBtn" href="javascript:;" tid="'+(l.tname||"")+'"><span>'+l.tname+"</span></a>")}r.$tagWrap.children().hide(),u.appendTo(r.$tagWrap),r.resetTagsTop(t,n)})},resetTagsTop:function(t,n){var r=this.$tagWrap,i=r.parent();if(t>=3){var s=t*n,o=i.closest("ul").position().top,u=i.height(),a=e(window).height(),f=e(document).scrollTop();s+o+u>f+a&&(s=f+a-u-o),i.css("top",s)}else{i.css("top",0)}},release:function(){this.unbindEvents(),this.index_load=null,e(".bodyBgColor").removeClass("bodyBgColor2")},render:function(){},afterRender:function(){},bindEvents:function(){var t=this.$container,n=t.find(".sort_list"),r=this;t.on("click","a",function(t){var n=e(this);if(n.is("[forseo=true]")){if(helper.isLogin()){t.preventDefault();return}t.stopPropagation();return}if(n.is("[hashlink]")){var r=n.attr("href");if(helper.isLogin()&&!/^http\:/.test(r)){if(location.pathname==="/"){location.hash=r,t.preventDefault();return}location.href="http://"+location.host+"/#"+r,t.preventDefault();return}}}),t.on("click","#nav_condition li",function(){var n=e(this);if(n.hasClass("on")){return}n.parent().find("li.on").removeClass("on"),n.addClass("on"),r.data.condition=n.attr("condition"),t.find(".tags_panel .tagBtn.on").removeClass("on"),r.onTagSelectBefore(),r.onTagSelect()});var i=t.find(".dis_sound_sort");i.on("mouseleave",".sort_list",function(){if(n.attr("data-show-tags")){return}n.removeClass("is-show-tags")}),i.find(".sort_list").menuAim({rowSelector:"> li",tolerance:5,activate:function(t){var i=e(t);if(n.attr("is-tags-enter")){return}n.addClass("is-show-tags"),i.parent().find("li.hover").removeClass("hover"),i.addClass("hover");var s=r.data.category,o=r.category_text;r.data.category=i.attr("cid"),r.createTags(i.index(),i.outerHeight()),r.data.category=s},enter:function(t){var r=e(t);r.hasClass("hover")&&n.addClass("is-show-tags")},deactivate:function(e){}}),i.on("mouseenter",".sort_list .tags_panel",function(){n.attr("is-tags-enter",!0)}),i.on("mouseleave",".sort_list .tags_panel",function(){n.removeAttr("is-tags-enter")}),i.on("click",".sort_list li",function(){var n=e(this);if(n.hasClass("on")&&parseInt(n.attr("is-data-all"))!==0){return}n.attr("data-all",1),n.parent().find("li.on").removeClass("on"),n.addClass("on");var i=n.attr("cid");r.data.category=i,r.category_text=e.trim(n.text()),r.category_link=n.find("a").attr("href"),t.find(".tags_panel .tagBtn.on").removeClass("on"),r.data.tag="",r.onTagSelectBefore(),r.onTagSelect()}),i.on("click",".tags_panel .tagBtn",function(){var n=e(this);if(n.hasClass("on")){return}var i=n.closest(".tag_wrap");i.find(".on").removeClass("on"),n.addClass("on");var s=t.find(".sort_list"),o=n.parent().attr("data-cache"),u=s.find("li[cid="+o+"]");r.data.tag=n.attr("tid"),r.data.category=o,r.category_text=e.trim(u.text()),r.category_link=u.find("a").attr("href"),r.onTagSelectBefore(),r.onTagSelect(),s.find("li.on").removeClass("on"),u.addClass("on").attr("is-data-all",0)});var s=e("#crumb_sub"),o=e("#crumb_all");o.on("click","a",function(){t.find(".sort_list li").eq(0).trigger("click"),n.removeClass("is-show-tags")}),s.on("click","a",function(){var r=e(this),i=r.attr("cid");t.find(".sort_list li[cid="+i+"]").trigger("click"),n.removeClass("is-show-tags")})},onTagSelect:function(){},onTagSelectBefore:function(){this.createCrumbs()},createCrumbs:function(){var t=this.data,n=t.category,r=this.category_text,i=t.tag,s=e("#crumb_sub"),o=s.find("a"),u=e("#crumb_tag"),a=u.find("span");n&&r?(s.show(),o.text(r).attr("cid",n).attr("href",this.category_link)):s.hide(),i?(u.show(),a.text(i)):u.hide()
},unbindEvents:function(){this.$container.off()}});return r}),define("page/discovery/dis_album",["jquery","page/discovery/album_sound","underscore","module/player/player","plugin/jquery.selecter"],function(e,t,n,r){var i=t.extend({container:"#discoverAlbum",url_album:"/explore/album_detail",data:{category:0,condition:"",tag:"",per_page:12},init:function(){this.initCommon(),this.$container=e("#discoverAlbum"),this.$layoutRight=this.$container.find(".layout_right"),r.render({$container:this.$layoutRight}),this.initStatus()},initData:function(){var e=this.$container,t=e.find(".sort_list li.on"),n=e.find("#nav_condition li.on");this.data.category=t.attr("cid"),this.data.condition=n.attr("condition"),this.data_tag="",this.data.tag=""},initStatus:function(){var e=this.$container,t=this,n=e.find("#nav_status");n.selecter(),n.on("change",function(){e.find(".tags_panel .tagBtn.on").removeClass("on"),t.onTagSelect()})},onTagSelect:function(){window.console&&console.log(this.data);if(helper.isLogin()){this.data_tag=this.data.tag;var t=this.$container.find("#nav_status"),n=["3","9"];e.inArray(this.data.category,n)>=0?(this.data.status=t.selecter("val")||0,t.removeClass("hidden")):(t.addClass("hidden"),this.data.status=0),this.getAlbumList(1)}},getAlbumList:function(t){var n=this,i=e.extend({},this.data,{page:t,tag:n.data_tag});e.get(this.url_album,helper.sortObjectKeys(i),function(t){e(".layout_right").html(t),r.render({$container:this.$layoutRight})})},release:function(){this.callParent("release"),this.unbindEvents()},bindEvents:function(){this.callParent("bindEvents");var t=this.$container,n=this;t.on("click",".pagingBar [data-page]",function(){n.getAlbumList(e(this).attr("data-page"))}),t.on("click",".discoverAlbum_wrapper .playBtn",function(){var t=e(this),r=t.closest(".miniPlayer3");if(r.attr("sound_id")){return}var i=t.closest(".discoverAlbum_item"),s=i.attr("album_id");n.initSoundId(r,t,s)})},initSoundId:function(t,n,i){e.get("/album/"+i+"/sound_ids",function(e){var i=e[0];t.attr("sound_id",i),r.render({$container:t}),n.trigger("click")})},unbindEvents:function(){this.callParent("unbindEvents")}});return new i}),define("page/discovery/dis_index",["jquery","page/page_base","module/player/player"],function(e,t,n){var r=t.extend({init:function(){this.callParent("init"),e(".bodyBgColor").addClass("bodyBgColor2"),this.$el=e("#discoverPage"),this.$picWrapper=this.$el.find(".picWrapper"),this.initSlide(),e(".disRankUserPanel").on("click",function(t){var n=e(t.target);if(n.attr("href")){return}if(n.closest("a").size()!=0){return}if(!n.size()||!n.closest("[sound_id]").size()){var r=e(this).find(".rankUserPanel2 .userface60").attr("href");return r&&(location.href=r),!1}}),n.render({$container:this.$el,waveRenderDelay:!0})},initSlide:function(){var t=this.$picWrapper,n=t.find(".border-wrap"),r=0,i=-1,s=this;this._slideStop=!1;var o=function(t,r){r=r||e.noop;var o=t.index(),a=t.height(),f=t.parent().find(".on"),l=320;helper.browser.msie&&parseInt(helper.browser.version)<=8&&(l=0),f.removeClass("on"),n.stop().animate({top:o*a},l,"linear",function(){t.addClass("on"),n.attr("href",t.attr("href"));if(o==i){return}s.showSlideImg(o,i,u),i=t.index(),r(i)})};t.on("mouseenter",".nav",function(){var t=e(this);o(t)}),t.on({mouseenter:function(){s.stopSlide()},mouseleave:function(){s.startSlide()}});var u=t.find(".nav"),a=u.size()-1;this._slideTimer=setInterval(function(){if(s._slideStop){return}if(u.eq(i).attr("data-playing")){return}r!=i&&(r=i),r++,r>a&&(r=0),o(u.eq(r))},4000),o(u.eq(0))},showSlideImg:function(t,r,i){var s=this.$picWrapper.find(".picShow"),o=300;helper.browser.msie&&parseInt(helper.browser.version)<=8&&(o=0),s.eq(r).fadeOut(o,function(){n.render({$container:s})}),s.on("onSoundPlay",function(){var t=e(this),n=t.index();i.eq(n).attr("data-playing",!0)}),s.on("onSoundStop onSoundPause onSoundFinish",function(){var t=e(this),n=t.index();i.eq(n).removeAttr("data-playing")}),s.eq(t).fadeIn(o)},stopSlide:function(){this._slideStop=!0},startSlide:function(){this._slideStop=!1},release:function(){this.callParent("release"),clearInterval(this._slideTimer),e(".bodyBgColor").removeClass("bodyBgColor2")},render:function(){},afterRender:function(){},bindEvents:function(){}});return new r}),define("module/dialogs/edit_player",["jquery","plugin/dialog"],function(e,t){var n={open:function(t,n,r,i){this.callback=i||e.noop,this.createPop(t,n,r)},createPop:function(n,r,i){var s=config.STATIC_PATH+"/css/img/",o=["playerS1.png","playerS2.png","playerS3.png","playerS4.png","playerS5.png","playerS6.png"];n!="album"&&(o=["playerSound1.png","playerSound2.png","playerSound3.png","playerSound4.png","playerSound5.png","playerSound6.png"]);var u='<div class="popup_dl"><strong>配色</strong><div class="playerColorBar"><a class="playerColor c1 on"></a><a class="playerColor c2"></a><a class="playerColor c3"></a><a class="playerColor c4"></a><a class="playerColor c5"></a><a class="playerColor c6"></a></div></div><div class="popup_dl"><input type="checkbox" id="autoPlay">自动播放<div class="listenhelp"><a class="grouphelp"></a><div class="grouphelp_txt">勾选后，则播放加载完成后自动开始播放<span class="arrow_grouphelp"><i></i></span></div></div><img src="'+s+o[0]+'" class="playerPic">'+"</div>"+'<div class="operate">'+'<a class="confirmBtn">保存</a>'+'<a class="cancelBtn" dialog-role="close">取消</a>'+"</div>",a={dialogClass:"editPlayer",header:"编辑播放器样式",content:u},f=new t.Dialog(a),l=this;
this.pop=f;var c=f.getEl(),h=c.find(".playerPic"),p=c.find(".playerColorBar");c.find(".playerPic").on("load",function(){f.setPosition()}),p.on("click",".playerColor",function(){var t=e(this),n=t.index();h.attr("src",s+o[n]),t.parent().find(".on").removeClass("on"),t.addClass("on")}),p.find(".playerColor").eq(r).click();var d=e("#autoPlay");i&&d.attr("checked","checked"),c.on("click",".confirmBtn",function(){var e=p.find(".on").index(),t=!!d[0].checked;l.savePlayer(e,t,function(){f.close()})}),f.open()},savePlayer:function(e,t,n){this.callback(e,t),n()}};return n});define("page/final/final_sound",["jquery","page/page_base","helper","module/player/player","module/comment_box","module/common/ireport","model/comment","plugin/dialog","module/dialogs/share2friend","module/common/ifollow","module/common/sound2public"],function(e,t,n,r,i,s,o,u,a,f){var l=t.extend({init:function(){this.callParent("init"),this.$el=e(".mainbox_wrapper"),this.$soundBox=this.$el.find(".detail_soundBox2"),this.track_id=this.$soundBox.attr("sound_id"),this.relayBoxHtml=e("#reply_box_template").html(),this.initPlayer(),this.initCommentBox(),this.initForwardBox(),this.bindEvents(),window.location.href.indexOf("relay=true")>0?this.getForwardList():this.getCommentList(),s.init(),f.init(),n.isLogin()&&this.initAjaxContent()},initAjaxContent:function(){var e=this.track_id,t=this.$el,n="/sounds/"+e+"/",r=n+"maybe_like_list",i=n+"right",s=n+"rich_intro",o=t.find(".recommendSound_body"),u=t.find(".rich_intro"),a=t.find(".mainbox_right"),f=this;u.load(s),o.addClass("loadingMore").load(r,function(){o.removeClass("loadingMore")}),a.addClass("loadingMore").load(i,function(){a.removeClass("loadingMore"),f.afterRender()})},initPlayer:function(){var e=this;r.render({$container:e.$soundBox})},initBox:function(e,t,n){var r=this,s=e.find(".commentBox_inputBox"),o=e.find(".comment_input textarea"),u=this.track_id;o.on({blur:function(){s.removeClass("focus")},focus:function(){s.addClass("focus")}}),new i({$el:e,trackId:u,$input:o,isForward:t,success:function(e){n(e)}})},initCommentBox:function(){var e=this,t=e.$el.find(".commentSection_body  .commentSend .commentBox");this.initBox(t,!1,function(t){e.getCommentList(),e.$el.find(".commentBtn").html("评论("+(t.track_comments_count||0)+")")})},initForwardBox:function(){var e=this,t=e.$el.find(".relaySection_body .commentSend .commentBox");this.initBox(t,!0,function(t){e.getForwardList(),e.$el.find(".forwordBtn").html("转采("+(t.track_shares_count||0)+")")})},getForwardList:function(t){t=t||1;var n={id:this.track_id,page:t},r="/sounds/"+n.id+"/relay_list",i=this,s=e("#relay_list_wrap");s.empty().addClass("loadingMore"),e.get(r,n,function(e){s.removeClass("loadingMore"),s.html(e)})},getCommentList:function(t){t=t||1;var n={id:this.track_id,page:t},r="/sounds/"+n.id+"/comment_list",i=this,o=e("#comment_list_wrap");o.empty().addClass("loadingMore"),e.get(r,n,function(e){o.removeClass("loadingMore"),o.html(e),s.init()})},getListAfter:function(){n.scrollTo(this.$el.find(".commentSection"),0)},release:function(){this.callParent("release"),this.unbindEvents(),s.release(),f.release()},bindEvents:function(){var t=this,n=this.$el;n.on("click",".commentSection_body .pagingBar_wrapper [data-page]",function(){var n=e(this).attr("data-page");t.getCommentList(n),t.getListAfter()}),n.on("click",".relaySection_body .pagingBar_wrapper [data-page]",function(){var n=e(this).attr("data-page");t.getForwardList(n),t.getListAfter()});var r=n.find(".commentSection_body"),i=n.find(".relaySection_body");n.on("click",".commentSection .tagTab .tab_item",function(){var n=e(this),s=n.index();if(n.hasClass("on")){return}n.parent().find(".on").removeClass("on"),n.addClass("on"),s==0?(r.show(),i.hide(),t.getCommentList()):(r.hide(),i.show(),t.getForwardList())}),n.on("click",".commentSection .delBtn",function(){var n=e(this),r=n.closest(".comment"),i=e.parseJSON(n.attr("data-options"));r.size()==0&&(r=n.closest(".listItem")),t.delComment(i,function(e,t){r.slideUp()},function(e,t){u.alert(t.msg)})}),n.on("click",".commentSection .replyBtn",function(){var n=e(this),r=n.closest(".comment"),i;r.size()>0?i=r.children(".reply_box_entry"):(r=n.closest(".comment2"),r.size()>0&&(i=r.children(".right").children(".reply_box_entry"))),t.createRelayBox(i,e.parseJSON(n.attr("data-options")))}),n.on("click",".recommendSound_head a",function(){t.changeRecommend()});var s=n.find(".mid_intro"),o=n.find(".rich_intro");n.on("click",".mid_intro .arrow",function(){s.stop().slideUp(),o.stop().slideDown()}),n.on("click",".rich_intro .arrow",function(){s.stop().slideDown(),o.stop().slideUp()}),n.on("click",".rich_intro a",function(){var e=this.host,t=this.href;if(e){var n=window.location.host;e==n?window.location.href=t:window.open(t)}return !1}),n.on("click",".shareLink[track_id]",function(){var t=e(this),n=t.attr("track_id"),r=t.attr("track_uid");a.open("sound",n,r)})},delComment:function(e,t,n){var r=new o({id:e.comment_id});r.set({trackId:e.track_id}),r.del(t,n)},changeRecommend:function(){var e=this.$el.find(".recommendSound_body"),t=e.children();
t.hide();var n=t.length;if(n<=5){t.show();return}var r=this.getRandomArr(n,5);for(var i=0;i<r.length;i++){t.eq(r[i]).show()}},getRandomArr:function(e,t){var n=[];while(e--){n[e]=e}var r=[];while(t--){var i=this.getRandom(n.length);r.push(n[i]),n.splice(i,1)}return r},getRandom:function(e){return parseInt(Math.random()*e)},createRelayBox:function(t,n){if(t.size()<1){return}if(t.attr("data-inited")){t.find(".commentBox").stop().slideToggle();return}t.html(_.template(this.replyBoxHtml,{logoPic60:config.CURRENT_USER.logoPic60})),t.find(".userface img").attr("src",current_user.logoPic60||current_user.logoPic);var r=this,s=t.find(".commentBox"),o=s.find("textarea");s.hide().stop().slideToggle();var u=s.find(".commentBox_inputBox"),a=u.find("input");a.on("focus",function(){return u.addClass("is-onEdit focus"),o.focus(),!1}),o.on({blur:function(){u.removeClass("focus"),e.trim(o.val())||u.removeClass("is-onEdit")},focus:function(){u.addClass("is-onEdit focus"),s.height("auto"),o.val()||o.val("回复@"+n.c_nickname+":")}}),new i({$el:s,trackId:r.track_id,parentId:n.c_id,second:n.c_second,$input:o,isForward:!1,success:function(e){r.$el.find(".commentBtn").html("评论("+(e.track_comments_count||0)+")"),s.stop().slideToggle()}}),t.attr("data-inited",!0)},unbindEvents:function(){this.$el.off()}});return new l}),define("page/final/final_tag",["jquery","page/page_base","module/player/player","model/tag","plugin/dialog","module/common/iletter","module/common/ifollow","helper"],function(e,t,n,r,i,s,o,u){var a=t.extend({init:function(){this.callParent("init"),this.$el=e(".mainbox_wrapper"),this.initData(),this.initPlayer(),this.bindEvents(),o.init(),u.isLogin()&&this.initAjaxContent()},data:{pre:"",scope:"hot"},initData:function(){var e=this;this.data={pre:e.$el.find(".soundTab .selecter-selected").attr("data-value"),scope:e.$el.find(".soundTab [data-scope][data-selected]").attr("data-scope")}},initAjaxContent:function(){var e=this.getTagId();if(!e){return}var t="/tag/"+e+"/show_right",n=this.$el.find(".mainbox_right"),r=this;n.addClass("loadingMore").load(t,function(){n.removeClass("loadingMore"),o.init(),r.afterRender()})},getTagId:function(){var e=window.location.href,t=e.replace(/.*tag\//i,"");return e.indexOf("follower")>0?!1:(t=t.replace(/\/.*/,""),t=t.replace(/\?.*/,""),t=encodeURIComponent(decodeURIComponent(t)),window.console&&console.log(t),t)},initPlayer:function(){var e=this;n.render({$container:e.$el})},release:function(){this.callParent("release"),this.unbindEvents(),o.release()},bindEvents:function(){var t=this,n=this.$el;n.find(".soundTab .selecter").selecter({onChange:function(e){t.data.pre=e||"",t.openWindow()}}),n.on("click",".soundTab a[data-scope]",function(){var n=e(this);t.data.scope=n.attr("data-scope"),t.openWindow(),n.parent().find("[data-selected]").removeAttr("data-selected"),n.attr("data-selected",!0)});var i=n.find(".interestBtn"),o=n.find(".tagCount"),u=i.attr("data-tag")||e(".tagName").text(),a=new r({tagName:u});n.on("click",".interestBtn",function(){var t=e(this);a.switchFollowedTag(function(n,r,i){r.response=="create"&&(o.each(function(){var t=e(this);t.text((t.text()||0)*1+1)}),t.addClass("already")),r.response=="destroy"&&(o.each(function(){var t=e(this);t.text((t.text()||0)*1-1)}),t.removeClass("already"))})}),s.bind(e(".sendLetterBtn"))},openWindow:function(){var e=window.location.href;e.indexOf("?")&&(e=e.replace(/\?.*/,"")),window.location.href=e+"?"+"scope="+this.data.pre+this.data.scope},unbindEvents:function(){this.$el.off()}});return new a}),define("page/final/sound_liker",["jquery","page/page_base","module/common/ireport","module/common/iletter","module/common/ifollow"],function(e,t,n,r,i){var s=t.extend({init:function(){this.callParent("init"),this.$el=e("#mainbox"),n.init(),i.init(),r.bind(e(".sendLetterBtn"))},release:function(){this.callParent("release"),i.release()}});return new s}),function(e){e.fn.qrcode=function(t){function i(e){this.mode=n,this.data=e}function s(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function o(e,t){if(void 0==e.length){throw Error(e.length+"/"+t)}for(var n=0;n<e.length&&0==e[n];){n++}this.num=Array(e.length-n+t);for(var r=0;r<e.length-n;r++){this.num[r]=e[r+n]}}function u(e,t){this.totalCount=e,this.dataCount=t}function a(){this.buffer=[],this.length=0}var n;i.prototype={getLength:function(){return this.data.length},write:function(e){for(var t=0;t<this.data.length;t++){e.put(this.data.charCodeAt(t),8)}}},s.prototype={addData:function(e){this.dataList.push(new i(e)),this.dataCache=null},isDark:function(e,t){if(0>e||this.moduleCount<=e||0>t||this.moduleCount<=t){throw Error(e+","+t)}return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){if(1>this.typeNumber){for(var e=1,e=1;40>e;e++){for(var t=u.getRSBlocks(e,this.errorCorrectLevel),n=new a,r=0,i=0;i<t.length;i++){r+=t[i].dataCount}for(i=0;i<this.dataList.length;i++){t=this.dataList[i],n.put(t.mode,4),n.put(t.getLength(),f.getLengthInBits(t.mode,e)),t.write(n)
}if(n.getLengthInBits()<=8*r){break}}this.typeNumber=e}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[n][r]=null}}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),7<=this.typeNumber&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=s.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(e,t){for(var n=-1;7>=n;n++){if(!(-1>=e+n||this.moduleCount<=e+n)){for(var r=-1;7>=r;r++){-1>=t+r||this.moduleCount<=t+r||(this.modules[e+n][t+r]=0<=n&&6>=n&&(0==r||6==r)||0<=r&&6>=r&&(0==n||6==n)||2<=n&&4>=n&&2<=r&&4>=r?!0:!1)}}}},getBestMaskPattern:function(){for(var e=0,t=0,n=0;8>n;n++){this.makeImpl(!0,n);var r=f.getLostPoint(this);if(0==n||e>r){e=r,t=n}}return t},createMovieClip:function(e,t,n){e=e.createEmptyMovieClip(t,n),this.make();for(t=0;t<this.modules.length;t++){for(var n=1*t,r=0;r<this.modules[t].length;r++){var i=1*r;this.modules[t][r]&&(e.beginFill(0,100),e.moveTo(i,n),e.lineTo(i+1,n),e.lineTo(i+1,n+1),e.lineTo(i,n+1),e.endFill())}}return e},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++){null==this.modules[e][6]&&(this.modules[e][6]=0==e%2)}for(e=8;e<this.moduleCount-8;e++){null==this.modules[6][e]&&(this.modules[6][e]=0==e%2)}},setupPositionAdjustPattern:function(){for(var e=f.getPatternPosition(this.typeNumber),t=0;t<e.length;t++){for(var n=0;n<e.length;n++){var r=e[t],i=e[n];if(null==this.modules[r][i]){for(var s=-2;2>=s;s++){for(var o=-2;2>=o;o++){this.modules[r+s][i+o]=-2==s||2==s||-2==o||2==o||0==s&&0==o?!0:!1}}}}}},setupTypeNumber:function(e){for(var t=f.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var r=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;18>n;n++){r=!e&&1==(t>>n&1),this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(e,t){for(var n=f.getBCHTypeInfo(this.errorCorrectLevel<<3|t),r=0;15>r;r++){var i=!e&&1==(n>>r&1);6>r?this.modules[r][8]=i:8>r?this.modules[r+1][8]=i:this.modules[this.moduleCount-15+r][8]=i}for(r=0;15>r;r++){i=!e&&1==(n>>r&1),8>r?this.modules[8][this.moduleCount-r-1]=i:9>r?this.modules[8][15-r-1+1]=i:this.modules[8][15-r-1]=i}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var n=-1,r=this.moduleCount-1,i=7,s=0,o=this.moduleCount-1;0<o;o-=2){for(6==o&&o--;;){for(var u=0;2>u;u++){if(null==this.modules[r][o-u]){var a=!1;s<e.length&&(a=1==(e[s]>>>i&1)),f.getMask(t,r,o-u)&&(a=!a),this.modules[r][o-u]=a,i--,-1==i&&(s++,i=7)}}r+=n;if(0>r||this.moduleCount<=r){r-=n,n=-n;break}}}}},s.PAD0=236,s.PAD1=17,s.createData=function(e,t,n){for(var t=u.getRSBlocks(e,t),r=new a,i=0;i<n.length;i++){var o=n[i];r.put(o.mode,4),r.put(o.getLength(),f.getLengthInBits(o.mode,e)),o.write(r)}for(i=e=0;i<t.length;i++){e+=t[i].dataCount}if(r.getLengthInBits()>8*e){throw Error("code length overflow. ("+r.getLengthInBits()+">"+8*e+")")}for(r.getLengthInBits()+4<=8*e&&r.put(0,4);0!=r.getLengthInBits()%8;){r.putBit(!1)}for(;!(r.getLengthInBits()>=8*e);){r.put(s.PAD0,8);if(r.getLengthInBits()>=8*e){break}r.put(s.PAD1,8)}return s.createBytes(r,t)},s.createBytes=function(e,t){for(var n=0,r=0,i=0,s=Array(t.length),u=Array(t.length),a=0;a<t.length;a++){var l=t[a].dataCount,c=t[a].totalCount-l,r=Math.max(r,l),i=Math.max(i,c);s[a]=Array(l);for(var h=0;h<s[a].length;h++){s[a][h]=255&e.buffer[h+n]}n+=l,h=f.getErrorCorrectPolynomial(c),l=(new o(s[a],h.getLength()-1)).mod(h),u[a]=Array(h.getLength()-1);for(h=0;h<u[a].length;h++){c=h+l.getLength()-u[a].length,u[a][h]=0<=c?l.get(c):0}}for(h=a=0;h<t.length;h++){a+=t[h].totalCount}n=Array(a);for(h=l=0;h<r;h++){for(a=0;a<t.length;a++){h<s[a].length&&(n[l++]=s[a][h])}}for(h=0;h<i;h++){for(a=0;a<t.length;a++){h<u[a].length&&(n[l++]=u[a][h])}}return n},n=4;for(var f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;0<=f.getBCHDigit(t)-f.getBCHDigit(f.G15);){t^=f.G15<<f.getBCHDigit(t)-f.getBCHDigit(f.G15)}return(e<<10|t)^f.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;
0<=f.getBCHDigit(t)-f.getBCHDigit(f.G18);){t^=f.G18<<f.getBCHDigit(t)-f.getBCHDigit(f.G18)}return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;){t++,e>>>=1}return t},getPatternPosition:function(e){return f.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case 0:return 0==(t+n)%2;case 1:return 0==t%2;case 2:return 0==n%3;case 3:return 0==(t+n)%3;case 4:return 0==(Math.floor(t/2)+Math.floor(n/3))%2;case 5:return 0==t*n%2+t*n%3;case 6:return 0==(t*n%2+t*n%3)%2;case 7:return 0==(t*n%3+(t+n)%2)%2;default:throw Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new o([1],0),n=0;n<e;n++){t=t.multiply(new o([1,l.gexp(n)],0))}return t},getLengthInBits:function(e,t){if(1<=t&&10>t){switch(e){case 1:return 10;case 2:return 9;case n:return 8;case 8:return 8;default:throw Error("mode:"+e)}}else{if(27>t){switch(e){case 1:return 12;case 2:return 11;case n:return 16;case 8:return 10;default:throw Error("mode:"+e)}}else{if(!(41>t)){throw Error("type:"+t)}switch(e){case 1:return 14;case 2:return 13;case n:return 16;case 8:return 12;default:throw Error("mode:"+e)}}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,r=0;r<t;r++){for(var i=0;i<t;i++){for(var s=0,o=e.isDark(r,i),u=-1;1>=u;u++){if(!(0>r+u||t<=r+u)){for(var a=-1;1>=a;a++){0>i+a||t<=i+a||0==u&&0==a||o==e.isDark(r+u,i+a)&&s++}}}5<s&&(n+=3+s-5)}}for(r=0;r<t-1;r++){for(i=0;i<t-1;i++){if(s=0,e.isDark(r,i)&&s++,e.isDark(r+1,i)&&s++,e.isDark(r,i+1)&&s++,e.isDark(r+1,i+1)&&s++,0==s||4==s){n+=3}}}for(r=0;r<t;r++){for(i=0;i<t-6;i++){e.isDark(r,i)&&!e.isDark(r,i+1)&&e.isDark(r,i+2)&&e.isDark(r,i+3)&&e.isDark(r,i+4)&&!e.isDark(r,i+5)&&e.isDark(r,i+6)&&(n+=40)}}for(i=0;i<t;i++){for(r=0;r<t-6;r++){e.isDark(r,i)&&!e.isDark(r+1,i)&&e.isDark(r+2,i)&&e.isDark(r+3,i)&&e.isDark(r+4,i)&&!e.isDark(r+5,i)&&e.isDark(r+6,i)&&(n+=40)}}for(i=s=0;i<t;i++){for(r=0;r<t;r++){e.isDark(r,i)&&s++}}return e=Math.abs(100*s/t/t-50)/5,n+10*e}},l={glog:function(e){if(1>e){throw Error("glog("+e+")")}return l.LOG_TABLE[e]},gexp:function(e){for(;0>e;){e+=255}for(;256<=e;){e-=255}return l.EXP_TABLE[e]},EXP_TABLE:Array(256),LOG_TABLE:Array(256)},c=0;8>c;c++){l.EXP_TABLE[c]=1<<c}for(c=8;256>c;c++){l.EXP_TABLE[c]=l.EXP_TABLE[c-4]^l.EXP_TABLE[c-5]^l.EXP_TABLE[c-6]^l.EXP_TABLE[c-8]}for(c=0;255>c;c++){l.LOG_TABLE[l.EXP_TABLE[c]]=c}return o.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=Array(this.getLength()+e.getLength()-1),n=0;n<this.getLength();n++){for(var r=0;r<e.getLength();r++){t[n+r]^=l.gexp(l.glog(this.get(n))+l.glog(e.get(r)))}}return new o(t,0)},mod:function(e){if(0>this.getLength()-e.getLength()){return this}for(var t=l.glog(this.get(0))-l.glog(e.get(0)),n=Array(this.getLength()),r=0;r<this.getLength();r++){n[r]=this.get(r)}for(r=0;r<e.getLength();r++){n[r]^=l.gexp(l.glog(e.get(r))+t)}return(new o(n,0)).mod(e)}},u.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],u.getRSBlocks=function(e,t){var n=u.getRsBlockTable(e,t);
if(void 0==n){throw Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t)}for(var r=n.length/3,i=[],s=0;s<r;s++){for(var o=n[3*s+0],a=n[3*s+1],f=n[3*s+2],l=0;l<o;l++){i.push(new u(a,f))}}return i},u.getRsBlockTable=function(e,t){switch(t){case 1:return u.RS_BLOCK_TABLE[4*(e-1)+0];case 0:return u.RS_BLOCK_TABLE[4*(e-1)+1];case 3:return u.RS_BLOCK_TABLE[4*(e-1)+2];case 2:return u.RS_BLOCK_TABLE[4*(e-1)+3]}},a.prototype={get:function(e){return 1==(this.buffer[Math.floor(e/8)]>>>7-e%8&1)},put:function(e,t){for(var n=0;n<t;n++){this.putBit(1==(e>>>t-n-1&1))}},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},"string"==typeof t&&(t={text:t}),t=e.extend({},{render:"canvas",width:256,height:256,typeNumber:-1,correctLevel:2,background:"#ffffff",foreground:"#000000"},t),this.each(function(){var n;if("canvas"==t.render){n=new s(t.typeNumber,t.correctLevel),n.addData(t.text),n.make();var i=document.createElement("canvas");i.width=t.width,i.height=t.height;for(var o=i.getContext("2d"),u=t.width/n.getModuleCount(),a=t.height/n.getModuleCount(),f=0;f<n.getModuleCount();f++){for(var l=0;l<n.getModuleCount();l++){o.fillStyle=n.isDark(f,l)?t.foreground:t.background;var c=Math.ceil((l+1)*u)-Math.floor(l*u),p=Math.ceil((f+1)*u)-Math.floor(f*u);o.fillRect(Math.round(l*u),Math.round(f*a),c,p)}}}else{n=new s(t.typeNumber,t.correctLevel),n.addData(t.text),n.make(),i=e("<table></table>").css("width",t.width+"px").css("height",t.height+"px").css("border","0px").css("border-collapse","collapse").css("background-color",t.background),o=t.width/n.getModuleCount(),u=t.height/n.getModuleCount();for(a=0;a<n.getModuleCount();a++){f=e("<tr></tr>").css("height",u+"px").appendTo(i);for(l=0;l<n.getModuleCount();l++){e("<td></td>").css("width",o+"px").css("background-color",n.isDark(a,l)?t.foreground:t.background).appendTo(f)}}}n=i,jQuery(n).appendTo(this)})}};