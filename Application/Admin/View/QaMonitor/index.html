<include file="Public/head"/>
<include file="Public/top"/>
<div class="clearfix">
    <div class="page-container">
        <include file="Public/left"/>

        <div class="page-content-wrapper">
            <div class="page-content">
                <!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
                <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="portlet-config"
                     class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
                                <h4 class="modal-title">Modal title</h4>
                            </div>
                            <div class="modal-body">
                                Widget settings form goes here
                            </div>
                            <div class="modal-footer">
                                <button class="btn blue" type="button">Save changes</button>
                                <button data-dismiss="modal" class="btn default" type="button">Close</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
                <!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
                <!-- BEGIN PAGE HEADER-->
                <!-- BEGIN PAGE HEAD -->
                <div class="page-head">
                    <!-- BEGIN PAGE TITLE -->
                    <!-- END PAGE TITLE -->
                    <!-- BEGIN PAGE TOOLBAR -->
                    <!--<div class="page-toolbar">
                         BEGIN THEME PANEL
                        <div class="btn-group btn-theme-panel">
                            <a data-toggle="dropdown" class="btn dropdown-toggle" href="javascript:;">
                            <i class="icon-settings"></i>
                            </a>
                            <div class="dropdown-menu theme-panel pull-right dropdown-custom hold-on-click">
                                <div class="row">
                                    <div class="col-md-4 col-sm-4 col-xs-12">
                                        <h3>THEME</h3>
                                        <ul class="theme-colors">
                                            <li data-theme="default" class="theme-color theme-color-default active">
                                                <span class="theme-color-view"></span>
                                                <span class="theme-color-name">Dark Header</span>
                                            </li>
                                            <li data-theme="light" class="theme-color theme-color-light">
                                                <span class="theme-color-view"></span>
                                                <span class="theme-color-name">Light Header</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-md-8 col-sm-8 col-xs-12 seperator">
                                        <h3>LAYOUT</h3>
                                        <ul class="theme-settings">
                                            <li>
                                                 Theme Style
                                                <select class="layout-style-option form-control input-small input-sm">
                                                    <option selected="selected" value="square">Square corners</option>
                                                    <option value="rounded">Rounded corners</option>
                                                </select>
                                            </li>
                                            <li>
                                                 Layout
                                                <select class="layout-option form-control input-small input-sm">
                                                    <option selected="selected" value="fluid">Fluid</option>
                                                    <option value="boxed">Boxed</option>
                                                </select>
                                            </li>
                                            <li>
                                                 Header
                                                <select class="page-header-option form-control input-small input-sm">
                                                    <option selected="selected" value="fixed">Fixed</option>
                                                    <option value="default">Default</option>
                                                </select>
                                            </li>
                                            <li>
                                                 Top Dropdowns
                                                <select class="page-header-top-dropdown-style-option form-control input-small input-sm">
                                                    <option value="light">Light</option>
                                                    <option selected="selected" value="dark">Dark</option>
                                                </select>
                                            </li>
                                            <li>
                                                 Sidebar Mode
                                                <select class="sidebar-option form-control input-small input-sm">
                                                    <option value="fixed">Fixed</option>
                                                    <option selected="selected" value="default">Default</option>
                                                </select>
                                            </li>
                                            <li>
                                                 Sidebar Menu
                                                <select class="sidebar-menu-option form-control input-small input-sm">
                                                    <option selected="selected" value="accordion">Accordion</option>
                                                    <option value="hover">Hover</option>
                                                </select>
                                            </li>
                                            <li>
                                                 Sidebar Position
                                                <select class="sidebar-pos-option form-control input-small input-sm">
                                                    <option selected="selected" value="left">Left</option>
                                                    <option value="right">Right</option>
                                                </select>
                                            </li>
                                            <li>
                                                 Footer
                                                <select class="page-footer-option form-control input-small input-sm">
                                                    <option value="fixed">Fixed</option>
                                                    <option selected="selected" value="default">Default</option>
                                                </select>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                         END THEME PANEL
                    </div> -->
                    <!-- END PAGE TOOLBAR -->
                </div>
                <!-- END PAGE HEAD -->
                <!-- BEGIN PAGE BREADCRUMB -->
                <!-- <ul class="page-breadcrumb breadcrumb">
                    <li>
                        <a href="#">竞猜</a>
                        <i class="fa fa-circle"></i>
                    </li>
                </ul> -->
                <!-- END PAGE BREADCRUMB -->
                <!-- END PAGE HEADER-->
                <!-- BEGIN PAGE CONTENT-->
                <!-- 注释 查询开始  -->
                <!-- 注释 查询结束  -->
                <div class="row">
                    <div class="col-md-12">
                        <!-- BEGIN EXAMPLE TABLE PORTLET-->
                        <div class="portlet box blue">
                            <div class="portlet-title">
                                <div class="caption">
                                    <i class="fa fa-edit"></i>进程列表
                                </div>
                            </div>
                            <div class="portlet-body">
                                <button style="margin-bottom:5px;" class="btn blue" type="button" id="qa-monitor-process-add">添加进程</button>
                                <table class="table table-striped table-hover table-bordered" id="sample_editable_1">
                                    <thead>
                                    <tr>
                                        <th>项目名</th>
                                        <th>项目路径</th>
                                        <th>进程名</th>
                                        <th>进程代码</th>
                                        <th>启用状态</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <notempty name="process_list">
                                        <foreach name="process_list" item="vo">
                                            <tr>
                                                <td>{$vo.project_name}</td>
                                                <td>{$vo.project_path}</td>
                                                <td>{$vo.process_name}</td>
                                                <td>{$vo.process_code}</td>
                                                <td>
                                                    <input type="checkbox" config-key="{$vo.id}" config-val="{$vo.monitor_status}" class="switch" checked/>
                                                </td>
                                                <td><a><i process_id="{$vo.id}" class="glyphicon glyphicon-trash monitor-process-delete" title="删除"></i></a></td>
                                            </tr>
                                        </foreach>
                                        <else/>
                                        <td colspan="6" class="text-center"> aOh! 暂时还没有内容!</td>
                                    </notempty>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- END EXAMPLE TABLE PORTLET-->
                    </div>
                </div>

                <!-- END PAGE CONTENT-->
            </div>
        </div>
    </div>
</div>
<script>
    $(function () {
        //添加进程
        $("#qa-monitor-process-add").on('click', function () {
            var options = {
                title: '添加进程',
                width: 800,
                border: 0,
                top: '25%',
                submit: function () {
                    var data = $("#monitor-process-form").serialize();
                    $.ajax({
                        url: "{:U('QaMonitor/processAdd')}",
                        type: 'GET',
                        data: data,
                        dataType: 'json',
                        success: function (res) {
                            if (res.status == 1) {
                                location.reload();
                            } else {
                                $.confirm({
                                    title: res.msg,
                                    level: 'danger',
                                    buttons: {
                                        "确定": {
                                            class: "blue"
                                        }
                                    }
                                })
                            }
                        },
                        error: function (e) {
                            alert(e.statusText);
                        }
                    })
                    return false;
                }
            }
            var html = '<form id="monitor-process-form">';
            html += '<div style="margin: 10px;">';
            html += '<span style="font-size: 15px;">项目名称 *：</span>';
            html += '<input type="text" name="project_name" class="form-control input-inline input-medium" placeholder="例如:studio-v3">';
            html += '</div>';
            html += '<div style="margin: 10px;">';
            html += '<span style="font-size: 15px;">项目路径 *：</span>';
            html += '<input type="text" name="project_path" class="form-control input-inline input-medium" placeholder="例如:/opt/html/studio-v3">';
            html += '</div>';
            html += '<div style="margin: 10px;">';
            html += '<span style="font-size: 15px;">进程名称 *：</span>';
            html += '<input type="text" name="process_name" class="form-control input-inline input-medium" placeholder="例如:问答日志">';
            html += '</div>';
            html += '<div style="margin: 10px;">';
            html += '<span style="font-size: 15px;">进程代码 *：</span>';
            html += '<input type="text" name="process_code" class="form-control input-inline input-medium" placeholder="例如:qaLog">';
            html += '</div>';
            html += '</form>';
            $.jBox(html, options);
        })

        //启用 停用进程
        $(".switch").bootstrapSwitch({
            state: false,
            onText: '启用',
            offText: '停用',
            onInit: function () {
                var $this = $(this);
                var default_config_val = $(this).attr('config-val') && $(this).attr('config-val') == '1' ? true : false;
                setTimeout(function () {
                    $this.bootstrapSwitch('state', default_config_val, true);
                    $this.parents('.checker').removeClass("checker");
                }, 100);
            },
            onSwitchChange: function (e, data) {
                var config_key = $(this).attr('config-key');
                var config_val = data ? 1 : 0;
                $.ajax({
                    url: "{:U('QaMonitor/processStartStop')}",
                    type: 'POST',
                    data: {process_id: config_key, process_status: config_val},
                    dataType: 'JSON',
                    context: this,
                    success: function (res) {
                        console.log(res);
                        if (res.status != 1) {
                            $.confirm({
                                title: res.msg,
                                level: 'danger',
                                buttons: {
                                    "确定": {
                                        class: "blue"
                                    }
                                }
                            })
                            $(this).bootstrapSwitch('toggleState', true);
                        }
                    },
                    error: function (e) {
                        alert(e.statusText);
                        location.reload();
                    }
                })
            }
        });
        //删除进程
        $(".monitor-process-delete").on('click',function () {
            var process_id = $(this).attr('process_id');
            $.ajax({
                url: "{:U('QaMonitor/processDelete')}",
                type: 'GET',
                data: {process_id: process_id},
                dataType: 'json',
                context:this,
                success: function (res) {
                    if (res.status == 1) {
                        $(this).parents('tr').remove();
                    } else {
                        $.confirm({
                            title: res.msg,
                            level: 'danger',
                            buttons: {
                                "确定": {
                                    class: "blue"
                                }
                            }
                        })
                    }
                },
                error: function (e) {
                    alert(e.statusText);
                }
            })
        })
    })
</script>

<include file="Public/footer"/>