<include file="Public/head" />
<include file="Public/top" />
<link rel="stylesheet" href="__JS__/codemirror/codemirror.css">
	<link rel="stylesheet" href="__JS__/codemirror/theme/{:C('codemirror_theme')}.css">
	<style>
		.CodeMirror,#preview_window{
			width:700px;
			height:500px;
		}
		#preview_window.loading{
			background: url('__STATIC__/thinkbox/skin/default/tips_loading.gif') no-repeat center;
		}

		#preview_window textarea{
			display: none;
		}
	</style>
<div class="clearfix">
	<div class="page-container">
		<include file="Public/left" />

		<div class="page-content-wrapper">
			<div class="page-content">
				<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
				<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog"
					tabindex="-1" id="portlet-config" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button aria-hidden="true" data-dismiss="modal" class="close"
									type="button"></button>
								<h4 class="modal-title">Modal title</h4>
							</div>
							<div class="modal-body">Widget settings form goes here</div>
							<div class="modal-footer">
								<button class="btn blue" type="button">Save changes</button>
								<button data-dismiss="modal" class="btn default" type="button">Close</button>
							</div>
						</div>
						<!-- /.modal-content -->
					</div>
					<!-- /.modal-dialog -->
				</div>
				<!-- /.modal -->
				<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
				<!-- BEGIN PAGE HEADER-->
				<!-- BEGIN PAGE HEAD -->
				<div class="page-head">
					<!-- BEGIN PAGE TITLE -->
					<!-- END PAGE TITLE -->
					<!-- BEGIN PAGE TOOLBAR -->
					<!--<div class="page-toolbar">
                     BEGIN THEME PANEL 
                    <div class="btn-group btn-theme-panel">
                        <a data-toggle="dropdown" class="btn dropdown-toggle" href="javascript:;">
                        <i class="icon-settings"></i>
                        </a>
                        <div class="dropdown-menu theme-panel pull-right dropdown-custom hold-on-click">
                            <div class="row">
                                <div class="col-md-4 col-sm-4 col-xs-12">
                                    <h3>THEME</h3>
                                    <ul class="theme-colors">
                                        <li data-theme="default" class="theme-color theme-color-default active">
                                            <span class="theme-color-view"></span>
                                            <span class="theme-color-name">Dark Header</span>
                                        </li>
                                        <li data-theme="light" class="theme-color theme-color-light">
                                            <span class="theme-color-view"></span>
                                            <span class="theme-color-name">Light Header</span>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-8 col-sm-8 col-xs-12 seperator">
                                    <h3>LAYOUT</h3>
                                    <ul class="theme-settings">
                                        <li>
                                             Theme Style
                                            <select class="layout-style-option form-control input-small input-sm">
                                                <option selected="selected" value="square">Square corners</option>
                                                <option value="rounded">Rounded corners</option>
                                            </select>
                                        </li>
                                        <li>
                                             Layout
                                            <select class="layout-option form-control input-small input-sm">
                                                <option selected="selected" value="fluid">Fluid</option>
                                                <option value="boxed">Boxed</option>
                                            </select>
                                        </li>
                                        <li>
                                             Header
                                            <select class="page-header-option form-control input-small input-sm">
                                                <option selected="selected" value="fixed">Fixed</option>
                                                <option value="default">Default</option>
                                            </select>
                                        </li>
                                        <li>
                                             Top Dropdowns
                                            <select class="page-header-top-dropdown-style-option form-control input-small input-sm">
                                                <option value="light">Light</option>
                                                <option selected="selected" value="dark">Dark</option>
                                            </select>
                                        </li>
                                        <li>
                                             Sidebar Mode
                                            <select class="sidebar-option form-control input-small input-sm">
                                                <option value="fixed">Fixed</option>
                                                <option selected="selected" value="default">Default</option>
                                            </select>
                                        </li>
                                        <li>
                                             Sidebar Menu
                                            <select class="sidebar-menu-option form-control input-small input-sm">
                                                <option selected="selected" value="accordion">Accordion</option>
                                                <option value="hover">Hover</option>
                                            </select>
                                        </li>
                                        <li>
                                             Sidebar Position
                                            <select class="sidebar-pos-option form-control input-small input-sm">
                                                <option selected="selected" value="left">Left</option>
                                                <option value="right">Right</option>
                                            </select>
                                        </li>
                                        <li>
                                             Footer
                                            <select class="page-footer-option form-control input-small input-sm">
                                                <option value="fixed">Fixed</option>
                                                <option selected="selected" value="default">Default</option>
                                            </select>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                     END THEME PANEL 
                </div> -->
					<!-- END PAGE TOOLBAR -->
				</div>
				<!-- END PAGE HEAD -->
				<!-- BEGIN PAGE BREADCRUMB -->
				<!-- END PAGE BREADCRUMB -->
				<!-- END PAGE HEADER-->
				<!-- BEGIN PAGE CONTENT-->

				<div class="row">
					<div class="col-md-12">
						<!-- BEGIN EXAMPLE TABLE PORTLET-->
						<div class="portlet box blue">
							<div class="portlet-title">
								<div class="caption">
	                                 <i class="fa fa-edit"></i>插件快速创建
	                            </div>
							</div>
							<div class="portlet-body form">
								<div class="form-body">
									<div class="alert alert-danger display-hide">
										<button data-close="alert" class="close"></button>
										<span></span>
									</div>
								</div>
								<div class="modal-body">
									<div class="row">
										<div class="col-md-12">
											<form id="form" class="form-horizontal" action="{:U('build')}" method="post">
												<div class="form-group">
													<label class="control-label col-md-3">标识名：<span class="required"> * </span></label>
													<div class="col-md-9">
														<input type="text" name="info[name]" value="Example" class="form-control input-inline input-medium"/>
														<span class="help-inline">请输入插件标识</span>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">插件名：</label>
													<div class="col-md-9">
														<input type="text" name="info[title]" value="示列"  class="form-control input-inline input-medium"/>
														<span class="help-inline">请输入插件名</span>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">版本：</label>
													<div class="col-md-9">
														<input type="text" name="info[version]" value="0.1"  class="form-control input-inline input-medium"/>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">作者：</label>
													<div class="col-md-9">
														<input type="text" name="info[author]" value="无名" class="form-control input-inline input-medium "/>
														<span class="help-inline">请输入插件作者</span>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">描述：</label>
													<div class="col-md-9">
														<textarea rows="3" class="form-control input-inline input-medium" name="info[description]">这是一个临时描述</textarea>
														<span class="help-inline">请输入描述</span>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">安装后是否启用：</label>
													<div class="col-md-9" style="padding-top:10px">
														<input type="checkbox" class="form-control input-inline" name="info[status]" value="1" checked />
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">是否需要配置：</label>
													<div class="col-md-9" style="padding-top:10px">
														<input type="checkbox" id="has_config" name="has_config" value="1" />
				
													</div>
												</div>
												
												<div class="form-group">
													<label class="control-label col-md-3"></label>
													<div class="col-md-9 has_config hidden">
														<textarea class="form-control input-inline input-large" name="config" rows="5">
&lt;?php
return array(
	'random'=>array(//配置在表单中的键名 ,这个会是config[random]
		'title'=>'是否开启随机:',//表单的文字
		'type'=>'radio',		 //表单的类型：text、textarea、checkbox、radio、select等
		'options'=>array(		 //select 和radion、checkbox的子选项
			'1'=>'开启',		 //值=>文字
			'0'=>'关闭',
		),
		'value'=>'1',			 //表单的默认值
	),
);
														</textarea><br/><br/>
														<input type="text" class="form-control input-inline input-large has_config hidden" name="custom_config"><br/><br/>
														<span class="check-tips has_config hidden">自定义模板,注意：自定义模板里的表单name必须为config[name]这种，获取保存后配置的值用$data.config.name</span>
													</div>
												</div>
												
												<div class="form-group">
													<label class="control-label col-md-3">是否需要外部访问：</label>
													<div class="col-md-9" style="padding-top:10px">
														<input type="checkbox" id="has_config" name="has_outurl" value="1"  />
				
													</div>
												</div>
												
												<div class="form-group">
													<label class="control-label col-md-3">实现的钩子方法：</label>
													<div class="col-md-9" style="padding-top:10px">
														<select class="form-control input-inline input-large" name="hook[]" size="10" multiple required>
															<volist name="Hooks" id="vo">
																<option value="{$vo.name}" title="{$vo.description}">{$vo.name}</option>
															</volist>
														</select>
				
													</div>
												</div>
												
												<div class="form-group">
													<label class="control-label col-md-3">是否需要后台列表：</label>
													<div class="col-md-9" style="padding-top:10px">
														<input type="checkbox" id="has_adminlist" name="has_adminlist" value="1" />勾选，扩展里已装插件后台列表会出现插件名的列表菜单，如系统的附件
				
													</div>
												</div>
												
												<div class="form-group">
													<label class="control-label col-md-3"></label>
													<div class="col-md-9 has_adminlist hidden">
														<textarea class="form-control input-inline input-large" name="admin_list" rows="5">
'model'=>'Example',		//要查的表
			'fields'=>'*',			//要查的字段
			'map'=>'',				//查询条件, 如果需要可以再插件类的构造方法里动态重置这个属性
			'order'=>'id desc',		//排序,
			'list_grid'=>array( 		//这里定义的是除了id序号外的表格里字段显示的表头名和模型一样支持函数和链接
                'cover_id|preview_pic:封面',
                'title:书名',
                'description:描述',
                'link_id|get_link:外链',
                'update_time|time_format:更新时间',
                'id:操作:[EDIT]|编辑,[DELETE]|删除'
            ),
														</textarea><br/><br/>
														<input type="text" class="form-control input-inline input-large has_adminlist hidden" name="custom_adminlist">
														<br/><br/>
														<span class="check-tips block has_adminlist hidden">自定义模板,注意：自定义模板里的列表变量为$_list这种,遍历后可以用listkey可以控制表头显示,也可以完全手写，分页变量用$_page</span>
													</div>
												</div>
												
												<div class="form-actions">
													<div class="row">
														<div class="col-md-offset-4 col-md-7">
															<input type="button" class="btn default" id="preview" value="预览">
															<!-- <button type="button" onclick="checkform(this.form)" class="btn blue">提交</button> -->
															<button class="btn blue ajax-post_custom submit-btn" target-form="form-horizontal" id="submit">确 定</button>
															<input type="button" class="btn default" onclick="javascript:history.back(-1);return false;" value="返回">
														</div>
													</div>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<script type="text/javascript" src="__JS__/codemirror/codemirror.js"></script>
					<script type="text/javascript" src="__JS__/codemirror/xml.js"></script>
					<script type="text/javascript" src="__JS__/codemirror/javascript.js"></script>
					<script type="text/javascript" src="__JS__/codemirror/clike.js"></script>
					<script type="text/javascript" src="__JS__/codemirror/php.js"></script>
				
					<script type="text/javascript" src="__STATIC__/thinkbox/jquery.thinkbox.js"></script>
					<script type="text/javascript">
					function bindShow(radio_bind, selectors){
						$(radio_bind).click(function(){
							$(selectors).toggleClass('hidden');
						})
					}

					//配置的动态
					bindShow('#has_config','.has_config');
					bindShow('#has_adminlist','.has_adminlist');
					$('#preview').click(function(){
						var preview_url = '{:U("preview")}';
						console.log($('#form').serialize());
						$.post(preview_url, $('#form').serialize(),function(data){
							$.thinkbox('<div id="preview_window" class="loading"><textarea></textarea></div>',{
								afterShow:function(){
									var codemirror_option = {
										lineNumbers   :true,
										matchBrackets :true,
										mode          :"application/x-httpd-php",
										indentUnit    :4,
										gutter        :true,
										fixedGutter   :true,
										indentWithTabs:true,
										readOnly	  :true,
										lineWrapping  :true,
										height		  :300,
										enterMode     :"keep",
										tabMode       :"shift",
										theme: "{:C('CODEMIRROR_THEME')}"
									};
									var preview_window = $("#preview_window").removeClass(".loading").find("textarea");
									var editor = CodeMirror.fromTextArea(preview_window[0], codemirror_option);
									editor.setValue(data);
									$(window).resize();
								},

								title:'预览插件主文件',
								unload: true,
								actions:['close'],
								drag:true
							});
						});
						return false;
					});
					
					$('.ajax-post_custom').click(function(){
				        var target,query,form;
				        var target_form = $(this).attr('target-form');
				        var check_url = '{:U('checkForm')}';
						$.ajax({
						   type: "POST",
						   url: check_url,
						   dataType: 'json',
						   async: false,
						   data: $('#form').serialize(),
						   success: function(data){
						    	if(data.status){
			    			        if( ($(this).attr('type')=='submit') || (target = $(this).attr('href')) || (target = $(this).attr('url')) ){
							            form = $('.'+target_form);
							            if ( form.get(0).nodeName=='FORM' ){
							                target = form.get(0).action;
							                query = form.serialize();
							            }else if( form.get(0).nodeName=='INPUT' || form.get(0).nodeName=='SELECT' || form.get(0).nodeName=='TEXTAREA') {
							                query = form.serialize();
							            }else{
							                query = form.find('input,select,textarea').serialize();
							            }
							            $.post(target,query).success(function(data){
							                if (data.status==1) {
							                    if (data.url) {
							                        $.confirm({title:data.info,modal: true, level:"success",buttons: {  
														   "确定": {
															   "class":"blue",
															   "action":function() {
																   location.replace(location.href);
															   }
														   }
													   }  
													});
							                    }else{
							                        $.confirm({title:data.info,modal: true, level:"success",buttons: {  
														   "确定": {
															   "class":"blue",
															   "action":function() {
																   location.replace(location.href);
															   }
														   }
													   }  
													});
							                    }
							                    setTimeout(function(){
							                        if (data.url) {
							                            location.href=data.url;
							                        }else{
							                        	location.reload();
							                        }
							                    },1500);
							                }else{
							                    //updateAlert(data.info);
							                    $.confirm({title:data.info,modal: true, level:"success",buttons: {  
													   "确定": {
														   "class":"blue",
														   "action":function() {
															   location.replace(location.href);
														   }
													   }
												   }  
												});
							                }
							            });
							        }
						    	}else{
						    		$.confirm({title:data.info,modal: true, level:"success",buttons: {  
										   "确定": {
											   "class":"blue",
											   "action":function() {
												   location.replace(location.href);
											   }
										   }
									   }  
									});
								}
						   }
						});

				        return false;
				    });
						function checkform(form) {
							if (form.username.value == '') {
								$(".display-hide > span").html("请输入昵称");
								$(".display-hide").show();
								form.username.focus();
								return false;
							}
							if (form.password.value == '') {
								$(".display-hide > span").html("请输入密码");
								$(".display-hide").show();
								form.password.focus();
								return false;
							}
							if (form.password.value != form.repassword.value) {
								$(".display-hide > span").html("您输入的新密码与确认密码不一致");
								$(".display-hide").show();
								form.password.focus();
								return false;
							}
							if (form.email.value == '') {
								$(".display-hide > span").html("请输入邮箱");
								$(".display-hide").show();
								form.email.focus();
								return false;
							}

							
							$(".display-hide").hide();
					        var data=$("#form").serialize();
							$.ajax({
					            url:"{:U('build')}",
					            data:data,
					            type:"POST",
					            dataType:"json",
					            success:function(msg){
					            	
					                if(msg.status == 1){
					                    var msg = msg.info;
					                    $.confirm({title:msg,modal: true, level:"success",buttons: {  
					                           "确定": {
					                               "class":"blue",
					                               "action":function() {
					                            	   //location.reload();
					                            	   location.href = '__ROOT__/admin/Addons/index';
					                               }
					                           }
					                       }  
					                    });
					                }else{
					                    var msg=msg.info+",请重新提交";
					                    $.confirm({title:msg,modal: true, level:"danger",buttons: {  
					                           "确定": {
					                               "class":"blue",
					                               "action":function() {
					                               }
					                           }
					                       }  
					                    });
					                }
					            }
					        });
							return false;
							
						}

					</script>

				</div>
			</div>
			<!-- END EXAMPLE TABLE PORTLET-->
		</div>
	</div>

	<!-- END PAGE CONTENT-->
</div>



<include file="Public/footer" />