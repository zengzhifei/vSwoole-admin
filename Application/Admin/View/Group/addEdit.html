<include file="Public/head"/>
<include file="Public/top"/>
<div class="clearfix">
    <div class="page-container">
        <include file="Public/left"/>

        <div class="page-content-wrapper">
            <!--图片上传需要引入的js-->
            <script type="text/javascript" src="__PUBLIC__/static/uploadify/jquery.uploadify.min.js"></script>


            <script src="__PUBLIC__/Home/interact/js/jquery.form.js" type="text/javascript"></script>
            <!-- BEGIN CONTAINER -->
            <!-- <div class="page-container"> -->
            <!-- <div class="page-content-wrapper"> -->
            <div class="page-content">
                <!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
                <div class="modal fade" id="portlet-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                <h4 class="modal-title">Modal title</h4>
                            </div>
                            <div class="modal-body">
                                Widget settings form goes here
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn blue">Save changes</button>
                                <button type="button" class="btn default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <!-- BEGIN VALIDATION STATES-->
                        <div class="portlet box blue">
                            <div class="portlet-title">
                                <div class="caption">
                                    <i class="fa fa-gift"></i>{$data['pageTitle']}
                                </div>
                                <div class="tools">
                                    <button class="btn btn-default" id="group-goBack" type="button">返回</button>
                                </div>
                            </div>
                            <div class="portlet-body form">
                                <!-- BEGIN FORM-->
                                <div class="alert alert-danger display-hide">
                                    <button data-close="alert" class="close"></button>
                                    <span></span>
                                </div>
                                <form id="form_sample_1" class="form-horizontal">
                                    <div class="form-body">
                                        <div class="form-group">
                                            <label class="col-md-3 control-label">分组类型<span class="required"> * </span></label>
                                            <div class="col-md-9">
                                                <select class="form-control input-inline input-small" name="group-select-type">
                                                    <option value="1" <if condition="$data['pageInfo']['group_type'] eq '1'">selected</if> >问答环节</option>
                                                    <option value="2" <if condition="$data['pageInfo']['group_type'] eq '2'">selected</if> >抢答环节</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-3">分组名称<span class="required"> * </span></label>
                                            <div class="col-md-9">
                                                <input type="text" name="group-title" value="{$data['pageInfo']['group_title']}" class="form-control input-inline input-medium" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-3">分组时区<span class="required"> &nbsp; </span></label>
                                            <div class="col-md-9">
                                                <input type="text" name="dateRangePicker" value="{$data['pageInfo']['group_time']}" class="form-control input-inline input-large"  placeholder="分组时间区间"  readonly />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-md-3">备注<span class="required"> &nbsp; </span></label>
                                            <div class="col-md-9">
                                                <textarea name="group-remark" class="form-control input-inline input-medium" rows="3">{$data['pageInfo']['group_remark']}</textarea>
                                            </div>
                                        </div>
                                        <notempty name="data.pageInfo">
                                            <input type="hidden" name="group-id" value="{$data['pageInfo']['id']}" />
                                            <input type="hidden" name="group-created" value="{$data['pageInfo']['group_created']}" />
                                        </notempty>
                                    </div>
                                    <div class="form-actions">
                                        <div class="row">
                                            <div class="col-md-offset-4  col-md-7">
                                                <button type="button" class="btn blue" id="group-submit">提交</button>
                                                <button type="reset" class="btn default">重置</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <!-- END FORM-->
                            </div>
                        </div>
                        <!-- END VALIDATION STATES-->
                    </div>
                </div>
                <!-- END PAGE CONTENT-->

                <!-- 创建浮层的html start -->
                <!-- javascript生成弹窗HTML -->
                <!-- 创建浮层的html end -->
            </div>
        </div>
    </div>
</div>
<!-- </div> -->
<!-- END CONTENT -->
<!-- </div> -->
<!-- END CONTAINER -->
<!-- BEGIN FOOTER -->
<script type="text/javascript"
        src="__PUBLIC__/Home/static/theme/assets/global/plugins/jquery-validation/js/jquery.validate.min.js"></script>
<!-- END PAGE LEVEL STYLES -->
<script>
    $(function () {
        //返回
        $("#group-goBack").on('click',function () {
            window.location.href = document.referrer;
        })
        //提交
        $("#group-submit").on('click',function () {
            var data = {
                stage_id: "{$data['pageParam']['stage_id']}",
                group_id: $("input[name='group-id']").val(),
                group_type: $("select[name='group-select-type']").val(),
                group_type_name: $("select[name='group-select-type'] option:selected").text(),
                group_title: $("input[name='group-title']").val(),
                group_time: $("input[name='dateRangePicker']").val(),
                group_created: $("input[name='group-created']").val(),
                group_remark: $("textarea[name='group-remark']").val()
            }

            if (data.group_title.replace(/\s+/g, "").length === 0) {
                $(".display-hide").show().find('span').html('请输入有效分组名称');
                $("input[name='stage-name']").focus();
                return false;
            }

            $(".display-hide").hide();

            $.ajax({
                url: "{:U('Group/saveGroup')}",
                type: 'POST',
                dataType: 'JSON',
                data: data,
                context: this,
                timeout: 20000,
                beforeSend: function () {
                    $(this).attr('disabled', true).text('保存中...');
                },
                complete: function () {
                    $(this).attr('disabled', false).text('保存');
                },
                success: function (msg) {
                    console.log(msg);
                    if (msg.status == 1) {
                        $.confirm({
                            title: '保存成功',
                            level: 'success',
                            buttons: {
                                "确定": {
                                    class:"blue",
                                    action:function() {
                                        $("#group-goBack").click();
                                    }
                                }
                            }
                        })
                    } else if (msg.status == -2) {
                        $.confirm({
                            title: '当前没有开启的期，请先开启一期，再添加分组',
                            level: 'warning',
                            buttons: {
                                "确定": {
                                    class:"blue",
                                    action:function() {
                                        window.location.href = "{:U('Column/index')}";
                                    }
                                }
                            }
                        })
                    } else {
                        $.confirm({
                            title: '表单填写数据格式有误',
                            level: 'warning',
                            buttons: {
                                "确定": {
                                    class:"blue"
                                }
                            }
                        })
                    }
                },
                error: function () {
                    $.confirm({
                        title: '保存失败!请刷新后重新提交',
                        level: 'danger',
                        buttons: {
                            "确定": {
                                class:"blue"
                            }
                        }
                    })
                }
            })
        })
    })
</script>


<include file="Public/footer"/>
