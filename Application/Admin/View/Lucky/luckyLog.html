<include file="Public/head" />
<include file="Public/top" />
<div class="clearfix">
    <div class="page-container">
    <include file="Public/left" />
    
        <div class="page-content-wrapper">
        <div class="page-content">
            <!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="portlet-config" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
                            <h4 class="modal-title">Modal title</h4>
                        </div>
                        <div class="modal-body">
                             Widget settings form goes here
                        </div>
                        <div class="modal-footer">
                            <button class="btn blue" type="button">Save changes</button>
                            <button data-dismiss="modal" class="btn default" type="button">Close</button>
                        </div>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
            <!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
            <!-- BEGIN PAGE HEADER-->
            <!-- BEGIN PAGE HEAD -->
            <div class="page-head">
                
            </div>

<div class="row">
                
                <div class="col-md-6" style="width:100%;">
                    <div class="portlet box blue">
                        <div class="portlet-title">
                            <div class="caption">
                                <i class="fa fa-gift"></i>中奖情况
                            </div>
                            <div class="tools">
                                <button class="btn btn-default" onclick="goback()" type="button">返回</button>
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div class="tabbable-line">
                            <button class="btn btn-default" style="margin:10px;" onclick='javascript:location.href="{:U('Lucky/exportLucky',array('lucky_id'=>$luck_id))}"' type="button">导出数据</button>
                            
                                <ul class="nav nav-tabs ">
                                    <li class="">
                                        <a onclick="addurl(1)" data-toggle="tab" href="javascript:;" aria-expanded="false">
                                        新增抽奖活动 </a>
                                    </li>
                                    <li class="">
                                    
                                        <a onclick="addurl2(1)" data-toggle="tab" href="javascript:;" aria-expanded="false">
                                        参与情况 </a>
                                    </li>
                                    <li class="active">
                                        <a onclick="addurl3(1)" data-toggle="tab" href="javascript:;" aria-expanded="ture">
                                        中奖情况 </a>
                                    </li>
                                    <li class="">
                                        <a onclick="addurl4(1)" data-toggle="tab" href="javascript:;" aria-expanded="false">
                                        奖品列表 </a>
                                    </li>
                                    <li class="">
                                        <a onclick="addurl5(1)" data-toggle="tab" href="javascript:;" aria-expanded="false">
                                        数据统计 </a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div id="tab_15_1" class="tab-pane active">
                                        
                                        <table class="table table-striped table-hover table-bordered" id="sample_editable_1">
                        <thead>
                        <tr>
                            <th>中奖者头像</th>
                            <th>中奖者昵称</th>
                            <th>openid</th>
                            <th>奖项
                                <!--<select class="form-control input-inline" name="type" id="type" vname="{$luck_id}">
	                                <option value='0'>全部</option>
	                                <foreach name="select_tab" item="vo">
	                                <option value='{$vo.id}'>{$vo.title}-{$vo.name}</option>
	                                </foreach>
	                            </select>
	                        --></th>
                            <th>中奖码</th>
                            <!-- 
                            <th>真实姓名</th>
                            <th>联系电话</th>
                             -->
                            <th>是否发奖</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <foreach name="list" item="lo">
                        <tr>
                            <td>{$lo.uheadimg}</td>
                            <td>{$lo.uname}</td>
                            <td>{$lo.uid}</td>
                            <td>{$lo.name}</td>
                            <td>{$lo.prize_code}</td>
                            <!-- 
                            <td></td>
                            <td></td> -->
                            <td><if condition="$lo.award_flag eq 0">未发<else/>已发</if></td>
                            <td>
                                <if condition="$lo.award_flag eq 0"><a href="javascript:void(0);" val="{$lo.award_flag}" vname="{$luck_id}" rel="{$lo.id}" onclick="awardprize(this)" ><i title="发奖" class="icon-badge"></i></a>
                                <else/>
                                <div class="icon-badge" title="已发奖"></div>
                                </if>
                                <if condition="$lo.award_flag eq 0"><a href="javascript:void(0);" onclick="deleteluckywinner(this)" rel="{$lo.uid}"><i title="删除" class="glyphicon glyphicon-trash delete"></i></a></if>
                            </td>
                        </tr>
                        </foreach>
                        </tbody>
                    </table>
                    <div class="row">
                            <div class="col-md-5 col-sm-12">
                               <div class="dataTables_info" id="sample_editable_1_info" role="status" aria-live="polite">当前是第 {$p} 页  总页数 {$totalpage}</div>
                            </div>
                            <div class="col-md-7 col-sm-12">
                            <div class="dataTables_paginate paging_simple_numbers" id="sample_editable_1_paginate">
                            {$page}
                            </div>
                        </div>
                    </div>
                                        
                                        
                                        
                                        
                                    </div>
                                </div>
                            </div>
                </div>
    </div>
    </div>
            </div>
            
            
            
                    </div>
        </div>
        </div>
        </div>
        
        <script>
        function addurl(type){
            if(type == 1){
                var url = "{:U('Lucky/modify')}";
            }
            location.href=url;
        }
        function addurl2(type){
            if(type == 1){
                var url = "{:U('Lucky/userList',array('lucky_id'=>$luck_id))}";
            }
            location.href=url;
        }
        function addurl3(type){
            if(type == 1){
                var url = "{:U('Lucky/luckyLog',array('lucky_id'=>$luck_id))}";
            }
            location.href=url;
        }
        function addurl4(type){
            if(type == 1){
                var url = "{:U('Lucky/luckyPrize',array('lucky_id'=>$luck_id))}";
            }
            location.href=url;
        }
        function addurl5(type){
            if(type == 1){
                var url = "{:U('Lucky/statisticsprize',array('lucky_id'=>$luck_id))}";
            }
            location.href=url;
        }
        function goback(){
            location.href = "{:U('Lucky/index')}";
        }
function deleteluckywinner(obj){
    var uid = $(obj).attr('rel');
        $.confirm({  
           title:"确定要删除该中奖用户？",
           modal: true,  
           level:"warning",
           buttons: {  
               "确定": {
                   "class":"blue",
                   "action":function() {
                       $.ajax({
                            url:"{:U('Lucky/deleteLuckyWinner')}",
                            type:'post',
                            data:{uid:uid},
                            dataType:'json',
                            success:function(msg){
                                if(msg.status==1){
                                    $(obj).parent().parent().remove();
                                    location.reload();
                                }
                            }
                    });
                   }
               },
               "取消": {
                   "class":"blue",
                   "action":function() {}
               }
           }  
        });
}
function awardprize(obj){
    //var uid = $(obj).attr('rel');
    var id = $(obj).attr('rel');
    //var award_flag = $(obj).attr('val');
    //var luck_id = $(obj).attr('vname');
        $.confirm({  
           title:"确定要对该中奖用户派奖？",
           modal: true,  
           level:"warning",
           buttons: {  
               "确定": {
                   "class":"blue",
                   "action":function() {
                       $.ajax({
                            url:"{:U('Lucky/awardPrize')}",
                            type:'post',
                            //data:{uid:uid,award_flag:1,luck_id:luck_id},
                            data:{id:id,award_flag:1},
                            dataType:'json',
                            success:function(msg){
                                if(msg.status==1){
                                    //$(obj).parent().parent().remove();
                                    location.reload();
                                }
                            }
                    });
                   }
               },
               "取消": {
                   "class":"blue",
                   "action":function() {}
               }
           }  
        });
}
$("#type").click(function(){
	var id = $(this).val();
	var luck_id = $(this).attr('vname');
	$.ajax({
        url:"{:addons_url('Lucky://Log/index')}",
        type:'post',
        data:{id:id,luck_id:luck_id},
        dataType:'json',
        success:function(msg){
            if(msg.status==1){
                //$(obj).parent().parent().remove();
                location.reload();
            }
        }
    });

});
</script>
<include file="Public/footer" />