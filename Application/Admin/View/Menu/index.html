
<include file="Public/head" />
<include file="Public/top" />
<script src="__PUBLIC__/Home/interact/js/jquery.form.js" type="text/javascript"></script>
<div class="clearfix">
	<div class="page-container">
	<include file="Public/left" />
	
	    <div class="page-content-wrapper">
		<div class="page-content">
			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="portlet-config" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
							<h4 class="modal-title">Modal title</h4>
						</div>
						<div class="modal-body">
							 Widget settings form goes here
						</div>
						<div class="modal-footer">
							<button class="btn blue" type="button">Save changes</button>
							<button data-dismiss="modal" class="btn default" type="button">Close</button>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			<!-- /.modal -->
			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- BEGIN PAGE HEADER-->
			<!-- BEGIN PAGE HEAD -->
			<div class="page-head">
				<!-- BEGIN PAGE TITLE -->
				<!-- END PAGE TITLE -->
				<!-- BEGIN PAGE TOOLBAR -->
				<!--<div class="page-toolbar">
					 BEGIN THEME PANEL 
					<div class="btn-group btn-theme-panel">
						<a data-toggle="dropdown" class="btn dropdown-toggle" href="javascript:;">
						<i class="icon-settings"></i>
						</a>
						<div class="dropdown-menu theme-panel pull-right dropdown-custom hold-on-click">
							<div class="row">
								<div class="col-md-4 col-sm-4 col-xs-12">
									<h3>THEME</h3>
									<ul class="theme-colors">
										<li data-theme="default" class="theme-color theme-color-default active">
											<span class="theme-color-view"></span>
											<span class="theme-color-name">Dark Header</span>
										</li>
										<li data-theme="light" class="theme-color theme-color-light">
											<span class="theme-color-view"></span>
											<span class="theme-color-name">Light Header</span>
										</li>
									</ul>
								</div>
								<div class="col-md-8 col-sm-8 col-xs-12 seperator">
									<h3>LAYOUT</h3>
									<ul class="theme-settings">
										<li>
											 Theme Style
											<select class="layout-style-option form-control input-small input-sm">
												<option selected="selected" value="square">Square corners</option>
												<option value="rounded">Rounded corners</option>
											</select>
										</li>
										<li>
											 Layout
											<select class="layout-option form-control input-small input-sm">
												<option selected="selected" value="fluid">Fluid</option>
												<option value="boxed">Boxed</option>
											</select>
										</li>
										<li>
											 Header
											<select class="page-header-option form-control input-small input-sm">
												<option selected="selected" value="fixed">Fixed</option>
												<option value="default">Default</option>
											</select>
										</li>
										<li>
											 Top Dropdowns
											<select class="page-header-top-dropdown-style-option form-control input-small input-sm">
												<option value="light">Light</option>
												<option selected="selected" value="dark">Dark</option>
											</select>
										</li>
										<li>
											 Sidebar Mode
											<select class="sidebar-option form-control input-small input-sm">
												<option value="fixed">Fixed</option>
												<option selected="selected" value="default">Default</option>
											</select>
										</li>
										<li>
											 Sidebar Menu
											<select class="sidebar-menu-option form-control input-small input-sm">
												<option selected="selected" value="accordion">Accordion</option>
												<option value="hover">Hover</option>
											</select>
										</li>
										<li>
											 Sidebar Position
											<select class="sidebar-pos-option form-control input-small input-sm">
												<option selected="selected" value="left">Left</option>
												<option value="right">Right</option>
											</select>
										</li>
										<li>
											 Footer
											<select class="page-footer-option form-control input-small input-sm">
												<option value="fixed">Fixed</option>
												<option selected="selected" value="default">Default</option>
											</select>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
					 END THEME PANEL 
				</div> -->
				<!-- END PAGE TOOLBAR -->
			</div>
			<!-- END PAGE HEAD -->
			<!-- BEGIN PAGE BREADCRUMB -->
			<!-- <ul class="page-breadcrumb breadcrumb">
				<li>
					<a href="#">投票</a>
					<i class="fa fa-circle"></i>
				</li>
			</ul> -->
			<!-- END PAGE BREADCRUMB -->
			<!-- END PAGE HEADER-->
			<!-- BEGIN PAGE CONTENT-->
			<div class="row">
            	<div class="col-md-12">
                <div class="portlet box">
                	<!-- <div class="portlet-title">
                    </div> -->
                	<div class="portlet-body form">

								<form role="form" class="form-horizontal search-form">
								<div class="form-body">
									<div class="form-group">
										<label class="col-md-1 control-label">关键字：</label>
										<div class="col-md-2" style="margin-right:70px;">
											<input type="text" placeholder="请输入菜单名称" name="title" class="form-control input-medium search-input" value="{:I('title')}">
										</div>
                                       
										<div class="col-md-2">
											<button class="btn blue" type="button" url="__SELF__" id="search">查询</button>
										</div>
									</div>
								</div>
							</form>

						</div>
                </div>
            </div>
			</div>
            <div class="row">
				<div class="col-md-12">
					<!-- BEGIN EXAMPLE TABLE PORTLET-->
					<div class="portlet box blue">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-edit"></i><present name="data">[ {$data.title} ] 子</present>菜单管理
							</div>
							<!-- <div class="tools">
								
							</div> -->
						</div>
						<style>
							.table-bordered th{text-align:center}
						</style>
						<div class="portlet-body">
            			    <button style="margin-bottom:5px;" class="btn blue" onclick="addurl(this)" url="{:U('add',array('pid'=>I('get.pid',0)))}">新 增</button>
            			    <button style="margin-bottom:5px;" class="btn blue" onclick="batchDelete(this)" url="{:U('del')}">删 除</button>
				            <!-- <button style="margin-bottom:5px;" class="btn blue" onclick="changeStatus(this)" url="{:U('import',array('pid'=>I('get.pid',0)))}">导 入</button> -->
				            <button style="margin-bottom:5px;" class="btn blue" onclick="sortList(this)" url="{:U('setSort')}">排序</button>
				            
							<form action="{:U('setSort')}" method="post" id="sortForm">
							<table class="table table-striped table-hover table-bordered" id="sample_editable_1">
							<thead>
							<tr>
								<th><input type="checkbox" id="checkAll"></th>
								<th>排序</th>
								<th>ID</th>
		                        <th>名称</th>
		                        <th>上级菜单</th>
		                        <th>分组</th>
		                        <th>URL</th>
		                        <th>仅开发者模式显示</th>
		                        <th>隐藏</th>
		                        <th>操作</th>
							</tr>
							</thead>
							<tbody>
							<notempty name="list">
			                <volist name="list" id="menu">
			                    <tr>
			                        <td><input type="checkbox" name="checkList" value="{$menu.id}"></td>
			                        <td><input type="text" size="4" style="text-align:center;" placeholder="排序" name="sort[{$menu.id}]" value="{$menu.sort}"></td>
			                        <td>{$menu.id}</td>
			                        <td>
			                            <a href="{:U('index?pid='.$menu['id'])}">{$menu.title}</a>
			                        </td>
			                        <td>{$menu.up_title|default='无'}</td>
			                        <td>{$menu.group}</td>
			                        <td>{$menu.url}</td>
			                        <td>
			                            <a href="javascript:void(0);" onclick="isShow(this)" rel="{:U('toogleDev',array('id'=>$menu['id'],'value'=>abs($menu['is_dev']-1)))}">
			                            {$menu.is_dev_text}
			                            </a>
			                        </td>
			                        <td>
			                            <a href="javascript:void(0);" onclick="isShow(this)" rel="{:U('toogleHide',array('id'=>$menu['id'],'value'=>abs($menu['hide']-1)))}">
			                            {$menu.hide_text}
			                            </a>
			                        </td>
			                        <td>
			                            <a title="编辑" href="{:U('edit?id='.$menu['id'])}">编辑</a>
			                            <a href="javascript:void(0);" onclick="deleteMenu(this)" rel="{$menu['id']}">删除</a>
			                        </td>
			                    </tr>
			                </volist>
							<else/>
							<td colspan="10" class="text-center"> aOh! 暂时还没有内容! </td>
							</notempty>
							</tbody>
							</table>
							</form>
							<!--  
							<div class="row">
							
								<div class="col-md-5 col-sm-12">
									<div class="dataTables_info" id="sample_editable_1_info" role="status" aria-live="polite">
									    当前是第 {$p} 页  总页数 {$totalpage}
									</div>
								</div>
								<div class="col-md-7 col-sm-12">
									<div class="dataTables_paginate paging_simple_numbers" id="sample_editable_1_paginate">
										  {$page}
									 </div>
								</div>
							</div>
                             -->
                           
						</div>
					</div>
					<!-- END EXAMPLE TABLE PORTLET-->
				</div>
			</div>
            
			<!-- END PAGE CONTENT-->
		</div>
		</div>
		</div>
		</div>
		<!-- 
		<script type="text/javascript" src="__STATIC__/think.js"></script>-->

         
		<script src="__STATIC__/thinkbox/jquery.thinkbox.js"></script>
	
		<script type="text/javascript">
		$(function() {
            //搜索功能
            $("#search").click(function() {
                var url = $(this).attr('url');
                var query = $('.search-form').find('input').serialize();
                query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g, '');
                query = query.replace(/^&/g, '');
                url += '&' + query;
                window.location.href = url;
            });
            //回车搜索
            $(".search-input").keyup(function(e) {
                if (e.keyCode === 13) {
                    $("#search").click();
                    //searchIt();
                    return false;
                }
            });
		});
		function searchIt(){
			var url = $(this).attr('url');
            var query = $('.search-form').find('input').serialize();
            query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g, '');
            query = query.replace(/^&/g, '');
            if (url.indexOf('?') > 0) {
                url += '&' + query;
            } else {
                url += '?' + query;
            }
            window.location.href = url;
		}
		function addurl(obj){
			var url = $(obj).attr('url');
			location.href=url;
		}

		function isShow(obj){
			var url = $(obj).attr('rel');
			$.ajax({
				url:url,
				type:'get',
				data:'',
				dataType:'json',
				success:function(msg){
					if(msg.status==1){
						location.replace(location.href);
					}
				}
			});
			
		}
		//排序
		function sortList(obj){
			var url = $(obj).attr('url');
			var info = $("#sortForm").serialize();
			$.ajax({
				url:url,
				type:'post',
				data:info,
				dataType:'json',
				success:function(msg){
					if(msg.status==1){
						location.replace(location.href);
					}
				}
			});
			
		}
		//删除
		function deleteMenu(obj){
				var id = $(obj).attr('rel');
					$.confirm({  
					   title:"确定要删除这条数据？",
					   modal: true,  
					   level:"warning",
					   buttons: {  
						   "确定": {
							   "class":"blue",
							   "action":function() {
								   $.ajax({
										url:"{:U('del')}",
										type:'post',
										data:{id:id},
										dataType:'json',
										success:function(msg){
											if(msg.status==1){
												$(obj).parent().parent().remove();
												location.replace(location.href);
											}
										}
								});
							   }
						   },
						   "取消": {
							   "class":"default",
							   "action":function() {}
						   }
					   }  
					});
		}
		//批量删除
		function batchDelete(obj){
			var idstr = getCheckBoxValue();
			var url = $(obj).attr('url');
			if(idstr==''){
				$.confirm({title:"你还没有选择删除的数据，请选择后删除",modal: true,level:"warning",buttons: {  
					   "确定": {"class":"blue","action":function() {}}
				   }  
				});
			}else{
				$.confirm({  
					   title:"确定要删除选中的数据？",
					   modal: true,  
					   level:"warning",
					   buttons: {  
						   "确定": {
							   "class":"blue",
							   "action":function() {
								   $.ajax({
										url:url,
										type:'post',
										data:{id:idstr},
										dataType:'json',
										success:function(msg){
											if(msg.status==1){
												location.replace(location.href);
											}
										}
								});
							   }
						   },
						   "取消": {
							   "class":"default",
							   "action":function() {}
						   }
					   }  
					});
			}
		}
		</script>

<include file="Public/footer" />