<include file="Public/head" xmlns="http://www.w3.org/1999/html"/>
<include file="Public/top" />
<div class="clearfix">
	<div class="page-container">
		<include file="Public/left" />

		<div class="page-content-wrapper">
			<div class="page-content">
				<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
				<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog"
					tabindex="-1" id="portlet-config" class="modal fade">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button aria-hidden="true" data-dismiss="modal" class="close"
									type="button"></button>
								<h4 class="modal-title">Modal title</h4>
							</div>
							<div class="modal-body">Widget settings form goes here</div>
							<div class="modal-footer">
								<button class="btn blue" type="button">Save changes</button>
								<button data-dismiss="modal" class="btn default" type="button">Close</button>
							</div>
						</div>
						<!-- /.modal-content -->
					</div>
					<!-- /.modal-dialog -->
				</div>
				<!-- /.modal -->
				<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
				<!-- BEGIN PAGE HEADER-->
				<!-- BEGIN PAGE HEAD -->
				<div class="page-head">
					<!-- BEGIN PAGE TITLE -->
					<!-- END PAGE TITLE -->
					<!-- BEGIN PAGE TOOLBAR -->
					<!--<div class="page-toolbar">
                     BEGIN THEME PANEL 
                    <div class="btn-group btn-theme-panel">
                        <a data-toggle="dropdown" class="btn dropdown-toggle" href="javascript:;">
                        <i class="icon-settings"></i>
                        </a>
                        <div class="dropdown-menu theme-panel pull-right dropdown-custom hold-on-click">
                            <div class="row">
                                <div class="col-md-4 col-sm-4 col-xs-12">
                                    <h3>THEME</h3>
                                    <ul class="theme-colors">
                                        <li data-theme="default" class="theme-color theme-color-default active">
                                            <span class="theme-color-view"></span>
                                            <span class="theme-color-name">Dark Header</span>
                                        </li>
                                        <li data-theme="light" class="theme-color theme-color-light">
                                            <span class="theme-color-view"></span>
                                            <span class="theme-color-name">Light Header</span>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-8 col-sm-8 col-xs-12 seperator">
                                    <h3>LAYOUT</h3>
                                    <ul class="theme-settings">
                                        <li>
                                             Theme Style
                                            <select class="layout-style-option form-control input-small input-sm">
                                                <option selected="selected" value="square">Square corners</option>
                                                <option value="rounded">Rounded corners</option>
                                            </select>
                                        </li>
                                        <li>
                                             Layout
                                            <select class="layout-option form-control input-small input-sm">
                                                <option selected="selected" value="fluid">Fluid</option>
                                                <option value="boxed">Boxed</option>
                                            </select>
                                        </li>
                                        <li>
                                             Header
                                            <select class="page-header-option form-control input-small input-sm">
                                                <option selected="selected" value="fixed">Fixed</option>
                                                <option value="default">Default</option>
                                            </select>
                                        </li>
                                        <li>
                                             Top Dropdowns
                                            <select class="page-header-top-dropdown-style-option form-control input-small input-sm">
                                                <option value="light">Light</option>
                                                <option selected="selected" value="dark">Dark</option>
                                            </select>
                                        </li>
                                        <li>
                                             Sidebar Mode
                                            <select class="sidebar-option form-control input-small input-sm">
                                                <option value="fixed">Fixed</option>
                                                <option selected="selected" value="default">Default</option>
                                            </select>
                                        </li>
                                        <li>
                                             Sidebar Menu
                                            <select class="sidebar-menu-option form-control input-small input-sm">
                                                <option selected="selected" value="accordion">Accordion</option>
                                                <option value="hover">Hover</option>
                                            </select>
                                        </li>
                                        <li>
                                             Sidebar Position
                                            <select class="sidebar-pos-option form-control input-small input-sm">
                                                <option selected="selected" value="left">Left</option>
                                                <option value="right">Right</option>
                                            </select>
                                        </li>
                                        <li>
                                             Footer
                                            <select class="page-footer-option form-control input-small input-sm">
                                                <option value="fixed">Fixed</option>
                                                <option selected="selected" value="default">Default</option>
                                            </select>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                     END THEME PANEL 
                </div> -->
					<!-- END PAGE TOOLBAR -->
				</div>
				<!-- END PAGE HEAD -->
				<!-- BEGIN PAGE BREADCRUMB -->
				<!-- END PAGE BREADCRUMB -->
				<!-- END PAGE HEADER-->
				<!-- BEGIN PAGE CONTENT-->

				<div class="row">
					<div class="col-md-12">
						<!-- BEGIN EXAMPLE TABLE PORTLET-->
						<div class="portlet box blue">
							<div class="portlet-title">
								<div class="caption">
	                                 <i class="fa fa-edit"></i>{$title}
	                            </div>
							</div>
							<div class="portlet-body form">
								<div class="form-body">
									<div class="alert alert-danger display-hide">
										<button data-close="alert" class="close"></button>
										<span></span>
									</div>
								</div>
								<div class="modal-body">
									<div class="row">
										<div class="col-md-12">
											<form id="sortform" class="form-horizontal">
												<div class="form-group">
													<label class="control-label col-md-3">模块名称<span class="required"> * </span></label>
													<div class="col-md-9">
														<input type="text" name="module-name" value="{$module.module_name}" maxlength="10" class="form-control input-inline input-medium"/>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">模块代码<span class="required"> * </span></label>
													<div class="col-md-9">
														<input type="text" name="module-code" value="{$module.module_code}" maxlength="10" class="form-control input-inline input-medium" placeholder="模块数据表名(不含前缀)"/>
													</div>
												</div>
												<notempty name="module">
													<input type="hidden" name="module-id" value="{$module.id}" />
												</notempty>
												<div class="form-actions">
													<div class="row">
														<div class="col-md-offset-4 col-md-7">
															<button type="button" class="btn blue" id="save-form">保存</button>
															<button type="button" class="btn default go-back">返回</button>
														</div>
													</div>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<script type="text/javascript">
						$(function () {
                            //保存
                            $("#save-form").on('click',function () {
                                var data = {
                                    module_id: $("input[name='module-id']").val(),
                                    module_name : $("input[name='module-name']").val(),
                                    module_code : $("input[name='module-code']").val(),
								}

								if (data.module_name.replace(/\s+/g, "").length === 0) {
                                    $(".display-hide").show().find('span').html('请输入有效模块名称');
                                    $("input[name='module-name']").focus();
                                    return false;
                                }
                                if (!(/^\w+$/.test(data.module_code))) {
                                    $(".display-hide").show().find('span').html('请输入有效模块代码');
                                    $("input[name='module-code']").focus();
                                    return false;
                                }
                                $(".display-hide").hide();

                                $.ajax({
                                    url: "{:U('Module/saveModule')}",
                                    type: 'POST',
                                    dataType: 'JSON',
                                    data: data,
                                    context: this,
                                    timeout: 20000,
                                    beforeSend: function () {
                                        $(this).attr('disabled', true).text('保存中...');
                                    },
                                    complete: function () {
                                        $(this).attr('disabled', false).text('保存');
                                    },
                                    success: function (res) {
                                        console.log(res);
                                        if (res.status == 1) {
                                            $.confirm({
                                                title: '保存成功',
                                                level: 'success',
                                                buttons: {
                                                    "确定": {
                                                        class:"blue",
                                                        action:function() {
                                                            window.location.href = document.referrer;
                                                        }
                                                    }
                                                }
                                            })
										} else {
                                            $.confirm({
                                                title: res.msg,
                                                level: 'warning',
                                                buttons: {
                                                    "确定": {
                                                        class:"blue"
                                                    }
                                                }
                                            })
										}

                                    },
                                    error: function (e) {
                                       alert(e.statusText);
                                    }
                                })
                            })
                        })

                        //返回
                        $(".go-back").on('click',function () {
                            window.location.href = document.referrer;
                        })

					</script>

				</div>
			</div>
			<!-- END EXAMPLE TABLE PORTLET-->
		</div>
	</div>

	<!-- END PAGE CONTENT-->
</div>



<include file="Public/footer" />