
<include file="Public/head" />
<include file="Public/top" />
<div class="clearfix">
	<div class="page-container">
	<include file="Public/left" />
	
	    <div class="page-content-wrapper">
		<div class="page-content">
			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="portlet-config" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
							<h4 class="modal-title">Modal title</h4>
						</div>
						<div class="modal-body">
							 Widget settings form goes here
						</div>
						<div class="modal-footer">
							<button class="btn blue" type="button">Save changes</button>
							<button data-dismiss="modal" class="btn default" type="button">Close</button>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			<!-- /.modal -->
			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- BEGIN PAGE HEADER-->
			<!-- BEGIN PAGE HEAD -->
			<div class="page-head">
				<!-- BEGIN PAGE TITLE -->
				<!-- END PAGE TITLE -->
				<!-- BEGIN PAGE TOOLBAR -->
				<!--<div class="page-toolbar">
					 BEGIN THEME PANEL 
					<div class="btn-group btn-theme-panel">
						<a data-toggle="dropdown" class="btn dropdown-toggle" href="javascript:;">
						<i class="icon-settings"></i>
						</a>
						<div class="dropdown-menu theme-panel pull-right dropdown-custom hold-on-click">
							<div class="row">
								<div class="col-md-4 col-sm-4 col-xs-12">
									<h3>THEME</h3>
									<ul class="theme-colors">
										<li data-theme="default" class="theme-color theme-color-default active">
											<span class="theme-color-view"></span>
											<span class="theme-color-name">Dark Header</span>
										</li>
										<li data-theme="light" class="theme-color theme-color-light">
											<span class="theme-color-view"></span>
											<span class="theme-color-name">Light Header</span>
										</li>
									</ul>
								</div>
								<div class="col-md-8 col-sm-8 col-xs-12 seperator">
									<h3>LAYOUT</h3>
									<ul class="theme-settings">
										<li>
											 Theme Style
											<select class="layout-style-option form-control input-small input-sm">
												<option selected="selected" value="square">Square corners</option>
												<option value="rounded">Rounded corners</option>
											</select>
										</li>
										<li>
											 Layout
											<select class="layout-option form-control input-small input-sm">
												<option selected="selected" value="fluid">Fluid</option>
												<option value="boxed">Boxed</option>
											</select>
										</li>
										<li>
											 Header
											<select class="page-header-option form-control input-small input-sm">
												<option selected="selected" value="fixed">Fixed</option>
												<option value="default">Default</option>
											</select>
										</li>
										<li>
											 Top Dropdowns
											<select class="page-header-top-dropdown-style-option form-control input-small input-sm">
												<option value="light">Light</option>
												<option selected="selected" value="dark">Dark</option>
											</select>
										</li>
										<li>
											 Sidebar Mode
											<select class="sidebar-option form-control input-small input-sm">
												<option value="fixed">Fixed</option>
												<option selected="selected" value="default">Default</option>
											</select>
										</li>
										<li>
											 Sidebar Menu
											<select class="sidebar-menu-option form-control input-small input-sm">
												<option selected="selected" value="accordion">Accordion</option>
												<option value="hover">Hover</option>
											</select>
										</li>
										<li>
											 Sidebar Position
											<select class="sidebar-pos-option form-control input-small input-sm">
												<option selected="selected" value="left">Left</option>
												<option value="right">Right</option>
											</select>
										</li>
										<li>
											 Footer
											<select class="page-footer-option form-control input-small input-sm">
												<option value="fixed">Fixed</option>
												<option selected="selected" value="default">Default</option>
											</select>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
					 END THEME PANEL 
				</div> -->
				<!-- END PAGE TOOLBAR -->
			</div>
			<!-- END PAGE HEAD -->
			<!-- BEGIN PAGE BREADCRUMB -->
			<!-- <ul class="page-breadcrumb breadcrumb">
				<li>
					<a href="#">投票</a>
					<i class="fa fa-circle"></i>
				</li>
			</ul> -->
			<!-- END PAGE BREADCRUMB -->
			<!-- END PAGE HEADER-->
			<!-- BEGIN PAGE CONTENT-->
			<!-- 注释 查询开始  -->
            <!-- <div class="row">
            	<div class="col-md-12">
                <div class="portlet box">
                	<div class="portlet-body form">
							<form role="form" class="form-horizontal">

								<button style="float:right;margin-right:50px;margin-top:10px" class="btn green" type="submit">查询</button>
								<div  class="form-body">
									<div  class="form-group">
										<div style="float:right;margin-right:60px" class="col-md-2">
											<input type="text" placeholder="请输入关键词查询" class="form-control input-medium">
										</div>
									</div>
										
								</div>
							</form>
						</div>
                </div>
            </div> -->
           <!--  <ul class="page-breadcrumb breadcrumb">
				<li>
					<a href="index.html">首页</a>
					<i class="fa fa-circle"></i>
				</li>
				<li>
					<a href="{:U('Vote/index')}">微投票</a>
					<i class="fa fa-circle"></i>
				</li>
				<li>
					<a href="#">投票列表</a>
				</li>
			</ul> -->
            <!-- 注释 查询结束  -->
            <div class="row">
            	<div class="col-md-12">
                <div class="portlet box">
                	<!-- <div class="portlet-title">
                    </div> -->
                	<div class="portlet-body form">
							<form role="form" class="form-horizontal" method="POST" action="{:U('Vote/index')}">
								<div class="form-body">
									<div class="form-group">
										<label class="col-md-1 control-label">关键词：</label>
										<div class="col-md-2">
											<input type="text" placeholder="关键词" name="keyword" class="form-control input-small" value="{$keyword}">
										</div>
                                        <label class="col-md-1 control-label">类型：</label>
										<div class="col-md-2">
											<select class="form-control input-inline input-small" name="type">
												<option value=''>全部</option>
												<option value="1" <if condition="$type eq 1">selected</if>>文字投票</option>
												<option value="2" <if condition="$type eq 2">selected</if>>图片投票</option>
											</select>
										</div>
										
										<label class="col-md-2 control-label">选择类型：</label>
										<div class="col-md-2">
											<select class="form-control input-inline input-small" name="option_type">
												<option value=''>全部</option>
												<option value="1" <if condition="$option_type eq 1">selected</if>>单选</option>
												<option value="2" <if condition="$option_type eq 2">selected</if>>多选</option>
											</select>
										</div>
										
										<div class="col-md-2">
											<button class="btn blue" type="submit">查询</button>
										</div>
									</div>
								</div>
								<!-- <div class="form-actions">
									<div class="row">
										<div class="col-md-offset-5 col-md-7">
											<button class="btn green" type="submit">查询</button>
										</div>
									</div>
								</div> -->
							</form>
						</div>
                </div>
            </div>
			</div>
            <div class="row">
				<div class="col-md-12">
					<!-- BEGIN EXAMPLE TABLE PORTLET-->
					<div class="portlet box blue">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-edit"></i>投票列表
							</div>
							<!-- <div class="tools">
								
							</div> -->
						</div>
						<style>
							.table-bordered th{text-align:center}
						</style>
						<div class="portlet-body">
						
						    <button style="margin-bottom:5px;" class="btn blue"  type="button" onclick="addurl()">新建投票</button>
            			    <button style="margin-bottom:5px;" class="btn blue"  type="button" onclick="bothdelte()">批量删除</button>
							
							<table class="table table-striped table-hover table-bordered" id="sample_editable_1">
						
							<thead>
							<tr>
								<th><input type="checkbox" id="checkAll"></th>
								<!-- <th>投票ID</th> -->
								<th>关键词</th>
								<th>投票标题</th>
								<th>类型</th>
								<th>状态</th>
								<th>投票时间</th>
								<!-- <th>缩略图</th> -->
								<th>操作</th>
							</tr>
							</thead>
							<tbody>
							<foreach name="list" item="vo">
							<tr>
								<td><input type="checkbox" name="checkList" value="{$vo.id}"></td>
								<!-- <td>{$vo.id}</td> -->
								<td>{$vo.keyword}</td>
								<td>{$vo.title}</td>
								<td><if condition="$vo.type eq 1">文字投票<else/>图片投票</if></td>
								<td class="center"><if condition="$vo.optioned_type eq 1">单选<else/>多选</if></td>
								<td>{$vo.starttime|date='Y/m/d',###} - {$vo.endtime|date='Y/m/d',###}</td>
								<!-- <td><img src="theme/assets/admin/layout4/img/avatar9.jpg" /></td> -->
								<td>
									<!-- <button class="btn btn-default" type="button" >查看</button> -->
									<a onclick='javascript:location.href="{:U("Vote/chsetVote",array("voteid"=>$vo[id]))}"'><i title="查看" class="glyphicon glyphicon-eye-open"></i></a>
									<if condition="$vo.endtime egt time()">
	                                	<!-- <button class="btn btn-default" type="button" onclick="updateurl({$vo.id})">编辑</button> -->
	                                	<a  onclick="updateurl({$vo.id})"><i title="修改" class="glyphicon glyphicon-edit"></i></a>
	                                </if>
	                                <if condition="($vo.endtime gt time()) and ($vo.is_end neq 1)">
	                                	<!-- <button class="btn btn-default" type="button" onclick="endvote(this)" rel="{$vo.id}">结束</button> -->
	                                	<a onclick="endvote(this)" rel="{$vo.id}"><i class="glyphicon glyphicon-stop" title="结束"></i></a>
	                                </if>
	                                <!-- <button class="btn btn-default" type="button" onclick="copyvote(this)" rel="{$vo.id}">复制</button> -->
	                                <!-- <a onclick="copyvote(this)" rel="{$vo.id}"><i class="fa fa-copy" title="复制"></i></a> -->
	                                <!-- <button class="btn btn-default" type="button" onclick="deletevote(this)" rel="{$vo.id}">删除</button> -->
	                                <a onclick="deletevote(this)" rel="{$vo.id}"><i class="glyphicon glyphicon-trash delete" title="删除"></i></a>
								</td>
							</tr>
							</foreach>
							</tbody>
							</table>
							<div class="row">
							
								<div class="col-md-5 col-sm-12">
									<div class="dataTables_info" id="sample_editable_1_info" role="status" aria-live="polite">
									    当前是第 {$p} 页  总页数 {$totalpage}
									</div>
								</div>
								<div class="col-md-7 col-sm-12">
									<div class="dataTables_paginate paging_simple_numbers" id="sample_editable_1_paginate">
										 <!-- <ul class="pagination">
										    <li class="paginate_button previous disabled" aria-controls="sample_editable_1" tabindex="0" id="sample_editable_1_previous"><a href="#"><i class="fa fa-angle-left"></i></a></li>
										    <li class="paginate_button active" aria-controls="sample_editable_1" tabindex="0"><a href="#">1</a></li>
										    <li class="paginate_button " aria-controls="sample_editable_1" tabindex="0"><a href="#">2</a></li>
										    <li class="paginate_button " aria-controls="sample_editable_1" tabindex="0"><a href="#">3</a></li>
										    <li class="paginate_button next" aria-controls="sample_editable_1" tabindex="0" id="sample_editable_1_next"><a href="#"><i class="fa fa-angle-right"></i></a></li>
										  </ul> -->
										  {$page}
									 </div>
								</div>
							</div>
                            
                           
						</div>
					</div>
					<!-- END EXAMPLE TABLE PORTLET-->
				</div>
			</div>
            
			<!-- END PAGE CONTENT-->
		</div>
		</div>
		</div>
		</div>
		<script>
			function addurl(type){
				var str = "{:U('Vote/addVote')}";
				/*var url = str.replace(".html","")
				    url = url+"/type/"+type;*/
				    location.href=str;
			}
			function updateurl(voteid){
				var str = "{:U('Vote/editVote')}";
				var url = str.replace(".html","")
				    url = url+"/id/"+voteid;
				    location.href=url;
			}
			function deletevote(obj){
				var voteid = $(obj).attr('rel');
					$.confirm({  
					   title:"确定要删除这条投票？",
					   modal: true,  
					   level:"warning",
					   buttons: {  
						   "确定": {
							   "class":"green",
							   "action":function() {
								   $.ajax({
										url:"{:U('Vote/deleteVote')}",
										type:'post',
										data:{voteid:voteid},
										dataType:'json',
										success:function(msg){
											if(msg.status==1){
												$(obj).parent().parent().remove();
											}
										}
								});
							   }
						   },
						   "取消": {
							   "class":"green",
							   "action":function() {}
						   }
					   }  
					});
			}
			function copyvote(obj){
				var voteid = $(obj).attr('rel');
					$.ajax({
							url:"{:U('Vote/copyVote')}",
							type:'post',
							data:{voteid:voteid},
							dataType:'json',
							success:function(msg){
								if(msg.status==1){
									$.confirm({title:msg.info,modal: true, level:"success",buttons: {  
											   "确定": {
												   "class":"green",
												   "action":function() {
													   location.reload();
												   }
											   }
										   }  
										});
									
								}else{
									$.confirm({title:msg.info,modal: true, level:"danger",buttons: {  
										   "确定": {
											   "class":"green",
											   "action":function() {
											   }
										   }
									   }  
									});
								}
							}
					});
			}
			function endvote(obj){
				var voteid = $(obj).attr('rel');
				$.confirm({  
					   title:"确定要结束这条投票？",
					   modal: true,  
					   level:"warning",
					   buttons: {  
						   "确定": {
							   "class":"green",
							   "action":function() {
								   $.ajax({
										url:"{:U('Vote/endVote')}",
										type:'post',
										data:{voteid:voteid},
										dataType:'json',
										success:function(msg){
											if(msg.status == 1){
												$(obj).hide();
											}
										}
								});
							   }
						   },
						   "取消": {
							   "class":"green",
							   "action":function() {}
						   }
					   }  
					});
			}
			
			
			
			function bothdelte(){
				var idstr = getCheckBoxValue();
				if(idstr==''){
					$.confirm({title:"你还没有选择删除的调研，请选择后删除",modal: true,level:"warning",buttons: {  
						   "确定": {"class":"green","action":function() {}}
					   }  
					});
				}else{
					$.confirm({  
						   title:"确定要删除选中的投票？",
						   modal: true,  
						   level:"warning",
						   buttons: {  
							   "确定": {
								   "class":"green",
								   "action":function() {
									   $.ajax({
											url:"{:U('Vote/deleteVote')}",
											type:'post',
											data:{voteid:idstr},
											dataType:'json',
											success:function(msg){
												if(msg.status==1){
													location.reload();
												}
											}
									});
								   }
							   },
							   "取消": {
								   "class":"green",
								   "action":function() {}
							   }
						   }  
						});
				}
				
			}
			
			
			
			/* function serach(){
				var keyword = $("[name='keyword']").val();
				var type    = $("[name='type']").val();
				var optiontype=$("[name='option_type']").val();
				var str = "{:U('Vote/index')}";
				var url = str.replace(".html","");
				if(keyword!=''){
					url += "/keyword/"+keyword;
				}
				if(type!=''){
					url += "/type/"+type;
				}
				if(optiontype!=''){
					url += "/option_type/"+optiontype;
				}
				location.href=url;
				
			} */
		</script>

<include file="Public/footer" />